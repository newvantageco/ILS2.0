import{e as s,r as $}from"./vendor-react-yzYIzJFU.js";import{S as Be}from"./StatCard-BoM6JgQE.js";import{T as gt,a as ht,b as ve,c as X,d as Nt,e as J}from"./table-cFqY84xs.js";import{S as qn,a as On}from"./StatusBadge-CMD14DAe.js";import{c as Mn,f as Y,E as Fn,ac as Rn,ad as Kn,ae as zn,af as qe,X as $n,e as Le,Y as Ne,a2 as yt,a3 as Qn,a4 as bt,a5 as xt,a6 as Dt,a7 as vt,I as ee,a8 as It,a1 as ae,C as Oe,h as at,i as st,a as Me,u as Gn,G as Hn,ag as Zn,aa as Ge,B as Wn,p as Xn,q as Jn,r as He,t as Ze,P as Vt,n as Yn,T as ei,ah as ti,M as ni}from"./index-BiBisH8X.js";import{S as rt,a as ot,b as lt,c as dt,d as ie}from"./select-BquPdUcS.js";import{L as ge}from"./label-DDyL8AZL.js";import{T as ii}from"./textarea-DoojhZ6C.js";import{u as Pe,a as ye}from"./vendor-react-query-Dxpktacb.js";import{P as ct}from"./plus-CbARstPA.js";import{T as zt}from"./trash-2-CGREO2o6.js";import{A as ai,a as si,b as ri,c as oi,d as li,e as di,f as ci,g as ui}from"./alert-dialog-CIFGUIX_.js";import{B as mi,D as pi,E as _i,I as fi,N as gi,O as hi,P as Ni,Z as We,a as yi,b as bi,c as xi,d as Di,e as vi,f as Ii,g as Si,h as wi,i as Ti,j as Ct,k as Pi,l as Ai,m as Ei,n as ki,o as Li,p as Ui,q as Vi,r as Ci,s as ji,t as Bi,u as qi,v as Oi,w as Mi,x as Fi,y as Ri,z as Ki,A as zi,C as $i,F as Qi,G as Gi,H as Hi,J as Zi,K as Wi,L as Xi,M as Ji,Q as Yi,R as ea,S as ta,T as na,U as ia,V as aa,W as le,X as fe,Y as sa,_ as oe,$ as ra,a0 as $t,a1 as Ie,a2 as oa,a3 as la,a4 as da,a5 as jt,a6 as q,a7 as ca,a8 as ua,a9 as ma,aa as pa,ab as _a,ac as fa,ad as ga,ae as ha,af as Na,ag as ya,ah as ba,ai as xa,aj as Da,ak as va,al as Ia,am as Sa,an as wa,ao as Qt,ap as Ta,aq as k,ar as C,as as Pa,at as Aa,au as Ea,av as ka,aw as La,ax as Ua,ay as Va,az as Ca,aA as ja,aB as be,aC as Ba,aD as qa,aE as Oa,aF as c,aG as Ma,aH as Fa,aI as Ra,aJ as St,aK as Ka,aL as za,aM as $a,aN as Qa,aO as Ga,aP as ue,aQ as me,aR as Te,aS as pe,aT as _e,aU as Ha}from"./form-B-_eTKWs.js";import{S as Za}from"./square-pen-DDuzz0bT.js";import{S as Wa}from"./CardSkeleton-fD8CCydl.js";import{E as Xa}from"./EmptyState-ugLtOoCh.js";import{c as Ja,o as Ya}from"./optimisticUpdates-DCvK2NTo.js";import{W as es}from"./wifi-ClHTJIKn.js";import{W as ts}from"./wifi-off-Dn3GJiqs.js";import{C as ns}from"./clock-CfQc0zyb.js";import{P as is}from"./printer-BW5EvF8T.js";import{f as as}from"./format-B8W-xB4I.js";import"./vendor-mui-DFe-F-Gn.js";import"./vendor-radix-B6etWzp2.js";import"./skeleton-a1RpvyBN.js";import"./en-US-816ENOvV.js";const ss=Mn("EllipsisVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);function rs({orders:e,onViewDetails:n,onUpdateStatus:i,onShipOrder:l}){return s.jsxDEV("div",{className:"rounded-md border border-border bg-card",children:s.jsxDEV(gt,{children:[s.jsxDEV(ht,{children:s.jsxDEV(ve,{children:[s.jsxDEV(X,{className:"font-semibold",children:"Order ID"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/OrderTable.tsx",lineNumber:41,columnNumber:13},this),s.jsxDEV(X,{className:"font-semibold",children:"Patient"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/OrderTable.tsx",lineNumber:42,columnNumber:13},this),s.jsxDEV(X,{className:"font-semibold",children:"ECP"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/OrderTable.tsx",lineNumber:43,columnNumber:13},this),s.jsxDEV(X,{className:"font-semibold",children:"Lens Type"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/OrderTable.tsx",lineNumber:44,columnNumber:13},this),s.jsxDEV(X,{className:"font-semibold",children:"Order Date"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/OrderTable.tsx",lineNumber:45,columnNumber:13},this),s.jsxDEV(X,{className:"font-semibold",children:"Status"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/OrderTable.tsx",lineNumber:46,columnNumber:13},this),s.jsxDEV(X,{className:"font-semibold text-right",children:"Actions"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/OrderTable.tsx",lineNumber:47,columnNumber:13},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/OrderTable.tsx",lineNumber:40,columnNumber:11},this)},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/OrderTable.tsx",lineNumber:39,columnNumber:9},this),s.jsxDEV(Nt,{children:e.map(u=>s.jsxDEV(ve,{className:"hover-elevate","data-testid":`row-order-${u.id}`,children:[s.jsxDEV(J,{className:"font-mono text-sm font-medium",children:u.id},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/OrderTable.tsx",lineNumber:57,columnNumber:15},this),s.jsxDEV(J,{children:u.patientName},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/OrderTable.tsx",lineNumber:60,columnNumber:15},this),s.jsxDEV(J,{className:"text-muted-foreground",children:u.ecp},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/OrderTable.tsx",lineNumber:61,columnNumber:15},this),s.jsxDEV(J,{children:u.lensType},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/OrderTable.tsx",lineNumber:62,columnNumber:15},this),s.jsxDEV(J,{className:"text-muted-foreground",children:u.orderDate},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/OrderTable.tsx",lineNumber:63,columnNumber:15},this),s.jsxDEV(J,{children:s.jsxDEV(qn,{status:u.status},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/OrderTable.tsx",lineNumber:65,columnNumber:17},this)},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/OrderTable.tsx",lineNumber:64,columnNumber:15},this),s.jsxDEV(J,{className:"text-right",children:s.jsxDEV("div",{className:"flex items-center justify-end gap-2",children:[s.jsxDEV(Y,{variant:"ghost",size:"sm",onClick:()=>n?.(u.id),"data-testid":`button-view-${u.id}`,children:[s.jsxDEV(Fn,{className:"h-4 w-4 mr-2"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/OrderTable.tsx",lineNumber:75,columnNumber:21},this),"View"]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/OrderTable.tsx",lineNumber:69,columnNumber:19},this),s.jsxDEV(Rn,{children:[s.jsxDEV(Kn,{asChild:!0,children:s.jsxDEV(Y,{variant:"ghost",size:"icon","data-testid":`button-menu-${u.id}`,children:s.jsxDEV(ss,{className:"h-4 w-4"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/OrderTable.tsx",lineNumber:85,columnNumber:25},this)},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/OrderTable.tsx",lineNumber:80,columnNumber:23},this)},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/OrderTable.tsx",lineNumber:79,columnNumber:21},this),s.jsxDEV(zn,{align:"end",children:[s.jsxDEV(qe,{onClick:()=>i?.(u.id,"in_production"),children:"Start Production"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/OrderTable.tsx",lineNumber:89,columnNumber:23},this),s.jsxDEV(qe,{onClick:()=>i?.(u.id,"quality_check"),children:"Move to QC"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/OrderTable.tsx",lineNumber:92,columnNumber:23},this),s.jsxDEV(qe,{onClick:()=>l?.(u.id),children:"Mark as Shipped"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/OrderTable.tsx",lineNumber:95,columnNumber:23},this),s.jsxDEV(qe,{onClick:()=>i?.(u.id,"on_hold"),children:"Put on Hold"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/OrderTable.tsx",lineNumber:98,columnNumber:23},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/OrderTable.tsx",lineNumber:88,columnNumber:21},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/OrderTable.tsx",lineNumber:78,columnNumber:19},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/OrderTable.tsx",lineNumber:68,columnNumber:17},this)},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/OrderTable.tsx",lineNumber:67,columnNumber:15},this)]},u.id,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/OrderTable.tsx",lineNumber:52,columnNumber:13},this))},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/OrderTable.tsx",lineNumber:50,columnNumber:9},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/OrderTable.tsx",lineNumber:38,columnNumber:7},this)},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/OrderTable.tsx",lineNumber:37,columnNumber:5},this)}function os({statusFilter:e,onStatusChange:n,ecpFilter:i,onEcpChange:l,onClearFilters:u}){const h=e||i;return s.jsxDEV("div",{className:"flex flex-wrap items-center gap-4",children:[s.jsxDEV(rt,{value:e,onValueChange:n,children:[s.jsxDEV(ot,{className:"w-48","data-testid":"select-status-filter",children:s.jsxDEV(lt,{placeholder:"Filter by Status"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/FilterBar.tsx",lineNumber:32,columnNumber:11},this)},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/FilterBar.tsx",lineNumber:31,columnNumber:9},this),s.jsxDEV(dt,{children:[s.jsxDEV(ie,{value:"all",children:"All Statuses"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/FilterBar.tsx",lineNumber:35,columnNumber:11},this),s.jsxDEV(ie,{value:"pending",children:"Pending"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/FilterBar.tsx",lineNumber:36,columnNumber:11},this),s.jsxDEV(ie,{value:"in_production",children:"In Production"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/FilterBar.tsx",lineNumber:37,columnNumber:11},this),s.jsxDEV(ie,{value:"quality_check",children:"Quality Check"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/FilterBar.tsx",lineNumber:38,columnNumber:11},this),s.jsxDEV(ie,{value:"shipped",children:"Shipped"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/FilterBar.tsx",lineNumber:39,columnNumber:11},this),s.jsxDEV(ie,{value:"completed",children:"Completed"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/FilterBar.tsx",lineNumber:40,columnNumber:11},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/FilterBar.tsx",lineNumber:34,columnNumber:9},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/FilterBar.tsx",lineNumber:30,columnNumber:7},this),s.jsxDEV(rt,{value:i,onValueChange:l,children:[s.jsxDEV(ot,{className:"w-48","data-testid":"select-ecp-filter",children:s.jsxDEV(lt,{placeholder:"Filter by ECP"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/FilterBar.tsx",lineNumber:46,columnNumber:11},this)},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/FilterBar.tsx",lineNumber:45,columnNumber:9},this),s.jsxDEV(dt,{children:[s.jsxDEV(ie,{value:"all",children:"All ECPs"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/FilterBar.tsx",lineNumber:49,columnNumber:11},this),s.jsxDEV(ie,{value:"vision-care",children:"Vision Care Center"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/FilterBar.tsx",lineNumber:50,columnNumber:11},this),s.jsxDEV(ie,{value:"eye-health",children:"Eye Health Associates"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/FilterBar.tsx",lineNumber:51,columnNumber:11},this),s.jsxDEV(ie,{value:"clarity",children:"Clarity Optical"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/FilterBar.tsx",lineNumber:52,columnNumber:11},this),s.jsxDEV(ie,{value:"perfect-vision",children:"Perfect Vision Clinic"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/FilterBar.tsx",lineNumber:53,columnNumber:11},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/FilterBar.tsx",lineNumber:48,columnNumber:9},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/FilterBar.tsx",lineNumber:44,columnNumber:7},this),h&&s.jsxDEV(Y,{variant:"ghost",size:"sm",onClick:u,"data-testid":"button-clear-filters",children:[s.jsxDEV($n,{className:"h-4 w-4 mr-2"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/FilterBar.tsx",lineNumber:64,columnNumber:11},this),"Clear Filters"]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/FilterBar.tsx",lineNumber:58,columnNumber:9},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/FilterBar.tsx",lineNumber:29,columnNumber:5},this)}function Xe(){const[e,n]=$.useState(!1),[i,l]=$.useState(""),[u,h]=$.useState(""),[D,A]=$.useState([{id:"1",materialSKU:"",description:"",quantity:1,unitPrice:""}]),{toast:w}=Le(),{data:v}=Pe({queryKey:["/api/suppliers"],enabled:e}),y=ye({mutationFn:async U=>await(await Ne("POST","/api/purchase-orders",U)).json(),onSuccess:()=>{w({title:"Purchase order created",description:"The purchase order has been sent to the supplier."}),n(!1),T()},onError:U=>{w({title:"Error creating purchase order",description:U.message,variant:"destructive"})}}),T=()=>{l(""),h(""),A([{id:"1",materialSKU:"",description:"",quantity:1,unitPrice:""}])},B=()=>{A([...D,{id:Date.now().toString(),materialSKU:"",description:"",quantity:1,unitPrice:""}])},se=U=>{D.length>1&&A(D.filter(z=>z.id!==U))},he=(U,z,Z)=>{A(D.map(W=>W.id===U?{...W,[z]:Z}:W))},H=()=>D.reduce((U,z)=>{const Z=parseFloat(z.unitPrice)||0;return U+Z*z.quantity},0),j=U=>{if(U.preventDefault(),!i){w({title:"Supplier required",description:"Please select a supplier.",variant:"destructive"});return}if(D.some(W=>!W.materialSKU||!W.description||!W.unitPrice)){w({title:"Incomplete line items",description:"Please fill in all fields for each line item.",variant:"destructive"});return}const Z=H();y.mutate({supplierId:i,notes:u||null,totalAmount:Z.toFixed(2),lineItems:D.map(W=>({itemName:W.materialSKU,description:W.description,quantity:W.quantity,unitPrice:W.unitPrice,totalPrice:(W.quantity*parseFloat(W.unitPrice||"0")).toFixed(2)}))})};return s.jsxDEV(yt,{open:e,onOpenChange:n,children:[s.jsxDEV(Qn,{asChild:!0,children:s.jsxDEV(Y,{"data-testid":"button-create-po",children:[s.jsxDEV(ct,{className:"h-4 w-4 mr-2"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/CreatePurchaseOrderDialog.tsx",lineNumber:175,columnNumber:11},this),"Create Purchase Order"]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/CreatePurchaseOrderDialog.tsx",lineNumber:174,columnNumber:9},this)},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/CreatePurchaseOrderDialog.tsx",lineNumber:173,columnNumber:7},this),s.jsxDEV(bt,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:s.jsxDEV("form",{onSubmit:j,children:[s.jsxDEV(xt,{children:[s.jsxDEV(Dt,{children:"Create Purchase Order"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/CreatePurchaseOrderDialog.tsx",lineNumber:182,columnNumber:13},this),s.jsxDEV(vt,{children:"Create a new purchase order to request materials from a supplier."},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/CreatePurchaseOrderDialog.tsx",lineNumber:183,columnNumber:13},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/CreatePurchaseOrderDialog.tsx",lineNumber:181,columnNumber:11},this),s.jsxDEV("div",{className:"space-y-6 py-4",children:[s.jsxDEV("div",{className:"space-y-2",children:[s.jsxDEV(ge,{htmlFor:"supplier",children:"Supplier"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/CreatePurchaseOrderDialog.tsx",lineNumber:189,columnNumber:15},this),s.jsxDEV(rt,{value:i,onValueChange:l,children:[s.jsxDEV(ot,{id:"supplier","data-testid":"select-supplier",children:s.jsxDEV(lt,{placeholder:"Select supplier"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/CreatePurchaseOrderDialog.tsx",lineNumber:192,columnNumber:19},this)},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/CreatePurchaseOrderDialog.tsx",lineNumber:191,columnNumber:17},this),s.jsxDEV(dt,{children:v?.map(U=>s.jsxDEV(ie,{value:U.id,children:U.organizationName||`${U.firstName} ${U.lastName}`},U.id,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/CreatePurchaseOrderDialog.tsx",lineNumber:196,columnNumber:21},this))},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/CreatePurchaseOrderDialog.tsx",lineNumber:194,columnNumber:17},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/CreatePurchaseOrderDialog.tsx",lineNumber:190,columnNumber:15},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/CreatePurchaseOrderDialog.tsx",lineNumber:188,columnNumber:13},this),s.jsxDEV("div",{className:"space-y-2",children:[s.jsxDEV(ge,{children:"Line Items"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/CreatePurchaseOrderDialog.tsx",lineNumber:205,columnNumber:15},this),s.jsxDEV("div",{className:"space-y-3",children:D.map((U,z)=>s.jsxDEV("div",{className:"border border-border rounded-md p-4 space-y-3","data-testid":`line-item-${z}`,children:[s.jsxDEV("div",{className:"flex items-center justify-between",children:[s.jsxDEV("span",{className:"text-sm font-medium",children:["Item ",z+1]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/CreatePurchaseOrderDialog.tsx",lineNumber:214,columnNumber:23},this),D.length>1&&s.jsxDEV(Y,{type:"button",variant:"outline",size:"sm",onClick:()=>se(U.id),"data-testid":`button-remove-item-${z}`,children:s.jsxDEV(zt,{className:"h-4 w-4"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/CreatePurchaseOrderDialog.tsx",lineNumber:223,columnNumber:27},this)},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/CreatePurchaseOrderDialog.tsx",lineNumber:216,columnNumber:25},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/CreatePurchaseOrderDialog.tsx",lineNumber:213,columnNumber:21},this),s.jsxDEV("div",{className:"grid grid-cols-2 gap-3",children:[s.jsxDEV("div",{className:"space-y-2",children:[s.jsxDEV(ge,{children:"Material SKU"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/CreatePurchaseOrderDialog.tsx",lineNumber:229,columnNumber:25},this),s.jsxDEV(ee,{value:U.materialSKU,onChange:Z=>he(U.id,"materialSKU",Z.target.value),placeholder:"e.g., PC-159-CR","data-testid":`input-sku-${z}`},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/CreatePurchaseOrderDialog.tsx",lineNumber:230,columnNumber:25},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/CreatePurchaseOrderDialog.tsx",lineNumber:228,columnNumber:23},this),s.jsxDEV("div",{className:"space-y-2",children:[s.jsxDEV(ge,{children:"Description"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/CreatePurchaseOrderDialog.tsx",lineNumber:238,columnNumber:25},this),s.jsxDEV(ee,{value:U.description,onChange:Z=>he(U.id,"description",Z.target.value),placeholder:"e.g., Polycarbonate 1.59 w/ CR coating","data-testid":`input-description-${z}`},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/CreatePurchaseOrderDialog.tsx",lineNumber:239,columnNumber:25},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/CreatePurchaseOrderDialog.tsx",lineNumber:237,columnNumber:23},this),s.jsxDEV("div",{className:"space-y-2",children:[s.jsxDEV(ge,{children:"Quantity"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/CreatePurchaseOrderDialog.tsx",lineNumber:247,columnNumber:25},this),s.jsxDEV(ee,{type:"number",min:"1",value:U.quantity,onChange:Z=>he(U.id,"quantity",parseInt(Z.target.value)||1),"data-testid":`input-quantity-${z}`},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/CreatePurchaseOrderDialog.tsx",lineNumber:248,columnNumber:25},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/CreatePurchaseOrderDialog.tsx",lineNumber:246,columnNumber:23},this),s.jsxDEV("div",{className:"space-y-2",children:[s.jsxDEV(ge,{children:"Unit Price ($)"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/CreatePurchaseOrderDialog.tsx",lineNumber:259,columnNumber:25},this),s.jsxDEV(ee,{type:"number",step:"0.01",min:"0",value:U.unitPrice,onChange:Z=>he(U.id,"unitPrice",Z.target.value),placeholder:"0.00","data-testid":`input-price-${z}`},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/CreatePurchaseOrderDialog.tsx",lineNumber:260,columnNumber:25},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/CreatePurchaseOrderDialog.tsx",lineNumber:258,columnNumber:23},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/CreatePurchaseOrderDialog.tsx",lineNumber:227,columnNumber:21},this)]},U.id,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/CreatePurchaseOrderDialog.tsx",lineNumber:208,columnNumber:19},this))},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/CreatePurchaseOrderDialog.tsx",lineNumber:206,columnNumber:15},this),s.jsxDEV(Y,{type:"button",variant:"outline",onClick:B,"data-testid":"button-add-item",children:[s.jsxDEV(ct,{className:"h-4 w-4 mr-2"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/CreatePurchaseOrderDialog.tsx",lineNumber:275,columnNumber:17},this),"Add Line Item"]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/CreatePurchaseOrderDialog.tsx",lineNumber:274,columnNumber:15},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/CreatePurchaseOrderDialog.tsx",lineNumber:204,columnNumber:13},this),s.jsxDEV("div",{className:"space-y-2",children:[s.jsxDEV(ge,{htmlFor:"notes",children:"Notes (Optional)"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/CreatePurchaseOrderDialog.tsx",lineNumber:281,columnNumber:15},this),s.jsxDEV(ii,{id:"notes",value:u,onChange:U=>h(U.target.value),placeholder:"Additional notes or special instructions","data-testid":"input-notes"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/CreatePurchaseOrderDialog.tsx",lineNumber:282,columnNumber:15},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/CreatePurchaseOrderDialog.tsx",lineNumber:280,columnNumber:13},this),s.jsxDEV("div",{className:"flex justify-between items-center pt-4 border-t",children:[s.jsxDEV("span",{className:"text-lg font-semibold",children:"Total Amount:"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/CreatePurchaseOrderDialog.tsx",lineNumber:292,columnNumber:15},this),s.jsxDEV("span",{className:"text-2xl font-semibold","data-testid":"text-total-amount",children:["$",H().toFixed(2)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/CreatePurchaseOrderDialog.tsx",lineNumber:293,columnNumber:15},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/CreatePurchaseOrderDialog.tsx",lineNumber:291,columnNumber:13},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/CreatePurchaseOrderDialog.tsx",lineNumber:187,columnNumber:11},this),s.jsxDEV(It,{children:[s.jsxDEV(Y,{type:"button",variant:"outline",onClick:()=>n(!1),"data-testid":"button-cancel-po",children:"Cancel"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/CreatePurchaseOrderDialog.tsx",lineNumber:299,columnNumber:13},this),s.jsxDEV(Y,{type:"submit",disabled:y.isPending,"data-testid":"button-submit-po",children:y.isPending?"Creating...":"Create Purchase Order"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/CreatePurchaseOrderDialog.tsx",lineNumber:307,columnNumber:13},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/CreatePurchaseOrderDialog.tsx",lineNumber:298,columnNumber:11},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/CreatePurchaseOrderDialog.tsx",lineNumber:180,columnNumber:9},this)},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/CreatePurchaseOrderDialog.tsx",lineNumber:179,columnNumber:7},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/CreatePurchaseOrderDialog.tsx",lineNumber:172,columnNumber:5},this)}function ls({orderId:e,open:n,onOpenChange:i}){const[l,u]=$.useState(""),{toast:h}=Le();$.useEffect(()=>{n&&u("")},[n]);const D=ye({mutationFn:async w=>await(await Ne("PATCH",`/api/orders/${e}/ship`,w)).json(),onSuccess:()=>{ae.invalidateQueries({queryKey:["/api/orders"]}),ae.invalidateQueries({queryKey:["/api/stats"]}),h({title:"Order shipped",description:"Order has been marked as shipped and customer notified."}),u(""),i(!1)},onError:w=>{h({title:"Error shipping order",description:w.message,variant:"destructive"})}}),A=w=>{if(w.preventDefault(),!l.trim()){h({title:"Tracking number required",description:"Please enter a tracking number",variant:"destructive"});return}D.mutate({trackingNumber:l.trim()})};return s.jsxDEV(yt,{open:n,onOpenChange:i,children:s.jsxDEV(bt,{children:s.jsxDEV("form",{onSubmit:A,children:[s.jsxDEV(xt,{children:[s.jsxDEV(Dt,{children:"Mark Order as Shipped"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/ShipOrderDialog.tsx",lineNumber:76,columnNumber:13},this),s.jsxDEV(vt,{children:"Enter the tracking number to mark this order as shipped. The customer will be notified via email."},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/ShipOrderDialog.tsx",lineNumber:77,columnNumber:13},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/ShipOrderDialog.tsx",lineNumber:75,columnNumber:11},this),s.jsxDEV("div",{className:"space-y-4 py-4",children:s.jsxDEV("div",{className:"space-y-2",children:[s.jsxDEV(ge,{htmlFor:"tracking",children:"Tracking Number"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/ShipOrderDialog.tsx",lineNumber:83,columnNumber:15},this),s.jsxDEV(ee,{id:"tracking",value:l,onChange:w=>u(w.target.value),placeholder:"Enter tracking number","data-testid":"input-tracking-number"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/ShipOrderDialog.tsx",lineNumber:84,columnNumber:15},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/ShipOrderDialog.tsx",lineNumber:82,columnNumber:13},this)},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/ShipOrderDialog.tsx",lineNumber:81,columnNumber:11},this),s.jsxDEV(It,{children:[s.jsxDEV(Y,{type:"button",variant:"outline",onClick:()=>i(!1),"data-testid":"button-cancel-ship",children:"Cancel"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/ShipOrderDialog.tsx",lineNumber:94,columnNumber:13},this),s.jsxDEV(Y,{type:"submit",disabled:D.isPending,"data-testid":"button-ship-order",children:D.isPending?"Shipping...":"Ship Order"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/ShipOrderDialog.tsx",lineNumber:102,columnNumber:13},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/ShipOrderDialog.tsx",lineNumber:93,columnNumber:11},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/ShipOrderDialog.tsx",lineNumber:74,columnNumber:9},this)},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/ShipOrderDialog.tsx",lineNumber:73,columnNumber:7},this)},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/ShipOrderDialog.tsx",lineNumber:72,columnNumber:5},this)}const _=Symbol.for("drizzle:entityKind");function R(e,n){if(!e||typeof e!="object")return!1;if(e instanceof n)return!0;if(!Object.prototype.hasOwnProperty.call(n,_))throw new Error(`Class "${n.name??"<unknown>"}" doesn't look like a Drizzle entity. If this is incorrect and the class is provided by Drizzle, please report this as a bug.`);let i=Object.getPrototypeOf(e).constructor;if(i)for(;i;){if(_ in i&&i[_]===n[_])return!0;i=Object.getPrototypeOf(i)}return!1}class Ae{constructor(n,i){this.table=n,this.config=i,this.name=i.name,this.keyAsName=i.keyAsName,this.notNull=i.notNull,this.default=i.default,this.defaultFn=i.defaultFn,this.onUpdateFn=i.onUpdateFn,this.hasDefault=i.hasDefault,this.primary=i.primaryKey,this.isUnique=i.isUnique,this.uniqueName=i.uniqueName,this.uniqueType=i.uniqueType,this.dataType=i.dataType,this.columnType=i.columnType,this.generated=i.generated,this.generatedIdentity=i.generatedIdentity}static[_]="Column";name;keyAsName;primary;notNull;default;defaultFn;onUpdateFn;hasDefault;isUnique;uniqueName;uniqueType;dataType;columnType;enumValues=void 0;generated=void 0;generatedIdentity=void 0;config;mapFromDriverValue(n){return n}mapToDriverValue(n){return n}shouldDisableInsert(){return this.config.generated!==void 0&&this.config.generated.type!=="byDefault"}}class ds{static[_]="ColumnBuilder";config;constructor(n,i,l){this.config={name:n,keyAsName:n==="",notNull:!1,default:void 0,hasDefault:!1,primaryKey:!1,isUnique:!1,uniqueName:void 0,uniqueType:void 0,dataType:i,columnType:l,generated:void 0}}$type(){return this}notNull(){return this.config.notNull=!0,this}default(n){return this.config.default=n,this.config.hasDefault=!0,this}$defaultFn(n){return this.config.defaultFn=n,this.config.hasDefault=!0,this}$default=this.$defaultFn;$onUpdateFn(n){return this.config.onUpdateFn=n,this.config.hasDefault=!0,this}$onUpdate=this.$onUpdateFn;primaryKey(){return this.config.primaryKey=!0,this.config.notNull=!0,this}setName(n){this.config.name===""&&(this.config.name=n)}}const xe=Symbol.for("drizzle:Name");class cs{static[_]="PgForeignKeyBuilder";reference;_onUpdate="no action";_onDelete="no action";constructor(n,i){this.reference=()=>{const{name:l,columns:u,foreignColumns:h}=n();return{name:l,columns:u,foreignTable:h[0].table,foreignColumns:h}},i&&(this._onUpdate=i.onUpdate,this._onDelete=i.onDelete)}onUpdate(n){return this._onUpdate=n===void 0?"no action":n,this}onDelete(n){return this._onDelete=n===void 0?"no action":n,this}build(n){return new us(n,this)}}class us{constructor(n,i){this.table=n,this.reference=i.reference,this.onUpdate=i._onUpdate,this.onDelete=i._onDelete}static[_]="PgForeignKey";reference;onUpdate;onDelete;getName(){const{name:n,columns:i,foreignColumns:l}=this.reference(),u=i.map(A=>A.name),h=l.map(A=>A.name),D=[this.table[xe],...u,l[0].table[xe],...h];return n??`${D.join("_")}_fk`}}function ms(e,...n){return e(...n)}function ps(e,n){return`${e[xe]}_${n.join("_")}_unique`}function Bt(e,n,i){for(let l=n;l<e.length;l++){const u=e[l];if(u==="\\"){l++;continue}if(u==='"')return[e.slice(n,l).replace(/\\/g,""),l+1];if(!i&&(u===","||u==="}"))return[e.slice(n,l).replace(/\\/g,""),l]}return[e.slice(n).replace(/\\/g,""),e.length]}function Gt(e,n=0){const i=[];let l=n,u=!1;for(;l<e.length;){const h=e[l];if(h===","){(u||l===n)&&i.push(""),u=!0,l++;continue}if(u=!1,h==="\\"){l+=2;continue}if(h==='"'){const[w,v]=Bt(e,l+1,!0);i.push(w),l=v;continue}if(h==="}")return[i,l+1];if(h==="{"){const[w,v]=Gt(e,l+1);i.push(w),l=v;continue}const[D,A]=Bt(e,l,!1);i.push(D),l=A}return[i,l]}function _s(e){const[n]=Gt(e,1);return n}function Ht(e){return`{${e.map(n=>Array.isArray(n)?Ht(n):typeof n=="string"?`"${n.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`:`${n}`).join(",")}}`}class L extends ds{foreignKeyConfigs=[];static[_]="PgColumnBuilder";array(n){return new gs(this.config.name,this,n)}references(n,i={}){return this.foreignKeyConfigs.push({ref:n,actions:i}),this}unique(n,i){return this.config.isUnique=!0,this.config.uniqueName=n,this.config.uniqueType=i?.nulls,this}generatedAlwaysAs(n){return this.config.generated={as:n,type:"always",mode:"stored"},this}buildForeignKeys(n,i){return this.foreignKeyConfigs.map(({ref:l,actions:u})=>ms((h,D)=>{const A=new cs(()=>{const w=h();return{columns:[n],foreignColumns:[w]}});return D.onUpdate&&A.onUpdate(D.onUpdate),D.onDelete&&A.onDelete(D.onDelete),A.build(i)},l,u))}buildExtraConfigColumn(n){return new fs(n,this.config)}}class E extends Ae{constructor(n,i){i.uniqueName||(i.uniqueName=ps(n,[i.name])),super(n,i),this.table=n}static[_]="PgColumn"}class fs extends E{static[_]="ExtraConfigColumn";getSQLType(){return this.getSQLType()}indexConfig={order:this.config.order??"asc",nulls:this.config.nulls??"last",opClass:this.config.opClass};defaultConfig={order:"asc",nulls:"last",opClass:void 0};asc(){return this.indexConfig.order="asc",this}desc(){return this.indexConfig.order="desc",this}nullsFirst(){return this.indexConfig.nulls="first",this}nullsLast(){return this.indexConfig.nulls="last",this}op(n){return this.indexConfig.opClass=n,this}}class Je{static[_]="IndexedColumn";constructor(n,i,l,u){this.name=n,this.keyAsName=i,this.type=l,this.indexConfig=u}name;keyAsName;type;indexConfig}class gs extends L{static[_]="PgArrayBuilder";constructor(n,i,l){super(n,"array","PgArray"),this.config.baseBuilder=i,this.config.size=l}build(n){const i=this.config.baseBuilder.build(n);return new wt(n,this.config,i)}}class wt extends E{constructor(n,i,l,u){super(n,i),this.baseColumn=l,this.range=u,this.size=i.size}size;static[_]="PgArray";getSQLType(){return`${this.baseColumn.getSQLType()}[${typeof this.size=="number"?this.size:""}]`}mapFromDriverValue(n){return typeof n=="string"&&(n=_s(n)),n.map(i=>this.baseColumn.mapFromDriverValue(i))}mapToDriverValue(n,i=!1){const l=n.map(u=>u===null?null:R(this.baseColumn,wt)?this.baseColumn.mapToDriverValue(u,!0):this.baseColumn.mapToDriverValue(u));return i?l:Ht(l)}}class hs extends L{static[_]="PgEnumObjectColumnBuilder";constructor(n,i){super(n,"string","PgEnumObjectColumn"),this.config.enum=i}build(n){return new Ns(n,this.config)}}class Ns extends E{static[_]="PgEnumObjectColumn";enum;enumValues=this.config.enum.enumValues;constructor(n,i){super(n,i),this.enum=i.enum}getSQLType(){return this.enum.enumName}}const Fe=Symbol.for("drizzle:isPgEnum");function ys(e){return!!e&&typeof e=="function"&&Fe in e&&e[Fe]===!0}class bs extends L{static[_]="PgEnumColumnBuilder";constructor(n,i){super(n,"string","PgEnumColumn"),this.config.enum=i}build(n){return new xs(n,this.config)}}class xs extends E{static[_]="PgEnumColumn";enum=this.config.enum;enumValues=this.config.enum.enumValues;constructor(n,i){super(n,i),this.enum=i.enum}getSQLType(){return this.enum.enumName}}function S(e,n){return Array.isArray(n)?Ds(e,[...n],void 0):vs(e,n,void 0)}function Ds(e,n,i){const l=Object.assign(u=>new bs(u??"",l),{enumName:e,enumValues:n,schema:i,[Fe]:!0});return l}function vs(e,n,i){const l=Object.assign(u=>new hs(u??"",l),{enumName:e,enumValues:Object.values(n),schema:i,[Fe]:!0});return l}class Zt{static[_]="Subquery";constructor(n,i,l,u=!1,h=[]){this._={brand:"Subquery",sql:n,selectedFields:i,alias:l,isWith:u,usedTables:h}}}const Is={startActiveSpan(e,n){return n()}},De=Symbol.for("drizzle:ViewBaseConfig"),Ye=Symbol.for("drizzle:Schema"),qt=Symbol.for("drizzle:Columns"),Ot=Symbol.for("drizzle:ExtraConfigColumns"),et=Symbol.for("drizzle:OriginalName"),tt=Symbol.for("drizzle:BaseName"),Re=Symbol.for("drizzle:IsAlias"),Mt=Symbol.for("drizzle:ExtraConfigBuilder"),Wt=Symbol.for("drizzle:IsDrizzleTable");class Q{static[_]="Table";static Symbol={Name:xe,Schema:Ye,OriginalName:et,Columns:qt,ExtraConfigColumns:Ot,BaseName:tt,IsAlias:Re,ExtraConfigBuilder:Mt};[xe];[et];[Ye];[qt];[Ot];[tt];[Re]=!1;[Wt]=!0;[Mt]=void 0;constructor(n,i,l){this[xe]=this[et]=n,this[Ye]=i,this[tt]=l}}function Xt(e){return typeof e=="object"&&e!==null&&Wt in e}function Ss(e){return e!=null&&typeof e.getSQL=="function"}function ws(e){const n={sql:"",params:[]};for(const i of e)n.sql+=i.sql,n.params.push(...i.params),i.typings?.length&&(n.typings||(n.typings=[]),n.typings.push(...i.typings));return n}class re{static[_]="StringChunk";value;constructor(n){this.value=Array.isArray(n)?n:[n]}getSQL(){return new O([this])}}class O{constructor(n){this.queryChunks=n;for(const i of n)if(R(i,Q)){const l=i[Q.Symbol.Schema];this.usedTables.push(l===void 0?i[Q.Symbol.Name]:l+"."+i[Q.Symbol.Name])}}static[_]="SQL";decoder=Jt;shouldInlineParams=!1;usedTables=[];append(n){return this.queryChunks.push(...n.queryChunks),this}toQuery(n){return Is.startActiveSpan("drizzle.buildSQL",i=>{const l=this.buildQueryFromSourceParams(this.queryChunks,n);return i?.setAttributes({"drizzle.query.text":l.sql,"drizzle.query.params":JSON.stringify(l.params)}),l})}buildQueryFromSourceParams(n,i){const l=Object.assign({},i,{inlineParams:i.inlineParams||this.shouldInlineParams,paramStartIndex:i.paramStartIndex||{value:0}}),{casing:u,escapeName:h,escapeParam:D,prepareTyping:A,inlineParams:w,paramStartIndex:v}=l;return ws(n.map(y=>{if(R(y,re))return{sql:y.value.join(""),params:[]};if(R(y,ut))return{sql:h(y.value),params:[]};if(y===void 0)return{sql:"",params:[]};if(Array.isArray(y)){const T=[new re("(")];for(const[B,se]of y.entries())T.push(se),B<y.length-1&&T.push(new re(", "));return T.push(new re(")")),this.buildQueryFromSourceParams(T,l)}if(R(y,O))return this.buildQueryFromSourceParams(y.queryChunks,{...l,inlineParams:w||y.shouldInlineParams});if(R(y,Q)){const T=y[Q.Symbol.Schema],B=y[Q.Symbol.Name];return{sql:T===void 0||y[Re]?h(B):h(T)+"."+h(B),params:[]}}if(R(y,Ae)){const T=u.getColumnCasing(y);if(i.invokeSource==="indexes")return{sql:h(T),params:[]};const B=y.table[Q.Symbol.Schema];return{sql:y.table[Re]||B===void 0?h(y.table[Q.Symbol.Name])+"."+h(T):h(B)+"."+h(y.table[Q.Symbol.Name])+"."+h(T),params:[]}}if(R(y,Ts)){const T=y[De].schema,B=y[De].name;return{sql:T===void 0||y[De].isAlias?h(B):h(T)+"."+h(B),params:[]}}if(R(y,en)){if(R(y.value,mt))return{sql:D(v.value++,y),params:[y],typings:["none"]};const T=y.value===null?null:y.encoder.mapToDriverValue(y.value);if(R(T,O))return this.buildQueryFromSourceParams([T],l);if(w)return{sql:this.mapInlineParam(T,l),params:[]};let B=["none"];return A&&(B=[A(y.encoder)]),{sql:D(v.value++,T),params:[T],typings:B}}return R(y,mt)?{sql:D(v.value++,y),params:[y],typings:["none"]}:R(y,O.Aliased)&&y.fieldAlias!==void 0?{sql:h(y.fieldAlias),params:[]}:R(y,Zt)?y._.isWith?{sql:h(y._.alias),params:[]}:this.buildQueryFromSourceParams([new re("("),y._.sql,new re(") "),new ut(y._.alias)],l):ys(y)?y.schema?{sql:h(y.schema)+"."+h(y.enumName),params:[]}:{sql:h(y.enumName),params:[]}:Ss(y)?y.shouldOmitSQLParens?.()?this.buildQueryFromSourceParams([y.getSQL()],l):this.buildQueryFromSourceParams([new re("("),y.getSQL(),new re(")")],l):w?{sql:this.mapInlineParam(y,l),params:[]}:{sql:D(v.value++,y),params:[y],typings:["none"]}}))}mapInlineParam(n,{escapeString:i}){if(n===null)return"null";if(typeof n=="number"||typeof n=="boolean")return n.toString();if(typeof n=="string")return i(n);if(typeof n=="object"){const l=n.toString();return i(l==="[object Object]"?JSON.stringify(n):l)}throw new Error("Unexpected param value: "+n)}getSQL(){return this}as(n){return n===void 0?this:new O.Aliased(this,n)}mapWith(n){return this.decoder=typeof n=="function"?{mapFromDriverValue:n}:n,this}inlineParams(){return this.shouldInlineParams=!0,this}if(n){return n?this:void 0}}class ut{constructor(n){this.value=n}static[_]="Name";brand;getSQL(){return new O([this])}}const Jt={mapFromDriverValue:e=>e},Yt={mapToDriverValue:e=>e};({...Jt,...Yt});class en{constructor(n,i=Yt){this.value=n,this.encoder=i}static[_]="Param";brand;getSQL(){return new O([this])}}function N(e,...n){const i=[];(n.length>0||e.length>0&&e[0]!=="")&&i.push(new re(e[0]));for(const[l,u]of n.entries())i.push(u,new re(e[l+1]));return new O(i)}(e=>{function n(){return new O([])}e.empty=n;function i(w){return new O(w)}e.fromList=i;function l(w){return new O([new re(w)])}e.raw=l;function u(w,v){const y=[];for(const[T,B]of w.entries())T>0&&v!==void 0&&y.push(v),y.push(B);return new O(y)}e.join=u;function h(w){return new ut(w)}e.identifier=h;function D(w){return new mt(w)}e.placeholder=D;function A(w,v){return new en(w,v)}e.param=A})(N||(N={}));(e=>{class n{constructor(l,u){this.sql=l,this.fieldAlias=u}static[_]="SQL.Aliased";isSelectionField=!1;getSQL(){return this.sql}clone(){return new n(this.sql,this.fieldAlias)}}e.Aliased=n})(O||(O={}));class mt{constructor(n){this.name=n}static[_]="Placeholder";getSQL(){return new O([this])}}const tn=Symbol.for("drizzle:IsDrizzleView");class Ts{static[_]="View";[De];[tn]=!0;constructor({name:n,schema:i,selectedFields:l,query:u}){this[De]={name:n,originalName:n,schema:i,selectedFields:l,query:u,isExisting:!u,isAlias:!1}}getSQL(){return new O([this])}}function Ps(e){return typeof e=="object"&&e!==null&&tn in e}Ae.prototype.getSQL=function(){return new O([this])};Q.prototype.getSQL=function(){return new O([this])};Zt.prototype.getSQL=function(){return new O([this])};function As(e){return e[Q.Symbol.Columns]}function Es(e){return e[De].selectedFields}function G(e,n){return{name:typeof e=="string"&&e.length>0?e:"",config:typeof e=="object"?e:n}}typeof TextDecoder>"u"||new TextDecoder;class Ke extends L{static[_]="PgIntColumnBaseBuilder";generatedAlwaysAsIdentity(n){if(n){const{name:i,...l}=n;this.config.generatedIdentity={type:"always",sequenceName:i,sequenceOptions:l}}else this.config.generatedIdentity={type:"always"};return this.config.hasDefault=!0,this.config.notNull=!0,this}generatedByDefaultAsIdentity(n){if(n){const{name:i,...l}=n;this.config.generatedIdentity={type:"byDefault",sequenceName:i,sequenceOptions:l}}else this.config.generatedIdentity={type:"byDefault"};return this.config.hasDefault=!0,this.config.notNull=!0,this}}class ks extends Ke{static[_]="PgBigInt53Builder";constructor(n){super(n,"number","PgBigInt53")}build(n){return new Ls(n,this.config)}}class Ls extends E{static[_]="PgBigInt53";getSQLType(){return"bigint"}mapFromDriverValue(n){return typeof n=="number"?n:Number(n)}}class Us extends Ke{static[_]="PgBigInt64Builder";constructor(n){super(n,"bigint","PgBigInt64")}build(n){return new Vs(n,this.config)}}class Vs extends E{static[_]="PgBigInt64";getSQLType(){return"bigint"}mapFromDriverValue(n){return BigInt(n)}}function Cs(e,n){const{name:i,config:l}=G(e,n);return l.mode==="number"?new ks(i):new Us(i)}class js extends L{static[_]="PgBigSerial53Builder";constructor(n){super(n,"number","PgBigSerial53"),this.config.hasDefault=!0,this.config.notNull=!0}build(n){return new Bs(n,this.config)}}class Bs extends E{static[_]="PgBigSerial53";getSQLType(){return"bigserial"}mapFromDriverValue(n){return typeof n=="number"?n:Number(n)}}class qs extends L{static[_]="PgBigSerial64Builder";constructor(n){super(n,"bigint","PgBigSerial64"),this.config.hasDefault=!0}build(n){return new Os(n,this.config)}}class Os extends E{static[_]="PgBigSerial64";getSQLType(){return"bigserial"}mapFromDriverValue(n){return BigInt(n)}}function Ms(e,n){const{name:i,config:l}=G(e,n);return l.mode==="number"?new js(i):new qs(i)}class Fs extends L{static[_]="PgBooleanBuilder";constructor(n){super(n,"boolean","PgBoolean")}build(n){return new Rs(n,this.config)}}class Rs extends E{static[_]="PgBoolean";getSQLType(){return"boolean"}}function p(e){return new Fs(e??"")}class Ks extends L{static[_]="PgCharBuilder";constructor(n,i){super(n,"string","PgChar"),this.config.length=i.length,this.config.enumValues=i.enum}build(n){return new zs(n,this.config)}}class zs extends E{static[_]="PgChar";length=this.config.length;enumValues=this.config.enumValues;getSQLType(){return this.length===void 0?"char":`char(${this.length})`}}function $s(e,n={}){const{name:i,config:l}=G(e,n);return new Ks(i,l)}class Qs extends L{static[_]="PgCidrBuilder";constructor(n){super(n,"string","PgCidr")}build(n){return new Gs(n,this.config)}}class Gs extends E{static[_]="PgCidr";getSQLType(){return"cidr"}}function Hs(e){return new Qs(e??"")}class Zs extends L{static[_]="PgCustomColumnBuilder";constructor(n,i,l){super(n,"custom","PgCustomColumn"),this.config.fieldConfig=i,this.config.customTypeParams=l}build(n){return new Ws(n,this.config)}}class Ws extends E{static[_]="PgCustomColumn";sqlName;mapTo;mapFrom;constructor(n,i){super(n,i),this.sqlName=i.customTypeParams.dataType(i.fieldConfig),this.mapTo=i.customTypeParams.toDriver,this.mapFrom=i.customTypeParams.fromDriver}getSQLType(){return this.sqlName}mapFromDriverValue(n){return typeof this.mapFrom=="function"?this.mapFrom(n):n}mapToDriverValue(n){return typeof this.mapTo=="function"?this.mapTo(n):n}}function Xs(e){return(n,i)=>{const{name:l,config:u}=G(n,i);return new Zs(l,u,e)}}class Ue extends L{static[_]="PgDateColumnBaseBuilder";defaultNow(){return this.default(N`now()`)}}class Js extends Ue{static[_]="PgDateBuilder";constructor(n){super(n,"date","PgDate")}build(n){return new Ys(n,this.config)}}class Ys extends E{static[_]="PgDate";getSQLType(){return"date"}mapFromDriverValue(n){return new Date(n)}mapToDriverValue(n){return n.toISOString()}}class er extends Ue{static[_]="PgDateStringBuilder";constructor(n){super(n,"string","PgDateString")}build(n){return new tr(n,this.config)}}class tr extends E{static[_]="PgDateString";getSQLType(){return"date"}}function V(e,n){const{name:i,config:l}=G(e,n);return l?.mode==="date"?new Js(i):new er(i)}class nr extends L{static[_]="PgDoublePrecisionBuilder";constructor(n){super(n,"number","PgDoublePrecision")}build(n){return new ir(n,this.config)}}class ir extends E{static[_]="PgDoublePrecision";getSQLType(){return"double precision"}mapFromDriverValue(n){return typeof n=="string"?Number.parseFloat(n):n}}function ar(e){return new nr(e??"")}class sr extends L{static[_]="PgInetBuilder";constructor(n){super(n,"string","PgInet")}build(n){return new rr(n,this.config)}}class rr extends E{static[_]="PgInet";getSQLType(){return"inet"}}function or(e){return new sr(e??"")}class lr extends Ke{static[_]="PgIntegerBuilder";constructor(n){super(n,"number","PgInteger")}build(n){return new dr(n,this.config)}}class dr extends E{static[_]="PgInteger";getSQLType(){return"integer"}mapFromDriverValue(n){return typeof n=="string"?Number.parseInt(n):n}}function g(e){return new lr(e??"")}class cr extends L{static[_]="PgIntervalBuilder";constructor(n,i){super(n,"string","PgInterval"),this.config.intervalConfig=i}build(n){return new ur(n,this.config)}}class ur extends E{static[_]="PgInterval";fields=this.config.intervalConfig.fields;precision=this.config.intervalConfig.precision;getSQLType(){const n=this.fields?` ${this.fields}`:"",i=this.precision?`(${this.precision})`:"";return`interval${n}${i}`}}function mr(e,n={}){const{name:i,config:l}=G(e,n);return new cr(i,l)}class pr extends L{static[_]="PgJsonBuilder";constructor(n){super(n,"json","PgJson")}build(n){return new _r(n,this.config)}}class _r extends E{static[_]="PgJson";constructor(n,i){super(n,i)}getSQLType(){return"json"}mapToDriverValue(n){return JSON.stringify(n)}mapFromDriverValue(n){if(typeof n=="string")try{return JSON.parse(n)}catch{return n}return n}}function fr(e){return new pr(e??"")}class gr extends L{static[_]="PgJsonbBuilder";constructor(n){super(n,"json","PgJsonb")}build(n){return new hr(n,this.config)}}class hr extends E{static[_]="PgJsonb";constructor(n,i){super(n,i)}getSQLType(){return"jsonb"}mapToDriverValue(n){return JSON.stringify(n)}mapFromDriverValue(n){if(typeof n=="string")try{return JSON.parse(n)}catch{return n}return n}}function m(e){return new gr(e??"")}class Nr extends L{static[_]="PgLineBuilder";constructor(n){super(n,"array","PgLine")}build(n){return new yr(n,this.config)}}class yr extends E{static[_]="PgLine";getSQLType(){return"line"}mapFromDriverValue(n){const[i,l,u]=n.slice(1,-1).split(",");return[Number.parseFloat(i),Number.parseFloat(l),Number.parseFloat(u)]}mapToDriverValue(n){return`{${n[0]},${n[1]},${n[2]}}`}}class br extends L{static[_]="PgLineABCBuilder";constructor(n){super(n,"json","PgLineABC")}build(n){return new xr(n,this.config)}}class xr extends E{static[_]="PgLineABC";getSQLType(){return"line"}mapFromDriverValue(n){const[i,l,u]=n.slice(1,-1).split(",");return{a:Number.parseFloat(i),b:Number.parseFloat(l),c:Number.parseFloat(u)}}mapToDriverValue(n){return`{${n.a},${n.b},${n.c}}`}}function Dr(e,n){const{name:i,config:l}=G(e,n);return!l?.mode||l.mode==="tuple"?new Nr(i):new br(i)}class vr extends L{static[_]="PgMacaddrBuilder";constructor(n){super(n,"string","PgMacaddr")}build(n){return new Ir(n,this.config)}}class Ir extends E{static[_]="PgMacaddr";getSQLType(){return"macaddr"}}function Sr(e){return new vr(e??"")}class wr extends L{static[_]="PgMacaddr8Builder";constructor(n){super(n,"string","PgMacaddr8")}build(n){return new Tr(n,this.config)}}class Tr extends E{static[_]="PgMacaddr8";getSQLType(){return"macaddr8"}}function Pr(e){return new wr(e??"")}class Ar extends L{static[_]="PgNumericBuilder";constructor(n,i,l){super(n,"string","PgNumeric"),this.config.precision=i,this.config.scale=l}build(n){return new Er(n,this.config)}}class Er extends E{static[_]="PgNumeric";precision;scale;constructor(n,i){super(n,i),this.precision=i.precision,this.scale=i.scale}mapFromDriverValue(n){return typeof n=="string"?n:String(n)}getSQLType(){return this.precision!==void 0&&this.scale!==void 0?`numeric(${this.precision}, ${this.scale})`:this.precision===void 0?"numeric":`numeric(${this.precision})`}}class kr extends L{static[_]="PgNumericNumberBuilder";constructor(n,i,l){super(n,"number","PgNumericNumber"),this.config.precision=i,this.config.scale=l}build(n){return new Lr(n,this.config)}}class Lr extends E{static[_]="PgNumericNumber";precision;scale;constructor(n,i){super(n,i),this.precision=i.precision,this.scale=i.scale}mapFromDriverValue(n){return typeof n=="number"?n:Number(n)}mapToDriverValue=String;getSQLType(){return this.precision!==void 0&&this.scale!==void 0?`numeric(${this.precision}, ${this.scale})`:this.precision===void 0?"numeric":`numeric(${this.precision})`}}class Ur extends L{static[_]="PgNumericBigIntBuilder";constructor(n,i,l){super(n,"bigint","PgNumericBigInt"),this.config.precision=i,this.config.scale=l}build(n){return new Vr(n,this.config)}}class Vr extends E{static[_]="PgNumericBigInt";precision;scale;constructor(n,i){super(n,i),this.precision=i.precision,this.scale=i.scale}mapFromDriverValue=BigInt;mapToDriverValue=String;getSQLType(){return this.precision!==void 0&&this.scale!==void 0?`numeric(${this.precision}, ${this.scale})`:this.precision===void 0?"numeric":`numeric(${this.precision})`}}function nn(e,n){const{name:i,config:l}=G(e,n),u=l?.mode;return u==="number"?new kr(i,l?.precision,l?.scale):u==="bigint"?new Ur(i,l?.precision,l?.scale):new Ar(i,l?.precision,l?.scale)}const d=nn;class Cr extends L{static[_]="PgPointTupleBuilder";constructor(n){super(n,"array","PgPointTuple")}build(n){return new jr(n,this.config)}}class jr extends E{static[_]="PgPointTuple";getSQLType(){return"point"}mapFromDriverValue(n){if(typeof n=="string"){const[i,l]=n.slice(1,-1).split(",");return[Number.parseFloat(i),Number.parseFloat(l)]}return[n.x,n.y]}mapToDriverValue(n){return`(${n[0]},${n[1]})`}}class Br extends L{static[_]="PgPointObjectBuilder";constructor(n){super(n,"json","PgPointObject")}build(n){return new qr(n,this.config)}}class qr extends E{static[_]="PgPointObject";getSQLType(){return"point"}mapFromDriverValue(n){if(typeof n=="string"){const[i,l]=n.slice(1,-1).split(",");return{x:Number.parseFloat(i),y:Number.parseFloat(l)}}return n}mapToDriverValue(n){return`(${n.x},${n.y})`}}function Or(e,n){const{name:i,config:l}=G(e,n);return!l?.mode||l.mode==="tuple"?new Cr(i):new Br(i)}function Mr(e){const n=[];for(let i=0;i<e.length;i+=2)n.push(Number.parseInt(e.slice(i,i+2),16));return new Uint8Array(n)}function Ft(e,n){const i=new ArrayBuffer(8),l=new DataView(i);for(let u=0;u<8;u++)l.setUint8(u,e[n+u]);return l.getFloat64(0,!0)}function an(e){const n=Mr(e);let i=0;const l=n[i];i+=1;const u=new DataView(n.buffer),h=u.getUint32(i,l===1);if(i+=4,h&536870912&&(u.getUint32(i,l===1),i+=4),(h&65535)===1){const D=Ft(n,i);i+=8;const A=Ft(n,i);return i+=8,[D,A]}throw new Error("Unsupported geometry type")}class Fr extends L{static[_]="PgGeometryBuilder";constructor(n){super(n,"array","PgGeometry")}build(n){return new Rr(n,this.config)}}class Rr extends E{static[_]="PgGeometry";getSQLType(){return"geometry(point)"}mapFromDriverValue(n){return an(n)}mapToDriverValue(n){return`point(${n[0]} ${n[1]})`}}class Kr extends L{static[_]="PgGeometryObjectBuilder";constructor(n){super(n,"json","PgGeometryObject")}build(n){return new zr(n,this.config)}}class zr extends E{static[_]="PgGeometryObject";getSQLType(){return"geometry(point)"}mapFromDriverValue(n){const i=an(n);return{x:i[0],y:i[1]}}mapToDriverValue(n){return`point(${n.x} ${n.y})`}}function $r(e,n){const{name:i,config:l}=G(e,n);return!l?.mode||l.mode==="tuple"?new Fr(i):new Kr(i)}class Qr extends L{static[_]="PgRealBuilder";constructor(n,i){super(n,"number","PgReal"),this.config.length=i}build(n){return new Gr(n,this.config)}}class Gr extends E{static[_]="PgReal";constructor(n,i){super(n,i)}getSQLType(){return"real"}mapFromDriverValue=n=>typeof n=="string"?Number.parseFloat(n):n}function Hr(e){return new Qr(e??"")}class Zr extends L{static[_]="PgSerialBuilder";constructor(n){super(n,"number","PgSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(n){return new Wr(n,this.config)}}class Wr extends E{static[_]="PgSerial";getSQLType(){return"serial"}}function Xr(e){return new Zr(e??"")}class Jr extends Ke{static[_]="PgSmallIntBuilder";constructor(n){super(n,"number","PgSmallInt")}build(n){return new Yr(n,this.config)}}class Yr extends E{static[_]="PgSmallInt";getSQLType(){return"smallint"}mapFromDriverValue=n=>typeof n=="string"?Number(n):n}function eo(e){return new Jr(e??"")}class to extends L{static[_]="PgSmallSerialBuilder";constructor(n){super(n,"number","PgSmallSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(n){return new no(n,this.config)}}class no extends E{static[_]="PgSmallSerial";getSQLType(){return"smallserial"}}function io(e){return new to(e??"")}class ao extends L{static[_]="PgTextBuilder";constructor(n,i){super(n,"string","PgText"),this.config.enumValues=i.enum}build(n){return new so(n,this.config)}}class so extends E{static[_]="PgText";enumValues=this.config.enumValues;getSQLType(){return"text"}}function o(e,n={}){const{name:i,config:l}=G(e,n);return new ao(i,l)}class ro extends Ue{constructor(n,i,l){super(n,"string","PgTime"),this.withTimezone=i,this.precision=l,this.config.withTimezone=i,this.config.precision=l}static[_]="PgTimeBuilder";build(n){return new oo(n,this.config)}}class oo extends E{static[_]="PgTime";withTimezone;precision;constructor(n,i){super(n,i),this.withTimezone=i.withTimezone,this.precision=i.precision}getSQLType(){return`time${this.precision===void 0?"":`(${this.precision})`}${this.withTimezone?" with time zone":""}`}}function lo(e,n={}){const{name:i,config:l}=G(e,n);return new ro(i,l.withTimezone??!1,l.precision)}class co extends Ue{static[_]="PgTimestampBuilder";constructor(n,i,l){super(n,"date","PgTimestamp"),this.config.withTimezone=i,this.config.precision=l}build(n){return new uo(n,this.config)}}class uo extends E{static[_]="PgTimestamp";withTimezone;precision;constructor(n,i){super(n,i),this.withTimezone=i.withTimezone,this.precision=i.precision}getSQLType(){return`timestamp${this.precision===void 0?"":` (${this.precision})`}${this.withTimezone?" with time zone":""}`}mapFromDriverValue=n=>new Date(this.withTimezone?n:n+"+0000");mapToDriverValue=n=>n.toISOString()}class mo extends Ue{static[_]="PgTimestampStringBuilder";constructor(n,i,l){super(n,"string","PgTimestampString"),this.config.withTimezone=i,this.config.precision=l}build(n){return new po(n,this.config)}}class po extends E{static[_]="PgTimestampString";withTimezone;precision;constructor(n,i){super(n,i),this.withTimezone=i.withTimezone,this.precision=i.precision}getSQLType(){return`timestamp${this.precision===void 0?"":`(${this.precision})`}${this.withTimezone?" with time zone":""}`}}function a(e,n={}){const{name:i,config:l}=G(e,n);return l?.mode==="string"?new mo(i,l.withTimezone??!1,l.precision):new co(i,l?.withTimezone??!1,l?.precision)}class _o extends L{static[_]="PgUUIDBuilder";constructor(n){super(n,"string","PgUUID")}defaultRandom(){return this.default(N`gen_random_uuid()`)}build(n){return new fo(n,this.config)}}class fo extends E{static[_]="PgUUID";getSQLType(){return"uuid"}}function go(e){return new _o(e??"")}class ho extends L{static[_]="PgVarcharBuilder";constructor(n,i){super(n,"string","PgVarchar"),this.config.length=i.length,this.config.enumValues=i.enum}build(n){return new No(n,this.config)}}class No extends E{static[_]="PgVarchar";length=this.config.length;enumValues=this.config.enumValues;getSQLType(){return this.length===void 0?"varchar":`varchar(${this.length})`}}function t(e,n={}){const{name:i,config:l}=G(e,n);return new ho(i,l)}class yo extends L{static[_]="PgBinaryVectorBuilder";constructor(n,i){super(n,"string","PgBinaryVector"),this.config.dimensions=i.dimensions}build(n){return new bo(n,this.config)}}class bo extends E{static[_]="PgBinaryVector";dimensions=this.config.dimensions;getSQLType(){return`bit(${this.dimensions})`}}function xo(e,n){const{name:i,config:l}=G(e,n);return new yo(i,l)}class Do extends L{static[_]="PgHalfVectorBuilder";constructor(n,i){super(n,"array","PgHalfVector"),this.config.dimensions=i.dimensions}build(n){return new vo(n,this.config)}}class vo extends E{static[_]="PgHalfVector";dimensions=this.config.dimensions;getSQLType(){return`halfvec(${this.dimensions})`}mapToDriverValue(n){return JSON.stringify(n)}mapFromDriverValue(n){return n.slice(1,-1).split(",").map(i=>Number.parseFloat(i))}}function Io(e,n){const{name:i,config:l}=G(e,n);return new Do(i,l)}class So extends L{static[_]="PgSparseVectorBuilder";constructor(n,i){super(n,"string","PgSparseVector"),this.config.dimensions=i.dimensions}build(n){return new wo(n,this.config)}}class wo extends E{static[_]="PgSparseVector";dimensions=this.config.dimensions;getSQLType(){return`sparsevec(${this.dimensions})`}}function To(e,n){const{name:i,config:l}=G(e,n);return new So(i,l)}class Po extends L{static[_]="PgVectorBuilder";constructor(n,i){super(n,"array","PgVector"),this.config.dimensions=i.dimensions}build(n){return new Ao(n,this.config)}}class Ao extends E{static[_]="PgVector";dimensions=this.config.dimensions;getSQLType(){return`vector(${this.dimensions})`}mapToDriverValue(n){return JSON.stringify(n)}mapFromDriverValue(n){return n.slice(1,-1).split(",").map(i=>Number.parseFloat(i))}}function Eo(e,n){const{name:i,config:l}=G(e,n);return new Po(i,l)}function ko(){return{bigint:Cs,bigserial:Ms,boolean:p,char:$s,cidr:Hs,customType:Xs,date:V,doublePrecision:ar,inet:or,integer:g,interval:mr,json:fr,jsonb:m,line:Dr,macaddr:Sr,macaddr8:Pr,numeric:nn,point:Or,geometry:$r,real:Hr,serial:Xr,smallint:eo,smallserial:io,text:o,time:lo,timestamp:a,uuid:go,varchar:t,bit:xo,halfvec:Io,sparsevec:To,vector:Eo}}const pt=Symbol.for("drizzle:PgInlineForeignKeys"),Rt=Symbol.for("drizzle:EnableRLS");class nt extends Q{static[_]="PgTable";static Symbol=Object.assign({},Q.Symbol,{InlineForeignKeys:pt,EnableRLS:Rt});[pt]=[];[Rt]=!1;[Q.Symbol.ExtraConfigBuilder]=void 0;[Q.Symbol.ExtraConfigColumns]={}}function Lo(e,n,i,l,u=e){const h=new nt(e,l,u),D=typeof n=="function"?n(ko()):n,A=Object.fromEntries(Object.entries(D).map(([y,T])=>{const B=T;B.setName(y);const se=B.build(h);return h[pt].push(...B.buildForeignKeys(se,h)),[y,se]})),w=Object.fromEntries(Object.entries(D).map(([y,T])=>{const B=T;B.setName(y);const se=B.buildExtraConfigColumn(h);return[y,se]})),v=Object.assign(h,A);return v[Q.Symbol.Columns]=A,v[Q.Symbol.ExtraConfigColumns]=w,i&&(v[nt.Symbol.ExtraConfigBuilder]=i),Object.assign(v,{enableRLS:()=>(v[nt.Symbol.EnableRLS]=!0,v)})}const f=(e,n,i)=>Lo(e,n,i,void 0);class sn{constructor(n,i){this.unique=n,this.name=i}static[_]="PgIndexBuilderOn";on(...n){return new it(n.map(i=>{if(R(i,O))return i;i=i;const l=new Je(i.name,!!i.keyAsName,i.columnType,i.indexConfig);return i.indexConfig=JSON.parse(JSON.stringify(i.defaultConfig)),l}),this.unique,!1,this.name)}onOnly(...n){return new it(n.map(i=>{if(R(i,O))return i;i=i;const l=new Je(i.name,!!i.keyAsName,i.columnType,i.indexConfig);return i.indexConfig=i.defaultConfig,l}),this.unique,!0,this.name)}using(n,...i){return new it(i.map(l=>{if(R(l,O))return l;l=l;const u=new Je(l.name,!!l.keyAsName,l.columnType,l.indexConfig);return l.indexConfig=JSON.parse(JSON.stringify(l.defaultConfig)),u}),this.unique,!0,this.name,n)}}class it{static[_]="PgIndexBuilder";config;constructor(n,i,l,u,h="btree"){this.config={name:u,columns:n,unique:i,only:l,method:h}}concurrently(){return this.config.concurrently=!0,this}with(n){return this.config.with=n,this}where(n){return this.config.where=n,this}build(n){return new Uo(this.config,n)}}class Uo{static[_]="PgIndex";config;constructor(n,i){this.config={...n,table:i}}}function r(e){return new sn(!1,e)}function Se(e){return new sn(!0,e)}const Vo=Object.freeze(Object.defineProperty({__proto__:null,BRAND:mi,DIRTY:pi,EMPTY_PATH:_i,INVALID:fi,NEVER:gi,OK:hi,ParseStatus:Ni,Schema:We,ZodAny:yi,ZodArray:bi,ZodBigInt:xi,ZodBoolean:Di,ZodBranded:vi,ZodCatch:Ii,ZodDate:Si,ZodDefault:wi,ZodDiscriminatedUnion:Ti,ZodEffects:Ct,ZodEnum:Pi,ZodError:Ai,get ZodFirstPartyTypeKind(){return Ei},ZodFunction:ki,ZodIntersection:Li,ZodIssueCode:Ui,ZodLazy:Vi,ZodLiteral:Ci,ZodMap:ji,ZodNaN:Bi,ZodNativeEnum:qi,ZodNever:Oi,ZodNull:Mi,ZodNullable:Fi,ZodNumber:Ri,ZodObject:Ki,ZodOptional:zi,ZodParsedType:$i,ZodPipeline:Qi,ZodPromise:Gi,ZodReadonly:Hi,ZodRecord:Zi,ZodSchema:We,ZodSet:Wi,ZodString:Xi,ZodSymbol:Ji,ZodTransformer:Ct,ZodTuple:Yi,ZodType:We,ZodUndefined:ea,ZodUnion:ta,ZodUnknown:na,ZodVoid:ia,addIssueToContext:aa,any:le,array:fe,bigint:sa,boolean:oe,coerce:ra,custom:$t,date:Ie,datetimeRegex:oa,defaultErrorMap:la,discriminatedUnion:da,effect:jt,enum:q,function:ca,getErrorMap:ua,getParsedType:ma,instanceof:pa,intersection:_a,isAborted:fa,isAsync:ga,isDirty:ha,isValid:Na,late:ya,lazy:ba,literal:xa,makeIssue:Da,map:va,nan:Ia,nativeEnum:Sa,never:wa,null:Qt,nullable:Ta,number:k,object:C,get objectUtil(){return Pa},oboolean:Aa,onumber:Ea,optional:ka,ostring:La,pipeline:Ua,preprocess:Va,promise:Ca,quotelessJson:ja,record:be,set:Ba,setErrorMap:qa,strictObject:Oa,string:c,symbol:Ma,transformer:jt,tuple:Fa,undefined:Ra,union:St,unknown:Ka,get util(){return za},void:$a},Symbol.toStringTag,{value:"Module"})),M={INT8_MIN:-128,INT8_MAX:127,INT8_UNSIGNED_MAX:255,INT16_MIN:-32768,INT16_MAX:32767,INT16_UNSIGNED_MAX:65535,INT24_MIN:-8388608,INT24_MAX:8388607,INT24_UNSIGNED_MAX:16777215,INT32_MIN:-2147483648,INT32_MAX:2147483647,INT32_UNSIGNED_MAX:4294967295,INT48_MIN:-0x800000000000,INT48_MAX:0x7fffffffffff,INT48_UNSIGNED_MAX:0xffffffffffff,INT64_MIN:-9223372036854775808n,INT64_MAX:9223372036854775807n,INT64_UNSIGNED_MAX:18446744073709551615n};function K(e,n){return n.includes(e.columnType)}function Co(e){return"enumValues"in e&&Array.isArray(e.enumValues)&&e.enumValues.length>0}const jo=St([c(),k(),oe(),Qt()]),Bo=St([jo,be(le()),fe(le())]),qo=$t(e=>e instanceof Buffer);function rn(e,n){const i=n?.zodInstance??Vo,l=n?.coerce??{};let u;return Co(e)&&(u=e.enumValues.length?i.enum(e.enumValues):i.string()),u||(K(e,["PgGeometry","PgPointTuple"])?u=i.tuple([i.number(),i.number()]):K(e,["PgGeometryObject","PgPointObject"])?u=i.object({x:i.number(),y:i.number()}):K(e,["PgHalfVector","PgVector"])?(u=i.array(i.number()),u=e.dimensions?u.length(e.dimensions):u):K(e,["PgLine"])?u=i.tuple([i.number(),i.number(),i.number()]):K(e,["PgLineABC"])?u=i.object({a:i.number(),b:i.number(),c:i.number()}):K(e,["PgArray"])?(u=i.array(rn(e.baseColumn,i)),u=e.size?u.length(e.size):u):e.dataType==="array"?u=i.array(i.any()):e.dataType==="number"?u=Oo(e,i,l):e.dataType==="bigint"?u=Mo(e,i,l):e.dataType==="boolean"?u=l===!0||l.boolean?i.coerce.boolean():i.boolean():e.dataType==="date"?u=l===!0||l.date?i.coerce.date():i.date():e.dataType==="string"?u=Fo(e,i,l):e.dataType==="json"?u=Bo:e.dataType==="custom"?u=i.any():e.dataType==="buffer"&&(u=qo)),u||(u=i.any()),u}function Oo(e,n,i){let l=e.getSQLType().includes("unsigned"),u,h,D=!1;K(e,["MySqlTinyInt","SingleStoreTinyInt"])?(u=l?0:M.INT8_MIN,h=l?M.INT8_UNSIGNED_MAX:M.INT8_MAX,D=!0):K(e,["PgSmallInt","PgSmallSerial","MySqlSmallInt","SingleStoreSmallInt"])?(u=l?0:M.INT16_MIN,h=l?M.INT16_UNSIGNED_MAX:M.INT16_MAX,D=!0):K(e,["PgReal","MySqlFloat","MySqlMediumInt","SingleStoreMediumInt","SingleStoreFloat"])?(u=l?0:M.INT24_MIN,h=l?M.INT24_UNSIGNED_MAX:M.INT24_MAX,D=K(e,["MySqlMediumInt","SingleStoreMediumInt"])):K(e,["PgInteger","PgSerial","MySqlInt","SingleStoreInt"])?(u=l?0:M.INT32_MIN,h=l?M.INT32_UNSIGNED_MAX:M.INT32_MAX,D=!0):K(e,["PgDoublePrecision","MySqlReal","MySqlDouble","SingleStoreReal","SingleStoreDouble","SQLiteReal"])?(u=l?0:M.INT48_MIN,h=l?M.INT48_UNSIGNED_MAX:M.INT48_MAX):K(e,["PgBigInt53","PgBigSerial53","MySqlBigInt53","MySqlSerial","SingleStoreBigInt53","SingleStoreSerial","SQLiteInteger"])?(l=l||K(e,["MySqlSerial","SingleStoreSerial"]),u=l?0:Number.MIN_SAFE_INTEGER,h=Number.MAX_SAFE_INTEGER,D=!0):K(e,["MySqlYear","SingleStoreYear"])?(u=1901,h=2155,D=!0):(u=Number.MIN_SAFE_INTEGER,h=Number.MAX_SAFE_INTEGER);let A=i===!0||i?.number?n.coerce.number():n.number();return A=A.min(u).max(h),D?A.int():A}function Mo(e,n,i){const l=e.getSQLType().includes("unsigned"),u=l?0n:M.INT64_MIN,h=l?M.INT64_UNSIGNED_MAX:M.INT64_MAX;return(i===!0||i?.bigint?n.coerce.bigint():n.bigint()).min(u).max(h)}function Fo(e,n,i){if(K(e,["PgUUID"]))return n.string().uuid();let l,u,h=!1;K(e,["PgVarchar","SQLiteText"])?l=e.length:K(e,["MySqlVarChar","SingleStoreVarChar"])?l=e.length??M.INT16_UNSIGNED_MAX:K(e,["MySqlText","SingleStoreText"])&&(e.textType==="longtext"?l=M.INT32_UNSIGNED_MAX:e.textType==="mediumtext"?l=M.INT24_UNSIGNED_MAX:e.textType==="text"?l=M.INT16_UNSIGNED_MAX:l=M.INT8_UNSIGNED_MAX),K(e,["PgChar","MySqlChar","SingleStoreChar"])&&(l=e.length,h=!0),K(e,["PgBinaryVector"])&&(u=/^[01]+$/,l=e.dimensions);let D=i===!0||i?.string?n.coerce.string():n.string();return D=u?D.regex(u):D,l&&h?D.length(l):l?D.max(l):D}function on(e){return Xt(e)?As(e):Es(e)}function ln(e,n,i,l){const u={};for(const[h,D]of Object.entries(e)){if(!R(D,Ae)&&!R(D,O)&&!R(D,O.Aliased)&&typeof D=="object"){const T=Xt(D)||Ps(D)?on(D):D;u[h]=ln(T,n[h]??{},i,l);continue}const A=n[h];if(A!==void 0&&typeof A!="function"){u[h]=A;continue}const w=R(D,Ae)?D:void 0,v=w?rn(w,l):le(),y=typeof A=="function"?A(v):v;i.never(w)||(u[h]=y,w&&(i.nullable(w)&&(u[h]=u[h].nullable()),i.optional(w)&&(u[h]=u[h].optional())))}return C(u)}const Ro={never:e=>e?.generated?.type==="always"||e?.generatedIdentity?.type==="always",optional:e=>!e.notNull||e.notNull&&e.hasDefault,nullable:e=>!e.notNull},I=(e,n)=>{const i=on(e);return ln(i,n??{},Ro)},Ee=S("role",["ecp","admin","lab_tech","engineer","supplier","platform_admin","company_admin","dispenser"]),dn=S("subscription_plan",["full","free_ecp"]);f("sessions",{sid:t("sid").primaryKey(),userId:t("user_id").references(()=>b.id).notNull(),sess:m("sess").notNull(),expire:a("expire").notNull()},e=>[r("IDX_session_expire").on(e.expire),r("IDX_session_user").on(e.userId)]);const Ko=S("account_status",["pending","active","suspended"]),zo=S("order_status",["pending","in_production","quality_check","shipped","completed","on_hold","cancelled"]),$o=S("analytics_event_type",["order_created","order_updated","quality_issue","equipment_status","material_usage","return_created","non_adapt_reported"]),cn=S("email_type",["invoice","receipt","prescription_reminder","recall_notification","appointment_reminder","order_confirmation","order_update","marketing","general"]),Qo=S("email_status",["queued","sent","delivered","opened","clicked","bounced","failed","spam"]),Go=S("email_event_type",["sent","delivered","opened","clicked","bounced","spam","unsubscribed"]),Ho=S("quality_issue_type",["surface_defect","coating_defect","measurement_error","material_defect","processing_error","other"]);f("analytics_events",{id:t("id").primaryKey().default(N`gen_random_uuid()`),eventType:$o("event_type").notNull(),timestamp:a("timestamp").defaultNow().notNull(),sourceId:t("source_id").notNull(),sourceType:t("source_type").notNull(),data:m("data").notNull(),metadata:m("metadata"),organizationId:t("organization_id").notNull()});const un=f("quality_issues",{id:t("id").primaryKey().default(N`gen_random_uuid()`),issueType:Ho("issue_type").notNull(),orderId:t("order_id").references(()=>te.id).notNull(),description:o("description").notNull(),severity:g("severity").notNull(),detectedAt:a("detected_at").defaultNow().notNull(),detectedBy:t("detected_by").references(()=>b.id).notNull(),status:t("status").notNull().default("open"),resolution:o("resolution"),resolvedAt:a("resolved_at"),resolvedBy:t("resolved_by").references(()=>b.id),rootCause:o("root_cause"),preventiveActions:o("preventive_actions"),metadata:m("metadata")});f("returns",{id:t("id").primaryKey().default(N`gen_random_uuid()`),orderId:t("order_id").references(()=>te.id).notNull(),returnReason:t("return_reason").notNull(),returnType:t("return_type").notNull(),description:o("description").notNull(),createdAt:a("created_at").defaultNow().notNull(),createdBy:t("created_by").references(()=>b.id).notNull(),status:t("status").notNull().default("pending"),processingNotes:o("processing_notes"),replacementOrderId:t("replacement_order_id").references(()=>te.id),qualityIssueId:t("quality_issue_id").references(()=>un.id),metadata:m("metadata")});C({orderId:c().min(1,"Order ID is required"),returnReason:c().min(1,"Return reason is required"),returnType:c().min(1,"Return type is required"),description:c().min(1,"Description is required"),createdBy:c().min(1,"Creator ID is required"),processingNotes:c().optional(),metadata:be(le()).optional()});C({status:c().min(1,"Status is required"),processingNotes:c().optional()});f("non_adapts",{id:t("id").primaryKey().default(N`gen_random_uuid()`),orderId:t("order_id").references(()=>te.id).notNull(),reportedBy:t("reported_by").references(()=>b.id).notNull(),patientFeedback:o("patient_feedback").notNull(),symptoms:m("symptoms").notNull(),createdAt:a("created_at").defaultNow().notNull(),resolution:o("resolution"),resolutionType:t("resolution_type"),resolvedAt:a("resolved_at"),qualityIssueId:t("quality_issue_id").references(()=>un.id),replacementOrderId:t("replacement_order_id").references(()=>te.id),metadata:m("metadata")});C({orderId:c().min(1,"Order ID is required"),reportedBy:c().min(1,"Reporter ID is required"),patientFeedback:c().min(1,"Patient feedback is required"),symptoms:fe(c()).nonempty("At least one symptom is required"),resolution:c().optional(),resolutionType:c().optional(),metadata:be(le()).optional()});C({resolution:c().optional(),resolutionType:c().optional()});const Zo=S("po_status",["draft","sent","acknowledged","in_transit","delivered","cancelled"]),Wo=S("document_type",["spec_sheet","certificate","sds","compliance","other"]),Xo=S("consult_priority",["normal","high","urgent"]),Jo=S("examination_status",["in_progress","finalized"]),Yo=S("equipment_status",["operational","maintenance","repair","offline"]);S("maintenance_type",["routine","repair","upgrade","emergency"]);const mn=f("equipment",{id:t("id").primaryKey().default(N`gen_random_uuid()`),companyId:t("company_id").notNull().references(()=>x.id,{onDelete:"cascade"}),testRoomId:t("test_room_id").references(()=>Pt.id,{onDelete:"set null"}),name:t("name",{length:200}).notNull(),manufacturer:t("manufacturer",{length:150}),model:t("model",{length:150}),serialNumber:t("serial_number",{length:100}).notNull(),status:Yo("status").notNull().default("operational"),purchaseDate:a("purchase_date"),lastCalibrationDate:a("last_calibration_date"),nextCalibrationDate:a("next_calibration_date"),calibrationFrequencyDays:g("calibration_frequency_days").default(365),lastMaintenance:a("last_maintenance"),nextMaintenance:a("next_maintenance"),specifications:m("specifications"),notes:o("notes"),location:t("location"),warrantyExpiration:a("warranty_expiration"),maintenanceHistory:m("maintenance_history").default("[]"),metadata:m("metadata"),createdAt:a("created_at").defaultNow().notNull(),updatedAt:a("updated_at").defaultNow().notNull()},e=>[r("idx_equipment_company").on(e.companyId),r("idx_equipment_test_room").on(e.testRoomId),r("idx_equipment_status").on(e.status),r("idx_equipment_next_calibration").on(e.nextCalibrationDate)]);f("order_timeline",{id:t("id").primaryKey().default(N`gen_random_uuid()`),orderId:t("order_id").references(()=>te.id).notNull(),status:t("status").notNull(),details:o("details"),timestamp:a("timestamp").defaultNow().notNull(),userId:t("user_id").references(()=>b.id).notNull(),metadata:m("metadata")});f("dicom_readings",{id:t("id").primaryKey().default(N`gen_random_uuid()`),examinationId:t("examination_id").references(()=>je.id).notNull(),studyInstanceUID:t("study_instance_uid").notNull(),seriesInstanceUID:t("series_instance_uid").notNull(),imageInstanceUID:t("image_instance_uid").notNull(),modality:t("modality").notNull(),equipmentId:t("equipment_id").references(()=>mn.id).notNull(),manufacturer:t("manufacturer"),modelName:t("model_name"),measurements:m("measurements"),rawData:o("raw_data").notNull(),createdAt:a("created_at").defaultNow().notNull()},e=>[r("idx_dicom_readings_examination").on(e.examinationId),r("idx_dicom_readings_equipment").on(e.equipmentId)]);const el=S("invoice_status",["draft","paid","void"]),tl=S("payment_method",["cash","card","mixed"]),nl=S("product_type",["frame","contact_lens","solution","service"]),il=S("notification_type",["info","warning","error","success"]),al=S("notification_severity",["low","medium","high"]);S("notification_target_type",["user","role","organization"]);f("notifications",{id:t("id").primaryKey().default(N`gen_random_uuid()`),type:il("type").notNull(),title:o("title").notNull(),message:o("message").notNull(),severity:al("severity").notNull(),target:m("target").notNull(),read:p("read").default(!1).notNull(),readAt:a("read_at"),createdAt:a("created_at").defaultNow().notNull()},e=>[r("idx_notifications_created_at").on(e.createdAt)]);const sl=S("company_type",["ecp","lab","supplier","hybrid"]),rl=S("company_status",["active","suspended","pending_approval","deactivated"]),x=f("companies",{id:t("id").primaryKey().default(N`gen_random_uuid()`),name:o("name").notNull(),type:sl("type").notNull(),status:rl("status").notNull().default("pending_approval"),email:t("email").notNull(),phone:t("phone"),website:t("website"),address:m("address"),registrationNumber:t("registration_number"),gocNumber:t("goc_number"),taxId:t("tax_id"),subscriptionPlan:dn("subscription_plan").notNull().default("free_ecp"),subscriptionStartDate:a("subscription_start_date"),subscriptionEndDate:a("subscription_end_date"),billingEmail:t("billing_email"),stripeCustomerId:t("stripe_customer_id",{length:255}),stripeSubscriptionId:t("stripe_subscription_id",{length:255}),stripeSubscriptionStatus:t("stripe_subscription_status",{length:50}),stripeCurrentPeriodEnd:a("stripe_current_period_end"),freeTrialEndDate:a("free_trial_end_date"),subscriptionCancelledAt:a("subscription_cancelled_at"),isSubscriptionExempt:p("is_subscription_exempt").default(!1),companyLogoUrl:o("company_logo_url"),companyLetterheadUrl:o("company_letterhead_url"),brandingSettings:m("branding_settings").default(N`'{
    "primaryColor": "#0f172a",
    "secondaryColor": "#3b82f6",
    "logoPosition": "top-left",
    "showGocNumber": true,
    "includeAftercare": true,
    "dispenseSlipFooter": ""
  }'::jsonb`),settings:m("settings").default(N`'{}'::jsonb`),preferences:m("preferences").default(N`'{}'::jsonb`),aiEnabled:p("ai_enabled").default(!0),aiModel:t("ai_model").default("gpt-4"),useExternalAi:p("use_external_ai").default(!0),aiLearningProgress:g("ai_learning_progress").default(0),shopifyEnabled:p("shopify_enabled").default(!1),shopifyShopUrl:t("shopify_shop_url"),shopifyShopName:t("shopify_shop_name"),shopifyAccessToken:t("shopify_access_token"),shopifyWebhookSecret:t("shopify_webhook_secret"),shopifyApiVersion:t("shopify_api_version").default("2024-10"),shopifyAutoSync:p("shopify_auto_sync").default(!1),shopifyLastSyncAt:a("shopify_last_sync_at"),shopifySyncSettings:m("shopify_sync_settings").default(N`'{}'::jsonb`),practiceGocNumber:t("practice_goc_number",{length:50}),practiceType:t("practice_type",{length:50}),primaryPractitionerName:t("primary_practitioner_name",{length:255}),primaryPractitionerGoc:t("primary_practitioner_goc",{length:50}),emergencyContactName:t("emergency_contact_name",{length:255}),emergencyContactPhone:t("emergency_contact_phone",{length:50}),outOfHoursContact:o("out_of_hours_contact"),insuranceProvider:t("insurance_provider",{length:255}),insurancePolicyNumber:t("insurance_policy_number",{length:100}),insuranceExpiryDate:a("insurance_expiry_date"),hasEcpAccess:p("has_ecp_access").default(!1),hasLabAccess:p("has_lab_access").default(!1),createdAt:a("created_at").defaultNow().notNull(),updatedAt:a("updated_at").defaultNow().notNull(),createdBy:t("created_by",{length:255}),updatedBy:t("updated_by",{length:255}),changeHistory:m("change_history").default(N`'[]'::jsonb`)},e=>[r("idx_companies_status").on(e.status),r("idx_companies_type").on(e.type),r("idx_companies_stripe_customer").on(e.stripeCustomerId),r("idx_companies_stripe_subscription").on(e.stripeSubscriptionId)]);f("subscription_plans",{id:t("id").primaryKey(),name:t("name",{length:100}).notNull(),displayName:t("display_name",{length:150}).notNull(),description:o("description"),priceMonthlyGbp:d("price_monthly_gbp",{precision:10,scale:2}),priceYearlyGbp:d("price_yearly_gbp",{precision:10,scale:2}),stripePriceIdMonthly:t("stripe_price_id_monthly",{length:255}),stripePriceIdYearly:t("stripe_price_id_yearly",{length:255}),features:m("features"),maxUsers:g("max_users"),maxOrdersPerMonth:g("max_orders_per_month"),aiEnabled:p("ai_enabled").default(!1),isActive:p("is_active").default(!0),createdAt:a("created_at").defaultNow().notNull()});f("stripe_payment_intents",{id:t("id",{length:255}).primaryKey(),companyId:t("company_id",{length:255}).notNull().references(()=>x.id,{onDelete:"cascade"}),amount:g("amount").notNull(),currency:t("currency",{length:3}).default("GBP"),status:t("status",{length:50}).notNull(),paymentMethod:t("payment_method",{length:255}),customerId:t("customer_id",{length:255}),subscriptionId:t("subscription_id",{length:255}),metadata:m("metadata"),createdAt:a("created_at").defaultNow().notNull()},e=>[r("idx_payment_intents_company").on(e.companyId),r("idx_payment_intents_subscription").on(e.subscriptionId)]);f("subscription_history",{id:t("id").primaryKey().default(N`gen_random_uuid()`),companyId:t("company_id",{length:255}).notNull().references(()=>x.id,{onDelete:"cascade"}),eventType:t("event_type",{length:100}).notNull(),oldPlan:t("old_plan",{length:50}),newPlan:t("new_plan",{length:50}),changedBy:t("changed_by",{length:255}).references(()=>b.id),reason:o("reason"),metadata:m("metadata"),createdAt:a("created_at").defaultNow().notNull()},e=>[r("idx_subscription_history_company").on(e.companyId),r("idx_subscription_history_event").on(e.eventType)]);f("dispense_records",{id:t("id").primaryKey().default(N`gen_random_uuid()`),orderId:t("order_id",{length:255}).notNull().references(()=>te.id,{onDelete:"cascade"}),prescriptionId:t("prescription_id",{length:255}).references(()=>we.id),companyId:t("company_id",{length:255}).notNull().references(()=>x.id,{onDelete:"cascade"}),patientId:t("patient_id",{length:255}).notNull().references(()=>F.id),dispensedByUserId:t("dispensed_by_user_id",{length:255}).notNull().references(()=>b.id),dispenserName:t("dispenser_name",{length:255}).notNull(),dispenserGocNumber:t("dispenser_goc_number",{length:50}),dispenseDate:a("dispense_date").defaultNow().notNull(),printedAt:a("printed_at"),patientSignature:o("patient_signature"),dispenserSignature:o("dispenser_signature"),specialInstructions:o("special_instructions"),aftercareProvided:p("aftercare_provided").default(!0),metadata:m("metadata"),createdAt:a("created_at").defaultNow().notNull()},e=>[r("idx_dispense_records_order").on(e.orderId),r("idx_dispense_records_company").on(e.companyId),r("idx_dispense_records_patient").on(e.patientId)]);const ol=f("company_supplier_relationships",{id:t("id").primaryKey().default(N`gen_random_uuid()`),companyId:t("company_id").notNull().references(()=>x.id,{onDelete:"cascade"}),supplierId:t("supplier_id").notNull().references(()=>x.id,{onDelete:"cascade"}),status:t("status").notNull().default("pending"),approvedBy:t("approved_by").references(()=>b.id),approvedAt:a("approved_at"),notes:o("notes"),createdAt:a("created_at").defaultNow().notNull()},e=>[r("idx_company_supplier_company").on(e.companyId),r("idx_company_supplier_supplier").on(e.supplierId)]),ll=S("ai_conversation_status",["active","resolved","archived"]),dl=S("ai_message_role",["user","assistant","system"]),pn=f("ai_conversations",{id:t("id").primaryKey().default(N`gen_random_uuid()`),companyId:t("company_id").notNull().references(()=>x.id,{onDelete:"cascade"}),userId:t("user_id").notNull().references(()=>b.id),title:o("title").notNull(),status:ll("status").notNull().default("active"),context:m("context"),createdAt:a("created_at").defaultNow().notNull(),updatedAt:a("updated_at").defaultNow().notNull()},e=>[r("idx_ai_conversations_company").on(e.companyId),r("idx_ai_conversations_user").on(e.userId)]),_n=f("ai_messages",{id:t("id").primaryKey().default(N`gen_random_uuid()`),conversationId:t("conversation_id").notNull().references(()=>pn.id,{onDelete:"cascade"}),role:dl("role").notNull(),content:o("content").notNull(),usedExternalAi:p("used_external_ai").default(!0),confidence:d("confidence",{precision:3,scale:2}),metadata:m("metadata"),createdAt:a("created_at").defaultNow().notNull()},e=>[r("idx_ai_messages_conversation").on(e.conversationId)]),cl=f("ai_knowledge_base",{id:t("id").primaryKey().default(N`gen_random_uuid()`),companyId:t("company_id").notNull().references(()=>x.id,{onDelete:"cascade"}),uploadedBy:t("uploaded_by").notNull().references(()=>b.id),filename:o("filename").notNull(),fileType:t("file_type").notNull(),fileSize:g("file_size"),fileUrl:o("file_url"),content:o("content"),summary:o("summary"),tags:m("tags"),embeddings:m("embeddings"),category:t("category"),isActive:p("is_active").default(!0),processingStatus:t("processing_status").default("pending"),createdAt:a("created_at").defaultNow().notNull(),updatedAt:a("updated_at").defaultNow().notNull()},e=>[r("idx_ai_knowledge_company").on(e.companyId),r("idx_ai_knowledge_category").on(e.category)]),ul=f("ai_learning_data",{id:t("id").primaryKey().default(N`gen_random_uuid()`),companyId:t("company_id").notNull().references(()=>x.id,{onDelete:"cascade"}),sourceType:t("source_type").notNull(),sourceId:t("source_id"),question:o("question"),answer:o("answer"),context:m("context"),category:t("category"),useCount:g("use_count").default(0),successRate:d("success_rate",{precision:3,scale:2}).default("1.00"),lastUsed:a("last_used"),confidence:d("confidence",{precision:3,scale:2}).default("0.50"),isValidated:p("is_validated").default(!1),validatedBy:t("validated_by").references(()=>b.id),validatedAt:a("validated_at"),createdAt:a("created_at").defaultNow().notNull(),updatedAt:a("updated_at").defaultNow().notNull()},e=>[r("idx_ai_learning_company").on(e.companyId),r("idx_ai_learning_category").on(e.category),r("idx_ai_learning_confidence").on(e.confidence)]),ml=f("ai_feedback",{id:t("id").primaryKey().default(N`gen_random_uuid()`),messageId:t("message_id").notNull().references(()=>_n.id,{onDelete:"cascade"}),userId:t("user_id").notNull().references(()=>b.id),companyId:t("company_id").notNull().references(()=>x.id,{onDelete:"cascade"}),rating:g("rating").notNull(),helpful:p("helpful"),accurate:p("accurate"),comments:o("comments"),createdAt:a("created_at").defaultNow().notNull()},e=>[r("idx_ai_feedback_message").on(e.messageId),r("idx_ai_feedback_company").on(e.companyId)]),Ve=f("ai_model_versions",{id:t("id").primaryKey().default(N`gen_random_uuid()`),versionNumber:t("version_number",{length:50}).notNull().unique(),modelName:t("model_name",{length:255}).notNull(),description:o("description"),status:t("status",{length:50}).notNull().default("draft"),createdBy:t("created_by").references(()=>b.id),approvedBy:t("approved_by").references(()=>b.id),approvedAt:a("approved_at"),metadata:m("metadata"),createdAt:a("created_at").defaultNow().notNull(),updatedAt:a("updated_at").defaultNow().notNull()},e=>[r("idx_ai_model_versions_status").on(e.status),r("idx_ai_model_versions_created").on(e.createdAt)]);f("ai_model_deployments",{id:t("id").primaryKey().default(N`gen_random_uuid()`),companyId:t("company_id").notNull().references(()=>x.id,{onDelete:"cascade"}),modelVersionId:t("model_version_id").notNull().references(()=>Ve.id,{onDelete:"cascade"}),versionNumber:t("version_number",{length:50}).notNull(),deploymentStatus:t("deployment_status",{length:50}).notNull().default("active"),deployedAt:a("deployed_at").defaultNow().notNull(),deactivatedAt:a("deactivated_at"),performanceMetrics:m("performance_metrics"),metadata:m("metadata")},e=>[r("idx_ai_deployments_company").on(e.companyId),r("idx_ai_deployments_version").on(e.modelVersionId),r("idx_ai_deployments_status").on(e.deploymentStatus)]);const pl=f("master_training_datasets",{id:t("id").primaryKey().default(N`gen_random_uuid()`),modelVersionId:t("model_version_id").references(()=>Ve.id),category:t("category",{length:100}).notNull(),title:t("title",{length:500}).notNull(),content:o("content").notNull(),contentType:t("content_type",{length:100}).notNull(),source:o("source"),qualityScore:d("quality_score",{precision:3,scale:2}),tags:m("tags"),status:t("status",{length:50}).notNull().default("pending"),createdBy:t("created_by").references(()=>b.id),approvedBy:t("approved_by").references(()=>b.id),approvedAt:a("approved_at"),metadata:m("metadata"),createdAt:a("created_at").defaultNow().notNull(),updatedAt:a("updated_at").defaultNow().notNull()},e=>[r("idx_master_training_category").on(e.category),r("idx_master_training_status").on(e.status),r("idx_master_training_version").on(e.modelVersionId)]);f("training_data_analytics",{id:t("id").primaryKey().default(N`gen_random_uuid()`),datasetId:t("dataset_id").notNull().references(()=>pl.id,{onDelete:"cascade"}),modelVersionId:t("model_version_id").notNull().references(()=>Ve.id,{onDelete:"cascade"}),usageCount:g("usage_count").default(0),successRate:d("success_rate",{precision:5,scale:2}),avgConfidence:d("avg_confidence",{precision:5,scale:2}),feedbackScore:d("feedback_score",{precision:5,scale:2}),improvementMetrics:m("improvement_metrics"),recordedAt:a("recorded_at").defaultNow().notNull()},e=>[r("idx_training_analytics_dataset").on(e.datasetId),r("idx_training_analytics_version").on(e.modelVersionId)]);f("company_ai_settings",{id:t("id").primaryKey().default(N`gen_random_uuid()`),companyId:t("company_id").notNull().unique().references(()=>x.id,{onDelete:"cascade"}),currentModelVersion:t("current_model_version",{length:50}),autoUpdateEnabled:p("auto_update_enabled").default(!0),customTrainingEnabled:p("custom_training_enabled").default(!1),dataRetentionDays:g("data_retention_days").default(90),lastTrainingSync:a("last_training_sync"),aiPreferences:m("ai_preferences"),createdAt:a("created_at").defaultNow().notNull(),updatedAt:a("updated_at").defaultNow().notNull()},e=>[r("idx_company_ai_settings_company").on(e.companyId)]);f("ai_training_jobs",{id:t("id").primaryKey().default(N`gen_random_uuid()`),modelVersionId:t("model_version_id").notNull().references(()=>Ve.id,{onDelete:"cascade"}),jobType:t("job_type",{length:50}).notNull(),status:t("status",{length:50}).notNull().default("queued"),startedAt:a("started_at"),completedAt:a("completed_at"),trainingDatasetIds:m("training_dataset_ids"),trainingMetrics:m("training_metrics"),errorLog:m("error_log"),createdBy:t("created_by").references(()=>b.id),createdAt:a("created_at").defaultNow().notNull()},e=>[r("idx_ai_training_jobs_version").on(e.modelVersionId),r("idx_ai_training_jobs_status").on(e.status)]);f("ai_deployment_queue",{id:t("id").primaryKey().default(N`gen_random_uuid()`),modelVersionId:t("model_version_id").notNull().references(()=>Ve.id,{onDelete:"cascade"}),companyIds:m("company_ids"),deploymentType:t("deployment_type",{length:50}).notNull(),scheduledAt:a("scheduled_at"),status:t("status",{length:50}).notNull().default("pending"),priority:g("priority").default(5),companiesDeployed:g("companies_deployed").default(0),companiesFailed:g("companies_failed").default(0),processedAt:a("processed_at"),errorLog:m("error_log"),createdBy:t("created_by").references(()=>b.id),createdAt:a("created_at").defaultNow().notNull(),updatedAt:a("updated_at").defaultNow().notNull()},e=>[r("idx_ai_deployment_queue_version").on(e.modelVersionId),r("idx_ai_deployment_queue_status").on(e.status),r("idx_ai_deployment_queue_scheduled").on(e.scheduledAt)]);const b=f("users",{id:t("id").primaryKey().default(N`gen_random_uuid()`),companyId:t("company_id").references(()=>x.id,{onDelete:"cascade"}),accountStatus:Ko("account_status").notNull().default("pending"),statusReason:o("status_reason"),organizationId:t("organization_id"),organizationName:o("organization_name"),email:t("email").unique(),password:t("password"),firstName:t("first_name"),lastName:t("last_name"),profileImageUrl:t("profile_image_url"),role:Ee("role"),enhancedRole:Ee("enhanced_role"),subscriptionPlan:dn("subscription_plan").notNull().default("full"),gocNumber:t("goc_number"),accountNumber:t("account_number"),contactEmail:t("contact_email"),contactPhone:t("contact_phone"),address:m("address"),isActive:p("is_active").default(!0),isVerified:p("is_verified").default(!1),lastLoginAt:a("last_login_at"),gocRegistrationNumber:t("goc_registration_number",{length:50}),gocRegistrationType:t("goc_registration_type",{length:50}),professionalQualifications:t("professional_qualifications",{length:255}),gocRegistrationExpiry:a("goc_registration_expiry"),indemnityInsuranceProvider:t("indemnity_insurance_provider",{length:255}),indemnityPolicyNumber:t("indemnity_policy_number",{length:100}),indemnityExpiryDate:a("indemnity_expiry_date"),cpdCompleted:p("cpd_completed").default(!0),cpdLastUpdated:a("cpd_last_updated"),signatureImage:o("signature_image"),canPrescribe:p("can_prescribe").default(!0),canDispense:p("can_dispense").default(!0),createdAt:a("created_at").defaultNow().notNull(),updatedAt:a("updated_at").defaultNow().notNull()});f("user_roles",{id:t("id").primaryKey().default(N`gen_random_uuid()`),userId:t("user_id").notNull().references(()=>b.id,{onDelete:"cascade"}),role:Ee("role").notNull(),assignedAt:a("assigned_at").defaultNow().notNull()},e=>[r("idx_user_roles_user_id").on(e.userId)]);const Ce=f("permissions",{id:t("id").primaryKey().default(N`gen_random_uuid()`),permissionKey:t("permission_key").notNull().unique(),permissionName:t("permission_name").notNull(),category:t("category").notNull(),description:o("description"),createdAt:a("created_at").defaultNow().notNull()},e=>[r("idx_permissions_category").on(e.category)]),_l=f("role_permissions",{id:t("id").primaryKey().default(N`gen_random_uuid()`),companyId:t("company_id").notNull().references(()=>x.id,{onDelete:"cascade"}),role:Ee("role").notNull(),permissionId:t("permission_id").notNull().references(()=>Ce.id,{onDelete:"cascade"}),createdAt:a("created_at").defaultNow().notNull()},e=>[r("idx_role_permissions_company").on(e.companyId),r("idx_role_permissions_role").on(e.role)]),fl=f("user_custom_permissions",{id:t("id").primaryKey().default(N`gen_random_uuid()`),userId:t("user_id").notNull().references(()=>b.id,{onDelete:"cascade"}),permissionId:t("permission_id").notNull().references(()=>Ce.id,{onDelete:"cascade"}),granted:p("granted").notNull().default(!0),createdAt:a("created_at").defaultNow().notNull(),createdBy:t("created_by").references(()=>b.id)},e=>[r("idx_user_custom_permissions_user").on(e.userId)]),ze=f("dynamic_roles",{id:t("id").primaryKey().default(N`gen_random_uuid()`),companyId:t("company_id").notNull().references(()=>x.id,{onDelete:"cascade"}),name:t("name",{length:100}).notNull(),description:o("description"),isSystemDefault:p("is_system_default").notNull().default(!1),isDeletable:p("is_deletable").notNull().default(!0),createdAt:a("created_at").defaultNow().notNull(),updatedAt:a("updated_at").defaultNow().notNull(),createdBy:t("created_by").references(()=>b.id)},e=>[r("idx_dynamic_roles_company").on(e.companyId),r("idx_dynamic_roles_name").on(e.name),r("idx_dynamic_roles_system_default").on(e.isSystemDefault),Se("unique_role_per_company").on(e.companyId,e.name)]),gl=f("dynamic_role_permissions",{id:t("id").primaryKey().default(N`gen_random_uuid()`),roleId:t("role_id").notNull().references(()=>ze.id,{onDelete:"cascade"}),permissionId:t("permission_id").notNull().references(()=>Ce.id,{onDelete:"cascade"}),createdAt:a("created_at").defaultNow().notNull(),grantedBy:t("granted_by").references(()=>b.id)},e=>[r("idx_dynamic_role_permissions_role").on(e.roleId),r("idx_dynamic_role_permissions_permission").on(e.permissionId),Se("unique_role_permission").on(e.roleId,e.permissionId)]),hl=f("user_dynamic_roles",{id:t("id").primaryKey().default(N`gen_random_uuid()`),userId:t("user_id").notNull().references(()=>b.id,{onDelete:"cascade"}),roleId:t("role_id").notNull().references(()=>ze.id,{onDelete:"cascade"}),isPrimary:p("is_primary").notNull().default(!1),assignedAt:a("assigned_at").defaultNow().notNull(),assignedBy:t("assigned_by").references(()=>b.id)},e=>[r("idx_user_dynamic_roles_user").on(e.userId),r("idx_user_dynamic_roles_role").on(e.roleId),r("idx_user_dynamic_roles_primary").on(e.isPrimary),Se("unique_user_role").on(e.userId,e.roleId)]),Nl=f("role_change_audit",{id:t("id").primaryKey().default(N`gen_random_uuid()`),companyId:t("company_id").notNull().references(()=>x.id,{onDelete:"cascade"}),changedBy:t("changed_by").references(()=>b.id),changedAt:a("changed_at").defaultNow().notNull(),actionType:t("action_type",{length:50}).notNull(),roleId:t("role_id").references(()=>ze.id,{onDelete:"set null"}),permissionId:t("permission_id").references(()=>Ce.id,{onDelete:"set null"}),details:m("details"),ipAddress:t("ip_address",{length:45}),userAgent:o("user_agent")},e=>[r("idx_role_change_audit_company").on(e.companyId),r("idx_role_change_audit_changed_by").on(e.changedBy),r("idx_role_change_audit_role").on(e.roleId),r("idx_role_change_audit_timestamp").on(e.changedAt),r("idx_role_change_audit_action").on(e.actionType)]),yl=S("audit_event_type",["access","create","read","update","delete","login","logout","auth_attempt","permission_change","export","print"]),bl=f("audit_logs",{id:t("id").primaryKey().default(N`gen_random_uuid()`),timestamp:a("timestamp").notNull().defaultNow(),userId:t("user_id").references(()=>b.id),userEmail:t("user_email"),userRole:Ee("user_role"),companyId:t("company_id").references(()=>x.id,{onDelete:"cascade"}),eventType:yl("event_type").notNull(),resourceType:t("resource_type").notNull(),resourceId:t("resource_id"),action:o("action").notNull(),ipAddress:t("ip_address"),userAgent:o("user_agent"),endpoint:t("endpoint"),method:t("method",{length:10}),statusCode:g("status_code"),success:p("success").notNull(),errorMessage:o("error_message"),changesBefore:m("changes_before"),changesAfter:m("changes_after"),metadata:m("metadata"),phiAccessed:p("phi_accessed").default(!1),phiFields:m("phi_fields"),justification:o("justification"),retentionDate:a("retention_date")},e=>[r("idx_audit_logs_user").on(e.userId),r("idx_audit_logs_company").on(e.companyId),r("idx_audit_logs_timestamp").on(e.timestamp),r("idx_audit_logs_resource").on(e.resourceType,e.resourceId),r("idx_audit_logs_phi").on(e.phiAccessed),r("idx_audit_logs_event_type").on(e.eventType),r("idx_audit_logs_retention").on(e.retentionDate)]),F=f("patients",{id:t("id").primaryKey().default(N`gen_random_uuid()`),customerNumber:t("customer_number",{length:20}).notNull().unique(),companyId:t("company_id").notNull().references(()=>x.id,{onDelete:"cascade"}),name:o("name").notNull(),dateOfBirth:o("date_of_birth"),email:t("email"),phone:t("phone",{length:50}),mobilePhone:t("mobile_phone",{length:50}),workPhone:t("work_phone",{length:50}),nhsNumber:t("nhs_number"),customerReferenceLabel:o("customer_reference_label"),customerReferenceNumber:o("customer_reference_number"),fullAddress:m("full_address"),addressLine1:t("address_line_1",{length:255}),addressLine2:t("address_line_2",{length:255}),city:t("city",{length:100}),county:t("county",{length:100}),postcode:t("postcode",{length:20}),country:t("country",{length:100}).default("United Kingdom"),timezone:t("timezone",{length:100}),timezoneOffset:g("timezone_offset"),locale:t("locale",{length:20}).default("en-GB"),ecpId:t("ecp_id").notNull().references(()=>b.id),previousOptician:t("previous_optician",{length:255}),gpName:t("gp_name",{length:255}),gpPractice:t("gp_practice",{length:255}),gpAddress:o("gp_address"),gpPhone:t("gp_phone",{length:50}),emergencyContactName:t("emergency_contact_name",{length:255}),emergencyContactPhone:t("emergency_contact_phone",{length:50}),emergencyContactRelationship:t("emergency_contact_relationship",{length:100}),emergencyContactEmail:t("emergency_contact_email",{length:255}),medicalHistory:m("medical_history"),currentMedications:o("current_medications"),allergies:o("allergies"),familyOcularHistory:o("family_ocular_history"),systemicConditions:m("systemic_conditions"),occupation:t("occupation",{length:255}),hobbies:o("hobbies"),vduUser:p("vdu_user").default(!1),vduHoursPerDay:d("vdu_hours_per_day",{precision:4,scale:1}),drivingRequirement:p("driving_requirement").default(!1),sportActivities:o("sport_activities"),readingHabits:o("reading_habits"),contactLensWearer:p("contact_lens_wearer").default(!1),contactLensType:t("contact_lens_type",{length:100}),contactLensBrand:t("contact_lens_brand",{length:100}),contactLensCompliance:t("contact_lens_compliance",{length:50}),preferredContactMethod:t("preferred_contact_method",{length:50}),preferredAppointmentTime:t("preferred_appointment_time",{length:50}),reminderPreference:t("reminder_preference",{length:50}),marketingConsent:p("marketing_consent").default(!1),dataSharingConsent:p("data_sharing_consent").default(!0),thirdPartyConsent:p("third_party_consent").default(!1),researchConsent:p("research_consent").default(!1),lastExaminationDate:a("last_examination_date"),nextExaminationDue:a("next_examination_due"),recallSchedule:t("recall_schedule",{length:50}),insuranceProvider:t("insurance_provider",{length:255}),insurancePolicyNumber:t("insurance_policy_number",{length:100}),nhsExemption:p("nhs_exemption").default(!1),nhsExemptionType:t("nhs_exemption_type",{length:100}),status:t("status",{length:50}).default("active"),vipPatient:p("vip_patient").default(!1),patientNotes:o("patient_notes"),internalNotes:o("internal_notes"),createdAt:a("created_at").defaultNow().notNull(),updatedAt:a("updated_at").defaultNow().notNull(),createdBy:t("created_by",{length:255}),updatedBy:t("updated_by",{length:255}),changeHistory:m("change_history").default(N`'[]'::jsonb`)}),te=f("orders",{id:t("id").primaryKey().default(N`gen_random_uuid()`),orderNumber:o("order_number").notNull().unique(),companyId:t("company_id").notNull().references(()=>x.id,{onDelete:"cascade"}),patientId:t("patient_id").notNull().references(()=>F.id),ecpId:t("ecp_id").notNull().references(()=>b.id),status:zo("status").notNull().default("pending"),odSphere:o("od_sphere"),odCylinder:o("od_cylinder"),odAxis:o("od_axis"),odAdd:o("od_add"),osSphere:o("os_sphere"),osCylinder:o("os_cylinder"),osAxis:o("os_axis"),osAdd:o("os_add"),pd:o("pd"),lensType:o("lens_type").notNull(),lensMaterial:o("lens_material").notNull(),coating:o("coating").notNull(),frameType:o("frame_type"),notes:o("notes"),traceFileUrl:o("trace_file_url"),trackingNumber:o("tracking_number"),shippedAt:a("shipped_at"),customerReferenceLabel:o("customer_reference_label"),customerReferenceNumber:o("customer_reference_number"),omaFileContent:o("oma_file_content"),omaFilename:o("oma_filename"),omaParsedData:m("oma_parsed_data"),jobId:t("job_id"),jobStatus:t("job_status"),sentToLabAt:a("sent_to_lab_at"),jobErrorMessage:o("job_error_message"),pdfUrl:o("pdf_url"),pdfErrorMessage:o("pdf_error_message"),analyticsErrorMessage:o("analytics_error_message"),orderDate:a("order_date").defaultNow().notNull(),dueDate:a("due_date"),completedAt:a("completed_at"),createdBy:t("created_by",{length:255}),updatedBy:t("updated_by",{length:255}),changeHistory:m("change_history").default(N`'[]'::jsonb`)}),xl=f("consult_logs",{id:t("id").primaryKey().default(N`gen_random_uuid()`),companyId:t("company_id").notNull().references(()=>x.id,{onDelete:"cascade"}),orderId:t("order_id").notNull().references(()=>te.id),ecpId:t("ecp_id").notNull().references(()=>b.id),priority:Xo("priority").notNull().default("normal"),subject:o("subject").notNull(),description:o("description").notNull(),status:o("status").notNull().default("open"),labResponse:o("lab_response"),createdAt:a("created_at").defaultNow().notNull(),respondedAt:a("responded_at")}),Dl=S("patient_activity_type",["profile_created","profile_updated","examination_scheduled","examination_completed","prescription_issued","order_placed","order_updated","order_completed","contact_lens_fitted","recall_sent","appointment_booked","appointment_cancelled","payment_received","refund_issued","complaint_logged","complaint_resolved","consent_updated","document_uploaded","note_added","referral_made","communication_sent"]),vl=f("patient_activity_log",{id:t("id").primaryKey().default(N`gen_random_uuid()`),companyId:t("company_id").notNull().references(()=>x.id,{onDelete:"cascade"}),patientId:t("patient_id").notNull().references(()=>F.id,{onDelete:"cascade"}),activityType:Dl("activity_type").notNull(),orderId:t("order_id").references(()=>te.id),examinationId:t("examination_id").references(()=>je.id),prescriptionId:t("prescription_id").references(()=>we.id),activityTitle:t("activity_title",{length:255}).notNull(),activityDescription:o("activity_description"),activityData:m("activity_data"),changesBefore:m("changes_before"),changesAfter:m("changes_after"),changedFields:m("changed_fields"),performedBy:t("performed_by",{length:255}).notNull(),performedByName:t("performed_by_name",{length:255}),performedByRole:t("performed_by_role",{length:100}),ipAddress:t("ip_address",{length:50}),userAgent:o("user_agent"),source:t("source",{length:100}).default("web"),createdAt:a("created_at").defaultNow().notNull()},e=>[r("idx_patient_activity_patient").on(e.patientId),r("idx_patient_activity_type").on(e.activityType),r("idx_patient_activity_date").on(e.createdAt),r("idx_patient_activity_company").on(e.companyId)]),Tt=f("purchase_orders",{id:t("id").primaryKey().default(N`gen_random_uuid()`),poNumber:o("po_number").notNull().unique(),companyId:t("company_id").notNull().references(()=>x.id,{onDelete:"cascade"}),supplierId:t("supplier_id").notNull().references(()=>b.id),createdById:t("created_by_id").notNull().references(()=>b.id),status:Zo("status").notNull().default("draft"),totalAmount:d("total_amount",{precision:10,scale:2}),notes:o("notes"),expectedDeliveryDate:a("expected_delivery_date"),actualDeliveryDate:a("actual_delivery_date"),trackingNumber:o("tracking_number"),createdAt:a("created_at").defaultNow().notNull(),updatedAt:a("updated_at").defaultNow().notNull()}),Il=f("po_line_items",{id:t("id").primaryKey().default(N`gen_random_uuid()`),purchaseOrderId:t("purchase_order_id").notNull().references(()=>Tt.id),itemName:o("item_name").notNull(),description:o("description"),quantity:g("quantity").notNull(),unitPrice:d("unit_price",{precision:10,scale:2}).notNull(),totalPrice:d("total_price",{precision:10,scale:2}).notNull(),createdAt:a("created_at").defaultNow().notNull()}),Sl=f("technical_documents",{id:t("id").primaryKey().default(N`gen_random_uuid()`),supplierId:t("supplier_id").notNull().references(()=>b.id),documentType:Wo("document_type").notNull(),title:o("title").notNull(),description:o("description"),fileUrl:o("file_url").notNull(),fileName:o("file_name").notNull(),fileSize:g("file_size"),materialName:o("material_name"),uploadedAt:a("uploaded_at").defaultNow().notNull()}),wl=f("organization_settings",{id:t("id").primaryKey().default(N`gen_random_uuid()`),companyName:o("company_name"),logoUrl:o("logo_url"),contactEmail:o("contact_email"),contactPhone:o("contact_phone"),address:m("address"),orderNumberPrefix:o("order_number_prefix").default("ORD"),defaultLeadTimeDays:g("default_lead_time_days").default(7),enableEmailNotifications:m("enable_email_notifications").default(N`'{"orderReceived": true, "orderShipped": true, "poCreated": true}'::jsonb`),businessHours:m("business_hours"),updatedAt:a("updated_at").defaultNow().notNull(),updatedById:t("updated_by_id").references(()=>b.id)}),Tl=f("user_preferences",{id:t("id").primaryKey().default(N`gen_random_uuid()`),userId:t("user_id").notNull().unique().references(()=>b.id),theme:o("theme").default("light"),language:o("language").default("en"),emailNotifications:m("email_notifications").default(N`'{"orderUpdates": true, "systemAlerts": true}'::jsonb`),dashboardLayout:m("dashboard_layout"),updatedAt:a("updated_at").defaultNow().notNull()}),je=f("eye_examinations",{id:t("id").primaryKey().default(N`gen_random_uuid()`),companyId:t("company_id").notNull().references(()=>x.id,{onDelete:"cascade"}),patientId:t("patient_id").notNull().references(()=>F.id),ecpId:t("ecp_id").notNull().references(()=>b.id),examinationDate:a("examination_date").defaultNow().notNull(),status:Jo("status").notNull().default("in_progress"),reasonForVisit:o("reason_for_visit"),medicalHistory:m("medical_history"),visualAcuity:m("visual_acuity"),refraction:m("refraction"),binocularVision:m("binocular_vision"),eyeHealth:m("eye_health"),equipmentReadings:m("equipment_readings"),generalHistory:m("general_history"),currentRx:m("current_rx"),newRx:m("new_rx"),ophthalmoscopy:m("ophthalmoscopy"),slitLamp:m("slit_lamp"),additionalTests:m("additional_tests"),tonometry:m("tonometry"),eyeSketch:m("eye_sketch"),images:m("images"),summary:m("summary"),finalized:p("finalized").default(!1),gosFormType:o("gos_form_type"),nhsVoucherCode:o("nhs_voucher_code"),notes:o("notes"),createdAt:a("created_at").defaultNow().notNull(),updatedAt:a("updated_at").defaultNow().notNull()}),we=f("prescriptions",{id:t("id").primaryKey().default(N`gen_random_uuid()`),companyId:t("company_id").notNull().references(()=>x.id,{onDelete:"cascade"}),examinationId:t("examination_id").references(()=>je.id),patientId:t("patient_id").notNull().references(()=>F.id),ecpId:t("ecp_id").notNull().references(()=>b.id),issueDate:a("issue_date").defaultNow().notNull(),expiryDate:a("expiry_date"),odSphere:o("od_sphere"),odCylinder:o("od_cylinder"),odAxis:o("od_axis"),odAdd:o("od_add"),osSphere:o("os_sphere"),osCylinder:o("os_cylinder"),osAxis:o("os_axis"),osAdd:o("os_add"),pd:o("pd"),pdRight:d("pd_right",{precision:4,scale:1}),pdLeft:d("pd_left",{precision:4,scale:1}),binocularPd:d("binocular_pd",{precision:4,scale:1}),nearPd:d("near_pd",{precision:4,scale:1}),odPrismHorizontal:d("od_prism_horizontal",{precision:4,scale:2}),odPrismVertical:d("od_prism_vertical",{precision:4,scale:2}),odPrismBase:t("od_prism_base",{length:20}),osPrismHorizontal:d("os_prism_horizontal",{precision:4,scale:2}),osPrismVertical:d("os_prism_vertical",{precision:4,scale:2}),osPrismBase:t("os_prism_base",{length:20}),backVertexDistance:d("back_vertex_distance",{precision:4,scale:1}),prescriptionType:t("prescription_type",{length:50}),dispensingNotes:o("dispensing_notes"),gocCompliant:p("goc_compliant").default(!0).notNull(),prescriberGocNumber:t("prescriber_goc_number",{length:50}),testRoomName:t("test_room_name",{length:100}),prescriberName:t("prescriber_name",{length:255}),prescriberQualifications:t("prescriber_qualifications",{length:255}),prescriberGocType:t("prescriber_goc_type",{length:50}),odVisualAcuityUnaided:t("od_visual_acuity_unaided",{length:20}),odVisualAcuityAided:t("od_visual_acuity_aided",{length:20}),odVisualAcuityPinhole:t("od_visual_acuity_pinhole",{length:20}),osVisualAcuityUnaided:t("os_visual_acuity_unaided",{length:20}),osVisualAcuityAided:t("os_visual_acuity_aided",{length:20}),osVisualAcuityPinhole:t("os_visual_acuity_pinhole",{length:20}),binocularVisualAcuity:t("binocular_visual_acuity",{length:20}),odNearVision:t("od_near_vision",{length:20}),osNearVision:t("os_near_vision",{length:20}),binocularNearVision:t("binocular_near_vision",{length:20}),odIntermediateAdd:d("od_intermediate_add",{precision:4,scale:2}),osIntermediateAdd:d("os_intermediate_add",{precision:4,scale:2}),odKReading1:d("od_k_reading_1",{precision:5,scale:2}),odKReading2:d("od_k_reading_2",{precision:5,scale:2}),odKAxis:g("od_k_axis"),osKReading1:d("os_k_reading_1",{precision:5,scale:2}),osKReading2:d("os_k_reading_2",{precision:5,scale:2}),osKAxis:g("os_k_axis"),intraocularPressureOd:t("intraocular_pressure_od",{length:20}),intraocularPressureOs:t("intraocular_pressure_os",{length:20}),ocularHealthNotes:o("ocular_health_notes"),clinicalRecommendations:o("clinical_recommendations"),followUpRequired:p("follow_up_required").default(!1),followUpDate:a("follow_up_date"),followUpReason:o("follow_up_reason"),recommendedLensType:t("recommended_lens_type",{length:100}),recommendedLensMaterial:t("recommended_lens_material",{length:100}),recommendedCoatings:o("recommended_coatings"),frameRecommendations:o("frame_recommendations"),specialInstructions:o("special_instructions"),usagePurpose:t("usage_purpose",{length:100}),wearTime:t("wear_time",{length:100}),drivingSuitable:p("driving_suitable").default(!0),dvlaNotified:p("dvla_notified").default(!1),verifiedByEcpId:t("verified_by_ecp_id").references(()=>b.id),verifiedAt:a("verified_at"),verificationNotes:o("verification_notes"),recordRetentionDate:a("record_retention_date"),referralMade:p("referral_made").default(!1),referralTo:t("referral_to",{length:255}),referralReason:o("referral_reason"),examinationDurationMinutes:g("examination_duration_minutes"),examinationType:t("examination_type",{length:50}),patientComplaint:o("patient_complaint"),previousPrescriptionId:t("previous_prescription_id"),isSigned:p("is_signed").default(!1).notNull(),signedByEcpId:t("signed_by_ecp_id").references(()=>b.id),digitalSignature:o("digital_signature"),signedAt:a("signed_at"),createdAt:a("created_at").defaultNow().notNull(),createdBy:t("created_by",{length:255}),updatedBy:t("updated_by",{length:255}),changeHistory:m("change_history").default(N`'[]'::jsonb`)},e=>[r("idx_prescriptions_test_room").on(e.testRoomName),r("idx_prescriptions_goc_number").on(e.prescriberGocNumber),r("idx_prescriptions_follow_up").on(e.followUpDate),r("idx_prescriptions_retention").on(e.recordRetentionDate),r("idx_prescriptions_verified").on(e.verifiedByEcpId)]),Pt=f("test_rooms",{id:t("id").primaryKey().default(N`gen_random_uuid()`),companyId:t("company_id").notNull().references(()=>x.id,{onDelete:"cascade"}),roomName:t("room_name",{length:100}).notNull(),roomCode:t("room_code",{length:20}),locationDescription:o("location_description"),equipmentList:o("equipment_list"),capacity:g("capacity").default(1),floorLevel:t("floor_level",{length:50}),accessibility:p("accessibility").default(!0),currentStatus:t("current_status",{length:50}).default("available"),lastMaintenanceDate:a("last_maintenance_date"),nextMaintenanceDate:a("next_maintenance_date"),equipmentDetails:m("equipment_details"),allowRemoteAccess:p("allow_remote_access").default(!1),locationId:t("location_id"),isActive:p("is_active").default(!0),displayOrder:g("display_order").default(0),createdAt:a("created_at").defaultNow().notNull(),updatedAt:a("updated_at").defaultNow().notNull()},e=>[r("idx_test_rooms_company").on(e.companyId),r("idx_test_rooms_active").on(e.isActive),r("idx_test_rooms_status").on(e.currentStatus),r("idx_test_rooms_location").on(e.locationId)]),Pl=f("test_room_bookings",{id:t("id").primaryKey().default(N`gen_random_uuid()`),testRoomId:t("test_room_id").notNull().references(()=>Pt.id,{onDelete:"cascade"}),patientId:t("patient_id").references(()=>F.id,{onDelete:"set null"}),userId:t("user_id").notNull().references(()=>b.id),bookingDate:a("booking_date").notNull(),startTime:a("start_time").notNull(),endTime:a("end_time").notNull(),appointmentType:t("appointment_type",{length:100}),status:t("status",{length:50}).default("scheduled"),notes:o("notes"),isRemoteSession:p("is_remote_session").default(!1),remoteAccessUrl:o("remote_access_url"),createdAt:a("created_at").defaultNow().notNull(),updatedAt:a("updated_at").defaultNow().notNull()},e=>[r("idx_bookings_test_room").on(e.testRoomId),r("idx_bookings_date").on(e.bookingDate),r("idx_bookings_status").on(e.status),r("idx_bookings_user").on(e.userId)]);f("calibration_records",{id:t("id").primaryKey().default(N`gen_random_uuid()`),equipmentId:t("equipment_id").notNull().references(()=>mn.id,{onDelete:"cascade"}),calibrationDate:a("calibration_date").notNull(),performedBy:t("performed_by",{length:200}).notNull(),certificateNumber:t("certificate_number",{length:100}),nextDueDate:a("next_due_date").notNull(),results:o("results"),passed:p("passed").notNull(),createdAt:a("created_at").defaultNow().notNull()},e=>[r("idx_calibration_equipment").on(e.equipmentId),r("idx_calibration_date").on(e.calibrationDate)]);f("remote_sessions",{id:t("id").primaryKey().default(N`gen_random_uuid()`),companyId:t("company_id").notNull().references(()=>x.id,{onDelete:"cascade"}),patientId:t("patient_id").notNull().references(()=>F.id,{onDelete:"cascade"}),prescriptionId:t("prescription_id").references(()=>we.id,{onDelete:"cascade"}),accessToken:t("access_token",{length:255}).unique().notNull(),requestedBy:t("requested_by").notNull().references(()=>b.id),expiresAt:a("expires_at").notNull(),status:t("status",{length:50}).default("pending"),approvedBy:t("approved_by").references(()=>b.id),approvedAt:a("approved_at"),revokedAt:a("revoked_at"),createdAt:a("created_at").defaultNow().notNull(),updatedAt:a("updated_at").defaultNow().notNull()},e=>[r("idx_remote_sessions_company").on(e.companyId),r("idx_remote_sessions_patient").on(e.patientId),r("idx_remote_sessions_token").on(e.accessToken),r("idx_remote_sessions_status").on(e.status),r("idx_remote_sessions_expires").on(e.expiresAt)]);const Al=f("goc_compliance_checks",{id:t("id").primaryKey().default(N`gen_random_uuid()`),companyId:t("company_id").notNull().references(()=>x.id,{onDelete:"cascade"}),userId:t("user_id").references(()=>b.id),checkType:t("check_type",{length:100}).notNull(),checkDate:a("check_date").defaultNow().notNull(),status:t("status",{length:50}).notNull(),details:o("details"),actionRequired:o("action_required"),resolvedAt:a("resolved_at"),resolvedBy:t("resolved_by").references(()=>b.id),createdAt:a("created_at").defaultNow().notNull()},e=>[r("idx_goc_compliance_company").on(e.companyId),r("idx_goc_compliance_status").on(e.status),r("idx_goc_compliance_date").on(e.checkDate)]),El=f("prescription_templates",{id:t("id").primaryKey().default(N`gen_random_uuid()`),companyId:t("company_id").notNull().references(()=>x.id,{onDelete:"cascade"}),createdBy:t("created_by").notNull().references(()=>b.id),templateName:t("template_name",{length:150}).notNull(),templateDescription:o("template_description"),prescriptionType:t("prescription_type",{length:50}),defaultValues:m("default_values").notNull(),usageCount:g("usage_count").default(0),isActive:p("is_active").default(!0),createdAt:a("created_at").defaultNow().notNull(),updatedAt:a("updated_at").defaultNow().notNull()},e=>[r("idx_prescription_templates_company").on(e.companyId)]),kl=f("clinical_protocols",{id:t("id").primaryKey().default(N`gen_random_uuid()`),companyId:t("company_id").notNull().references(()=>x.id,{onDelete:"cascade"}),protocolName:t("protocol_name",{length:255}).notNull(),protocolType:t("protocol_type",{length:100}),description:o("description"),protocolSteps:m("protocol_steps"),complianceNotes:o("compliance_notes"),isMandatory:p("is_mandatory").default(!1),createdBy:t("created_by").notNull().references(()=>b.id),createdAt:a("created_at").defaultNow().notNull(),updatedAt:a("updated_at").defaultNow().notNull()},e=>[r("idx_clinical_protocols_company").on(e.companyId)]),ne=f("products",{id:t("id").primaryKey().default(N`gen_random_uuid()`),companyId:t("company_id").notNull().references(()=>x.id,{onDelete:"cascade"}),ecpId:t("ecp_id").notNull().references(()=>b.id),productType:nl("product_type").notNull(),sku:o("sku"),brand:o("brand"),model:o("model"),name:o("name"),description:o("description"),category:o("category"),barcode:o("barcode"),imageUrl:o("image_url"),colorOptions:m("color_options").$type(),cost:d("cost",{precision:10,scale:2}),stockQuantity:g("stock_quantity").default(0).notNull(),lowStockThreshold:g("low_stock_threshold").default(10),unitPrice:d("unit_price",{precision:10,scale:2}).notNull(),taxRate:d("tax_rate",{precision:5,scale:2}).default("0"),isActive:p("is_active").default(!0),isPrescriptionRequired:p("is_prescription_required").default(!1),shopifyProductId:t("shopify_product_id"),shopifyVariantId:t("shopify_variant_id"),shopifyInventoryItemId:t("shopify_inventory_item_id"),lastShopifySync:a("last_shopify_sync"),createdAt:a("created_at").defaultNow().notNull(),updatedAt:a("updated_at").defaultNow().notNull()},e=>[r("idx_products_company_barcode").on(e.companyId,e.barcode),r("idx_products_category").on(e.category)]),fn=f("invoices",{id:t("id").primaryKey().default(N`gen_random_uuid()`),invoiceNumber:o("invoice_number").notNull().unique(),companyId:t("company_id").notNull().references(()=>x.id,{onDelete:"cascade"}),patientId:t("patient_id").references(()=>F.id),ecpId:t("ecp_id").notNull().references(()=>b.id),status:el("status").notNull().default("draft"),paymentMethod:tl("payment_method"),totalAmount:d("total_amount",{precision:10,scale:2}).notNull(),amountPaid:d("amount_paid",{precision:10,scale:2}).default("0").notNull(),invoiceDate:a("invoice_date").defaultNow().notNull(),createdAt:a("created_at").defaultNow().notNull(),updatedAt:a("updated_at").defaultNow().notNull()}),Ll=f("invoice_line_items",{id:t("id").primaryKey().default(N`gen_random_uuid()`),invoiceId:t("invoice_id").notNull().references(()=>fn.id),productId:t("product_id").references(()=>ne.id),description:o("description").notNull(),quantity:g("quantity").notNull(),unitPrice:d("unit_price",{precision:10,scale:2}).notNull(),totalPrice:d("total_price",{precision:10,scale:2}).notNull(),createdAt:a("created_at").defaultNow().notNull()}),Ul=S("adapt_alert_severity",["info","warning","critical"]);f("rx_frame_lens_analytics",{id:t("id").primaryKey().default(N`gen_random_uuid()`),lensType:o("lens_type").notNull(),lensMaterial:o("lens_material").notNull(),frameType:o("frame_type").notNull(),totalOrders:g("total_orders").default(0).notNull(),nonAdaptCount:g("non_adapt_count").default(0).notNull(),nonAdaptRate:d("non_adapt_rate",{precision:5,scale:4}).default("0").notNull(),remakeRate:d("remake_rate",{precision:5,scale:4}).default("0").notNull(),averageRemakeDays:d("average_remake_days",{precision:8,scale:2}).default("0"),historicalDataPoints:m("historical_data_points").default("[]"),lastUpdated:a("last_updated").defaultNow().notNull(),metadata:m("metadata")});f("prescription_alerts",{id:t("id").primaryKey().default(N`gen_random_uuid()`),orderId:t("order_id").references(()=>te.id).notNull(),ecpId:t("ecp_id").references(()=>b.id).notNull(),severity:Ul("severity").notNull(),alertType:o("alert_type").notNull(),riskScore:d("risk_score",{precision:5,scale:4}).notNull(),historicalNonAdaptRate:d("historical_non_adapt_rate",{precision:5,scale:4}),recommendedLensType:o("recommended_lens_type"),recommendedMaterial:o("recommended_material"),recommendedCoating:o("recommended_coating"),explanation:o("explanation").notNull(),dismissedAt:a("dismissed_at"),dismissedBy:t("dismissed_by").references(()=>b.id),actionTaken:o("action_taken"),actionTakenAt:a("action_taken_at"),createdAt:a("created_at").defaultNow().notNull(),updatedAt:a("updated_at").defaultNow().notNull(),metadata:m("metadata")},e=>[r("idx_prescription_alerts_order").on(e.orderId),r("idx_prescription_alerts_ecp").on(e.ecpId),r("idx_prescription_alerts_severity").on(e.severity)]);f("ecp_product_sales_analytics",{id:t("id").primaryKey().default(N`gen_random_uuid()`),ecpId:t("ecp_id").references(()=>b.id).notNull(),productType:o("product_type").notNull(),productBrand:o("product_brand"),productModel:o("product_model"),totalSalesCount:g("total_sales_count").default(0).notNull(),totalRevenue:d("total_revenue",{precision:12,scale:2}).default("0").notNull(),averageOrderValue:d("average_order_value",{precision:10,scale:2}).default("0"),monthlyTrend:m("monthly_trend").default("{}"),topPairings:m("top_pairings").default("[]"),lastAnalyzed:a("last_analyzed").defaultNow().notNull(),metadata:m("metadata")},e=>[r("idx_ecp_sales_analytics_ecp").on(e.ecpId)]);f("bi_recommendations",{id:t("id").primaryKey().default(N`gen_random_uuid()`),ecpId:t("ecp_id").references(()=>b.id).notNull(),recommendationType:o("recommendation_type").notNull(),priority:o("priority").notNull().default("medium"),title:o("title").notNull(),description:o("description").notNull(),impact:o("impact").notNull(),actionItems:m("action_items").default("[]"),dataSource:m("data_source").notNull(),estimatedRevenueLift:d("estimated_revenue_lift",{precision:12,scale:2}),estimatedErrorReduction:d("estimated_error_reduction",{precision:5,scale:4}),acknowledged:p("acknowledged").default(!1).notNull(),acknowledgedAt:a("acknowledged_at"),acknowledgedBy:t("acknowledged_by").references(()=>b.id),implementationStartedAt:a("implementation_started_at"),implementationCompletedAt:a("implementation_completed_at"),createdAt:a("created_at").defaultNow().notNull(),updatedAt:a("updated_at").defaultNow().notNull(),metadata:m("metadata")},e=>[r("idx_bi_recommendations_ecp").on(e.ecpId),r("idx_bi_recommendations_type").on(e.recommendationType),r("idx_bi_recommendations_priority").on(e.priority)]);I(b);I(F).omit({id:!0,customerNumber:!0,createdAt:!0});I(te).omit({id:!0,orderNumber:!0,orderDate:!0,completedAt:!0,patientId:!0,ecpId:!0}).extend({patientName:c().min(1,"Patient name is required"),patientDOB:c().optional()});C({status:q(["pending","in_production","quality_check","shipped","completed","on_hold","cancelled"])});I(xl).omit({id:!0,createdAt:!0,respondedAt:!0,labResponse:!0,status:!0,ecpId:!0});I(vl).omit({id:!0,createdAt:!0}).extend({activityType:q(["profile_created","profile_updated","examination_scheduled","examination_completed","prescription_issued","order_placed","order_updated","order_completed","contact_lens_fitted","recall_sent","appointment_booked","appointment_cancelled","payment_received","refund_issued","complaint_logged","complaint_resolved","consent_updated","document_uploaded","note_added","referral_made","communication_sent"])});I(Tt).omit({id:!0,poNumber:!0,createdAt:!0,updatedAt:!0,createdById:!0});I(Il).omit({id:!0,createdAt:!0,purchaseOrderId:!0});I(Sl).omit({id:!0,uploadedAt:!0,supplierId:!0});C({status:q(["draft","sent","acknowledged","in_transit","delivered","cancelled"]),trackingNumber:c().optional(),actualDeliveryDate:c().optional()});const gn=C({organizationName:c().min(1,"Organization name is required"),email:c().email("Valid email is required").optional(),accountNumber:c().optional(),contactEmail:c().email("Valid contact email required").optional(),contactPhone:c().optional(),address:C({street:c().optional(),city:c().optional(),state:c().optional(),zipCode:c().optional(),country:c().optional()}).optional()});gn.partial();I(wl).omit({id:!0,updatedAt:!0,updatedById:!0}).extend({address:C({street:c().optional(),city:c().optional(),state:c().optional(),zipCode:c().optional(),country:c().optional()}).optional()});I(Tl).omit({id:!0,userId:!0,updatedAt:!0});I(je).omit({id:!0,createdAt:!0,updatedAt:!0,ecpId:!0});I(we).omit({id:!0,createdAt:!0,ecpId:!0,isSigned:!0,signedByEcpId:!0,digitalSignature:!0,signedAt:!0});I(ne).omit({id:!0,createdAt:!0,updatedAt:!0,ecpId:!0});I(fn).omit({id:!0,invoiceNumber:!0,createdAt:!0,updatedAt:!0,ecpId:!0});I(Ll).omit({id:!0,createdAt:!0,invoiceId:!0});C({orderId:c().min(1,"Order ID is required"),ecpId:c().min(1,"ECP ID is required"),severity:q(["info","warning","critical"]),alertType:c().min(1,"Alert type is required"),riskScore:k().min(0).max(1),historicalNonAdaptRate:k().min(0).max(1).optional(),recommendedLensType:c().optional(),recommendedMaterial:c().optional(),recommendedCoating:c().optional(),explanation:c().min(1,"Explanation is required"),metadata:be(le()).optional()});C({dismissedAt:Ie().optional(),dismissedBy:c().optional(),actionTaken:c().optional(),actionTakenAt:Ie().optional()});C({ecpId:c().min(1,"ECP ID is required"),recommendationType:q(["stocking","upsell","cross_sell","breakage_reduction","error_reduction"]),priority:q(["low","medium","high"]).optional(),title:c().min(1,"Title is required"),description:c().min(1,"Description is required"),impact:c().min(1,"Impact statement is required"),actionItems:fe(C({action:c(),details:c().optional()})).optional(),dataSource:be(le()),estimatedRevenueLift:k().optional(),estimatedErrorReduction:k().min(0).max(1).optional(),metadata:be(le()).optional()});C({acknowledged:oe().optional(),acknowledgedBy:c().optional(),implementationStartedAt:Ie().optional(),implementationCompletedAt:Ie().optional()});S("nlp_intent_tag",["first_time_pal","first_time_progressive","cvs_syndrome","computer_heavy_use","night_driving_complaint","glare_complaint","near_work_focus","occupational_hazard","sports_activity","high_prescription","presbyopia_onset","astigmatism_high","anisometropia","monovision_candidate","light_sensitive","blue_light_concern","uv_protection_needed","anti_reflective_needed","scratch_resistant_needed","impact_resistant_needed"]);f("lims_clinical_analytics",{id:t("id").primaryKey().default(N`gen_random_uuid()`),lensType:o("lens_type").notNull(),lensMaterial:o("lens_material").notNull(),coating:o("coating").notNull(),frameWrapAngle:d("frame_wrap_angle",{precision:5,scale:2}),prescriptionPower:m("prescription_power"),totalOrdersAnalyzed:g("total_orders_analyzed").default(0).notNull(),nonAdaptCount:g("non_adapt_count").default(0).notNull(),remakeCount:g("remake_count").default(0).notNull(),successRate:d("success_rate",{precision:5,scale:4}).default("0").notNull(),nonAdaptRate:d("non_adapt_rate",{precision:5,scale:4}).default("0").notNull(),remakeRate:d("remake_rate",{precision:5,scale:4}).default("0").notNull(),patternInsights:m("pattern_insights"),clinicalContext:m("clinical_context"),lastUpdated:a("last_updated").defaultNow().notNull(),metadata:m("metadata")});const Vl=f("nlp_clinical_analysis",{id:t("id").primaryKey().default(N`gen_random_uuid()`),orderId:t("order_id").references(()=>te.id).notNull(),rawClinicalNotes:o("raw_clinical_notes").notNull(),intentTags:m("intent_tags").notNull(),patientLifestyle:o("patient_lifestyle"),patientComplaints:m("patient_complaints"),clinicalFlags:m("clinical_flags"),clinicalSummary:o("clinical_summary"),recommendedLensCharacteristics:m("recommended_lens_characteristics"),analyzedAt:a("analyzed_at").defaultNow().notNull(),confidence:d("confidence",{precision:5,scale:4}).default("0.8").notNull(),metadata:m("metadata")},e=>[r("idx_nlp_analysis_order").on(e.orderId)]);f("ecp_catalog_data",{id:t("id").primaryKey().default(N`gen_random_uuid()`),ecpId:t("ecp_id").references(()=>b.id).notNull(),productSku:o("product_sku").notNull(),productName:o("product_name").notNull(),brand:o("brand"),category:o("category"),lensType:o("lens_type"),lensMaterial:o("lens_material"),coating:o("coating"),designFeatures:m("design_features"),retailPrice:d("retail_price",{precision:10,scale:2}).notNull(),wholesalePrice:d("wholesale_price",{precision:10,scale:2}),stockQuantity:g("stock_quantity").default(0).notNull(),isInStock:p("is_in_stock").default(!0).notNull(),uploadedAt:a("uploaded_at").defaultNow().notNull(),lastUpdated:a("last_updated").defaultNow().notNull(),metadata:m("metadata")},e=>[r("idx_ecp_catalog_ecp_id").on(e.ecpId),r("idx_ecp_catalog_sku").on(e.productSku)]);f("ai_dispensing_recommendations",{id:t("id").primaryKey().default(N`gen_random_uuid()`),orderId:t("order_id").references(()=>te.id).notNull(),ecpId:t("ecp_id").references(()=>b.id).notNull(),nlpAnalysisId:t("nlp_analysis_id").references(()=>Vl.id),rxData:m("rx_data").notNull(),clinicalIntentTags:m("clinical_intent_tags").notNull(),clinicalNotesSummary:o("clinical_notes_summary"),recommendations:m("recommendations").notNull(),limsPatternMatch:m("lims_pattern_match"),clinicalConfidenceScore:d("clinical_confidence_score",{precision:5,scale:4}).notNull(),recommendationStatus:o("recommendation_status").default("pending"),acceptedRecommation:m("accepted_recommendation"),acceptedAt:a("accepted_at"),customizationApplied:o("customization_applied"),customizedAt:a("customized_at"),generatedAt:a("generated_at").defaultNow().notNull(),metadata:m("metadata")},e=>[r("idx_ai_recommendations_order").on(e.orderId),r("idx_ai_recommendations_ecp").on(e.ecpId),r("idx_ai_recommendations_status").on(e.recommendationStatus)]);const Cl=C({odSphere:c().optional(),odCylinder:c().optional(),odAxis:c().optional(),odAdd:c().optional(),osSphere:c().optional(),osCylinder:c().optional(),osAxis:c().optional(),osAdd:c().optional(),pd:c().optional()}),jl=C({rawNotes:c().min(10,"Clinical notes must be at least 10 characters"),patientAge:k().optional(),occupation:c().optional()});C({ecpId:c().min(1,"ECP ID required"),csvData:fe(C({sku:c().min(1),name:c().min(1),brand:c().optional(),category:c().optional(),lensType:c().optional(),lensMaterial:c().optional(),coating:c().optional(),retailPrice:k().positive(),wholesalePrice:k().optional(),stockQuantity:k().nonnegative()}))});C({orderId:c().min(1,"Order ID required"),ecpId:c().min(1,"ECP ID required"),prescription:Cl,clinicalNotes:jl,frameData:C({wrapAngle:k().optional(),type:c().optional()}).optional()});const Bl=C({tier:q(["BEST","BETTER","GOOD"]),lens:C({type:c(),material:c(),design:c().optional()}),coating:C({name:c(),features:fe(c())}),retailPrice:k(),matchScore:k().min(0).max(1),clinicalJustification:c(),lifeStyleJustification:c(),clinicalContext:fe(C({tag:c(),justification:c()}))});C({orderId:c(),recommendations:fe(Bl),clinicalConfidenceScore:k().min(0).max(1),analysisMetadata:C({nlpConfidence:k().min(0).max(1),limsMatchCount:k(),patternMatches:fe(c())})});const ql=I(x);ql.partial();I(ol);const Ol=I(pn);Ol.partial();I(_n);const Ml=I(cl);Ml.partial();const Fl=I(ul);Fl.partial();I(ml);const Rl=I(Ce);Rl.partial();I(_l);I(fl);const Kl=I(ze).omit({id:!0,createdAt:!0,updatedAt:!0});Kl.partial();I(gl).omit({id:!0,createdAt:!0});I(hl).omit({id:!0,assignedAt:!0});I(Nl).omit({id:!0,changedAt:!0});I(bl).omit({id:!0,timestamp:!0});const zl=I(Pt);zl.partial();const $l=I(Pl);$l.partial();const Ql=I(Al);Ql.partial();const Gl=I(El);Gl.partial();const Hl=I(kl);Hl.partial();const hn=f("pos_transactions",{id:t("id").primaryKey().default(N`gen_random_uuid()`),companyId:t("company_id").references(()=>x.id,{onDelete:"cascade"}).notNull(),transactionNumber:t("transaction_number",{length:50}).notNull(),staffId:t("staff_id").references(()=>b.id).notNull(),patientId:t("patient_id").references(()=>F.id),subtotal:d("subtotal",{precision:10,scale:2}).notNull(),taxAmount:d("tax_amount",{precision:10,scale:2}).default("0"),discountAmount:d("discount_amount",{precision:10,scale:2}).default("0"),totalAmount:d("total_amount",{precision:10,scale:2}).notNull(),paymentMethod:t("payment_method",{length:50}).notNull(),paymentStatus:t("payment_status",{length:50}).default("completed"),cashReceived:d("cash_received",{precision:10,scale:2}),changeGiven:d("change_given",{precision:10,scale:2}),notes:o("notes"),refundReason:o("refund_reason"),refundedAt:a("refunded_at"),transactionDate:a("transaction_date").defaultNow().notNull(),createdAt:a("created_at").defaultNow().notNull(),updatedAt:a("updated_at").defaultNow().notNull()},e=>[r("idx_pos_transactions_company_id").on(e.companyId),r("idx_pos_transactions_staff_id").on(e.staffId),r("idx_pos_transactions_date").on(e.transactionDate),r("idx_pos_transactions_status").on(e.paymentStatus)]),Zl=f("pos_transaction_items",{id:t("id").primaryKey().default(N`gen_random_uuid()`),transactionId:t("transaction_id").references(()=>hn.id,{onDelete:"cascade"}).notNull(),productId:t("product_id").references(()=>ne.id).notNull(),quantity:g("quantity").notNull(),unitPrice:d("unit_price",{precision:10,scale:2}).notNull(),unitCost:d("unit_cost",{precision:10,scale:2}),taxRate:d("tax_rate",{precision:5,scale:2}).default("0"),discountAmount:d("discount_amount",{precision:10,scale:2}).default("0"),lineTotal:d("line_total",{precision:10,scale:2}).notNull(),createdAt:a("created_at").defaultNow().notNull()},e=>[r("idx_pos_items_transaction_id").on(e.transactionId),r("idx_pos_items_product_id").on(e.productId)]),Wl=f("pdf_templates",{id:t("id").primaryKey().default(N`gen_random_uuid()`),companyId:t("company_id").references(()=>x.id,{onDelete:"cascade"}).notNull(),name:t("name",{length:100}).notNull(),templateType:t("template_type",{length:50}).notNull(),htmlTemplate:o("html_template").notNull(),cssStyles:o("css_styles"),headerLogoUrl:o("header_logo_url"),footerText:o("footer_text"),primaryColor:t("primary_color",{length:7}).default("#000000"),secondaryColor:t("secondary_color",{length:7}).default("#666666"),isDefault:p("is_default").default(!1),paperSize:t("paper_size",{length:20}).default("A4"),orientation:t("orientation",{length:20}).default("portrait"),createdAt:a("created_at").defaultNow().notNull(),updatedAt:a("updated_at").defaultNow().notNull()},e=>[r("idx_pdf_templates_company_id").on(e.companyId),r("idx_pdf_templates_type").on(e.templateType)]),Xl=I(hn,{subtotal:c().regex(/^\d+(\.\d{1,2})?$/,"Invalid subtotal"),taxAmount:c().regex(/^\d+(\.\d{1,2})?$/,"Invalid tax amount").optional(),discountAmount:c().regex(/^\d+(\.\d{1,2})?$/,"Invalid discount amount").optional(),totalAmount:c().regex(/^\d+(\.\d{1,2})?$/,"Invalid total amount"),paymentMethod:q(["cash","card","insurance","split","debit","mobile_pay"]),paymentStatus:q(["completed","refunded","partial_refund","pending"])});Xl.partial();I(Zl,{quantity:k().int().min(1,"Quantity must be at least 1"),unitPrice:c().regex(/^\d+(\.\d{1,2})?$/,"Invalid price"),lineTotal:c().regex(/^\d+(\.\d{1,2})?$/,"Invalid line total")});const Jl=I(Wl,{templateType:q(["invoice","receipt","prescription","report","order","label"]),paperSize:q(["A4","Letter","Receipt","Label"]),orientation:q(["portrait","landscape"])});Jl.partial();const Yl=S("movement_type",["sale","refund","adjustment","received","transfer_out","transfer_in","damaged","initial"]),ed=f("inventory_movements",{id:t("id").primaryKey().default(N`gen_random_uuid()`),companyId:t("company_id").references(()=>x.id,{onDelete:"cascade"}).notNull(),productId:t("product_id").references(()=>ne.id,{onDelete:"cascade"}).notNull(),movementType:Yl("movement_type").notNull(),quantity:g("quantity").notNull(),previousStock:g("previous_stock").notNull(),newStock:g("new_stock").notNull(),referenceType:t("reference_type",{length:50}),referenceId:t("reference_id"),reason:o("reason"),notes:o("notes"),performedBy:t("performed_by").references(()=>b.id).notNull(),locationId:t("location_id"),createdAt:a("created_at").defaultNow().notNull()},e=>[r("idx_inventory_movements_company").on(e.companyId),r("idx_inventory_movements_product").on(e.productId),r("idx_inventory_movements_type").on(e.movementType),r("idx_inventory_movements_date").on(e.createdAt),r("idx_inventory_movements_performed_by").on(e.performedBy)]),Nn=f("product_variants",{id:t("id").primaryKey().default(N`gen_random_uuid()`),productId:t("product_id").references(()=>ne.id,{onDelete:"cascade"}).notNull(),companyId:t("company_id").references(()=>x.id,{onDelete:"cascade"}).notNull(),variantSku:t("variant_sku",{length:100}).notNull(),variantName:t("variant_name",{length:255}).notNull(),color:t("color",{length:50}),size:t("size",{length:50}),style:t("style",{length:100}),attributes:m("attributes"),unitPrice:d("unit_price",{precision:10,scale:2}),cost:d("cost",{precision:10,scale:2}),stockQuantity:g("stock_quantity").default(0).notNull(),lowStockThreshold:g("low_stock_threshold").default(10),barcode:t("barcode",{length:100}),imageUrl:o("image_url"),isActive:p("is_active").default(!0),displayOrder:g("display_order").default(0),createdAt:a("created_at").defaultNow().notNull(),updatedAt:a("updated_at").defaultNow().notNull()},e=>[r("idx_product_variants_product").on(e.productId),r("idx_product_variants_company").on(e.companyId),r("idx_product_variants_sku").on(e.variantSku),r("idx_product_variants_barcode").on(e.barcode)]),td=f("low_stock_alerts",{id:t("id").primaryKey().default(N`gen_random_uuid()`),companyId:t("company_id").references(()=>x.id,{onDelete:"cascade"}).notNull(),productId:t("product_id").references(()=>ne.id,{onDelete:"cascade"}).notNull(),variantId:t("variant_id").references(()=>Nn.id,{onDelete:"cascade"}),alertType:t("alert_type",{length:50}).notNull(),currentStock:g("current_stock").notNull(),threshold:g("threshold").notNull(),status:t("status",{length:50}).default("active"),acknowledgedBy:t("acknowledged_by").references(()=>b.id),acknowledgedAt:a("acknowledged_at"),resolvedAt:a("resolved_at"),suggestedReorderQuantity:g("suggested_reorder_quantity"),createdAt:a("created_at").defaultNow().notNull(),updatedAt:a("updated_at").defaultNow().notNull()},e=>[r("idx_low_stock_alerts_company").on(e.companyId),r("idx_low_stock_alerts_product").on(e.productId),r("idx_low_stock_alerts_status").on(e.status)]),yn=f("email_templates",{id:t("id").primaryKey().default(N`gen_random_uuid()`),companyId:t("company_id").references(()=>x.id).notNull(),name:t("name",{length:200}).notNull(),description:o("description"),emailType:cn("email_type").notNull(),subject:t("subject",{length:500}).notNull(),htmlContent:o("html_content").notNull(),textContent:o("text_content"),variables:m("variables"),isActive:p("is_active").default(!0).notNull(),isDefault:p("is_default").default(!1),createdBy:t("created_by").references(()=>b.id).notNull(),createdAt:a("created_at").defaultNow().notNull(),updatedAt:a("updated_at").defaultNow().notNull()},e=>[r("idx_email_templates_company").on(e.companyId),r("idx_email_templates_type").on(e.emailType),r("idx_email_templates_active").on(e.isActive)]),bn=f("email_logs",{id:t("id").primaryKey().default(N`gen_random_uuid()`),companyId:t("company_id").references(()=>x.id).notNull(),recipientEmail:t("recipient_email",{length:255}).notNull(),recipientName:t("recipient_name",{length:255}),patientId:t("patient_id").references(()=>F.id),emailType:cn("email_type").notNull(),subject:t("subject",{length:500}).notNull(),htmlContent:o("html_content").notNull(),textContent:o("text_content"),status:Qo("status").default("queued").notNull(),trackingId:t("tracking_id",{length:100}).unique(),templateId:t("template_id").references(()=>yn.id),relatedEntityType:t("related_entity_type",{length:50}),relatedEntityId:t("related_entity_id"),sentBy:t("sent_by").references(()=>b.id).notNull(),sentAt:a("sent_at"),deliveredAt:a("delivered_at"),openCount:g("open_count").default(0).notNull(),firstOpenedAt:a("first_opened_at"),lastOpenedAt:a("last_opened_at"),clickCount:g("click_count").default(0).notNull(),firstClickedAt:a("first_clicked_at"),lastClickedAt:a("last_clicked_at"),errorMessage:o("error_message"),retryCount:g("retry_count").default(0).notNull(),metadata:m("metadata"),createdAt:a("created_at").defaultNow().notNull(),updatedAt:a("updated_at").defaultNow().notNull()},e=>[r("idx_email_logs_company").on(e.companyId),r("idx_email_logs_recipient").on(e.recipientEmail),r("idx_email_logs_patient").on(e.patientId),r("idx_email_logs_type").on(e.emailType),r("idx_email_logs_status").on(e.status),r("idx_email_logs_sent_at").on(e.sentAt),r("idx_email_logs_tracking_id").on(e.trackingId),r("idx_email_logs_related").on(e.relatedEntityType,e.relatedEntityId)]),nd=f("email_tracking_events",{id:t("id").primaryKey().default(N`gen_random_uuid()`),emailLogId:t("email_log_id").references(()=>bn.id).notNull(),eventType:Go("event_type").notNull(),eventData:m("event_data"),userAgent:o("user_agent"),ipAddress:t("ip_address",{length:45}),location:m("location"),device:t("device",{length:50}),timestamp:a("timestamp").defaultNow().notNull()},e=>[r("idx_email_tracking_events_log").on(e.emailLogId),r("idx_email_tracking_events_type").on(e.eventType),r("idx_email_tracking_events_timestamp").on(e.timestamp)]);I(ed,{quantity:k().int().refine(e=>e!==0,{message:"Quantity cannot be zero"}),movementType:q(["sale","refund","adjustment","received","transfer_out","transfer_in","damaged","initial"])});const id=I(Nn,{variantSku:c().min(1,"Variant SKU is required"),variantName:c().min(1,"Variant name is required")});id.partial();I(td,{alertType:q(["low_stock","out_of_stock","reorder_point"]),currentStock:k().int().min(0),threshold:k().int().min(0)});const ad=I(yn,{name:c().min(1,"Template name is required"),subject:c().min(1,"Subject is required"),htmlContent:c().min(1,"HTML content is required"),emailType:q(["invoice","receipt","prescription_reminder","recall_notification","appointment_reminder","order_confirmation","order_update","marketing","general"])});ad.partial();I(bn,{recipientEmail:c().email("Valid email is required"),subject:c().min(1,"Subject is required"),htmlContent:c().min(1,"HTML content is required"),emailType:q(["invoice","receipt","prescription_reminder","recall_notification","appointment_reminder","order_confirmation","order_update","marketing","general"])});I(nd,{eventType:q(["sent","delivered","opened","clicked","bounced","spam","unsubscribed"])});const sd=S("ai_notification_type",["briefing","alert","reminder","insight"]),rd=S("ai_notification_priority",["critical","high","medium","low"]),od=f("ai_notifications",{id:t("id").primaryKey().default(N`gen_random_uuid()`),companyId:t("company_id").notNull().references(()=>x.id,{onDelete:"cascade"}),userId:t("user_id").references(()=>b.id),type:sd("type").notNull(),priority:rd("priority").default("medium").notNull(),title:o("title").notNull(),message:o("message").notNull(),summary:o("summary"),recommendation:o("recommendation"),actionUrl:o("action_url"),actionLabel:o("action_label"),data:m("data"),isRead:p("is_read").default(!1).notNull(),readAt:a("read_at"),isDismissed:p("is_dismissed").default(!1).notNull(),dismissedAt:a("dismissed_at"),expiresAt:a("expires_at"),generatedBy:t("generated_by",{length:50}).default("proactive_insights"),createdAt:a("created_at").defaultNow().notNull(),updatedAt:a("updated_at").defaultNow().notNull()},e=>[r("idx_ai_notifications_company").on(e.companyId,e.createdAt),r("idx_ai_notifications_user").on(e.userId,e.isRead),r("idx_ai_notifications_priority").on(e.priority,e.createdAt)]),ld=I(od,{type:q(["briefing","alert","reminder","insight"]),priority:q(["critical","high","medium","low"]),title:c().min(1,"Title is required"),message:c().min(1,"Message is required")});ld.partial();const dd=S("ai_po_status",["draft","pending_review","approved","rejected","converted"]),xn=f("ai_purchase_orders",{id:t("id").primaryKey().default(N`gen_random_uuid()`),companyId:t("company_id").notNull().references(()=>x.id,{onDelete:"cascade"}),generatedAt:a("generated_at").defaultNow().notNull(),generatedBy:t("generated_by",{length:50}).default("autonomous_purchasing"),aiModel:t("ai_model",{length:50}),supplierId:t("supplier_id").references(()=>b.id),supplierName:o("supplier_name"),estimatedTotal:d("estimated_total",{precision:10,scale:2}),reason:o("reason").notNull(),aiAnalysis:m("ai_analysis"),confidence:d("confidence",{precision:5,scale:2}),status:dd("status").default("pending_review").notNull(),reviewedById:t("reviewed_by_id").references(()=>b.id),reviewedAt:a("reviewed_at"),reviewNotes:o("review_notes"),convertedPoId:t("converted_po_id").references(()=>Tt.id),convertedAt:a("converted_at"),expiresAt:a("expires_at"),createdAt:a("created_at").defaultNow().notNull(),updatedAt:a("updated_at").defaultNow().notNull()},e=>[r("idx_ai_po_company_status").on(e.companyId,e.status),r("idx_ai_po_generated_at").on(e.generatedAt),r("idx_ai_po_supplier").on(e.supplierId)]),cd=f("ai_purchase_order_items",{id:t("id").primaryKey().default(N`gen_random_uuid()`),aiPoId:t("ai_po_id").notNull().references(()=>xn.id,{onDelete:"cascade"}),productId:t("product_id").references(()=>ne.id),productName:o("product_name").notNull(),productSku:t("product_sku",{length:100}),currentStock:g("current_stock"),lowStockThreshold:g("low_stock_threshold"),recommendedQuantity:g("recommended_quantity").notNull(),estimatedUnitPrice:d("estimated_unit_price",{precision:10,scale:2}),estimatedTotalPrice:d("estimated_total_price",{precision:10,scale:2}),urgency:t("urgency",{length:20}).default("medium"),stockoutRisk:d("stockout_risk",{precision:5,scale:2}),leadTimeDays:g("lead_time_days"),createdAt:a("created_at").defaultNow().notNull()},e=>[r("idx_ai_po_items_po").on(e.aiPoId),r("idx_ai_po_items_product").on(e.productId)]);I(xn,{status:q(["draft","pending_review","approved","rejected","converted"]).optional(),reason:c().min(1,"Reason is required"),estimatedTotal:c().optional(),confidence:c().optional()});I(cd,{recommendedQuantity:k().min(1,"Quantity must be at least 1"),productName:c().min(1,"Product name is required")});const ud=S("forecast_horizon",["week","month","quarter","year"]),Dn=S("forecast_method",["moving_average","exponential_smoothing","linear_regression","seasonal_decomposition","ai_ml"]),md=f("demand_forecasts",{id:t("id").primaryKey().$defaultFn(()=>crypto.randomUUID()),companyId:t("company_id").notNull().references(()=>x.id),productId:t("product_id").notNull().references(()=>ne.id),forecastDate:a("forecast_date").notNull(),predictedDemand:g("predicted_demand").notNull(),confidenceInterval:d("confidence_interval",{precision:5,scale:2}),forecastMethod:Dn("forecast_method").default("ai_ml").notNull(),horizon:ud("horizon").default("week").notNull(),historicalAverage:d("historical_average",{precision:10,scale:2}),trendFactor:d("trend_factor",{precision:5,scale:2}),seasonalityFactor:d("seasonality_factor",{precision:5,scale:2}),actualDemand:g("actual_demand"),accuracyScore:d("accuracy_score",{precision:5,scale:2}),modelVersion:t("model_version",{length:50}),confidence:d("confidence",{precision:5,scale:2}).notNull(),generatedAt:a("generated_at").defaultNow().notNull(),updatedAt:a("updated_at").defaultNow().notNull()},e=>[r("idx_demand_forecasts_company").on(e.companyId),r("idx_demand_forecasts_product").on(e.productId),r("idx_demand_forecasts_date").on(e.forecastDate),r("idx_demand_forecasts_generated").on(e.generatedAt)]),pd=f("seasonal_patterns",{id:t("id").primaryKey().$defaultFn(()=>crypto.randomUUID()),companyId:t("company_id").notNull().references(()=>x.id),productId:t("product_id").references(()=>ne.id),patternType:t("pattern_type",{length:50}).notNull(),patternName:t("pattern_name",{length:255}).notNull(),peakPeriod:t("peak_period",{length:100}),demandMultiplier:d("demand_multiplier",{precision:5,scale:2}).notNull(),confidence:d("confidence",{precision:5,scale:2}).notNull(),observationCount:g("observation_count").notNull(),firstObserved:a("first_observed").notNull(),lastObserved:a("last_observed").notNull(),isActive:p("is_active").default(!0).notNull(),createdAt:a("created_at").defaultNow().notNull(),updatedAt:a("updated_at").defaultNow().notNull()},e=>[r("idx_seasonal_patterns_company").on(e.companyId),r("idx_seasonal_patterns_product").on(e.productId),r("idx_seasonal_patterns_type").on(e.patternType)]),_d=f("forecast_accuracy_metrics",{id:t("id").primaryKey().$defaultFn(()=>crypto.randomUUID()),companyId:t("company_id").notNull().references(()=>x.id),productId:t("product_id").references(()=>ne.id),periodStart:a("period_start").notNull(),periodEnd:a("period_end").notNull(),mape:d("mape",{precision:5,scale:2}),mae:d("mae",{precision:10,scale:2}),rmse:d("rmse",{precision:10,scale:2}),totalForecasts:g("total_forecasts").notNull(),accurateForecasts:g("accurate_forecasts").notNull(),forecastMethod:Dn("forecast_method").notNull(),modelVersion:t("model_version",{length:50}),createdAt:a("created_at").defaultNow().notNull()},e=>[r("idx_forecast_accuracy_company").on(e.companyId),r("idx_forecast_accuracy_period").on(e.periodStart,e.periodEnd)]);I(md,{predictedDemand:k().min(0),confidence:c().optional(),forecastDate:Ie()});I(pd,{patternName:c().min(1),demandMultiplier:c(),confidence:c()});I(_d,{totalForecasts:k().min(0),accurateForecasts:k().min(0)});const vn=S("relationship_type",["ecp_to_lab","lab_to_supplier","ecp_to_supplier","lab_to_lab"]),In=S("connection_status",["pending","active","rejected","disconnected"]),fd=f("company_relationships",{id:t("id").primaryKey().$defaultFn(()=>crypto.randomUUID()),companyAId:t("company_a_id").notNull().references(()=>x.id),companyBId:t("company_b_id").notNull().references(()=>x.id),relationshipType:vn("relationship_type").notNull(),status:In("status").notNull().default("pending"),initiatedByCompanyId:t("initiated_by_company_id").notNull().references(()=>x.id),connectionTerms:o("connection_terms"),connectionMessage:o("connection_message"),requestedAt:a("requested_at").defaultNow().notNull(),approvedAt:a("approved_at"),rejectedAt:a("rejected_at"),disconnectedAt:a("disconnected_at"),reviewedByUserId:t("reviewed_by_user_id").references(()=>b.id),createdAt:a("created_at").defaultNow().notNull(),updatedAt:a("updated_at").defaultNow().notNull()},e=>[r("idx_company_relationships_a").on(e.companyAId),r("idx_company_relationships_b").on(e.companyBId),r("idx_company_relationships_status").on(e.status),r("idx_company_relationships_type").on(e.relationshipType)]),gd=f("connection_requests",{id:t("id").primaryKey().$defaultFn(()=>crypto.randomUUID()),fromCompanyId:t("from_company_id").notNull().references(()=>x.id),toCompanyId:t("to_company_id").notNull().references(()=>x.id),fromUserId:t("from_user_id").notNull().references(()=>b.id),message:o("message"),requestedRelationshipType:vn("requested_relationship_type").notNull(),proposedTerms:o("proposed_terms"),status:In("status").notNull().default("pending"),reviewedByUserId:t("reviewed_by_user_id").references(()=>b.id),reviewedAt:a("reviewed_at"),responseMessage:o("response_message"),expiresAt:a("expires_at"),createdAt:a("created_at").defaultNow().notNull(),updatedAt:a("updated_at").defaultNow().notNull()},e=>[r("idx_connection_requests_from").on(e.fromCompanyId),r("idx_connection_requests_to").on(e.toCompanyId),r("idx_connection_requests_status").on(e.status)]),hd=f("company_profiles",{id:t("id").primaryKey().$defaultFn(()=>crypto.randomUUID()),companyId:t("company_id").notNull().references(()=>x.id).unique(),isMarketplaceVisible:p("is_marketplace_visible").default(!0).notNull(),marketplaceVerified:p("marketplace_verified").default(!1).notNull(),featuredUntil:a("featured_until"),profileHeadline:t("profile_headline",{length:200}),profileDescription:o("profile_description"),tagline:t("tagline",{length:100}),specialties:m("specialties").default(N`'[]'::jsonb`),certifications:m("certifications").default(N`'[]'::jsonb`),equipment:m("equipment").default(N`'[]'::jsonb`),serviceArea:t("service_area",{length:200}),turnaroundTimeDays:g("turnaround_time_days"),minimumOrderValue:d("minimum_order_value",{precision:10,scale:2}),rushServiceAvailable:p("rush_service_available").default(!1),shippingMethods:m("shipping_methods").default(N`'[]'::jsonb`),logoUrl:t("logo_url",{length:500}),bannerImageUrl:t("banner_image_url",{length:500}),galleryImages:m("gallery_images").default(N`'[]'::jsonb`),websiteUrl:t("website_url",{length:500}),contactEmail:t("contact_email",{length:255}),contactPhone:t("contact_phone",{length:50}),publicAddress:m("public_address"),totalConnections:g("total_connections").default(0).notNull(),totalOrders:g("total_orders").default(0).notNull(),averageRating:d("average_rating",{precision:3,scale:2}),totalReviews:g("total_reviews").default(0).notNull(),slug:t("slug",{length:255}).unique(),metaDescription:o("meta_description"),createdAt:a("created_at").defaultNow().notNull(),updatedAt:a("updated_at").defaultNow().notNull()},e=>[r("idx_company_profiles_visible").on(e.isMarketplaceVisible),r("idx_company_profiles_slug").on(e.slug),r("idx_company_profiles_service_area").on(e.serviceArea)]);I(fd);I(gd);I(hd);const Nd=f("market_insights",{id:t("id",{length:255}).primaryKey().$defaultFn(()=>crypto.randomUUID()),insightType:t("insight_type",{length:100}).notNull(),category:t("category",{length:100}).notNull(),title:t("title",{length:255}).notNull(),description:o("description"),periodStart:a("period_start").notNull(),periodEnd:a("period_end").notNull(),region:t("region",{length:100}),country:t("country",{length:100}),dataPoints:m("data_points").$type().notNull(),companiesIncluded:g("companies_included").notNull(),recordsAnalyzed:g("records_analyzed").notNull(),confidenceLevel:d("confidence_level",{precision:5,scale:2}),marginOfError:d("margin_of_error",{precision:5,scale:2}),accessLevel:t("access_level",{length:50}).notNull().default("free"),price:d("price",{precision:10,scale:2}),generatedBy:t("generated_by",{length:255}),status:t("status",{length:50}).notNull().default("draft"),publishedAt:a("published_at"),createdAt:a("created_at").notNull().defaultNow(),updatedAt:a("updated_at").notNull().defaultNow()},e=>[r("idx_market_insights_type").on(e.insightType),r("idx_market_insights_category").on(e.category),r("idx_market_insights_region").on(e.region),r("idx_market_insights_period").on(e.periodStart,e.periodEnd),r("idx_market_insights_status").on(e.status),r("idx_market_insights_access").on(e.accessLevel)]),yd=f("platform_statistics",{id:t("id",{length:255}).primaryKey().$defaultFn(()=>crypto.randomUUID()),date:V("date").notNull(),periodType:t("period_type",{length:50}).notNull().default("daily"),totalCompanies:g("total_companies").notNull().default(0),activeCompanies:g("active_companies").notNull().default(0),newCompaniesAdded:g("new_companies_added").notNull().default(0),companiesByType:m("companies_by_type").$type(),totalUsers:g("total_users").notNull().default(0),activeUsers:g("active_users").notNull().default(0),newUsersAdded:g("new_users_added").notNull().default(0),totalRevenue:d("total_revenue",{precision:12,scale:2}).notNull().default("0"),mrr:d("mrr",{precision:12,scale:2}).notNull().default("0"),arr:d("arr",{precision:12,scale:2}).notNull().default("0"),churnRate:d("churn_rate",{precision:5,scale:2}),subscriptionsByPlan:m("subscriptions_by_plan").$type(),ordersCreated:g("orders_created").notNull().default(0),patientsAdded:g("patients_added").notNull().default(0),invoicesGenerated:g("invoices_generated").notNull().default(0),aiQueriesProcessed:g("ai_queries_processed").notNull().default(0),apiCallsTotal:g("api_calls_total").notNull().default(0),apiErrorRate:d("api_error_rate",{precision:5,scale:2}),averageResponseTime:g("average_response_time"),uptimePercentage:d("uptime_percentage",{precision:5,scale:2}),totalConnections:g("total_connections").notNull().default(0),connectionRequestsCreated:g("connection_requests_created").notNull().default(0),connectionApprovalRate:d("connection_approval_rate",{precision:5,scale:2}),createdAt:a("created_at").notNull().defaultNow(),updatedAt:a("updated_at").notNull().defaultNow()},e=>[r("idx_platform_statistics_date").on(e.date),r("idx_platform_statistics_period").on(e.periodType),Se("idx_platform_statistics_date_period").on(e.date,e.periodType)]),bd=f("aggregated_metrics",{id:t("id",{length:255}).primaryKey().$defaultFn(()=>crypto.randomUUID()),metricType:t("metric_type",{length:100}).notNull(),category:t("category",{length:100}).notNull(),companyType:t("company_type",{length:50}),region:t("region",{length:100}),productType:t("product_type",{length:100}),periodStart:a("period_start").notNull(),periodEnd:a("period_end").notNull(),granularity:t("granularity",{length:50}).notNull(),count:g("count").notNull().default(0),sum:d("sum",{precision:15,scale:2}),average:d("average",{precision:15,scale:2}),median:d("median",{precision:15,scale:2}),min:d("min",{precision:15,scale:2}),max:d("max",{precision:15,scale:2}),stdDev:d("std_dev",{precision:15,scale:2}),percentile25:d("percentile_25",{precision:15,scale:2}),percentile50:d("percentile_50",{precision:15,scale:2}),percentile75:d("percentile_75",{precision:15,scale:2}),percentile90:d("percentile_90",{precision:15,scale:2}),percentile95:d("percentile_95",{precision:15,scale:2}),sampleSize:g("sample_size").notNull(),completeness:d("completeness",{precision:5,scale:2}),lastRefreshed:a("last_refreshed").notNull().defaultNow(),nextRefreshAt:a("next_refresh_at"),refreshStatus:t("refresh_status",{length:50}).notNull().default("current"),createdAt:a("created_at").notNull().defaultNow(),updatedAt:a("updated_at").notNull().defaultNow()},e=>[r("idx_aggregated_metrics_type").on(e.metricType),r("idx_aggregated_metrics_category").on(e.category),r("idx_aggregated_metrics_period").on(e.periodStart,e.periodEnd),r("idx_aggregated_metrics_dimensions").on(e.companyType,e.region,e.productType),r("idx_aggregated_metrics_refresh").on(e.refreshStatus,e.nextRefreshAt)]),Sn=f("event_log",{id:t("id",{length:255}).primaryKey().$defaultFn(()=>crypto.randomUUID()),type:t("type",{length:100}).notNull(),userId:t("user_id",{length:255}).references(()=>b.id),companyId:t("company_id",{length:255}).references(()=>x.id),data:m("data").notNull(),metadata:m("metadata"),timestamp:a("timestamp").notNull(),createdAt:a("created_at").notNull().defaultNow()},e=>[r("idx_event_log_type").on(e.type),r("idx_event_log_user").on(e.userId),r("idx_event_log_company").on(e.companyId),r("idx_event_log_timestamp").on(e.timestamp),r("idx_event_log_created").on(e.createdAt)]),wn=f("webhook_subscriptions",{id:t("id",{length:255}).primaryKey().$defaultFn(()=>crypto.randomUUID()),companyId:t("company_id",{length:255}).notNull().references(()=>x.id),url:t("url",{length:500}).notNull(),events:o("events").array().notNull(),secret:t("secret",{length:100}).notNull(),active:p("active").notNull().default(!0),createdAt:a("created_at").notNull().defaultNow(),updatedAt:a("updated_at").notNull().defaultNow()},e=>[r("idx_webhook_subscriptions_company").on(e.companyId),r("idx_webhook_subscriptions_active").on(e.active)]),xd=f("webhook_deliveries",{id:t("id",{length:255}).primaryKey().$defaultFn(()=>crypto.randomUUID()),subscriptionId:t("subscription_id",{length:255}).notNull().references(()=>wn.id,{onDelete:"cascade"}),eventId:t("event_id",{length:255}).notNull().references(()=>Sn.id),status:t("status",{length:20}).notNull(),responseCode:g("response_code"),errorMessage:o("error_message"),deliveredAt:a("delivered_at"),createdAt:a("created_at").notNull().defaultNow(),attempts:g("attempts").notNull().default(1),nextRetryAt:a("next_retry_at")},e=>[r("idx_webhook_deliveries_subscription").on(e.subscriptionId),r("idx_webhook_deliveries_event").on(e.eventId),r("idx_webhook_deliveries_status").on(e.status),r("idx_webhook_deliveries_next_retry").on(e.nextRetryAt)]),Dd=S("face_shape",["oval","round","square","heart","diamond","oblong","triangle"]),vd=S("frame_style",["rectangle","square","round","oval","cat_eye","aviator","wayfarer","browline","rimless","semi_rimless","geometric","wrap"]),Id=S("frame_material",["metal","plastic","acetate","titanium","wood","carbon_fiber","mixed"]),Sd=f("patient_face_analysis",{id:t("id",{length:255}).primaryKey().$defaultFn(()=>crypto.randomUUID()),patientId:t("patient_id",{length:255}).notNull().references(()=>F.id,{onDelete:"cascade"}),companyId:t("company_id",{length:255}).notNull().references(()=>x.id,{onDelete:"cascade"}),faceShape:Dd("face_shape").notNull(),faceShapeConfidence:d("face_shape_confidence",{precision:5,scale:2}).notNull(),faceLength:d("face_length",{precision:10,scale:2}),faceWidth:d("face_width",{precision:10,scale:2}),jawlineWidth:d("jawline_width",{precision:10,scale:2}),foreheadWidth:d("forehead_width",{precision:10,scale:2}),cheekboneWidth:d("cheekbone_width",{precision:10,scale:2}),skinTone:t("skin_tone",{length:50}),hairColor:t("hair_color",{length:50}),eyeColor:t("eye_color",{length:50}),photoUrl:o("photo_url").notNull(),thumbnailUrl:o("thumbnail_url"),aiModel:t("ai_model",{length:100}).notNull().default("tensorflow-facemesh-v1"),processingTime:g("processing_time"),landmarkPoints:m("landmark_points"),rawAnalysisData:m("raw_analysis_data"),analyzedAt:a("analyzed_at").notNull().defaultNow(),createdAt:a("created_at").notNull().defaultNow(),updatedAt:a("updated_at").notNull().defaultNow()},e=>[r("idx_face_analysis_patient").on(e.patientId),r("idx_face_analysis_company").on(e.companyId),r("idx_face_analysis_face_shape").on(e.faceShape)]);f("frame_characteristics",{id:t("id",{length:255}).primaryKey().$defaultFn(()=>crypto.randomUUID()),productId:t("product_id",{length:255}).notNull().unique().references(()=>ne.id,{onDelete:"cascade"}),companyId:t("company_id",{length:255}).notNull().references(()=>x.id,{onDelete:"cascade"}),frameStyle:vd("frame_style").notNull(),frameMaterial:Id("frame_material").notNull(),frameSize:t("frame_size",{length:50}).notNull(),recommendedFaceShapes:m("recommended_face_shapes").$type().notNull().default(N`'[]'::jsonb`),lensWidth:d("lens_width",{precision:5,scale:1}),bridgeWidth:d("bridge_width",{precision:5,scale:1}),templeLength:d("temple_length",{precision:5,scale:1}),frameHeight:d("frame_height",{precision:5,scale:1}),gender:t("gender",{length:20}),ageRange:t("age_range",{length:50}),style:t("style",{length:100}),colorFamily:t("color_family",{length:50}),hasNosePads:p("has_nose_pads").default(!1),isAdjustable:p("is_adjustable").default(!1),isSunglasses:p("is_sunglasses").default(!1),isPolarized:p("is_polarized").default(!1),popularityScore:d("popularity_score",{precision:5,scale:2}).default("0"),createdAt:a("created_at").notNull().defaultNow(),updatedAt:a("updated_at").notNull().defaultNow()},e=>[r("idx_frame_chars_product").on(e.productId),r("idx_frame_chars_company").on(e.companyId),r("idx_frame_chars_style").on(e.frameStyle),r("idx_frame_chars_material").on(e.frameMaterial)]);f("frame_recommendations",{id:t("id",{length:255}).primaryKey().$defaultFn(()=>crypto.randomUUID()),faceAnalysisId:t("face_analysis_id",{length:255}).notNull().references(()=>Sd.id,{onDelete:"cascade"}),patientId:t("patient_id",{length:255}).notNull().references(()=>F.id,{onDelete:"cascade"}),productId:t("product_id",{length:255}).notNull().references(()=>ne.id,{onDelete:"cascade"}),companyId:t("company_id",{length:255}).notNull().references(()=>x.id,{onDelete:"cascade"}),matchScore:d("match_score",{precision:5,scale:2}).notNull(),matchReason:o("match_reason").notNull(),rank:g("rank").notNull(),viewed:p("viewed").default(!1),viewedAt:a("viewed_at"),liked:p("liked").default(!1),likedAt:a("liked_at"),purchased:p("purchased").default(!1),purchasedAt:a("purchased_at"),dismissed:p("dismissed").default(!1),dismissedAt:a("dismissed_at"),clickCount:g("click_count").default(0),shareCount:g("share_count").default(0),createdAt:a("created_at").notNull().defaultNow(),updatedAt:a("updated_at").notNull().defaultNow()},e=>[r("idx_frame_recs_analysis").on(e.faceAnalysisId),r("idx_frame_recs_patient").on(e.patientId),r("idx_frame_recs_product").on(e.productId),r("idx_frame_recs_company").on(e.companyId),r("idx_frame_recs_match_score").on(e.matchScore),r("idx_frame_recs_rank").on(e.rank)]);f("frame_recommendation_analytics",{id:t("id",{length:255}).primaryKey().$defaultFn(()=>crypto.randomUUID()),companyId:t("company_id",{length:255}).notNull().references(()=>x.id,{onDelete:"cascade"}),productId:t("product_id",{length:255}).notNull().references(()=>ne.id,{onDelete:"cascade"}),totalRecommendations:g("total_recommendations").default(0),totalViews:g("total_views").default(0),totalLikes:g("total_likes").default(0),totalPurchases:g("total_purchases").default(0),totalDismissals:g("total_dismissals").default(0),viewRate:d("view_rate",{precision:5,scale:2}).default("0"),likeRate:d("like_rate",{precision:5,scale:2}).default("0"),purchaseRate:d("purchase_rate",{precision:5,scale:2}).default("0"),dismissalRate:d("dismissal_rate",{precision:5,scale:2}).default("0"),avgMatchScore:d("avg_match_score",{precision:5,scale:2}).default("0"),avgRank:d("avg_rank",{precision:5,scale:2}).default("0"),periodStart:a("period_start").notNull(),periodEnd:a("period_end").notNull(),createdAt:a("created_at").notNull().defaultNow(),updatedAt:a("updated_at").notNull().defaultNow()},e=>[r("idx_frame_rec_analytics_company").on(e.companyId),r("idx_frame_rec_analytics_product").on(e.productId),r("idx_frame_rec_analytics_period").on(e.periodStart,e.periodEnd)]);C({patientId:c().min(1,"Patient ID is required"),companyId:c().min(1,"Company ID is required"),faceShape:q(["oval","round","square","heart","diamond","oblong","triangle"]),faceShapeConfidence:k().min(0).max(100),faceLength:k().optional(),faceWidth:k().optional(),jawlineWidth:k().optional(),foreheadWidth:k().optional(),cheekboneWidth:k().optional(),skinTone:c().optional(),hairColor:c().optional(),eyeColor:c().optional(),photoUrl:c().url(),thumbnailUrl:c().url().optional(),aiModel:c().default("tensorflow-facemesh-v1"),processingTime:k().optional(),landmarkPoints:le().optional(),rawAnalysisData:le().optional()});C({productId:c().min(1,"Product ID is required"),companyId:c().min(1,"Company ID is required"),frameStyle:q(["rectangle","square","round","oval","cat_eye","aviator","wayfarer","browline","rimless","semi_rimless","geometric","wrap"]),frameMaterial:q(["metal","plastic","acetate","titanium","wood","carbon_fiber","mixed"]),frameSize:q(["small","medium","large"]),recommendedFaceShapes:fe(c()),lensWidth:k().optional(),bridgeWidth:k().optional(),templeLength:k().optional(),frameHeight:k().optional(),gender:c().optional(),ageRange:c().optional(),style:c().optional(),colorFamily:c().optional(),hasNosePads:oe().default(!1),isAdjustable:oe().default(!1),isSunglasses:oe().default(!1),isPolarized:oe().default(!1),popularityScore:k().min(0).max(100).default(0)});I(Nd);I(yd);I(bd);I(Sn);I(wn);I(xd);const wd=S("nhs_gos_claim_type",["GOS1","GOS2","GOS3","GOS4"]),Td=S("nhs_claim_status",["draft","submitted","accepted","rejected","paid","queried"]),Pd=S("nhs_voucher_type",["A","B","C","D","E","F","G","H"]),At=S("nhs_exemption_reason",["age_under_16","age_16_18_education","age_60_plus","income_support","jobseekers_allowance","pension_credit","universal_credit","hc2_certificate","hc3_certificate","war_pension","diabetes","glaucoma","registered_blind","family_history_glaucoma"]),Ad=f("nhs_practitioners",{id:t("id",{length:255}).primaryKey().$defaultFn(()=>crypto.randomUUID()),userId:t("user_id",{length:255}).notNull().references(()=>b.id,{onDelete:"cascade"}),companyId:t("company_id",{length:255}).notNull().references(()=>x.id,{onDelete:"cascade"}),gocNumber:t("goc_number",{length:20}).notNull().unique(),gocRegistrationType:t("goc_registration_type",{length:50}).notNull(),gocExpiryDate:V("goc_expiry_date").notNull(),performerNumber:t("performer_number",{length:20}).notNull().unique(),nhsContractStartDate:V("nhs_contract_start_date"),nhsContractEndDate:V("nhs_contract_end_date"),indemnityProvider:t("indemnity_provider",{length:255}),indemnityPolicyNumber:t("indemnity_policy_number",{length:100}),indemnityExpiryDate:V("indemnity_expiry_date"),isActive:p("is_active").notNull().default(!0),createdAt:a("created_at").notNull().defaultNow(),updatedAt:a("updated_at").notNull().defaultNow()},e=>[r("idx_nhs_practitioners_user").on(e.userId),r("idx_nhs_practitioners_company").on(e.companyId),r("idx_nhs_practitioners_goc").on(e.gocNumber)]);f("nhs_contract_details",{id:t("id",{length:255}).primaryKey().$defaultFn(()=>crypto.randomUUID()),companyId:t("company_id",{length:255}).notNull().unique().references(()=>x.id,{onDelete:"cascade"}),contractNumber:t("contract_number",{length:50}).notNull().unique(),contractHolderName:t("contract_holder_name",{length:255}).notNull(),contractStartDate:V("contract_start_date").notNull(),contractEndDate:V("contract_end_date"),odsCode:t("ods_code",{length:20}).notNull(),practiceAddress:m("practice_address").notNull(),pcseAccountNumber:t("pcse_account_number",{length:50}),pcseBankDetails:m("pcse_bank_details"),claimSubmissionEmail:t("claim_submission_email",{length:255}),claimSubmissionMethod:t("claim_submission_method",{length:50}),isActive:p("is_active").notNull().default(!0),createdAt:a("created_at").notNull().defaultNow(),updatedAt:a("updated_at").notNull().defaultNow()},e=>[r("idx_nhs_contracts_company").on(e.companyId),r("idx_nhs_contracts_ods").on(e.odsCode)]);const Ed=f("nhs_claims",{id:t("id",{length:255}).primaryKey().$defaultFn(()=>crypto.randomUUID()),companyId:t("company_id",{length:255}).notNull().references(()=>x.id,{onDelete:"cascade"}),patientId:t("patient_id",{length:255}).notNull().references(()=>F.id),examinationId:t("examination_id",{length:255}).references(()=>je.id),practitionerId:t("practitioner_id",{length:255}).notNull().references(()=>Ad.id),claimType:wd("claim_type").notNull(),claimNumber:t("claim_number",{length:50}).notNull().unique(),claimDate:V("claim_date").notNull(),testDate:V("test_date").notNull(),patientNhsNumber:t("patient_nhs_number",{length:20}),patientExemptionReason:At("patient_exemption_reason"),patientExemptionEvidence:t("patient_exemption_evidence",{length:255}),prescriptionIssued:p("prescription_issued").notNull().default(!1),referralMade:p("referral_made").notNull().default(!1),referralUrgency:t("referral_urgency",{length:50}),clinicalNotes:o("clinical_notes"),status:Td("status").notNull().default("draft"),submittedAt:a("submitted_at"),submittedBy:t("submitted_by",{length:255}).references(()=>b.id),pcseReference:t("pcse_reference",{length:100}),pcseStatus:t("pcse_status",{length:50}),pcseResponse:m("pcse_response"),rejectionReason:o("rejection_reason"),claimAmount:d("claim_amount",{precision:10,scale:2}).notNull(),paidAmount:d("paid_amount",{precision:10,scale:2}),paidAt:a("paid_at"),paymentReference:t("payment_reference",{length:100}),metadata:m("metadata"),createdAt:a("created_at").notNull().defaultNow(),updatedAt:a("updated_at").notNull().defaultNow()},e=>[r("idx_nhs_claims_company").on(e.companyId),r("idx_nhs_claims_patient").on(e.patientId),r("idx_nhs_claims_examination").on(e.examinationId),r("idx_nhs_claims_practitioner").on(e.practitionerId),r("idx_nhs_claims_status").on(e.status),r("idx_nhs_claims_date").on(e.claimDate)]);f("nhs_vouchers",{id:t("id",{length:255}).primaryKey().$defaultFn(()=>crypto.randomUUID()),companyId:t("company_id",{length:255}).notNull().references(()=>x.id,{onDelete:"cascade"}),patientId:t("patient_id",{length:255}).notNull().references(()=>F.id),prescriptionId:t("prescription_id",{length:255}).references(()=>we.id),claimId:t("claim_id",{length:255}).references(()=>Ed.id),voucherType:Pd("voucher_type").notNull(),voucherNumber:t("voucher_number",{length:50}).notNull().unique(),voucherValue:d("voucher_value",{precision:10,scale:2}).notNull(),issueDate:V("issue_date").notNull(),expiryDate:V("expiry_date").notNull(),exemptionReason:At("exemption_reason").notNull(),exemptionEvidence:t("exemption_evidence",{length:255}),sphereOD:d("sphere_od",{precision:5,scale:2}),sphereOS:d("sphere_os",{precision:5,scale:2}),cylinderOD:d("cylinder_od",{precision:5,scale:2}),cylinderOS:d("cylinder_os",{precision:5,scale:2}),prismRequired:p("prism_required").default(!1),tintRequired:p("tint_required").default(!1),isRedeemed:p("is_redeemed").notNull().default(!1),redeemedAt:a("redeemed_at"),redeemedAmount:d("redeemed_amount",{precision:10,scale:2}),patientContribution:d("patient_contribution",{precision:10,scale:2}),hasComplexSupplement:p("has_complex_supplement").default(!1),supplementAmount:d("supplement_amount",{precision:10,scale:2}),supplementReason:o("supplement_reason"),status:t("status",{length:50}).notNull().default("active"),metadata:m("metadata"),createdAt:a("created_at").notNull().defaultNow(),updatedAt:a("updated_at").notNull().defaultNow()},e=>[r("idx_nhs_vouchers_company").on(e.companyId),r("idx_nhs_vouchers_patient").on(e.patientId),r("idx_nhs_vouchers_status").on(e.status),r("idx_nhs_vouchers_expiry").on(e.expiryDate)]);const kd=f("nhs_patient_exemptions",{id:t("id",{length:255}).primaryKey().$defaultFn(()=>crypto.randomUUID()),companyId:t("company_id",{length:255}).notNull().references(()=>x.id,{onDelete:"cascade"}),patientId:t("patient_id",{length:255}).notNull().references(()=>F.id),exemptionReason:At("exemption_reason").notNull(),evidenceType:t("evidence_type",{length:100}),evidenceNumber:t("evidence_number",{length:100}),evidenceDocumentUrl:o("evidence_document_url"),validFrom:V("valid_from").notNull(),validUntil:V("valid_until"),isLifelong:p("is_lifelong").default(!1),verifiedBy:t("verified_by",{length:255}).references(()=>b.id),verifiedAt:a("verified_at"),isActive:p("is_active").notNull().default(!0),notes:o("notes"),metadata:m("metadata"),createdAt:a("created_at").notNull().defaultNow(),updatedAt:a("updated_at").notNull().defaultNow()},e=>[r("idx_nhs_exemptions_company").on(e.companyId),r("idx_nhs_exemptions_patient").on(e.patientId),r("idx_nhs_exemptions_status").on(e.isActive),r("idx_nhs_exemptions_expiry").on(e.validUntil)]);f("nhs_payments",{id:t("id",{length:255}).primaryKey().$defaultFn(()=>crypto.randomUUID()),companyId:t("company_id",{length:255}).notNull().references(()=>x.id,{onDelete:"cascade"}),paymentReference:t("payment_reference",{length:100}).notNull().unique(),paymentDate:V("payment_date").notNull(),paymentAmount:d("payment_amount",{precision:10,scale:2}).notNull(),periodStart:V("period_start").notNull(),periodEnd:V("period_end").notNull(),claimCount:g("claim_count").notNull().default(0),claimIds:m("claim_ids").$type(),paymentMethod:t("payment_method",{length:50}),bankAccount:t("bank_account",{length:20}),isReconciled:p("is_reconciled").notNull().default(!1),reconciledAt:a("reconciled_at"),reconciledBy:t("reconciled_by",{length:255}).references(()=>b.id),discrepancyAmount:d("discrepancy_amount",{precision:10,scale:2}),discrepancyNotes:o("discrepancy_notes"),metadata:m("metadata"),createdAt:a("created_at").notNull().defaultNow(),updatedAt:a("updated_at").notNull().defaultNow()},e=>[r("idx_nhs_payments_company").on(e.companyId),r("idx_nhs_payments_date").on(e.paymentDate),r("idx_nhs_payments_reconciled").on(e.isReconciled)]);C({userId:c().min(1),companyId:c().min(1),gocNumber:c().min(1).max(20),gocRegistrationType:q(["optometrist","dispensing_optician"]),gocExpiryDate:c(),performerNumber:c().min(1).max(20),nhsContractStartDate:c().optional(),nhsContractEndDate:c().optional(),indemnityProvider:c().optional(),indemnityPolicyNumber:c().optional(),indemnityExpiryDate:c().optional()});C({companyId:c().min(1),patientId:c().min(1),examinationId:c().optional(),practitionerId:c().min(1),claimType:q(["GOS1","GOS2","GOS3","GOS4"]),testDate:c(),patientNhsNumber:c().optional(),patientExemptionReason:c().optional(),patientExemptionEvidence:c().optional(),prescriptionIssued:oe().default(!1),referralMade:oe().default(!1),referralUrgency:q(["routine","urgent","emergency"]).optional(),clinicalNotes:c().optional(),claimAmount:k().positive()});C({companyId:c().min(1),patientId:c().min(1),prescriptionId:c().optional(),claimId:c().optional(),voucherType:q(["A","B","C","D","E","F","G","H"]),voucherValue:k().positive(),issueDate:c(),expiryDate:c(),exemptionReason:c(),exemptionEvidence:c().optional(),sphereOD:k().optional(),sphereOS:k().optional(),cylinderOD:k().optional(),cylinderOS:k().optional(),prismRequired:oe().default(!1),tintRequired:oe().default(!1)});const Tn=S("cl_wearing_schedule",["daily_wear","extended_wear","continuous_wear","occasional_wear"]),Pn=S("cl_replacement_schedule",["daily_disposable","two_weekly","monthly","quarterly","yearly"]),ke=S("cl_lens_type",["soft","rigid_gas_permeable","hybrid","scleral","orthokeratology"]),_t=S("cl_design",["spherical","toric","multifocal","monovision","custom"]),ft=S("cl_fit_assessment",["optimal","acceptable","too_tight","too_loose","decentered"]),Ld=S("cl_aftercare_status",["scheduled","completed","cancelled","no_show","rescheduled"]),Ud=f("contact_lens_assessments",{id:t("id",{length:255}).primaryKey().$defaultFn(()=>crypto.randomUUID()),companyId:t("company_id",{length:255}).notNull().references(()=>x.id,{onDelete:"cascade"}),patientId:t("patient_id",{length:255}).notNull().references(()=>F.id),practitionerId:t("practitioner_id",{length:255}).references(()=>b.id),assessmentDate:V("assessment_date").notNull(),previousClWearer:p("previous_cl_wearer").notNull().default(!1),previousClType:t("previous_cl_type",{length:100}),reasonForDiscontinuation:o("reason_for_discontinuation"),motivationReason:o("motivation_reason"),occupation:t("occupation",{length:255}),hobbies:o("hobbies"),screenTime:t("screen_time",{length:50}),dryEyes:p("dry_eyes").default(!1),allergies:o("allergies"),medications:o("medications"),contraindications:o("contraindications"),tearQuality:t("tear_quality",{length:50}),tearBreakupTime:d("tear_breakup_time",{precision:4,scale:1}),corneaCondition:o("cornea_condition"),conjunctivaCondition:o("conjunctiva_condition"),lidsCondition:o("lids_condition"),suitable:p("suitable").notNull(),recommendedLensType:ke("recommended_lens_type"),recommendedWearingSchedule:Tn("recommended_wearing_schedule"),notes:o("notes"),createdAt:a("created_at").notNull().defaultNow(),updatedAt:a("updated_at").notNull().defaultNow()},e=>[r("cl_assessments_company_idx").on(e.companyId),r("cl_assessments_patient_idx").on(e.patientId),r("cl_assessments_date_idx").on(e.assessmentDate)]),Vd=f("contact_lens_fittings",{id:t("id",{length:255}).primaryKey().$defaultFn(()=>crypto.randomUUID()),companyId:t("company_id",{length:255}).notNull().references(()=>x.id,{onDelete:"cascade"}),patientId:t("patient_id",{length:255}).notNull().references(()=>F.id),assessmentId:t("assessment_id",{length:255}).references(()=>Ud.id),practitionerId:t("practitioner_id",{length:255}).references(()=>b.id),fittingDate:V("fitting_date").notNull(),eye:t("eye",{length:2}).notNull(),trialLensBrand:t("trial_lens_brand",{length:255}).notNull(),trialLensType:ke("trial_lens_type").notNull(),trialBaseCurve:d("trial_base_curve",{precision:4,scale:2}),trialDiameter:d("trial_diameter",{precision:4,scale:1}),trialPower:d("trial_power",{precision:5,scale:2}),trialCylinder:d("trial_cylinder",{precision:5,scale:2}),trialAxis:g("trial_axis"),trialAddition:d("trial_addition",{precision:3,scale:2}),overRefractionSphere:d("over_refraction_sphere",{precision:5,scale:2}),overRefractionCylinder:d("over_refraction_cylinder",{precision:5,scale:2}),overRefractionAxis:g("over_refraction_axis"),centration:t("centration",{length:50}),movement:t("movement",{length:50}),coverage:t("coverage",{length:50}),comfort:t("comfort",{length:50}),fitAssessment:ft("fit_assessment").notNull(),distanceVision:t("distance_vision",{length:10}),nearVision:t("near_vision",{length:10}),finalBaseCurve:d("final_base_curve",{precision:4,scale:2}),finalDiameter:d("final_diameter",{precision:4,scale:1}),finalPower:d("final_power",{precision:5,scale:2}),finalCylinder:d("final_cylinder",{precision:5,scale:2}),finalAxis:g("final_axis"),finalAddition:d("final_addition",{precision:3,scale:2}),insertionTaught:p("insertion_taught").default(!1),removalTaught:p("removal_taught").default(!1),careTaught:p("care_taught").default(!1),patientDemonstrated:p("patient_demonstrated").default(!1),notes:o("notes"),createdAt:a("created_at").notNull().defaultNow(),updatedAt:a("updated_at").notNull().defaultNow()},e=>[r("cl_fittings_company_idx").on(e.companyId),r("cl_fittings_patient_idx").on(e.patientId),r("cl_fittings_date_idx").on(e.fittingDate)]),An=f("contact_lens_prescriptions",{id:t("id",{length:255}).primaryKey().$defaultFn(()=>crypto.randomUUID()),companyId:t("company_id",{length:255}).notNull().references(()=>x.id,{onDelete:"cascade"}),patientId:t("patient_id",{length:255}).notNull().references(()=>F.id),fittingId:t("fitting_id",{length:255}).references(()=>Vd.id),practitionerId:t("practitioner_id",{length:255}).references(()=>b.id),prescriptionDate:V("prescription_date").notNull(),expiryDate:V("expiry_date"),odBrand:t("od_brand",{length:255}).notNull(),odLensType:ke("od_lens_type").notNull(),odDesign:_t("od_design").notNull(),odBaseCurve:d("od_base_curve",{precision:4,scale:2}).notNull(),odDiameter:d("od_diameter",{precision:4,scale:1}).notNull(),odPower:d("od_power",{precision:5,scale:2}).notNull(),odCylinder:d("od_cylinder",{precision:5,scale:2}),odAxis:g("od_axis"),odAddition:d("od_addition",{precision:3,scale:2}),odColor:t("od_color",{length:100}),osBrand:t("os_brand",{length:255}).notNull(),osLensType:ke("os_lens_type").notNull(),osDesign:_t("os_design").notNull(),osBaseCurve:d("os_base_curve",{precision:4,scale:2}).notNull(),osDiameter:d("os_diameter",{precision:4,scale:1}).notNull(),osPower:d("os_power",{precision:5,scale:2}).notNull(),osCylinder:d("os_cylinder",{precision:5,scale:2}),osAxis:g("os_axis"),osAddition:d("os_addition",{precision:3,scale:2}),osColor:t("os_color",{length:100}),wearingSchedule:Tn("wearing_schedule").notNull(),replacementSchedule:Pn("replacement_schedule").notNull(),maxWearingTime:g("max_wearing_time"),careSystemBrand:t("care_system_brand",{length:255}),careSystemType:t("care_system_type",{length:100}),firstFollowUpDate:V("first_follow_up_date"),weekFollowUpDate:V("week_follow_up_date"),monthFollowUpDate:V("month_follow_up_date"),specialInstructions:o("special_instructions"),notes:o("notes"),nhsFunded:p("nhs_funded").default(!1),nhsExemptionId:t("nhs_exemption_id",{length:255}).references(()=>kd.id),isActive:p("is_active").notNull().default(!0),createdAt:a("created_at").notNull().defaultNow(),updatedAt:a("updated_at").notNull().defaultNow()},e=>[r("cl_prescriptions_company_idx").on(e.companyId),r("cl_prescriptions_patient_idx").on(e.patientId),r("cl_prescriptions_date_idx").on(e.prescriptionDate),r("cl_prescriptions_active_idx").on(e.isActive)]);f("contact_lens_aftercare",{id:t("id",{length:255}).primaryKey().$defaultFn(()=>crypto.randomUUID()),companyId:t("company_id",{length:255}).notNull().references(()=>x.id,{onDelete:"cascade"}),patientId:t("patient_id",{length:255}).notNull().references(()=>F.id),prescriptionId:t("prescription_id",{length:255}).references(()=>An.id),practitionerId:t("practitioner_id",{length:255}).references(()=>b.id),appointmentDate:V("appointment_date").notNull(),appointmentType:t("appointment_type",{length:50}).notNull(),status:Ld("status").notNull().default("scheduled"),wearingTimeCompliance:t("wearing_time_compliance",{length:50}),replacementCompliance:t("replacement_compliance",{length:50}),careSystemCompliance:t("care_system_compliance",{length:50}),sleepingInLenses:p("sleeping_in_lenses"),waterExposure:p("water_exposure"),visualAcuityOD:t("visual_acuity_od",{length:10}),visualAcuityOS:t("visual_acuity_os",{length:10}),comfort:t("comfort",{length:50}),lensConditionOD:t("lens_condition_od",{length:100}),lensConditionOS:t("lens_condition_os",{length:100}),fitAssessmentOD:ft("fit_assessment_od"),fitAssessmentOS:ft("fit_assessment_os"),corneaHealthOD:t("cornea_health_od",{length:100}),corneaHealthOS:t("cornea_health_os",{length:100}),conjunctivaHealthOD:t("conjunctiva_health_od",{length:100}),conjunctivaHealthOS:t("conjunctiva_health_os",{length:100}),problemsReported:o("problems_reported"),adverseEvents:o("adverse_events"),prescriptionChanged:p("prescription_changed").default(!1),lensesReplaced:p("lenses_replaced").default(!1),careSystemChanged:p("care_system_changed").default(!1),additionalTraining:p("additional_training").default(!1),referralMade:p("referral_made").default(!1),nextAppointmentDate:V("next_appointment_date"),nextAppointmentReason:o("next_appointment_reason"),notes:o("notes"),createdAt:a("created_at").notNull().defaultNow(),updatedAt:a("updated_at").notNull().defaultNow()},e=>[r("cl_aftercare_company_idx").on(e.companyId),r("cl_aftercare_patient_idx").on(e.patientId),r("cl_aftercare_date_idx").on(e.appointmentDate),r("cl_aftercare_status_idx").on(e.status)]);const Kt=f("contact_lens_inventory",{id:t("id",{length:255}).primaryKey().$defaultFn(()=>crypto.randomUUID()),companyId:t("company_id",{length:255}).notNull().references(()=>x.id,{onDelete:"cascade"}),brand:t("brand",{length:255}).notNull(),productName:t("product_name",{length:255}).notNull(),lensType:ke("lens_type").notNull(),design:_t("design").notNull(),replacementSchedule:Pn("replacement_schedule").notNull(),baseCurve:d("base_curve",{precision:4,scale:2}).notNull(),diameter:d("diameter",{precision:4,scale:1}).notNull(),power:d("power",{precision:5,scale:2}).notNull(),cylinder:d("cylinder",{precision:5,scale:2}),axis:g("axis"),addition:d("addition",{precision:3,scale:2}),quantityInStock:g("quantity_in_stock").notNull().default(0),reorderLevel:g("reorder_level").notNull().default(5),reorderQuantity:g("reorder_quantity").notNull().default(10),unitCost:d("unit_cost",{precision:10,scale:2}),retailPrice:d("retail_price",{precision:10,scale:2}),supplierId:t("supplier_id",{length:255}),supplierProductCode:t("supplier_product_code",{length:100}),expiryDate:V("expiry_date"),batchNumber:t("batch_number",{length:100}),isActive:p("is_active").notNull().default(!0),isTrialLens:p("is_trial_lens").default(!1),createdAt:a("created_at").notNull().defaultNow(),updatedAt:a("updated_at").notNull().defaultNow()},e=>[r("cl_inventory_company_idx").on(e.companyId),r("cl_inventory_brand_idx").on(e.brand),r("cl_inventory_stock_idx").on(e.quantityInStock),r("cl_inventory_active_idx").on(e.isActive),Se("cl_inventory_unique").on(e.companyId,e.brand,e.baseCurve,e.diameter,e.power,e.cylinder,e.axis,e.addition)]);f("contact_lens_orders",{id:t("id",{length:255}).primaryKey().$defaultFn(()=>crypto.randomUUID()),companyId:t("company_id",{length:255}).notNull().references(()=>x.id,{onDelete:"cascade"}),patientId:t("patient_id",{length:255}).notNull().references(()=>F.id),prescriptionId:t("prescription_id",{length:255}).references(()=>An.id),orderNumber:t("order_number",{length:50}).notNull().unique(),orderDate:V("order_date").notNull(),odInventoryId:t("od_inventory_id",{length:255}).references(()=>Kt.id),odQuantity:g("od_quantity").notNull(),odUnitPrice:d("od_unit_price",{precision:10,scale:2}).notNull(),osInventoryId:t("os_inventory_id",{length:255}).references(()=>Kt.id),osQuantity:g("os_quantity").notNull(),osUnitPrice:d("os_unit_price",{precision:10,scale:2}).notNull(),careSystemInventoryId:t("care_system_inventory_id",{length:255}),careSystemQuantity:g("care_system_quantity"),careSystemPrice:d("care_system_price",{precision:10,scale:2}),subtotal:d("subtotal",{precision:10,scale:2}).notNull(),discount:d("discount",{precision:10,scale:2}).default("0"),tax:d("tax",{precision:10,scale:2}).default("0"),total:d("total",{precision:10,scale:2}).notNull(),nhsFunded:p("nhs_funded").default(!1),nhsVoucherId:t("nhs_voucher_id",{length:255}),status:t("status",{length:50}).notNull().default("pending"),orderedDate:V("ordered_date"),receivedDate:V("received_date"),dispensedDate:V("dispensed_date"),notes:o("notes"),createdAt:a("created_at").notNull().defaultNow(),updatedAt:a("updated_at").notNull().defaultNow()},e=>[r("cl_orders_company_idx").on(e.companyId),r("cl_orders_patient_idx").on(e.patientId),r("cl_orders_date_idx").on(e.orderDate),r("cl_orders_status_idx").on(e.status)]);const Cd=S("shopify_store_status",["active","inactive","suspended","expired"]),Et=f("shopify_stores",{id:t("id",{length:255}).primaryKey().$defaultFn(()=>crypto.randomUUID()),companyId:t("company_id",{length:255}).notNull().references(()=>x.id,{onDelete:"cascade"}),shopifyDomain:t("shopify_domain",{length:255}).notNull().unique(),shopifyStoreId:t("shopify_store_id",{length:255}).notNull().unique(),storeName:t("store_name",{length:255}).notNull(),storeEmail:t("store_email",{length:255}),storeUrl:t("store_url",{length:500}).notNull(),accessToken:o("access_token").notNull(),apiKey:t("api_key",{length:255}).notNull(),apiSecretKey:o("api_secret_key").notNull(),webhookSecret:o("webhook_secret"),enablePrescriptionVerification:p("enable_prescription_verification").default(!0),enableAIRecommendations:p("enable_ai_recommendations").default(!0),enableAutoOrderSync:p("enable_auto_order_sync").default(!0),requirePrescriptionUpload:p("require_prescription_upload").default(!1),markupPercentage:d("markup_percentage",{precision:5,scale:2}).default("0"),status:Cd("status").notNull().default("active"),installedAt:a("installed_at").notNull().defaultNow(),lastSyncAt:a("last_sync_at"),expiresAt:a("expires_at"),createdAt:a("created_at").notNull().defaultNow(),updatedAt:a("updated_at").notNull().defaultNow()},e=>[r("shopify_stores_company_idx").on(e.companyId),r("shopify_stores_status_idx").on(e.status)]),jd=S("shopify_order_sync_status",["pending","synced","processing","completed","failed","cancelled"]),Bd=f("shopify_orders",{id:t("id",{length:255}).primaryKey().$defaultFn(()=>crypto.randomUUID()),companyId:t("company_id",{length:255}).notNull().references(()=>x.id,{onDelete:"cascade"}),shopifyStoreId:t("shopify_store_id",{length:255}).notNull().references(()=>Et.id,{onDelete:"cascade"}),ilsOrderId:t("ils_order_id",{length:255}).references(()=>te.id),patientId:t("patient_id",{length:255}).references(()=>F.id),prescriptionId:t("prescription_id",{length:255}).references(()=>we.id),shopifyOrderNumber:t("shopify_order_number",{length:100}).notNull(),shopifyOrderId:t("shopify_order_id",{length:255}).notNull().unique(),shopifyOrderName:t("shopify_order_name",{length:100}),customerEmail:t("customer_email",{length:255}),customerPhone:t("customer_phone",{length:50}),customerName:t("customer_name",{length:255}),shippingAddress:m("shipping_address"),billingAddress:m("billing_address"),orderItems:m("order_items").notNull(),prescriptionData:m("prescription_data"),prescriptionVerified:p("prescription_verified").default(!1),prescriptionVerifiedAt:a("prescription_verified_at"),prescriptionVerifiedBy:t("prescription_verified_by",{length:255}),aiRecommendations:m("ai_recommendations"),aiRecommendationUsed:p("ai_recommendation_used").default(!1),subtotal:d("subtotal",{precision:10,scale:2}).notNull(),tax:d("tax",{precision:10,scale:2}).default("0"),shipping:d("shipping",{precision:10,scale:2}).default("0"),total:d("total",{precision:10,scale:2}).notNull(),currency:t("currency",{length:10}).notNull().default("GBP"),syncStatus:jd("sync_status").notNull().default("pending"),shopifyFulfillmentStatus:t("shopify_fulfillment_status",{length:50}),shopifyFinancialStatus:t("shopify_financial_status",{length:50}),syncedAt:a("synced_at"),lastSyncAttempt:a("last_sync_attempt"),syncError:o("sync_error"),syncRetryCount:g("sync_retry_count").default(0),fulfilledAt:a("fulfilled_at"),trackingNumber:t("tracking_number",{length:255}),trackingUrl:t("tracking_url",{length:500}),notes:o("notes"),shopifyCreatedAt:a("shopify_created_at"),shopifyUpdatedAt:a("shopify_updated_at"),createdAt:a("created_at").notNull().defaultNow(),updatedAt:a("updated_at").notNull().defaultNow()},e=>[r("shopify_orders_company_idx").on(e.companyId),r("shopify_orders_store_idx").on(e.shopifyStoreId),r("shopify_orders_sync_status_idx").on(e.syncStatus),r("shopify_orders_shopify_id_idx").on(e.shopifyOrderId),r("shopify_orders_ils_order_idx").on(e.ilsOrderId)]),qd=S("prescription_verification_status",["pending","verified","rejected","expired","requires_review"]);f("prescription_uploads",{id:t("id",{length:255}).primaryKey().$defaultFn(()=>crypto.randomUUID()),companyId:t("company_id",{length:255}).notNull().references(()=>x.id,{onDelete:"cascade"}),shopifyOrderId:t("shopify_order_id",{length:255}).references(()=>Bd.id),patientId:t("patient_id",{length:255}).references(()=>F.id),fileUrl:o("file_url").notNull(),fileName:t("file_name",{length:255}).notNull(),fileType:t("file_type",{length:50}).notNull(),fileSize:g("file_size"),aiExtractedData:m("ai_extracted_data"),aiExtractionConfidence:d("ai_extraction_confidence",{precision:5,scale:2}),prescriptionData:m("prescription_data"),prescriptionDate:V("prescription_date"),expiryDate:V("expiry_date"),practitionerName:t("practitioner_name",{length:255}),practitionerGocNumber:t("practitioner_goc_number",{length:50}),verificationStatus:qd("verification_status").notNull().default("pending"),verifiedBy:t("verified_by",{length:255}),verifiedAt:a("verified_at"),rejectionReason:o("rejection_reason"),requiresReview:p("requires_review").default(!1),reviewNotes:o("review_notes"),uploadedAt:a("uploaded_at").notNull().defaultNow(),createdAt:a("created_at").notNull().defaultNow(),updatedAt:a("updated_at").notNull().defaultNow()},e=>[r("prescription_uploads_company_idx").on(e.companyId),r("prescription_uploads_order_idx").on(e.shopifyOrderId),r("prescription_uploads_status_idx").on(e.verificationStatus),r("prescription_uploads_requires_review_idx").on(e.requiresReview)]);f("shopify_products",{id:t("id",{length:255}).primaryKey().$defaultFn(()=>crypto.randomUUID()),companyId:t("company_id",{length:255}).notNull().references(()=>x.id,{onDelete:"cascade"}),shopifyStoreId:t("shopify_store_id",{length:255}).notNull().references(()=>Et.id,{onDelete:"cascade"}),shopifyProductId:t("shopify_product_id",{length:255}).notNull(),shopifyVariantId:t("shopify_variant_id",{length:255}),productTitle:t("product_title",{length:255}).notNull(),productType:t("product_type",{length:100}),sku:t("sku",{length:100}),ilsProductId:t("ils_product_id",{length:255}),ilsProductType:t("ils_product_type",{length:50}),price:d("price",{precision:10,scale:2}).notNull(),compareAtPrice:d("compare_at_price",{precision:10,scale:2}),inventoryQuantity:g("inventory_quantity").default(0),trackInventory:p("track_inventory").default(!1),lastSyncedAt:a("last_synced_at"),syncEnabled:p("sync_enabled").default(!0),productMetadata:m("product_metadata"),createdAt:a("created_at").notNull().defaultNow(),updatedAt:a("updated_at").notNull().defaultNow()},e=>[r("shopify_products_company_idx").on(e.companyId),r("shopify_products_store_idx").on(e.shopifyStoreId),r("shopify_products_shopify_id_idx").on(e.shopifyProductId),Se("shopify_products_unique").on(e.shopifyStoreId,e.shopifyProductId,e.shopifyVariantId)]);f("shopify_webhooks",{id:t("id",{length:255}).primaryKey().$defaultFn(()=>crypto.randomUUID()),shopifyStoreId:t("shopify_store_id",{length:255}).references(()=>Et.id,{onDelete:"cascade"}),webhookTopic:t("webhook_topic",{length:100}).notNull(),shopifyWebhookId:t("shopify_webhook_id",{length:255}),payload:m("payload").notNull(),headers:m("headers"),processed:p("processed").default(!1),processedAt:a("processed_at"),processingError:o("processing_error"),processingRetryCount:g("processing_retry_count").default(0),signatureValid:p("signature_valid"),receivedAt:a("received_at").notNull().defaultNow(),createdAt:a("created_at").notNull().defaultNow()},e=>[r("shopify_webhooks_store_idx").on(e.shopifyStoreId),r("shopify_webhooks_topic_idx").on(e.webhookTopic),r("shopify_webhooks_processed_idx").on(e.processed),r("shopify_webhooks_received_idx").on(e.receivedAt)]);function Od({open:e,onOpenChange:n,supplier:i}){const{toast:l}=Le(),u=!!i,h=Qa({resolver:Ha(gn),defaultValues:{organizationName:"",email:"",accountNumber:"",contactEmail:"",contactPhone:"",address:{street:"",city:"",state:"",zipCode:"",country:""}}});$.useEffect(()=>{e&&i?h.reset({organizationName:i.organizationName||"",email:i.email||"",accountNumber:i.accountNumber||"",contactEmail:i.contactEmail||"",contactPhone:i.contactPhone||"",address:i.address||{street:"",city:"",state:"",zipCode:"",country:""}}):e&&!i&&h.reset({organizationName:"",email:"",accountNumber:"",contactEmail:"",contactPhone:"",address:{street:"",city:"",state:"",zipCode:"",country:""}})},[e,i,h]);const D=ye({mutationFn:async v=>await(await Ne("POST","/api/suppliers",v)).json(),onSuccess:()=>{ae.invalidateQueries({queryKey:["/api/suppliers"]}),l({title:"Supplier created",description:"The supplier has been created successfully."}),n(!1)},onError:v=>{l({title:"Error creating supplier",description:v.message,variant:"destructive"})}}),A=ye({mutationFn:async v=>await(await Ne("PATCH",`/api/suppliers/${i?.id}`,v)).json(),onSuccess:()=>{ae.invalidateQueries({queryKey:["/api/suppliers"]}),l({title:"Supplier updated",description:"The supplier has been updated successfully."}),n(!1)},onError:v=>{l({title:"Error updating supplier",description:v.message,variant:"destructive"})}}),w=v=>{u?A.mutate(v):D.mutate(v)};return s.jsxDEV(yt,{open:e,onOpenChange:n,children:s.jsxDEV(bt,{className:"max-w-2xl max-h-[90vh] overflow-y-auto","data-testid":"dialog-supplier-management",children:[s.jsxDEV(xt,{children:[s.jsxDEV(Dt,{"data-testid":"text-dialog-title",children:u?"Edit Supplier":"Add New Supplier"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SupplierManagementDialog.tsx",lineNumber:157,columnNumber:11},this),s.jsxDEV(vt,{children:u?"Update the supplier information below.":"Enter the details for the new supplier."},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SupplierManagementDialog.tsx",lineNumber:160,columnNumber:11},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SupplierManagementDialog.tsx",lineNumber:156,columnNumber:9},this),s.jsxDEV(Ga,{...h,children:s.jsxDEV("form",{onSubmit:h.handleSubmit(w),className:"space-y-4",children:[s.jsxDEV(ue,{control:h.control,name:"organizationName",render:({field:v})=>s.jsxDEV(me,{children:[s.jsxDEV(Te,{children:"Organization Name *"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SupplierManagementDialog.tsx",lineNumber:174,columnNumber:19},this),s.jsxDEV(pe,{children:s.jsxDEV(ee,{...v,placeholder:"ABC Lens Company","data-testid":"input-organization-name"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SupplierManagementDialog.tsx",lineNumber:176,columnNumber:21},this)},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SupplierManagementDialog.tsx",lineNumber:175,columnNumber:19},this),s.jsxDEV(_e,{},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SupplierManagementDialog.tsx",lineNumber:182,columnNumber:19},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SupplierManagementDialog.tsx",lineNumber:173,columnNumber:17},this)},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SupplierManagementDialog.tsx",lineNumber:169,columnNumber:13},this),s.jsxDEV(ue,{control:h.control,name:"accountNumber",render:({field:v})=>s.jsxDEV(me,{children:[s.jsxDEV(Te,{children:"Account Number"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SupplierManagementDialog.tsx",lineNumber:192,columnNumber:19},this),s.jsxDEV(pe,{children:s.jsxDEV(ee,{...v,placeholder:"ACCT-12345","data-testid":"input-account-number"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SupplierManagementDialog.tsx",lineNumber:194,columnNumber:21},this)},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SupplierManagementDialog.tsx",lineNumber:193,columnNumber:19},this),s.jsxDEV(_e,{},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SupplierManagementDialog.tsx",lineNumber:200,columnNumber:19},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SupplierManagementDialog.tsx",lineNumber:191,columnNumber:17},this)},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SupplierManagementDialog.tsx",lineNumber:187,columnNumber:13},this),s.jsxDEV("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxDEV(ue,{control:h.control,name:"email",render:({field:v})=>s.jsxDEV(me,{children:[s.jsxDEV(Te,{children:"Login Email"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SupplierManagementDialog.tsx",lineNumber:211,columnNumber:21},this),s.jsxDEV(pe,{children:s.jsxDEV(ee,{...v,type:"email",placeholder:"supplier@example.com","data-testid":"input-email"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SupplierManagementDialog.tsx",lineNumber:213,columnNumber:23},this)},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SupplierManagementDialog.tsx",lineNumber:212,columnNumber:21},this),s.jsxDEV(_e,{},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SupplierManagementDialog.tsx",lineNumber:220,columnNumber:21},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SupplierManagementDialog.tsx",lineNumber:210,columnNumber:19},this)},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SupplierManagementDialog.tsx",lineNumber:206,columnNumber:15},this),s.jsxDEV(ue,{control:h.control,name:"contactEmail",render:({field:v})=>s.jsxDEV(me,{children:[s.jsxDEV(Te,{children:"Contact Email"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SupplierManagementDialog.tsx",lineNumber:230,columnNumber:21},this),s.jsxDEV(pe,{children:s.jsxDEV(ee,{...v,type:"email",placeholder:"orders@example.com","data-testid":"input-contact-email"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SupplierManagementDialog.tsx",lineNumber:232,columnNumber:23},this)},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SupplierManagementDialog.tsx",lineNumber:231,columnNumber:21},this),s.jsxDEV(_e,{},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SupplierManagementDialog.tsx",lineNumber:239,columnNumber:21},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SupplierManagementDialog.tsx",lineNumber:229,columnNumber:19},this)},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SupplierManagementDialog.tsx",lineNumber:225,columnNumber:15},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SupplierManagementDialog.tsx",lineNumber:205,columnNumber:13},this),s.jsxDEV(ue,{control:h.control,name:"contactPhone",render:({field:v})=>s.jsxDEV(me,{children:[s.jsxDEV(Te,{children:"Contact Phone"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SupplierManagementDialog.tsx",lineNumber:250,columnNumber:19},this),s.jsxDEV(pe,{children:s.jsxDEV(ee,{...v,placeholder:"(555) 123-4567","data-testid":"input-contact-phone"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SupplierManagementDialog.tsx",lineNumber:252,columnNumber:21},this)},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SupplierManagementDialog.tsx",lineNumber:251,columnNumber:19},this),s.jsxDEV(_e,{},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SupplierManagementDialog.tsx",lineNumber:258,columnNumber:19},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SupplierManagementDialog.tsx",lineNumber:249,columnNumber:17},this)},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SupplierManagementDialog.tsx",lineNumber:245,columnNumber:13},this),s.jsxDEV("div",{className:"space-y-3",children:[s.jsxDEV(ge,{children:"Address"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SupplierManagementDialog.tsx",lineNumber:264,columnNumber:15},this),s.jsxDEV(ue,{control:h.control,name:"address.street",render:({field:v})=>s.jsxDEV(me,{children:[s.jsxDEV(pe,{children:s.jsxDEV(ee,{...v,placeholder:"Street Address","data-testid":"input-address-street"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SupplierManagementDialog.tsx",lineNumber:271,columnNumber:23},this)},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SupplierManagementDialog.tsx",lineNumber:270,columnNumber:21},this),s.jsxDEV(_e,{},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SupplierManagementDialog.tsx",lineNumber:277,columnNumber:21},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SupplierManagementDialog.tsx",lineNumber:269,columnNumber:19},this)},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SupplierManagementDialog.tsx",lineNumber:265,columnNumber:15},this),s.jsxDEV("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxDEV(ue,{control:h.control,name:"address.city",render:({field:v})=>s.jsxDEV(me,{children:[s.jsxDEV(pe,{children:s.jsxDEV(ee,{...v,placeholder:"City","data-testid":"input-address-city"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SupplierManagementDialog.tsx",lineNumber:289,columnNumber:25},this)},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SupplierManagementDialog.tsx",lineNumber:288,columnNumber:23},this),s.jsxDEV(_e,{},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SupplierManagementDialog.tsx",lineNumber:295,columnNumber:23},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SupplierManagementDialog.tsx",lineNumber:287,columnNumber:21},this)},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SupplierManagementDialog.tsx",lineNumber:283,columnNumber:17},this),s.jsxDEV(ue,{control:h.control,name:"address.state",render:({field:v})=>s.jsxDEV(me,{children:[s.jsxDEV(pe,{children:s.jsxDEV(ee,{...v,placeholder:"State/Province","data-testid":"input-address-state"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SupplierManagementDialog.tsx",lineNumber:306,columnNumber:25},this)},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SupplierManagementDialog.tsx",lineNumber:305,columnNumber:23},this),s.jsxDEV(_e,{},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SupplierManagementDialog.tsx",lineNumber:312,columnNumber:23},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SupplierManagementDialog.tsx",lineNumber:304,columnNumber:21},this)},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SupplierManagementDialog.tsx",lineNumber:300,columnNumber:17},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SupplierManagementDialog.tsx",lineNumber:282,columnNumber:15},this),s.jsxDEV("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxDEV(ue,{control:h.control,name:"address.zipCode",render:({field:v})=>s.jsxDEV(me,{children:[s.jsxDEV(pe,{children:s.jsxDEV(ee,{...v,placeholder:"Zip/Postal Code","data-testid":"input-address-zip"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SupplierManagementDialog.tsx",lineNumber:325,columnNumber:25},this)},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SupplierManagementDialog.tsx",lineNumber:324,columnNumber:23},this),s.jsxDEV(_e,{},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SupplierManagementDialog.tsx",lineNumber:331,columnNumber:23},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SupplierManagementDialog.tsx",lineNumber:323,columnNumber:21},this)},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SupplierManagementDialog.tsx",lineNumber:319,columnNumber:17},this),s.jsxDEV(ue,{control:h.control,name:"address.country",render:({field:v})=>s.jsxDEV(me,{children:[s.jsxDEV(pe,{children:s.jsxDEV(ee,{...v,placeholder:"Country","data-testid":"input-address-country"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SupplierManagementDialog.tsx",lineNumber:342,columnNumber:25},this)},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SupplierManagementDialog.tsx",lineNumber:341,columnNumber:23},this),s.jsxDEV(_e,{},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SupplierManagementDialog.tsx",lineNumber:348,columnNumber:23},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SupplierManagementDialog.tsx",lineNumber:340,columnNumber:21},this)},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SupplierManagementDialog.tsx",lineNumber:336,columnNumber:17},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SupplierManagementDialog.tsx",lineNumber:318,columnNumber:15},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SupplierManagementDialog.tsx",lineNumber:263,columnNumber:13},this),s.jsxDEV(It,{children:[s.jsxDEV(Y,{type:"button",variant:"outline",onClick:()=>n(!1),"data-testid":"button-cancel",children:"Cancel"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SupplierManagementDialog.tsx",lineNumber:356,columnNumber:15},this),s.jsxDEV(Y,{type:"submit",disabled:D.isPending||A.isPending,"data-testid":"button-save-supplier",children:u?"Update Supplier":"Add Supplier"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SupplierManagementDialog.tsx",lineNumber:364,columnNumber:15},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SupplierManagementDialog.tsx",lineNumber:355,columnNumber:13},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SupplierManagementDialog.tsx",lineNumber:168,columnNumber:11},this)},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SupplierManagementDialog.tsx",lineNumber:167,columnNumber:9},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SupplierManagementDialog.tsx",lineNumber:155,columnNumber:7},this)},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SupplierManagementDialog.tsx",lineNumber:154,columnNumber:5},this)}function Md(){const[e,n]=$.useState(!1),[i,l]=$.useState(null),[u,h]=$.useState(!1),[D,A]=$.useState(null),{toast:w}=Le(),{data:v,isLoading:y}=Pe({queryKey:["/api/suppliers"]}),T=ye({mutationFn:async j=>await(await Ne("DELETE",`/api/suppliers/${j}`,{})).json(),onSuccess:()=>{ae.invalidateQueries({queryKey:["/api/suppliers"]}),w({title:"Supplier deleted",description:"The supplier has been deleted successfully."}),h(!1),A(null)},onError:j=>{w({title:"Error deleting supplier",description:j.message,variant:"destructive"})}}),B=()=>{l(null),n(!0)},se=j=>{l(j),n(!0)},he=j=>{A(j),h(!0)},H=()=>{D&&T.mutate(D.id)};return y?s.jsxDEV(Oe,{children:[s.jsxDEV(at,{children:s.jsxDEV(st,{children:"Suppliers"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SuppliersTable.tsx",lineNumber:88,columnNumber:11},this)},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SuppliersTable.tsx",lineNumber:87,columnNumber:9},this),s.jsxDEV(Me,{children:s.jsxDEV("div",{className:"text-center py-8",children:s.jsxDEV("div",{className:"w-8 h-8 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SuppliersTable.tsx",lineNumber:92,columnNumber:13},this)},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SuppliersTable.tsx",lineNumber:91,columnNumber:11},this)},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SuppliersTable.tsx",lineNumber:90,columnNumber:9},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SuppliersTable.tsx",lineNumber:86,columnNumber:7},this):s.jsxDEV(s.Fragment,{children:[s.jsxDEV(Oe,{children:[s.jsxDEV(at,{className:"flex flex-row items-center justify-between gap-2",children:[s.jsxDEV(st,{children:"Suppliers"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SuppliersTable.tsx",lineNumber:103,columnNumber:11},this),s.jsxDEV(Y,{onClick:B,"data-testid":"button-add-supplier",children:[s.jsxDEV(ct,{className:"h-4 w-4 mr-2"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SuppliersTable.tsx",lineNumber:105,columnNumber:13},this),"Add Supplier"]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SuppliersTable.tsx",lineNumber:104,columnNumber:11},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SuppliersTable.tsx",lineNumber:102,columnNumber:9},this),s.jsxDEV(Me,{children:!v||v.length===0?s.jsxDEV("div",{className:"text-center py-8",children:s.jsxDEV("p",{className:"text-muted-foreground",children:"No suppliers found. Add your first supplier to get started."},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SuppliersTable.tsx",lineNumber:112,columnNumber:15},this)},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SuppliersTable.tsx",lineNumber:111,columnNumber:13},this):s.jsxDEV(gt,{children:[s.jsxDEV(ht,{children:s.jsxDEV(ve,{children:[s.jsxDEV(X,{children:"Organization"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SuppliersTable.tsx",lineNumber:118,columnNumber:19},this),s.jsxDEV(X,{children:"Account Number"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SuppliersTable.tsx",lineNumber:119,columnNumber:19},this),s.jsxDEV(X,{children:"Contact Email"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SuppliersTable.tsx",lineNumber:120,columnNumber:19},this),s.jsxDEV(X,{children:"Contact Phone"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SuppliersTable.tsx",lineNumber:121,columnNumber:19},this),s.jsxDEV(X,{children:"Actions"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SuppliersTable.tsx",lineNumber:122,columnNumber:19},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SuppliersTable.tsx",lineNumber:117,columnNumber:17},this)},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SuppliersTable.tsx",lineNumber:116,columnNumber:15},this),s.jsxDEV(Nt,{children:v.map(j=>s.jsxDEV(ve,{"data-testid":`row-supplier-${j.id}`,children:[s.jsxDEV(J,{className:"font-medium","data-testid":`text-org-name-${j.id}`,children:j.organizationName||"N/A"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SuppliersTable.tsx",lineNumber:128,columnNumber:21},this),s.jsxDEV(J,{"data-testid":`text-account-number-${j.id}`,children:j.accountNumber||"N/A"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SuppliersTable.tsx",lineNumber:131,columnNumber:21},this),s.jsxDEV(J,{"data-testid":`text-contact-email-${j.id}`,children:j.contactEmail||j.email||"N/A"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SuppliersTable.tsx",lineNumber:134,columnNumber:21},this),s.jsxDEV(J,{"data-testid":`text-contact-phone-${j.id}`,children:j.contactPhone||"N/A"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SuppliersTable.tsx",lineNumber:137,columnNumber:21},this),s.jsxDEV(J,{children:s.jsxDEV("div",{className:"flex gap-2",children:[s.jsxDEV(Y,{variant:"ghost",size:"sm",onClick:()=>se(j),"data-testid":`button-edit-supplier-${j.id}`,children:s.jsxDEV(Za,{className:"h-4 w-4"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SuppliersTable.tsx",lineNumber:148,columnNumber:27},this)},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SuppliersTable.tsx",lineNumber:142,columnNumber:25},this),s.jsxDEV(Y,{variant:"ghost",size:"sm",onClick:()=>he(j),"data-testid":`button-delete-supplier-${j.id}`,children:s.jsxDEV(zt,{className:"h-4 w-4"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SuppliersTable.tsx",lineNumber:156,columnNumber:27},this)},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SuppliersTable.tsx",lineNumber:150,columnNumber:25},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SuppliersTable.tsx",lineNumber:141,columnNumber:23},this)},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SuppliersTable.tsx",lineNumber:140,columnNumber:21},this)]},j.id,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SuppliersTable.tsx",lineNumber:127,columnNumber:19},this))},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SuppliersTable.tsx",lineNumber:125,columnNumber:15},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SuppliersTable.tsx",lineNumber:115,columnNumber:13},this)},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SuppliersTable.tsx",lineNumber:109,columnNumber:9},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SuppliersTable.tsx",lineNumber:101,columnNumber:7},this),s.jsxDEV(Od,{open:e,onOpenChange:n,supplier:i},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SuppliersTable.tsx",lineNumber:168,columnNumber:7},this),s.jsxDEV(ai,{open:u,onOpenChange:h,children:s.jsxDEV(si,{"data-testid":"dialog-delete-supplier",children:[s.jsxDEV(ri,{children:[s.jsxDEV(oi,{children:"Are you sure?"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SuppliersTable.tsx",lineNumber:177,columnNumber:13},this),s.jsxDEV(li,{children:['This will permanently delete the supplier "',D?.organizationName,'". This action cannot be undone.']},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SuppliersTable.tsx",lineNumber:178,columnNumber:13},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SuppliersTable.tsx",lineNumber:176,columnNumber:11},this),s.jsxDEV(di,{children:[s.jsxDEV(ci,{"data-testid":"button-cancel-delete",children:"Cancel"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SuppliersTable.tsx",lineNumber:184,columnNumber:13},this),s.jsxDEV(ui,{onClick:H,disabled:T.isPending,"data-testid":"button-confirm-delete",children:"Delete"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SuppliersTable.tsx",lineNumber:185,columnNumber:13},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SuppliersTable.tsx",lineNumber:183,columnNumber:11},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SuppliersTable.tsx",lineNumber:175,columnNumber:9},this)},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SuppliersTable.tsx",lineNumber:174,columnNumber:7},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/SuppliersTable.tsx",lineNumber:100,columnNumber:5},this)}function _c(){const[e,n]=$.useState(""),[i,l]=$.useState(""),[u,h]=$.useState(""),[D,A]=$.useState(!1),[w,v]=$.useState(""),[,y]=Gn(),{toast:T}=Le(),{user:B}=Hn(),he=`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}/ws`,H=Zn(he);$.useEffect(()=>{H&&H.readyState===WebSocket.OPEN&&B?.companyId&&H.send(JSON.stringify({type:"join-company",companyId:B.companyId}))},[H,B?.companyId]),$.useEffect(()=>{if(!H)return;const P=de=>{try{const ce=JSON.parse(de.data);switch(ce.type){case"order:created":T({title:"New Order Created",description:`Order ${ce.data.orderNumber} has been created`}),ae.invalidateQueries({queryKey:["/api/orders"]}),ae.invalidateQueries({queryKey:["/api/stats"]});break;case"order:status_changed":T({title:"Order Status Updated",description:`Order ${ce.data.orderNumber} is now ${ce.data.newStatus}`}),ae.invalidateQueries({queryKey:["/api/orders"]}),ae.invalidateQueries({queryKey:["/api/stats"]});break;case"order:shipped":T({title:"Order Shipped",description:`Order ${ce.data.orderNumber} has been shipped`}),ae.invalidateQueries({queryKey:["/api/orders"]}),ae.invalidateQueries({queryKey:["/api/stats"]});break}}catch(ce){console.error("Error processing WebSocket message:",ce)}};return H.addEventListener("message",P),()=>{H.removeEventListener("message",P)}},[H,T]);const{data:j,isLoading:U,error:z}=Pe({queryKey:["/api/stats"]}),Z=new URLSearchParams;i&&i!=="all"&&Z.append("status",i),e&&Z.append("search",e);const W=Z.toString(),kt=W?["/api/orders",`?${W}`]:["/api/orders"],{data:En,isLoading:kn,error:$e}=Pe({queryKey:kt}),{data:Qe,isLoading:Fd}=Pe({queryKey:["/api/purchase-orders"]});$.useEffect(()=>{z&&Ge(z)&&(T({title:"Session expired",description:"Please log in again to continue.",variant:"destructive"}),window.location.href="/api/login")},[z,T]),$.useEffect(()=>{$e&&Ge($e)&&(T({title:"Session expired",description:"Please log in again to continue.",variant:"destructive"}),window.location.href="/api/login")},[$e,T]);const Ln=ye({mutationFn:async({id:P,status:de})=>await(await Ne("PATCH",`/api/orders/${P}/status`,{status:de})).json(),...Ja({queryKey:kt,updater:(P,de)=>Ya(P,de.id,ce=>({...ce,status:de.status}))||[],successMessage:"Status updated",errorMessage:"Failed to update status"}),onSuccess:()=>{ae.invalidateQueries({queryKey:["/api/stats"]})},onError:P=>{Ge(P)?(T({title:"Session expired",description:"Please log in again to continue.",variant:"destructive"}),window.location.href="/api/login"):T({title:"Update failed",description:P.message,variant:"destructive"})}}),Un=(P,de)=>{Ln.mutate({id:P,status:de})},Vn=P=>{v(P),A(!0)},Cn=async P=>{try{window.open(`/api/purchase-orders/${P}/pdf`,"_blank")}catch{T({title:"Error printing PO",description:"Failed to generate PDF",variant:"destructive"})}},Lt=ye({mutationFn:async P=>await(await Ne("POST",`/api/purchase-orders/${P}/email`,{})).json(),onSuccess:()=>{T({title:"Email sent",description:"Purchase order has been emailed to the supplier."})},onError:P=>{T({title:"Error sending email",description:P.message,variant:"destructive"})}}),Ut=(En||[]).map(P=>({id:P.id,patientName:P.patient.name,ecp:P.ecp.organizationName||`${P.ecp.firstName} ${P.ecp.lastName}`,status:P.status,orderDate:new Date(P.orderDate).toISOString().split("T")[0],lensType:P.lensType})),jn=j?.total?Math.round(j.completed/j.total*100):0,Bn=j?.completed||0;return s.jsxDEV("div",{className:"space-y-6",children:[s.jsxDEV("div",{className:"flex items-center justify-between",children:[s.jsxDEV("div",{children:[s.jsxDEV("h1",{className:"text-2xl font-semibold",children:"Lab Dashboard"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/LabDashboard.tsx",lineNumber:243,columnNumber:11},this),s.jsxDEV("p",{className:"text-muted-foreground mt-1",children:"Monitor production status and manage your order queue."},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/LabDashboard.tsx",lineNumber:244,columnNumber:11},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/LabDashboard.tsx",lineNumber:242,columnNumber:9},this),s.jsxDEV(Wn,{variant:H&&H.readyState===WebSocket.OPEN?"default":"secondary",className:"gap-2",children:H&&H.readyState===WebSocket.OPEN?s.jsxDEV(s.Fragment,{children:[s.jsxDEV(es,{className:"h-3 w-3"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/LabDashboard.tsx",lineNumber:251,columnNumber:15},this),"Live Updates"]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/LabDashboard.tsx",lineNumber:250,columnNumber:13},this):s.jsxDEV(s.Fragment,{children:[s.jsxDEV(ts,{className:"h-3 w-3"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/LabDashboard.tsx",lineNumber:256,columnNumber:15},this),"Offline"]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/LabDashboard.tsx",lineNumber:255,columnNumber:13},this)},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/LabDashboard.tsx",lineNumber:248,columnNumber:9},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/LabDashboard.tsx",lineNumber:241,columnNumber:7},this),s.jsxDEV(Xn,{defaultValue:"orders",className:"w-full",children:[s.jsxDEV(Jn,{children:[s.jsxDEV(He,{value:"orders","data-testid":"tab-orders",children:"Orders"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/LabDashboard.tsx",lineNumber:265,columnNumber:11},this),s.jsxDEV(He,{value:"purchase-orders","data-testid":"tab-purchase-orders",children:"Purchase Orders"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/LabDashboard.tsx",lineNumber:266,columnNumber:11},this),s.jsxDEV(He,{value:"suppliers","data-testid":"tab-suppliers",children:"Suppliers"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/LabDashboard.tsx",lineNumber:267,columnNumber:11},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/LabDashboard.tsx",lineNumber:264,columnNumber:9},this),s.jsxDEV(Ze,{value:"orders",className:"space-y-6 mt-6",children:[U?s.jsxDEV("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[1,2,3,4].map(P=>s.jsxDEV(Wa,{},P,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/LabDashboard.tsx",lineNumber:274,columnNumber:17},this))},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/LabDashboard.tsx",lineNumber:272,columnNumber:13},this):s.jsxDEV("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[s.jsxDEV(Be,{title:"Total Orders",value:j?.total.toString()||"0",icon:Vt},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/LabDashboard.tsx",lineNumber:279,columnNumber:15},this),s.jsxDEV(Be,{title:"In Production",value:j?.inProduction.toString()||"0",icon:ns},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/LabDashboard.tsx",lineNumber:284,columnNumber:15},this),s.jsxDEV(Be,{title:"Completed Today",value:Bn.toString(),icon:Yn},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/LabDashboard.tsx",lineNumber:289,columnNumber:15},this),s.jsxDEV(Be,{title:"Efficiency Rate",value:`${jn}%`,icon:ei},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/LabDashboard.tsx",lineNumber:294,columnNumber:15},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/LabDashboard.tsx",lineNumber:278,columnNumber:13},this),s.jsxDEV("div",{className:"space-y-4",children:[s.jsxDEV("div",{className:"flex flex-col sm:flex-row gap-4 items-start",children:[s.jsxDEV(On,{value:e,onChange:n,placeholder:"Search orders, patients, or ECPs..."},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/LabDashboard.tsx",lineNumber:304,columnNumber:15},this),s.jsxDEV(Xe,{},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/LabDashboard.tsx",lineNumber:309,columnNumber:15},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/LabDashboard.tsx",lineNumber:303,columnNumber:13},this),s.jsxDEV(os,{statusFilter:i,onStatusChange:l,ecpFilter:u,onEcpChange:h,onClearFilters:()=>{l(""),h("")}},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/LabDashboard.tsx",lineNumber:312,columnNumber:13},this),kn?s.jsxDEV("div",{className:"h-96 bg-card rounded-md animate-pulse"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/LabDashboard.tsx",lineNumber:324,columnNumber:15},this):Ut.length===0?s.jsxDEV(Xa,{icon:ti,title:"No orders found",description:e||i?"Try adjusting your search or filters.":"Orders will appear here once they are created."},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/LabDashboard.tsx",lineNumber:326,columnNumber:15},this):s.jsxDEV(rs,{orders:Ut,onViewDetails:P=>y(`/order/${P}`),onUpdateStatus:Un,onShipOrder:Vn},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/LabDashboard.tsx",lineNumber:336,columnNumber:15},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/LabDashboard.tsx",lineNumber:302,columnNumber:11},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/LabDashboard.tsx",lineNumber:270,columnNumber:9},this),s.jsxDEV(Ze,{value:"purchase-orders",className:"space-y-6 mt-6",children:[s.jsxDEV("div",{className:"flex items-center justify-between",children:[s.jsxDEV("p",{className:"text-sm text-muted-foreground",children:"Manage purchase orders and send them to suppliers"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/LabDashboard.tsx",lineNumber:348,columnNumber:13},this),s.jsxDEV(Xe,{},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/LabDashboard.tsx",lineNumber:349,columnNumber:13},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/LabDashboard.tsx",lineNumber:347,columnNumber:11},this),Qe&&Qe.length>0?s.jsxDEV(Oe,{children:[s.jsxDEV(at,{children:s.jsxDEV(st,{children:"Purchase Orders"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/LabDashboard.tsx",lineNumber:355,columnNumber:17},this)},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/LabDashboard.tsx",lineNumber:354,columnNumber:15},this),s.jsxDEV(Me,{children:s.jsxDEV(gt,{children:[s.jsxDEV(ht,{children:s.jsxDEV(ve,{children:[s.jsxDEV(X,{children:"PO Number"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/LabDashboard.tsx",lineNumber:361,columnNumber:23},this),s.jsxDEV(X,{children:"Supplier"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/LabDashboard.tsx",lineNumber:362,columnNumber:23},this),s.jsxDEV(X,{children:"Date"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/LabDashboard.tsx",lineNumber:363,columnNumber:23},this),s.jsxDEV(X,{children:"Total"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/LabDashboard.tsx",lineNumber:364,columnNumber:23},this),s.jsxDEV(X,{children:"Actions"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/LabDashboard.tsx",lineNumber:365,columnNumber:23},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/LabDashboard.tsx",lineNumber:360,columnNumber:21},this)},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/LabDashboard.tsx",lineNumber:359,columnNumber:19},this),s.jsxDEV(Nt,{children:Qe.map(P=>s.jsxDEV(ve,{"data-testid":`row-po-${P.id}`,children:[s.jsxDEV(J,{className:"font-medium","data-testid":`text-po-number-${P.id}`,children:P.poNumber},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/LabDashboard.tsx",lineNumber:371,columnNumber:25},this),s.jsxDEV(J,{"data-testid":`text-po-supplier-${P.id}`,children:P.supplier.organizationName||"Unknown"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/LabDashboard.tsx",lineNumber:374,columnNumber:25},this),s.jsxDEV(J,{"data-testid":`text-po-date-${P.id}`,children:as(new Date(P.createdAt),"MMM dd, yyyy")},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/LabDashboard.tsx",lineNumber:377,columnNumber:25},this),s.jsxDEV(J,{"data-testid":`text-po-total-${P.id}`,children:["$",parseFloat(P.totalAmount||"0").toFixed(2)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/LabDashboard.tsx",lineNumber:380,columnNumber:25},this),s.jsxDEV(J,{children:s.jsxDEV("div",{className:"flex gap-2",children:[s.jsxDEV(Y,{variant:"ghost",size:"sm",onClick:()=>Cn(P.id),"data-testid":`button-print-po-${P.id}`,children:s.jsxDEV(is,{className:"h-4 w-4"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/LabDashboard.tsx",lineNumber:391,columnNumber:31},this)},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/LabDashboard.tsx",lineNumber:385,columnNumber:29},this),s.jsxDEV(Y,{variant:"ghost",size:"sm",onClick:()=>Lt.mutate(P.id),disabled:Lt.isPending,"data-testid":`button-email-po-${P.id}`,children:s.jsxDEV(ni,{className:"h-4 w-4"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/LabDashboard.tsx",lineNumber:400,columnNumber:31},this)},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/LabDashboard.tsx",lineNumber:393,columnNumber:29},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/LabDashboard.tsx",lineNumber:384,columnNumber:27},this)},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/LabDashboard.tsx",lineNumber:383,columnNumber:25},this)]},P.id,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/LabDashboard.tsx",lineNumber:370,columnNumber:23},this))},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/LabDashboard.tsx",lineNumber:368,columnNumber:19},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/LabDashboard.tsx",lineNumber:358,columnNumber:17},this)},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/LabDashboard.tsx",lineNumber:357,columnNumber:15},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/LabDashboard.tsx",lineNumber:353,columnNumber:13},this):s.jsxDEV(Oe,{children:s.jsxDEV(Me,{className:"py-12",children:s.jsxDEV("div",{className:"text-center",children:[s.jsxDEV(Vt,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/LabDashboard.tsx",lineNumber:414,columnNumber:19},this),s.jsxDEV("h3",{className:"text-lg font-semibold mb-2",children:"No Purchase Orders"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/LabDashboard.tsx",lineNumber:415,columnNumber:19},this),s.jsxDEV("p",{className:"text-muted-foreground mb-4",children:"Create your first purchase order to get started."},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/LabDashboard.tsx",lineNumber:416,columnNumber:19},this),s.jsxDEV(Xe,{},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/LabDashboard.tsx",lineNumber:417,columnNumber:19},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/LabDashboard.tsx",lineNumber:413,columnNumber:17},this)},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/LabDashboard.tsx",lineNumber:412,columnNumber:15},this)},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/LabDashboard.tsx",lineNumber:411,columnNumber:13},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/LabDashboard.tsx",lineNumber:346,columnNumber:9},this),s.jsxDEV(Ze,{value:"suppliers",className:"space-y-6 mt-6",children:s.jsxDEV(Md,{},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/LabDashboard.tsx",lineNumber:425,columnNumber:11},this)},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/LabDashboard.tsx",lineNumber:424,columnNumber:9},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/LabDashboard.tsx",lineNumber:263,columnNumber:7},this),s.jsxDEV(ls,{orderId:w,open:D,onOpenChange:A},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/LabDashboard.tsx",lineNumber:429,columnNumber:7},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/LabDashboard.tsx",lineNumber:240,columnNumber:5},this)}export{_c as default};
