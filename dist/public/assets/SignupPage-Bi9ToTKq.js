import{r as x,e}from"./vendor-react-yzYIzJFU.js";import{G as U,u as y,e as C,W as h,C as S,h as D,i as v,j as P,a as E,f as L,I as l,z as k,Y as w}from"./index-BiBisH8X.js";import{a as R}from"./vendor-react-query-Dxpktacb.js";import{L as r}from"./label-DDyL8AZL.js";import{S as F,a as A,b as z,c as G,d as o}from"./select-BquPdUcS.js";import{R as K,a as j}from"./radio-group-D19d1obH.js";import{C as O}from"./crown-CM0gKtDO.js";import{P as q}from"./printer-BW5EvF8T.js";import"./vendor-mui-DFe-F-Gn.js";import"./vendor-radix-B6etWzp2.js";function Z(){const{user:m,isLoading:I}=U(),[,d]=y(),{toast:t}=C(),[s,n]=x.useState({role:"",organizationName:"",adminSetupKey:"",subscriptionPlan:"",gocNumber:""});x.useEffect(()=>{n(i=>{if(!i.role)return i.subscriptionPlan===""?i:{...i,subscriptionPlan:""};const a=i.role==="ecp"?"free_ecp":"full";return i.subscriptionPlan===a?i:{...i,subscriptionPlan:a}})},[s.role]);const g=s.role.length>0,c=s.role==="ecp",b=!g||c,N=!g||!c,u=R({mutationFn:async i=>await(await w("POST","/api/auth/complete-signup",i)).json(),onSuccess:i=>{const a=s.role==="admin";t({title:"Account created successfully",description:a?"Your admin account has been activated. Redirecting to dashboard...":"Your account is pending approval. You'll be notified once it's activated."}),d("/")},onError:i=>{t({title:"Signup failed",description:i.message,variant:"destructive"})}}),V=i=>{if(i.preventDefault(),!s.role){t({title:"Role required",description:"Please select your role",variant:"destructive"});return}if(s.role==="admin"&&!s.adminSetupKey){t({title:"Admin setup key required",description:"Please enter the admin setup key to create an admin account",variant:"destructive"});return}if((s.role==="optometrist"||s.role==="ecp")&&!s.gocNumber){t({title:"GOC number required",description:"Please enter your GOC registration number",variant:"destructive"});return}const a=s.role==="ecp"?"free_ecp":"full",f=s.subscriptionPlan||a;if(f!==a){t({title:"Plan not available",description:"The selected plan is not available for the chosen role",variant:"destructive"});return}const p={role:s.role,organizationName:s.organizationName,subscriptionPlan:f};s.role==="admin"&&(p.adminSetupKey=s.adminSetupKey),s.gocNumber&&(p.gocNumber=s.gocNumber),u.mutate(p)};return I?e.jsxDEV("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxDEV(h,{className:"h-8 w-8 animate-spin text-muted-foreground"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/SignupPage.tsx",lineNumber:140,columnNumber:9},this)},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/SignupPage.tsx",lineNumber:139,columnNumber:7},this):m?e.jsxDEV("div",{className:"flex items-center justify-center min-h-screen p-4",children:e.jsxDEV(S,{className:"w-full max-w-2xl",children:[e.jsxDEV(D,{children:[e.jsxDEV(v,{children:"Complete Your Account Setup"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/SignupPage.tsx",lineNumber:167,columnNumber:11},this),e.jsxDEV(P,{children:"Welcome! Please provide some additional information to complete your registration"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/SignupPage.tsx",lineNumber:168,columnNumber:11},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/SignupPage.tsx",lineNumber:166,columnNumber:9},this),e.jsxDEV(E,{children:e.jsxDEV("form",{onSubmit:V,className:"space-y-6",children:[e.jsxDEV("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxDEV("div",{className:"space-y-2",children:[e.jsxDEV(r,{children:"First Name"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/SignupPage.tsx",lineNumber:176,columnNumber:17},this),e.jsxDEV(l,{value:m.firstName||"",disabled:!0,"data-testid":"input-first-name"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/SignupPage.tsx",lineNumber:177,columnNumber:17},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/SignupPage.tsx",lineNumber:175,columnNumber:15},this),e.jsxDEV("div",{className:"space-y-2",children:[e.jsxDEV(r,{children:"Last Name"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/SignupPage.tsx",lineNumber:184,columnNumber:17},this),e.jsxDEV(l,{value:m.lastName||"",disabled:!0,"data-testid":"input-last-name"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/SignupPage.tsx",lineNumber:185,columnNumber:17},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/SignupPage.tsx",lineNumber:183,columnNumber:15},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/SignupPage.tsx",lineNumber:174,columnNumber:13},this),e.jsxDEV("div",{className:"space-y-2",children:[e.jsxDEV(r,{children:"Email"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/SignupPage.tsx",lineNumber:194,columnNumber:15},this),e.jsxDEV(l,{value:m.email||"",disabled:!0,"data-testid":"input-email"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/SignupPage.tsx",lineNumber:195,columnNumber:15},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/SignupPage.tsx",lineNumber:193,columnNumber:13},this),e.jsxDEV("div",{className:"space-y-2",children:[e.jsxDEV(r,{htmlFor:"role",children:"Role *"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/SignupPage.tsx",lineNumber:203,columnNumber:15},this),e.jsxDEV(F,{value:s.role,onValueChange:i=>n({...s,role:i}),children:[e.jsxDEV(A,{id:"role","data-testid":"select-role",children:e.jsxDEV(z,{placeholder:"Select your role"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/SignupPage.tsx",lineNumber:211,columnNumber:19},this)},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/SignupPage.tsx",lineNumber:210,columnNumber:17},this),e.jsxDEV(G,{children:[e.jsxDEV(o,{value:"ecp",children:"Eye Care Professional (ECP)"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/SignupPage.tsx",lineNumber:214,columnNumber:19},this),e.jsxDEV(o,{value:"optometrist",children:"Optometrist"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/SignupPage.tsx",lineNumber:215,columnNumber:19},this),e.jsxDEV(o,{value:"lab_tech",children:"Lab Technician"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/SignupPage.tsx",lineNumber:216,columnNumber:19},this),e.jsxDEV(o,{value:"engineer",children:"Engineer"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/SignupPage.tsx",lineNumber:217,columnNumber:19},this),e.jsxDEV(o,{value:"supplier",children:"Supplier"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/SignupPage.tsx",lineNumber:218,columnNumber:19},this),e.jsxDEV(o,{value:"admin",children:"Administrator"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/SignupPage.tsx",lineNumber:219,columnNumber:19},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/SignupPage.tsx",lineNumber:213,columnNumber:17},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/SignupPage.tsx",lineNumber:204,columnNumber:15},this),e.jsxDEV("p",{className:"text-sm text-muted-foreground",children:"Choose the role that best describes your position"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/SignupPage.tsx",lineNumber:222,columnNumber:15},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/SignupPage.tsx",lineNumber:202,columnNumber:13},this),(s.role==="optometrist"||s.role==="ecp")&&e.jsxDEV("div",{className:"space-y-2",children:[e.jsxDEV(r,{htmlFor:"gocNumber",children:"GOC Registration Number *"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/SignupPage.tsx",lineNumber:229,columnNumber:17},this),e.jsxDEV(l,{id:"gocNumber",value:s.gocNumber,onChange:i=>n({...s,gocNumber:i.target.value}),placeholder:"Enter your GOC registration number","data-testid":"input-goc-number"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/SignupPage.tsx",lineNumber:230,columnNumber:17},this),e.jsxDEV("p",{className:"text-sm text-muted-foreground",children:"Your General Optical Council registration number is required for optometrists and ECPs"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/SignupPage.tsx",lineNumber:239,columnNumber:17},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/SignupPage.tsx",lineNumber:228,columnNumber:15},this),e.jsxDEV("div",{className:"space-y-3",children:[e.jsxDEV(r,{children:"Subscription Plan"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/SignupPage.tsx",lineNumber:246,columnNumber:15},this),e.jsxDEV(K,{value:s.subscriptionPlan,onValueChange:i=>n(a=>({...a,subscriptionPlan:i})),className:"grid gap-3",children:[e.jsxDEV(r,{htmlFor:"plan-full",className:k("flex items-start gap-3 rounded-lg border p-4 transition focus-within:ring-2 focus-within:ring-primary/40",s.subscriptionPlan==="full"&&"border-primary ring-2 ring-primary/40 bg-primary/5",b?"cursor-not-allowed opacity-60":"cursor-pointer hover:border-primary/50"),children:[e.jsxDEV(j,{id:"plan-full",value:"full",disabled:b||u.isPending,className:"mt-1"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/SignupPage.tsx",lineNumber:262,columnNumber:19},this),e.jsxDEV("div",{className:"space-y-1",children:[e.jsxDEV("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxDEV(O,{className:"h-4 w-4 text-primary"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/SignupPage.tsx",lineNumber:270,columnNumber:23},this),e.jsxDEV("span",{className:"font-semibold",children:"Full Experience"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/SignupPage.tsx",lineNumber:271,columnNumber:23},this),e.jsxDEV("span",{className:"text-sm text-muted-foreground",children:"£199/month"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/SignupPage.tsx",lineNumber:272,columnNumber:23},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/SignupPage.tsx",lineNumber:269,columnNumber:21},this),e.jsxDEV("p",{className:"text-sm text-muted-foreground",children:"Access every module in ILS including patient care, clinical records, analytics, and retail operations."},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/SignupPage.tsx",lineNumber:274,columnNumber:21},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/SignupPage.tsx",lineNumber:268,columnNumber:19},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/SignupPage.tsx",lineNumber:254,columnNumber:17},this),e.jsxDEV(r,{htmlFor:"plan-free",className:k("flex items-start gap-3 rounded-lg border p-4 transition focus-within:ring-2 focus-within:ring-primary/40",s.subscriptionPlan==="free_ecp"&&"border-primary ring-2 ring-primary/40 bg-primary/5",N?"cursor-not-allowed opacity-60":"cursor-pointer hover:border-primary/50"),children:[e.jsxDEV(j,{id:"plan-free",value:"free_ecp",disabled:N||u.isPending,className:"mt-1"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/SignupPage.tsx",lineNumber:288,columnNumber:19},this),e.jsxDEV("div",{className:"space-y-1",children:[e.jsxDEV("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxDEV(q,{className:"h-4 w-4 text-primary"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/SignupPage.tsx",lineNumber:296,columnNumber:23},this),e.jsxDEV("span",{className:"font-semibold",children:"ECP Records (Free)"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/SignupPage.tsx",lineNumber:297,columnNumber:23},this),e.jsxDEV("span",{className:"text-sm text-muted-foreground",children:"£0/month"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/SignupPage.tsx",lineNumber:298,columnNumber:23},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/SignupPage.tsx",lineNumber:295,columnNumber:21},this),e.jsxDEV("p",{className:"text-sm text-muted-foreground",children:"Create lens orders and download purchase order records. Upgrade anytime for full clinical and retail capabilities."},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/SignupPage.tsx",lineNumber:300,columnNumber:21},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/SignupPage.tsx",lineNumber:294,columnNumber:19},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/SignupPage.tsx",lineNumber:280,columnNumber:17},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/SignupPage.tsx",lineNumber:247,columnNumber:15},this),e.jsxDEV("p",{className:"text-xs text-muted-foreground",children:c?"ECP accounts start on the free plan so you can submit orders immediately.":"All non-ECP roles require the Full Experience subscription."},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/SignupPage.tsx",lineNumber:306,columnNumber:15},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/SignupPage.tsx",lineNumber:245,columnNumber:13},this),s.role==="admin"&&e.jsxDEV("div",{className:"space-y-2",children:[e.jsxDEV(r,{htmlFor:"adminKey",children:"Admin Setup Key *"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/SignupPage.tsx",lineNumber:315,columnNumber:17},this),e.jsxDEV(l,{id:"adminKey",type:"password",value:s.adminSetupKey,onChange:i=>n({...s,adminSetupKey:i.target.value}),placeholder:"Enter admin setup key","data-testid":"input-admin-key"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/SignupPage.tsx",lineNumber:316,columnNumber:17},this),e.jsxDEV("p",{className:"text-sm text-muted-foreground",children:"Required: Contact your system administrator for the admin setup key"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/SignupPage.tsx",lineNumber:326,columnNumber:17},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/SignupPage.tsx",lineNumber:314,columnNumber:15},this),e.jsxDEV("div",{className:"space-y-2",children:[e.jsxDEV(r,{htmlFor:"orgName",children:"Organization Name"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/SignupPage.tsx",lineNumber:333,columnNumber:15},this),e.jsxDEV(l,{id:"orgName",value:s.organizationName,onChange:i=>n({...s,organizationName:i.target.value}),placeholder:"Enter your organization name","data-testid":"input-organization-name"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/SignupPage.tsx",lineNumber:334,columnNumber:15},this),e.jsxDEV("p",{className:"text-sm text-muted-foreground",children:"Optional: The company or practice you work for"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/SignupPage.tsx",lineNumber:343,columnNumber:15},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/SignupPage.tsx",lineNumber:332,columnNumber:13},this),e.jsxDEV("div",{className:"flex flex-col gap-3 pt-4",children:[e.jsxDEV(L,{type:"submit",disabled:u.isPending||!s.role,className:"w-full","data-testid":"button-submit-signup",children:u.isPending?e.jsxDEV(e.Fragment,{children:[e.jsxDEV(h,{className:"mr-2 h-4 w-4 animate-spin"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/SignupPage.tsx",lineNumber:357,columnNumber:21},this),"Creating Account..."]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/SignupPage.tsx",lineNumber:356,columnNumber:19},this):"Complete Registration"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/SignupPage.tsx",lineNumber:349,columnNumber:15},this),s.role!=="admin"&&e.jsxDEV("p",{className:"text-xs text-muted-foreground text-center",children:"Your account will be reviewed by an administrator before activation"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/SignupPage.tsx",lineNumber:365,columnNumber:17},this),s.role==="admin"&&e.jsxDEV("p",{className:"text-xs text-muted-foreground text-center",children:"Admin accounts are activated immediately upon verification"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/SignupPage.tsx",lineNumber:370,columnNumber:17},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/SignupPage.tsx",lineNumber:348,columnNumber:13},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/SignupPage.tsx",lineNumber:173,columnNumber:11},this)},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/SignupPage.tsx",lineNumber:172,columnNumber:9},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/SignupPage.tsx",lineNumber:165,columnNumber:7},this)},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/SignupPage.tsx",lineNumber:164,columnNumber:5},this):e.jsxDEV("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxDEV(S,{className:"w-full max-w-md",children:[e.jsxDEV(D,{children:[e.jsxDEV(v,{children:"Sign In Required"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/SignupPage.tsx",lineNumber:150,columnNumber:13},this),e.jsxDEV(P,{children:"Please sign in with Replit to continue"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/SignupPage.tsx",lineNumber:151,columnNumber:13},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/SignupPage.tsx",lineNumber:149,columnNumber:11},this),e.jsxDEV(E,{children:e.jsxDEV(L,{onClick:()=>d("/"),className:"w-full","data-testid":"button-go-home",children:"Go to Home"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/SignupPage.tsx",lineNumber:154,columnNumber:13},this)},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/SignupPage.tsx",lineNumber:153,columnNumber:11},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/SignupPage.tsx",lineNumber:148,columnNumber:9},this)},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/SignupPage.tsx",lineNumber:147,columnNumber:7},this)}export{Z as default};
