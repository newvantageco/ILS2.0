import{r as j,e}from"./vendor-react-yzYIzJFU.js";import{u as L,a as p}from"./vendor-react-query-Dxpktacb.js";import{e as k,C as b,h as N,a as g,i as U,j as I,$ as V,I as w,V as y,B as h,f as x,a9 as C,M as T,Y as F}from"./index-BiBisH8X.js";import{T as M,a as R,b as f,c as i,d as $,e as a}from"./table-cFqY84xs.js";import{T as H}from"./TableSkeleton-CSZegB3T.js";import{E as O}from"./EmptyState-ugLtOoCh.js";import{C as q}from"./circle-check-DUGURuAb.js";import{C as B}from"./clock-CfQc0zyb.js";import{f as P}from"./format-B8W-xB4I.js";import"./vendor-mui-DFe-F-Gn.js";import"./vendor-radix-B6etWzp2.js";import"./skeleton-a1RpvyBN.js";import"./en-US-816ENOvV.js";function ie(){const[l,D]=j.useState(""),{toast:o}=k(),{data:c,isLoading:v}=L({queryKey:["/api/prescriptions"]}),m=p({mutationFn:async s=>{const t=await fetch(`/api/prescriptions/${s}/pdf`,{method:"GET",credentials:"include",headers:{Accept:"application/pdf"}});if(!t.ok){const E=await t.json().catch(()=>({message:"Failed to download PDF"}));throw new Error(E.message||"Failed to download PDF")}const S=await t.blob(),d=window.URL.createObjectURL(S),n=document.createElement("a");n.href=d,n.download=`prescription-${s}.pdf`,document.body.appendChild(n),n.click(),window.URL.revokeObjectURL(d),document.body.removeChild(n)},onSuccess:()=>{o({title:"PDF Downloaded",description:"The prescription PDF has been downloaded."})},onError:s=>{o({title:"Error",description:s.message||"Failed to download PDF. Please try again.",variant:"destructive"})}}),u=p({mutationFn:async s=>await(await F("POST",`/api/prescriptions/${s}/email`)).json(),onSuccess:()=>{o({title:"Email Sent",description:"The prescription has been emailed to the patient."})},onError:()=>{o({title:"Error",description:"Failed to send email. Please try again.",variant:"destructive"})}}),r=c?.filter(s=>{const t=l.toLowerCase();return s.patient.name.toLowerCase().includes(t)});return v?e.jsxDEV("div",{className:"space-y-6",children:[e.jsxDEV("div",{className:"flex items-center justify-between",children:e.jsxDEV("div",{className:"h-10 w-48 bg-muted animate-pulse rounded"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/PrescriptionsPage.tsx",lineNumber:127,columnNumber:11},this)},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/PrescriptionsPage.tsx",lineNumber:126,columnNumber:9},this),e.jsxDEV(b,{children:[e.jsxDEV(N,{children:e.jsxDEV("div",{className:"h-8 w-48 bg-muted animate-pulse rounded"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/PrescriptionsPage.tsx",lineNumber:131,columnNumber:13},this)},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/PrescriptionsPage.tsx",lineNumber:130,columnNumber:11},this),e.jsxDEV(g,{children:e.jsxDEV(H,{rows:5,columns:7},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/PrescriptionsPage.tsx",lineNumber:134,columnNumber:13},this)},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/PrescriptionsPage.tsx",lineNumber:133,columnNumber:11},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/PrescriptionsPage.tsx",lineNumber:129,columnNumber:9},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/PrescriptionsPage.tsx",lineNumber:125,columnNumber:7},this):e.jsxDEV("div",{className:"space-y-6",children:[e.jsxDEV("div",{className:"flex items-center justify-between gap-4 flex-wrap",children:e.jsxDEV("div",{children:[e.jsxDEV("h1",{className:"text-3xl font-bold tracking-tight",children:"Prescriptions"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/PrescriptionsPage.tsx",lineNumber:145,columnNumber:11},this),e.jsxDEV("p",{className:"text-muted-foreground mt-1",children:"View and manage optical prescriptions"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/PrescriptionsPage.tsx",lineNumber:146,columnNumber:11},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/PrescriptionsPage.tsx",lineNumber:144,columnNumber:9},this)},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/PrescriptionsPage.tsx",lineNumber:143,columnNumber:7},this),e.jsxDEV(b,{children:[e.jsxDEV(N,{children:e.jsxDEV("div",{className:"flex items-center gap-4 flex-wrap",children:[e.jsxDEV("div",{className:"flex-1",children:[e.jsxDEV(U,{children:"All Prescriptions"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/PrescriptionsPage.tsx",lineNumber:156,columnNumber:15},this),e.jsxDEV(I,{children:"View and manage optical prescriptions"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/PrescriptionsPage.tsx",lineNumber:157,columnNumber:15},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/PrescriptionsPage.tsx",lineNumber:155,columnNumber:13},this),e.jsxDEV("div",{className:"relative w-full sm:w-72",children:[e.jsxDEV(V,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/PrescriptionsPage.tsx",lineNumber:160,columnNumber:15},this),e.jsxDEV(w,{placeholder:"Search by patient name...",value:l,onChange:s=>D(s.target.value),className:"pl-9","data-testid":"input-search-prescriptions"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/PrescriptionsPage.tsx",lineNumber:161,columnNumber:15},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/PrescriptionsPage.tsx",lineNumber:159,columnNumber:13},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/PrescriptionsPage.tsx",lineNumber:154,columnNumber:11},this)},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/PrescriptionsPage.tsx",lineNumber:153,columnNumber:9},this),e.jsxDEV(g,{children:!r||r.length===0?e.jsxDEV(O,{icon:y,title:l?"No prescriptions found":"No prescriptions yet",description:l?"Try adjusting your search query":"Prescriptions will appear here after eye examinations"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/PrescriptionsPage.tsx",lineNumber:173,columnNumber:13},this):e.jsxDEV("div",{className:"rounded-md border",children:e.jsxDEV(M,{children:[e.jsxDEV(R,{children:e.jsxDEV(f,{children:[e.jsxDEV(i,{children:"Patient"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/PrescriptionsPage.tsx",lineNumber:187,columnNumber:21},this),e.jsxDEV(i,{children:"Issue Date"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/PrescriptionsPage.tsx",lineNumber:188,columnNumber:21},this),e.jsxDEV(i,{children:"Expiry Date"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/PrescriptionsPage.tsx",lineNumber:189,columnNumber:21},this),e.jsxDEV(i,{children:"Right Eye (OD)"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/PrescriptionsPage.tsx",lineNumber:190,columnNumber:21},this),e.jsxDEV(i,{children:"Left Eye (OS)"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/PrescriptionsPage.tsx",lineNumber:191,columnNumber:21},this),e.jsxDEV(i,{children:"Status"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/PrescriptionsPage.tsx",lineNumber:192,columnNumber:21},this),e.jsxDEV(i,{className:"text-right",children:"Actions"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/PrescriptionsPage.tsx",lineNumber:193,columnNumber:21},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/PrescriptionsPage.tsx",lineNumber:186,columnNumber:19},this)},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/PrescriptionsPage.tsx",lineNumber:185,columnNumber:17},this),e.jsxDEV($,{children:r.map(s=>e.jsxDEV(f,{"data-testid":`row-prescription-${s.id}`,children:[e.jsxDEV(a,{className:"font-medium",children:e.jsxDEV("div",{children:[e.jsxDEV("div",{"data-testid":`text-prescription-patient-${s.id}`,children:s.patient.name},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/PrescriptionsPage.tsx",lineNumber:201,columnNumber:27},this),s.patient.email&&e.jsxDEV("div",{className:"text-sm text-muted-foreground",children:s.patient.email},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/PrescriptionsPage.tsx",lineNumber:205,columnNumber:29},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/PrescriptionsPage.tsx",lineNumber:200,columnNumber:25},this)},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/PrescriptionsPage.tsx",lineNumber:199,columnNumber:23},this),e.jsxDEV(a,{children:P(new Date(s.issueDate),"dd/MM/yyyy")},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/PrescriptionsPage.tsx",lineNumber:211,columnNumber:23},this),e.jsxDEV(a,{children:s.expiryDate?P(new Date(s.expiryDate),"dd/MM/yyyy"):"—"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/PrescriptionsPage.tsx",lineNumber:214,columnNumber:23},this),e.jsxDEV(a,{children:e.jsxDEV("div",{className:"text-sm font-mono",children:[e.jsxDEV("div",{children:["SPH: ",s.odSphere||"—"]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/PrescriptionsPage.tsx",lineNumber:221,columnNumber:27},this),e.jsxDEV("div",{children:["CYL: ",s.odCylinder||"—"]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/PrescriptionsPage.tsx",lineNumber:222,columnNumber:27},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/PrescriptionsPage.tsx",lineNumber:220,columnNumber:25},this)},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/PrescriptionsPage.tsx",lineNumber:219,columnNumber:23},this),e.jsxDEV(a,{children:e.jsxDEV("div",{className:"text-sm font-mono",children:[e.jsxDEV("div",{children:["SPH: ",s.osSphere||"—"]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/PrescriptionsPage.tsx",lineNumber:227,columnNumber:27},this),e.jsxDEV("div",{children:["CYL: ",s.osCylinder||"—"]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/PrescriptionsPage.tsx",lineNumber:228,columnNumber:27},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/PrescriptionsPage.tsx",lineNumber:226,columnNumber:25},this)},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/PrescriptionsPage.tsx",lineNumber:225,columnNumber:23},this),e.jsxDEV(a,{children:s.isSigned?e.jsxDEV(h,{variant:"default",className:"gap-1",children:[e.jsxDEV(q,{className:"h-3 w-3"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/PrescriptionsPage.tsx",lineNumber:234,columnNumber:29},this),"Signed"]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/PrescriptionsPage.tsx",lineNumber:233,columnNumber:27},this):e.jsxDEV(h,{variant:"secondary",className:"gap-1",children:[e.jsxDEV(B,{className:"h-3 w-3"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/PrescriptionsPage.tsx",lineNumber:239,columnNumber:29},this),"Unsigned"]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/PrescriptionsPage.tsx",lineNumber:238,columnNumber:27},this)},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/PrescriptionsPage.tsx",lineNumber:231,columnNumber:23},this),e.jsxDEV(a,{className:"text-right",children:e.jsxDEV("div",{className:"flex items-center justify-end gap-2",children:[e.jsxDEV(x,{size:"sm",variant:"outline",onClick:()=>m.mutate(s.id),disabled:m.isPending,"data-testid":`button-download-pdf-${s.id}`,children:[e.jsxDEV(C,{className:"h-4 w-4 mr-2"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/PrescriptionsPage.tsx",lineNumber:253,columnNumber:29},this),"PDF"]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/PrescriptionsPage.tsx",lineNumber:246,columnNumber:27},this),s.patient.email&&s.isSigned&&e.jsxDEV(x,{size:"sm",variant:"default",onClick:()=>u.mutate(s.id),disabled:u.isPending,"data-testid":`button-email-prescription-${s.id}`,children:[e.jsxDEV(T,{className:"h-4 w-4 mr-2"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/PrescriptionsPage.tsx",lineNumber:264,columnNumber:31},this),"Email"]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/PrescriptionsPage.tsx",lineNumber:257,columnNumber:29},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/PrescriptionsPage.tsx",lineNumber:245,columnNumber:25},this)},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/PrescriptionsPage.tsx",lineNumber:244,columnNumber:23},this)]},s.id,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/PrescriptionsPage.tsx",lineNumber:198,columnNumber:21},this))},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/PrescriptionsPage.tsx",lineNumber:196,columnNumber:17},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/PrescriptionsPage.tsx",lineNumber:184,columnNumber:15},this)},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/PrescriptionsPage.tsx",lineNumber:183,columnNumber:13},this)},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/PrescriptionsPage.tsx",lineNumber:171,columnNumber:9},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/PrescriptionsPage.tsx",lineNumber:152,columnNumber:7},this),r&&r.length>0&&e.jsxDEV("div",{className:"text-sm text-muted-foreground",children:["Showing ",r.length," of ",c?.length," prescriptions"]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/PrescriptionsPage.tsx",lineNumber:280,columnNumber:9},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/pages/PrescriptionsPage.tsx",lineNumber:142,columnNumber:5},this)}export{ie as default};
