import{r,e}from"./vendor-react-yzYIzJFU.js";import{c as C,u as w,a as N}from"./vendor-react-query-Dxpktacb.js";import{e as A,C as b,h as g,i as y,v as h,a as x,W as f,j as F,B as P,o as d,I,X as T,f as D,w as R}from"./index-BiBisH8X.js";import{L as v}from"./label-DDyL8AZL.js";import{A as a,b as c}from"./alert-DQClezAk.js";import{R as q}from"./refresh-cw-C3bXnO94.js";function G(){const{toast:t}=A(),S=C(),[l,k]=r.useState(""),[m,U]=r.useState(""),[M,Q]=r.useState(!1),[u,i]=r.useState("idle"),{data:n,isLoading:j}=w({queryKey:["/api/shopify/status"]}),o=N({mutationFn:async()=>{const s=await fetch("/api/shopify/verify",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({shopUrl:l.trim(),accessToken:m.trim(),apiVersion:"2024-10"})});if(!s.ok)throw new Error("Failed to verify connection");return s.json()},onSuccess:s=>{s.valid?(i("valid"),t({title:"Connection Verified",description:"Successfully connected to your Shopify store."})):(i("invalid"),t({title:"Connection Failed",description:s.error||"Could not connect to Shopify store.",variant:"destructive"}))},onError:()=>{i("invalid"),t({title:"Verification Error",description:"Failed to verify connection. Please check your credentials.",variant:"destructive"})}}),p=N({mutationFn:async()=>{const s=await fetch("/api/shopify/sync",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include"});if(!s.ok){const E=await s.json();throw new Error(E.message||"Failed to sync customers")}return s.json()},onSuccess:s=>{S.invalidateQueries({queryKey:["/api/shopify/status"]}),S.invalidateQueries({queryKey:["/api/patients"]}),t({title:"Sync Complete",description:`Successfully synced ${s.success} customers. ${s.skipped} skipped, ${s.failed} failed.`})},onError:s=>{t({title:"Sync Failed",description:s.message,variant:"destructive"})}}),L=()=>{if(!l.trim()||!m.trim()){t({title:"Missing Information",description:"Please enter both Shop URL and Access Token.",variant:"destructive"});return}o.mutate()},V=()=>{if(!n?.enabled){t({title:"Not Connected",description:"Please verify your Shopify connection first.",variant:"destructive"});return}p.mutate()};return j?e.jsxDEV(b,{children:[e.jsxDEV(g,{children:e.jsxDEV(y,{className:"flex items-center gap-2",children:[e.jsxDEV(h,{className:"h-5 w-5"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/ShopifyIntegrationSettings.tsx",lineNumber:146,columnNumber:13},this),"Shopify Integration"]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/ShopifyIntegrationSettings.tsx",lineNumber:145,columnNumber:11},this)},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/ShopifyIntegrationSettings.tsx",lineNumber:144,columnNumber:9},this),e.jsxDEV(x,{children:e.jsxDEV("div",{className:"flex items-center justify-center py-8",children:e.jsxDEV(f,{className:"h-8 w-8 animate-spin text-muted-foreground"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/ShopifyIntegrationSettings.tsx",lineNumber:152,columnNumber:13},this)},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/ShopifyIntegrationSettings.tsx",lineNumber:151,columnNumber:11},this)},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/ShopifyIntegrationSettings.tsx",lineNumber:150,columnNumber:9},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/ShopifyIntegrationSettings.tsx",lineNumber:143,columnNumber:7},this):e.jsxDEV(b,{children:[e.jsxDEV(g,{children:e.jsxDEV("div",{className:"flex items-center justify-between",children:[e.jsxDEV("div",{children:[e.jsxDEV(y,{className:"flex items-center gap-2",children:[e.jsxDEV(h,{className:"h-5 w-5"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/ShopifyIntegrationSettings.tsx",lineNumber:165,columnNumber:15},this),"Shopify Integration"]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/ShopifyIntegrationSettings.tsx",lineNumber:164,columnNumber:13},this),e.jsxDEV(F,{className:"mt-1.5",children:"Sync your Shopify customers as patients automatically"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/ShopifyIntegrationSettings.tsx",lineNumber:168,columnNumber:13},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/ShopifyIntegrationSettings.tsx",lineNumber:163,columnNumber:11},this),n?.enabled&&e.jsxDEV(P,{variant:"default",className:"bg-green-500",children:[e.jsxDEV(d,{className:"h-3 w-3 mr-1"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/ShopifyIntegrationSettings.tsx",lineNumber:174,columnNumber:15},this),"Connected"]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/ShopifyIntegrationSettings.tsx",lineNumber:173,columnNumber:13},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/ShopifyIntegrationSettings.tsx",lineNumber:162,columnNumber:9},this)},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/ShopifyIntegrationSettings.tsx",lineNumber:161,columnNumber:7},this),e.jsxDEV(x,{className:"space-y-6",children:[n?.enabled&&n.shopUrl&&e.jsxDEV(a,{children:[e.jsxDEV(h,{className:"h-4 w-4"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/ShopifyIntegrationSettings.tsx",lineNumber:184,columnNumber:13},this),e.jsxDEV(c,{children:["Connected to ",e.jsxDEV("strong",{children:n.shopUrl},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/ShopifyIntegrationSettings.tsx",lineNumber:186,columnNumber:28},this),n.lastSyncAt&&e.jsxDEV("span",{className:"text-muted-foreground ml-2",children:["• Last synced ",new Date(n.lastSyncAt).toLocaleString()]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/ShopifyIntegrationSettings.tsx",lineNumber:188,columnNumber:17},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/ShopifyIntegrationSettings.tsx",lineNumber:185,columnNumber:13},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/ShopifyIntegrationSettings.tsx",lineNumber:183,columnNumber:11},this),e.jsxDEV("div",{className:"space-y-4",children:[e.jsxDEV("div",{className:"space-y-2",children:[e.jsxDEV(v,{htmlFor:"shopUrl",children:"Shop URL"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/ShopifyIntegrationSettings.tsx",lineNumber:199,columnNumber:13},this),e.jsxDEV(I,{id:"shopUrl",placeholder:"mystore.myshopify.com",value:l,onChange:s=>{k(s.target.value),i("idle")},disabled:o.isPending},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/ShopifyIntegrationSettings.tsx",lineNumber:200,columnNumber:13},this),e.jsxDEV("p",{className:"text-xs text-muted-foreground",children:"Your Shopify store URL (e.g., mystore.myshopify.com)"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/ShopifyIntegrationSettings.tsx",lineNumber:210,columnNumber:13},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/ShopifyIntegrationSettings.tsx",lineNumber:198,columnNumber:11},this),e.jsxDEV("div",{className:"space-y-2",children:[e.jsxDEV(v,{htmlFor:"accessToken",children:"Admin API Access Token"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/ShopifyIntegrationSettings.tsx",lineNumber:216,columnNumber:13},this),e.jsxDEV(I,{id:"accessToken",type:"password",placeholder:"shpat_••••••••••••••••",value:m,onChange:s=>{U(s.target.value),i("idle")},disabled:o.isPending},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/ShopifyIntegrationSettings.tsx",lineNumber:217,columnNumber:13},this),e.jsxDEV("p",{className:"text-xs text-muted-foreground",children:"Generate from Shopify Admin → Apps → Develop apps → Create private app"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/ShopifyIntegrationSettings.tsx",lineNumber:228,columnNumber:13},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/ShopifyIntegrationSettings.tsx",lineNumber:215,columnNumber:11},this),u==="valid"&&e.jsxDEV(a,{className:"bg-green-50 border-green-200",children:[e.jsxDEV(d,{className:"h-4 w-4 text-green-600"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/ShopifyIntegrationSettings.tsx",lineNumber:236,columnNumber:15},this),e.jsxDEV(c,{className:"text-green-800",children:"Connection verified successfully! You can now sync your customers."},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/ShopifyIntegrationSettings.tsx",lineNumber:237,columnNumber:15},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/ShopifyIntegrationSettings.tsx",lineNumber:235,columnNumber:13},this),u==="invalid"&&e.jsxDEV(a,{variant:"destructive",children:[e.jsxDEV(T,{className:"h-4 w-4"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/ShopifyIntegrationSettings.tsx",lineNumber:245,columnNumber:15},this),e.jsxDEV(c,{children:"Connection failed. Please check your credentials and try again."},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/ShopifyIntegrationSettings.tsx",lineNumber:246,columnNumber:15},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/ShopifyIntegrationSettings.tsx",lineNumber:244,columnNumber:13},this),e.jsxDEV("div",{className:"flex gap-3",children:[e.jsxDEV(D,{onClick:L,disabled:o.isPending,variant:"outline",children:o.isPending?e.jsxDEV(e.Fragment,{children:[e.jsxDEV(f,{className:"h-4 w-4 mr-2 animate-spin"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/ShopifyIntegrationSettings.tsx",lineNumber:261,columnNumber:19},this),"Verifying..."]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/ShopifyIntegrationSettings.tsx",lineNumber:260,columnNumber:17},this):e.jsxDEV(e.Fragment,{children:[e.jsxDEV(d,{className:"h-4 w-4 mr-2"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/ShopifyIntegrationSettings.tsx",lineNumber:266,columnNumber:19},this),"Verify Connection"]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/ShopifyIntegrationSettings.tsx",lineNumber:265,columnNumber:17},this)},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/ShopifyIntegrationSettings.tsx",lineNumber:254,columnNumber:13},this),u==="valid"&&e.jsxDEV(D,{onClick:V,disabled:p.isPending,children:p.isPending?e.jsxDEV(e.Fragment,{children:[e.jsxDEV(f,{className:"h-4 w-4 mr-2 animate-spin"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/ShopifyIntegrationSettings.tsx",lineNumber:279,columnNumber:21},this),"Syncing..."]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/ShopifyIntegrationSettings.tsx",lineNumber:278,columnNumber:19},this):e.jsxDEV(e.Fragment,{children:[e.jsxDEV(q,{className:"h-4 w-4 mr-2"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/ShopifyIntegrationSettings.tsx",lineNumber:284,columnNumber:21},this),"Sync Customers Now"]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/ShopifyIntegrationSettings.tsx",lineNumber:283,columnNumber:19},this)},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/ShopifyIntegrationSettings.tsx",lineNumber:273,columnNumber:15},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/ShopifyIntegrationSettings.tsx",lineNumber:253,columnNumber:11},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/ShopifyIntegrationSettings.tsx",lineNumber:197,columnNumber:9},this),e.jsxDEV(a,{children:[e.jsxDEV(R,{className:"h-4 w-4"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/ShopifyIntegrationSettings.tsx",lineNumber:295,columnNumber:11},this),e.jsxDEV(c,{children:[e.jsxDEV("strong",{children:"How it works:"},void 0,!1,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/ShopifyIntegrationSettings.tsx",lineNumber:297,columnNumber:13},this)," Shopify customers will be imported as patients with their contact information. Existing patients (matched by email) will be skipped to avoid duplicates."]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/ShopifyIntegrationSettings.tsx",lineNumber:296,columnNumber:11},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/ShopifyIntegrationSettings.tsx",lineNumber:294,columnNumber:9},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/ShopifyIntegrationSettings.tsx",lineNumber:180,columnNumber:7},this)]},void 0,!0,{fileName:"/Users/saban/Desktop/ILS2.0/client/src/components/ShopifyIntegrationSettings.tsx",lineNumber:160,columnNumber:5},this)}export{G as S};
