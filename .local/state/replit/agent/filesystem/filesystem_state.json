{"file_contents":{"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","size_bytes":2765},"client/src/pages/examples/NewOrderPage.tsx":{"content":"import NewOrderPage from '../NewOrderPage'\n\nexport default function NewOrderPageExample() {\n  return <NewOrderPage />\n}\n","size_bytes":120},"client/src/pages/RoleSwitcher.tsx":{"content":"import { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Users, Beaker, Package, Building2 } from \"lucide-react\";\nimport { useLocation } from \"wouter\";\n\nexport default function RoleSwitcher() {\n  const [, setLocation] = useLocation();\n\n  const roles = [\n    {\n      title: \"Eye Care Professional\",\n      description: \"Submit orders, track status, and manage patient prescriptions\",\n      icon: Users,\n      path: \"/ecp/dashboard\",\n      color: \"bg-blue-500/10 text-blue-700 dark:text-blue-400\",\n    },\n    {\n      title: \"Lab Technician\",\n      description: \"Manage production queue, update order status, and quality control\",\n      icon: Package,\n      path: \"/lab/dashboard\",\n      color: \"bg-emerald-500/10 text-emerald-700 dark:text-emerald-400\",\n    },\n    {\n      title: \"Principal Engineer\",\n      description: \"Analytics hub, equipment tracking, and R&D project management\",\n      icon: Beaker,\n      path: \"/engineer/dashboard\",\n      color: \"bg-purple-500/10 text-purple-700 dark:text-purple-400\",\n    },\n    {\n      title: \"Supplier\",\n      description: \"View purchase orders, manage deliveries, and technical documentation\",\n      icon: Building2,\n      path: \"/supplier/dashboard\",\n      color: \"bg-orange-500/10 text-orange-700 dark:text-orange-400\",\n    },\n  ];\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center p-4\">\n      <div className=\"max-w-4xl w-full space-y-8\">\n        <div className=\"text-center\">\n          <div className=\"inline-flex items-center justify-center w-16 h-16 rounded-md bg-primary mb-4\">\n            <span className=\"text-primary-foreground font-bold text-2xl\">ILS</span>\n          </div>\n          <h1 className=\"text-3xl font-bold\">Integrated Lens System</h1>\n          <p className=\"text-muted-foreground mt-2\">\n            Select your role to access the portal\n          </p>\n        </div>\n\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n          {roles.map((role) => {\n            const Icon = role.icon;\n            return (\n              <Card key={role.title} className=\"hover-elevate\">\n                <CardHeader>\n                  <div className={`w-12 h-12 rounded-md ${role.color} flex items-center justify-center mb-2`}>\n                    <Icon className=\"h-6 w-6\" />\n                  </div>\n                  <CardTitle>{role.title}</CardTitle>\n                  <CardDescription>{role.description}</CardDescription>\n                </CardHeader>\n                <CardContent>\n                  <Button\n                    className=\"w-full\"\n                    onClick={() => setLocation(role.path)}\n                    data-testid={`button-role-${role.title.toLowerCase().replace(/\\s+/g, '-')}`}\n                  >\n                    Access Portal\n                  </Button>\n                </CardContent>\n              </Card>\n            );\n          })}\n        </div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":3011},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","size_bytes":1642},"client/src/pages/SupplierDashboard.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Package, FileText, Truck, Plus, Edit, Trash2, Printer, Mail } from \"lucide-react\";\nimport { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { format } from \"date-fns\";\nimport type { PurchaseOrderWithDetails } from \"@shared/schema\";\nimport { TechnicalDocumentManager } from \"@/components/TechnicalDocumentManager\";\n\nfunction POStatusBadge({ status }: { status: string }) {\n  const variants: Record<string, { color: string }> = {\n    draft: { color: \"bg-slate-500\" },\n    sent: { color: \"bg-blue-500\" },\n    acknowledged: { color: \"bg-purple-500\" },\n    in_transit: { color: \"bg-yellow-600\" },\n    delivered: { color: \"bg-green-600\" },\n    cancelled: { color: \"bg-red-500\" },\n  };\n\n  const variant = variants[status] || { color: \"bg-gray-500\" };\n\n  return (\n    <Badge className={`${variant.color} text-white`} data-testid={`badge-po-status-${status}`}>\n      {status.replace(/_/g, \" \").toUpperCase()}\n    </Badge>\n  );\n}\n\nfunction UpdatePOStatusDialog({ po }: { po: PurchaseOrderWithDetails }) {\n  const [open, setOpen] = useState(false);\n  const [status, setStatus] = useState(po.status);\n  const [trackingNumber, setTrackingNumber] = useState(po.trackingNumber || \"\");\n  const { toast } = useToast();\n\n  const updateMutation = useMutation({\n    mutationFn: async (data: { status: string; trackingNumber?: string }) => {\n      const response = await apiRequest(\"PATCH\", `/api/purchase-orders/${po.id}/status`, data);\n      return await response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/purchase-orders\"] });\n      toast({\n        title: \"Purchase order updated\",\n        description: \"The purchase order status has been updated successfully.\",\n      });\n      setOpen(false);\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Error updating purchase order\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    updateMutation.mutate({\n      status,\n      trackingNumber: trackingNumber || undefined,\n    });\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={setOpen}>\n      <DialogTrigger asChild>\n        <Button variant=\"outline\" size=\"sm\" data-testid={`button-update-po-${po.id}`}>\n          <Edit className=\"h-4 w-4 mr-2\" />\n          Update\n        </Button>\n      </DialogTrigger>\n      <DialogContent>\n        <form onSubmit={handleSubmit}>\n          <DialogHeader>\n            <DialogTitle>Update Purchase Order Status</DialogTitle>\n            <DialogDescription>\n              Update the status and tracking information for {po.poNumber}\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-4 py-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"status\">Status</Label>\n              <Select value={status} onValueChange={(value) => setStatus(value as typeof po.status)}>\n                <SelectTrigger id=\"status\" data-testid=\"select-po-status\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"acknowledged\">Acknowledged</SelectItem>\n                  <SelectItem value=\"in_transit\">In Transit</SelectItem>\n                  <SelectItem value=\"delivered\">Delivered</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"tracking\">Tracking Number</Label>\n              <Input\n                id=\"tracking\"\n                value={trackingNumber}\n                onChange={(e) => setTrackingNumber(e.target.value)}\n                placeholder=\"Enter tracking number\"\n                data-testid=\"input-tracking-number\"\n              />\n            </div>\n          </div>\n          <DialogFooter>\n            <Button\n              type=\"button\"\n              variant=\"outline\"\n              onClick={() => setOpen(false)}\n              data-testid=\"button-cancel-update\"\n            >\n              Cancel\n            </Button>\n            <Button type=\"submit\" disabled={updateMutation.isPending} data-testid=\"button-save-update\">\n              {updateMutation.isPending ? \"Updating...\" : \"Update Status\"}\n            </Button>\n          </DialogFooter>\n        </form>\n      </DialogContent>\n    </Dialog>\n  );\n}\n\nexport default function SupplierDashboard() {\n  const { toast } = useToast();\n\n  const { data: purchaseOrders, isLoading: posLoading } = useQuery<PurchaseOrderWithDetails[]>({\n    queryKey: [\"/api/purchase-orders\"],\n  });\n\n  const { data: technicalDocs, isLoading: docsLoading } = useQuery<any[]>({\n    queryKey: [\"/api/technical-documents\"],\n  });\n\n  const handlePrintPO = async (poId: string) => {\n    try {\n      window.open(`/api/purchase-orders/${poId}/pdf`, '_blank');\n    } catch (error) {\n      toast({\n        title: \"Error printing PO\",\n        description: \"Failed to generate PDF\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const stats = {\n    totalPOs: purchaseOrders?.length || 0,\n    pendingPOs: purchaseOrders?.filter(po => po.status === 'sent' || po.status === 'acknowledged').length || 0,\n    inTransit: purchaseOrders?.filter(po => po.status === 'in_transit').length || 0,\n    documents: technicalDocs?.length || 0,\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <div>\n        <h1 className=\"text-2xl font-semibold\" data-testid=\"text-supplier-dashboard-title\">\n          Supplier Portal\n        </h1>\n        <p className=\"text-muted-foreground mt-1\">\n          Manage purchase orders and technical documentation.\n        </p>\n      </div>\n\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Total Purchase Orders</CardTitle>\n            <Package className=\"h-4 w-4 text-muted-foreground\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-semibold\" data-testid=\"stat-total-pos\">{stats.totalPOs}</div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Pending Action</CardTitle>\n            <Package className=\"h-4 w-4 text-muted-foreground\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-semibold\" data-testid=\"stat-pending-pos\">{stats.pendingPOs}</div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">In Transit</CardTitle>\n            <Truck className=\"h-4 w-4 text-muted-foreground\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-semibold\" data-testid=\"stat-in-transit\">{stats.inTransit}</div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Technical Docs</CardTitle>\n            <FileText className=\"h-4 w-4 text-muted-foreground\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-semibold\" data-testid=\"stat-documents\">{stats.documents}</div>\n          </CardContent>\n        </Card>\n      </div>\n\n      <Card>\n        <CardHeader>\n          <CardTitle>Purchase Orders</CardTitle>\n        </CardHeader>\n        <CardContent>\n          {posLoading ? (\n            <div className=\"flex items-center justify-center py-8\">\n              <div className=\"w-8 h-8 border-4 border-primary border-t-transparent rounded-full animate-spin\"></div>\n            </div>\n          ) : purchaseOrders && purchaseOrders.length > 0 ? (\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead>PO Number</TableHead>\n                  <TableHead>Date</TableHead>\n                  <TableHead>Items</TableHead>\n                  <TableHead>Total</TableHead>\n                  <TableHead>Status</TableHead>\n                  <TableHead>Tracking</TableHead>\n                  <TableHead>Actions</TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {purchaseOrders.map((po) => (\n                  <TableRow key={po.id} data-testid={`row-po-${po.id}`}>\n                    <TableCell className=\"font-medium\" data-testid={`text-po-number-${po.id}`}>\n                      {po.poNumber}\n                    </TableCell>\n                    <TableCell data-testid={`text-po-date-${po.id}`}>\n                      {format(new Date(po.createdAt), \"MMM dd, yyyy\")}\n                    </TableCell>\n                    <TableCell data-testid={`text-po-items-${po.id}`}>\n                      {po.lineItems.length} item(s)\n                    </TableCell>\n                    <TableCell data-testid={`text-po-total-${po.id}`}>\n                      ${parseFloat(po.totalAmount || \"0\").toFixed(2)}\n                    </TableCell>\n                    <TableCell>\n                      <POStatusBadge status={po.status} />\n                    </TableCell>\n                    <TableCell data-testid={`text-tracking-${po.id}`}>\n                      {po.trackingNumber || \"-\"}\n                    </TableCell>\n                    <TableCell>\n                      <div className=\"flex gap-2\">\n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          onClick={() => handlePrintPO(po.id)}\n                          data-testid={`button-print-po-${po.id}`}\n                        >\n                          <Printer className=\"h-4 w-4\" />\n                        </Button>\n                        <UpdatePOStatusDialog po={po} />\n                      </div>\n                    </TableCell>\n                  </TableRow>\n                ))}\n              </TableBody>\n            </Table>\n          ) : (\n            <div className=\"text-center py-8 text-muted-foreground\" data-testid=\"text-no-pos\">\n              No purchase orders yet. The lab will send orders as materials are needed.\n            </div>\n          )}\n        </CardContent>\n      </Card>\n\n      <TechnicalDocumentManager />\n    </div>\n  );\n}\n","size_bytes":11356},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","size_bytes":1139},"db/index.ts":{"content":"import { drizzle } from \"drizzle-orm/neon-serverless\";\nimport ws from \"ws\";\nimport * as schema from \"../shared/schema\";\n\nif (!process.env.DATABASE_URL) {\n  console.error(\"FATAL: DATABASE_URL environment variable is not set\");\n  console.error(\"This is required for database connectivity\");\n  \n  // In production deployment, this should be configured in deployment secrets\n  if (process.env.REPLIT_DEPLOYMENT) {\n    console.error(\"Running in production deployment - DATABASE_URL must be set in deployment configuration\");\n  }\n  \n  throw new Error(\"DATABASE_URL must be set. Please configure it in your deployment secrets or environment variables.\");\n}\n\nconsole.log(\"Initializing database connection...\");\n\nexport const db = drizzle({\n  connection: process.env.DATABASE_URL,\n  schema,\n  ws: ws,\n});\n\nconsole.log(\"Database connection initialized successfully\");\n","size_bytes":858},"client/src/components/examples/FilterBar.tsx":{"content":"import { FilterBar } from '../FilterBar'\nimport { useState } from 'react'\n\nexport default function FilterBarExample() {\n  const [statusFilter, setStatusFilter] = useState('')\n  const [ecpFilter, setEcpFilter] = useState('')\n\n  return (\n    <FilterBar\n      statusFilter={statusFilter}\n      onStatusChange={setStatusFilter}\n      ecpFilter={ecpFilter}\n      onEcpChange={setEcpFilter}\n      onClearFilters={() => {\n        setStatusFilter('')\n        setEcpFilter('')\n      }}\n    />\n  )\n}\n","size_bytes":490},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","size_bytes":6210},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","size_bytes":689},"tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nexport default {\n  darkMode: [\"class\"],\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      borderRadius: {\n        lg: \".5625rem\", /* 9px */\n        md: \".375rem\", /* 6px */\n        sm: \".1875rem\", /* 3px */\n      },\n      colors: {\n        // Flat / base colors (regular buttons)\n        background: \"hsl(var(--background) / <alpha-value>)\",\n        foreground: \"hsl(var(--foreground) / <alpha-value>)\",\n        border: \"hsl(var(--border) / <alpha-value>)\",\n        input: \"hsl(var(--input) / <alpha-value>)\",\n        card: {\n          DEFAULT: \"hsl(var(--card) / <alpha-value>)\",\n          foreground: \"hsl(var(--card-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--card-border) / <alpha-value>)\",\n        },\n        popover: {\n          DEFAULT: \"hsl(var(--popover) / <alpha-value>)\",\n          foreground: \"hsl(var(--popover-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--popover-border) / <alpha-value>)\",\n        },\n        primary: {\n          DEFAULT: \"hsl(var(--primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--primary-foreground) / <alpha-value>)\",\n          border: \"var(--primary-border)\",\n        },\n        secondary: {\n          DEFAULT: \"hsl(var(--secondary) / <alpha-value>)\",\n          foreground: \"hsl(var(--secondary-foreground) / <alpha-value>)\",\n          border: \"var(--secondary-border)\",\n        },\n        muted: {\n          DEFAULT: \"hsl(var(--muted) / <alpha-value>)\",\n          foreground: \"hsl(var(--muted-foreground) / <alpha-value>)\",\n          border: \"var(--muted-border)\",\n        },\n        accent: {\n          DEFAULT: \"hsl(var(--accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--accent-foreground) / <alpha-value>)\",\n          border: \"var(--accent-border)\",\n        },\n        destructive: {\n          DEFAULT: \"hsl(var(--destructive) / <alpha-value>)\",\n          foreground: \"hsl(var(--destructive-foreground) / <alpha-value>)\",\n          border: \"var(--destructive-border)\",\n        },\n        ring: \"hsl(var(--ring) / <alpha-value>)\",\n        chart: {\n          \"1\": \"hsl(var(--chart-1) / <alpha-value>)\",\n          \"2\": \"hsl(var(--chart-2) / <alpha-value>)\",\n          \"3\": \"hsl(var(--chart-3) / <alpha-value>)\",\n          \"4\": \"hsl(var(--chart-4) / <alpha-value>)\",\n          \"5\": \"hsl(var(--chart-5) / <alpha-value>)\",\n        },\n        sidebar: {\n          ring: \"hsl(var(--sidebar-ring) / <alpha-value>)\",\n          DEFAULT: \"hsl(var(--sidebar) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--sidebar-border) / <alpha-value>)\",\n        },\n        \"sidebar-primary\": {\n          DEFAULT: \"hsl(var(--sidebar-primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-primary-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-primary-border)\",\n        },\n        \"sidebar-accent\": {\n          DEFAULT: \"hsl(var(--sidebar-accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-accent-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-accent-border)\"\n        },\n        status: {\n          online: \"rgb(34 197 94)\",\n          away: \"rgb(245 158 11)\",\n          busy: \"rgb(239 68 68)\",\n          offline: \"rgb(156 163 175)\",\n        },\n      },\n      fontFamily: {\n        sans: [\"var(--font-sans)\"],\n        serif: [\"var(--font-serif)\"],\n        mono: [\"var(--font-mono)\"],\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: { height: \"0\" },\n          to: { height: \"var(--radix-accordion-content-height)\" },\n        },\n        \"accordion-up\": {\n          from: { height: \"var(--radix-accordion-content-height)\" },\n          to: { height: \"0\" },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n      },\n    },\n  },\n  plugins: [require(\"tailwindcss-animate\"), require(\"@tailwindcss/typography\")],\n} satisfies Config;\n","size_bytes":4050},"client/src/components/StatCard.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { LucideIcon } from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\n\ninterface StatCardProps {\n  title: string;\n  value: string | number;\n  icon: LucideIcon;\n  trend?: {\n    value: string;\n    isPositive: boolean;\n  };\n  className?: string;\n}\n\nexport function StatCard({ title, value, icon: Icon, trend, className }: StatCardProps) {\n  return (\n    <Card className={cn(\"hover-elevate\", className)}>\n      <CardContent className=\"p-6\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex-1\">\n            <p className=\"text-sm font-medium text-muted-foreground\">{title}</p>\n            <p className=\"text-3xl font-bold mt-2\" data-testid={`stat-${title.toLowerCase().replace(/\\s+/g, '-')}`}>\n              {value}\n            </p>\n            {trend && (\n              <p className={cn(\n                \"text-sm mt-2\",\n                trend.isPositive ? \"text-green-600 dark:text-green-400\" : \"text-red-600 dark:text-red-400\"\n              )}>\n                {trend.value}\n              </p>\n            )}\n          </div>\n          <div className=\"flex-shrink-0\">\n            <div className=\"w-12 h-12 rounded-md bg-primary/10 flex items-center justify-center\">\n              <Icon className=\"h-6 w-6 text-primary\" />\n            </div>\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","size_bytes":1415},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","size_bytes":756},"server/replitAuth.ts":{"content":"import * as client from \"openid-client\";\nimport { Strategy, type VerifyFunction } from \"openid-client/passport\";\nimport passport from \"passport\";\nimport session from \"express-session\";\nimport type { Express, RequestHandler } from \"express\";\nimport memoize from \"memoizee\";\nimport connectPg from \"connect-pg-simple\";\nimport { storage } from \"./storage\";\nimport { setupLocalAuth } from \"./localAuth\";\n\nif (!process.env.REPLIT_DOMAINS) {\n  throw new Error(\"Environment variable REPLIT_DOMAINS not provided\");\n}\n\nconst getOidcConfig = memoize(\n  async () => {\n    return await client.discovery(\n      new URL(process.env.ISSUER_URL ?? \"https://replit.com/oidc\"),\n      process.env.REPL_ID!\n    );\n  },\n  { maxAge: 3600 * 1000 }\n);\n\nexport function getSession() {\n  const sessionTtl = 7 * 24 * 60 * 60 * 1000; // 1 week\n  const pgStore = connectPg(session);\n  const sessionStore = new pgStore({\n    conString: process.env.DATABASE_URL,\n    createTableIfMissing: false,\n    ttl: sessionTtl,\n    tableName: \"sessions\",\n  });\n  return session({\n    secret: process.env.SESSION_SECRET!,\n    store: sessionStore,\n    resave: false,\n    saveUninitialized: false,\n    cookie: {\n      httpOnly: true,\n      secure: true,\n      maxAge: sessionTtl,\n    },\n  });\n}\n\nfunction updateUserSession(\n  user: any,\n  tokens: client.TokenEndpointResponse & client.TokenEndpointResponseHelpers\n) {\n  user.claims = tokens.claims();\n  user.access_token = tokens.access_token;\n  user.refresh_token = tokens.refresh_token;\n  user.expires_at = user.claims?.exp;\n}\n\nasync function upsertUser(claims: any) {\n  await storage.upsertUser({\n    id: claims[\"sub\"],\n    email: claims[\"email\"],\n    firstName: claims[\"first_name\"],\n    lastName: claims[\"last_name\"],\n    profileImageUrl: claims[\"profile_image_url\"],\n  });\n}\n\nexport async function setupAuth(app: Express) {\n  app.set(\"trust proxy\", 1);\n  app.use(getSession());\n  app.use(passport.initialize());\n  app.use(passport.session());\n\n  const config = await getOidcConfig();\n\n  const verify: VerifyFunction = async (\n    tokens: client.TokenEndpointResponse & client.TokenEndpointResponseHelpers,\n    verified: passport.AuthenticateCallback\n  ) => {\n    const user = {};\n    updateUserSession(user, tokens);\n    await upsertUser(tokens.claims());\n    verified(null, user);\n  };\n\n  for (const domain of process.env.REPLIT_DOMAINS!.split(\",\")) {\n    const strategy = new Strategy(\n      {\n        name: `replitauth:${domain}`,\n        config,\n        scope: \"openid email profile offline_access\",\n        callbackURL: `https://${domain}/api/callback`,\n      },\n      verify\n    );\n    passport.use(strategy);\n  }\n\n  passport.serializeUser((user: Express.User, cb) => cb(null, user));\n  passport.deserializeUser((user: Express.User, cb) => cb(null, user));\n\n  // Setup local email/password authentication\n  setupLocalAuth();\n\n  app.get(\"/api/login\", (req, res, next) => {\n    passport.authenticate(`replitauth:${req.hostname}`, {\n      prompt: \"login consent\",\n      scope: [\"openid\", \"email\", \"profile\", \"offline_access\"],\n    })(req, res, next);\n  });\n\n  app.get(\"/api/callback\", (req, res, next) => {\n    passport.authenticate(`replitauth:${req.hostname}`, {\n      successReturnToOrRedirect: \"/\",\n      failureRedirect: \"/api/login\",\n    })(req, res, next);\n  });\n\n  app.get(\"/api/logout\", (req, res) => {\n    req.logout(() => {\n      res.redirect(\n        client.buildEndSessionUrl(config, {\n          client_id: process.env.REPL_ID!,\n          post_logout_redirect_uri: `${req.protocol}://${req.hostname}`,\n        }).href\n      );\n    });\n  });\n}\n\nexport const isAuthenticated: RequestHandler = async (req, res, next) => {\n  const user = req.user as any;\n\n  // Check if user is authenticated via passport\n  if (!req.isAuthenticated()) {\n    return res.status(401).json({ message: \"Unauthorized\" });\n  }\n\n  // If this is a local email/password user, skip token refresh logic\n  if (user.local) {\n    return next();\n  }\n\n  // For Replit OAuth users, check and refresh tokens as needed\n  if (!user.expires_at) {\n    return res.status(401).json({ message: \"Unauthorized\" });\n  }\n\n  const now = Math.floor(Date.now() / 1000);\n  if (now <= user.expires_at) {\n    return next();\n  }\n\n  const refreshToken = user.refresh_token;\n  if (!refreshToken) {\n    res.status(401).json({ message: \"Unauthorized\" });\n    return;\n  }\n\n  try {\n    const config = await getOidcConfig();\n    const tokenResponse = await client.refreshTokenGrant(config, refreshToken);\n    updateUserSession(user, tokenResponse);\n    return next();\n  } catch (error) {\n    res.status(401).json({ message: \"Unauthorized\" });\n    return;\n  }\n};\n","size_bytes":4623},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","size_bytes":1753},"client/src/App.tsx":{"content":"import { Switch, Route, Redirect } from \"wouter\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport { SidebarProvider, SidebarTrigger } from \"@/components/ui/sidebar\";\nimport { AppSidebar } from \"@/components/AppSidebar\";\nimport { ThemeToggle } from \"@/components/ThemeToggle\";\nimport { RoleSwitcherDropdown } from \"@/components/RoleSwitcherDropdown\";\nimport { Button } from \"@/components/ui/button\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport Landing from \"@/pages/Landing\";\nimport NotFound from \"@/pages/not-found\";\nimport ECPDashboard from \"@/pages/ECPDashboard\";\nimport LabDashboard from \"@/pages/LabDashboard\";\nimport SupplierDashboard from \"@/pages/SupplierDashboard\";\nimport NewOrderPage from \"@/pages/NewOrderPage\";\nimport OrderDetailsPage from \"@/pages/OrderDetailsPage\";\nimport SettingsPage from \"@/pages/SettingsPage\";\nimport SignupPage from \"@/pages/SignupPage\";\nimport PendingApprovalPage from \"@/pages/PendingApprovalPage\";\nimport AccountSuspendedPage from \"@/pages/AccountSuspendedPage\";\nimport AdminDashboard from \"@/pages/AdminDashboard\";\nimport EmailLoginPage from \"@/pages/EmailLoginPage\";\nimport EmailSignupPage from \"@/pages/EmailSignupPage\";\nimport GitHubPushPage from \"@/pages/github-push\";\nimport { LogOut } from \"lucide-react\";\nimport { useLocation } from \"wouter\";\n\nfunction AppLayout({ children, userRole }: { children: React.ReactNode; userRole: \"ecp\" | \"lab_tech\" | \"supplier\" | \"engineer\" | \"admin\" }) {\n  const style = {\n    \"--sidebar-width\": \"16rem\",\n  };\n\n  const handleLogout = () => {\n    window.location.href = \"/api/logout\";\n  };\n\n  return (\n    <SidebarProvider style={style as React.CSSProperties}>\n      <div className=\"flex h-screen w-full\">\n        <AppSidebar userRole={userRole} />\n        <div className=\"flex flex-col flex-1\">\n          <header className=\"flex items-center justify-between p-4 border-b border-border\">\n            <SidebarTrigger data-testid=\"button-sidebar-toggle\" />\n            <div className=\"flex items-center gap-2\">\n              <RoleSwitcherDropdown />\n              <ThemeToggle />\n              <Button \n                variant=\"ghost\" \n                size=\"icon\" \n                onClick={handleLogout}\n                data-testid=\"button-logout\"\n              >\n                <LogOut className=\"h-4 w-4\" />\n              </Button>\n            </div>\n          </header>\n          <main className=\"flex-1 overflow-auto p-6 md:p-8\">\n            {children}\n          </main>\n        </div>\n      </div>\n    </SidebarProvider>\n  );\n}\n\nfunction AuthenticatedApp() {\n  const { user, isLoading } = useAuth();\n  const [location] = useLocation();\n\n  // Public routes (accessible without auth)\n  if (location === '/email-login') {\n    return <EmailLoginPage />;\n  }\n  \n  if (location === '/email-signup') {\n    return <EmailSignupPage />;\n  }\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center h-screen\">\n        <div className=\"text-center\">\n          <div className=\"w-16 h-16 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-4\"></div>\n          <p className=\"text-muted-foreground\">Loading...</p>\n        </div>\n      </div>\n    );\n  }\n\n  if (!user) {\n    return <Landing />;\n  }\n\n  // Handle users who need to complete signup\n  if (!user.role) {\n    return (\n      <Switch>\n        <Route path=\"/signup\" component={SignupPage} />\n        <Route><Redirect to=\"/signup\" /></Route>\n      </Switch>\n    );\n  }\n\n  // Handle pending approval status\n  if (user.accountStatus === 'pending') {\n    return (\n      <Switch>\n        <Route path=\"/pending-approval\" component={PendingApprovalPage} />\n        <Route><Redirect to=\"/pending-approval\" /></Route>\n      </Switch>\n    );\n  }\n\n  // Handle suspended accounts\n  if (user.accountStatus === 'suspended') {\n    return (\n      <Switch>\n        <Route path=\"/account-suspended\" component={AccountSuspendedPage} />\n        <Route><Redirect to=\"/account-suspended\" /></Route>\n      </Switch>\n    );\n  }\n\n  const userRole = user.role;\n  \n  const getRoleBasePath = () => {\n    switch (userRole) {\n      case \"ecp\":\n        return \"/ecp\";\n      case \"lab_tech\":\n      case \"engineer\":\n        return \"/lab\";\n      case \"supplier\":\n        return \"/supplier\";\n      case \"admin\":\n        return \"/admin\";\n      default:\n        return \"/lab\";\n    }\n  };\n\n  if (location === \"/\" || location === \"\") {\n    return <Redirect to={`${getRoleBasePath()}/dashboard`} />;\n  }\n\n  return (\n    <AppLayout userRole={userRole}>\n      <Switch>\n        {userRole === \"ecp\" && (\n          <>\n            <Route path=\"/ecp/dashboard\" component={ECPDashboard} />\n            <Route path=\"/ecp/new-order\" component={NewOrderPage} />\n            <Route path=\"/ecp/orders\" component={ECPDashboard} />\n            <Route path=\"/order/:id\" component={OrderDetailsPage} />\n            <Route path=\"/ecp/returns\">\n              <div className=\"text-center py-12\">\n                <h2 className=\"text-2xl font-semibold\">Returns Management</h2>\n                <p className=\"text-muted-foreground mt-2\">Returns and non-adapt tracking</p>\n              </div>\n            </Route>\n          </>\n        )}\n\n        {(userRole === \"lab_tech\" || userRole === \"engineer\") && (\n          <>\n            <Route path=\"/lab/dashboard\" component={LabDashboard} />\n            <Route path=\"/order/:id\" component={OrderDetailsPage} />\n            <Route path=\"/lab/queue\">\n              <div className=\"text-center py-12\">\n                <h2 className=\"text-2xl font-semibold\">Order Queue</h2>\n                <p className=\"text-muted-foreground mt-2\">Full order queue management</p>\n              </div>\n            </Route>\n            <Route path=\"/lab/production\">\n              <div className=\"text-center py-12\">\n                <h2 className=\"text-2xl font-semibold\">Production Tracking</h2>\n                <p className=\"text-muted-foreground mt-2\">Real-time production monitoring</p>\n              </div>\n            </Route>\n            <Route path=\"/lab/quality\">\n              <div className=\"text-center py-12\">\n                <h2 className=\"text-2xl font-semibold\">Quality Control</h2>\n                <p className=\"text-muted-foreground mt-2\">QC inspection and approval workflow</p>\n              </div>\n            </Route>\n            <Route path=\"/lab/analytics\">\n              <div className=\"text-center py-12\">\n                <h2 className=\"text-2xl font-semibold\">Analytics Hub</h2>\n                <p className=\"text-muted-foreground mt-2\">Root cause analysis and data correlation</p>\n              </div>\n            </Route>\n            <Route path=\"/lab/equipment\">\n              <div className=\"text-center py-12\">\n                <h2 className=\"text-2xl font-semibold\">Equipment Management</h2>\n                <p className=\"text-muted-foreground mt-2\">Calibration tracking and maintenance scheduling</p>\n              </div>\n            </Route>\n            <Route path=\"/lab/rnd\">\n              <div className=\"text-center py-12\">\n                <h2 className=\"text-2xl font-semibold\">R&D Projects</h2>\n                <p className=\"text-muted-foreground mt-2\">Pilot runs and experimental tracking</p>\n              </div>\n            </Route>\n          </>\n        )}\n\n        {userRole === \"supplier\" && (\n          <>\n            <Route path=\"/supplier/dashboard\" component={SupplierDashboard} />\n            <Route path=\"/supplier/orders\" component={SupplierDashboard} />\n            <Route path=\"/supplier/library\" component={SupplierDashboard} />\n          </>\n        )}\n\n        {userRole === \"admin\" && (\n          <>\n            <Route path=\"/admin/dashboard\" component={AdminDashboard} />\n            <Route path=\"/admin/users\" component={AdminDashboard} />\n            <Route path=\"/admin/platform\">\n              <div className=\"text-center py-12\">\n                <h2 className=\"text-2xl font-semibold\">Platform Settings</h2>\n                <p className=\"text-muted-foreground mt-2\">Configure platform-wide settings and restrictions</p>\n              </div>\n            </Route>\n          </>\n        )}\n\n        <Route path=\"/settings\" component={SettingsPage} />\n        <Route path=\"/github-push\" component={GitHubPushPage} />\n        <Route path=\"/help\">\n          <div className=\"text-center py-12\">\n            <h2 className=\"text-2xl font-semibold\">Help & Documentation</h2>\n            <p className=\"text-muted-foreground mt-2\">Support resources and guides</p>\n          </div>\n        </Route>\n\n        <Route component={NotFound} />\n      </Switch>\n    </AppLayout>\n  );\n}\n\nexport default function App() {\n  return (\n    <QueryClientProvider client={queryClient}>\n      <TooltipProvider>\n        <AuthenticatedApp />\n        <Toaster />\n      </TooltipProvider>\n    </QueryClientProvider>\n  );\n}\n","size_bytes":8980},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","size_bytes":4420},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      {children}\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","size_bytes":4281},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","size_bytes":772},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Dot } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-2 ring-ring ring-offset-background\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Dot />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","size_bytes":2154},"client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { AlertCircle } from \"lucide-react\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-gray-50\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex mb-4 gap-2\">\n            <AlertCircle className=\"h-8 w-8 text-red-500\" />\n            <h1 className=\"text-2xl font-bold text-gray-900\">404 Page Not Found</h1>\n          </div>\n\n          <p className=\"mt-4 text-sm text-gray-600\">\n            Did you forget to add the page to the router?\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":711},"client/src/components/examples/StatusBadge.tsx":{"content":"import { StatusBadge } from '../StatusBadge'\n\nexport default function StatusBadgeExample() {\n  return (\n    <div className=\"flex flex-wrap gap-2\">\n      <StatusBadge status=\"pending\" />\n      <StatusBadge status=\"in_production\" />\n      <StatusBadge status=\"quality_check\" />\n      <StatusBadge status=\"shipped\" />\n      <StatusBadge status=\"completed\" />\n      <StatusBadge status=\"on_hold\" />\n      <StatusBadge status=\"cancelled\" />\n    </div>\n  )\n}\n","size_bytes":453},"client/src/components/examples/PrescriptionDisplay.tsx":{"content":"import { PrescriptionDisplay } from '../PrescriptionDisplay'\n\nexport default function PrescriptionDisplayExample() {\n  const prescription = {\n    od: {\n      sphere: \"-2.50\",\n      cylinder: \"-0.75\",\n      axis: \"180\",\n      add: \"+2.00\",\n    },\n    os: {\n      sphere: \"-2.25\",\n      cylinder: \"-1.00\",\n      axis: \"175\",\n      add: \"+2.00\",\n    },\n    pd: \"63\",\n  };\n\n  return (\n    <div className=\"max-w-2xl\">\n      <PrescriptionDisplay prescription={prescription} />\n    </div>\n  )\n}\n","size_bytes":488},"client/src/pages/examples/RoleSwitcher.tsx":{"content":"import RoleSwitcher from '../RoleSwitcher'\n\nexport default function RoleSwitcherExample() {\n  return <RoleSwitcher />\n}\n","size_bytes":120},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  // Whitespace-nowrap: Badges should never wrap.\n  \"whitespace-nowrap inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\" +\n  \" hover-elevate \" ,\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground shadow-xs\",\n        secondary: \"border-transparent bg-secondary text-secondary-foreground\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground shadow-xs\",\n\n        outline: \" border [border-color:var(--badge-outline)] shadow-xs\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  },\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  );\n}\n\nexport { Badge, badgeVariants }\n","size_bytes":1202},"client/src/components/ui/label.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","size_bytes":710},"client/src/components/examples/StatCard.tsx":{"content":"import { StatCard } from '../StatCard'\nimport { Package, Clock, CheckCircle, TrendingUp } from 'lucide-react'\n\nexport default function StatCardExample() {\n  return (\n    <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\n      <StatCard\n        title=\"Total Orders\"\n        value=\"1,234\"\n        icon={Package}\n        trend={{ value: \"+12.5% from last month\", isPositive: true }}\n      />\n      <StatCard\n        title=\"In Production\"\n        value=\"45\"\n        icon={Clock}\n      />\n      <StatCard\n        title=\"Completed Today\"\n        value=\"23\"\n        icon={CheckCircle}\n        trend={{ value: \"+5.2% from yesterday\", isPositive: true }}\n      />\n      <StatCard\n        title=\"Efficiency Rate\"\n        value=\"94%\"\n        icon={TrendingUp}\n        trend={{ value: \"+2.1% from last week\", isPositive: true }}\n      />\n    </div>\n  )\n}\n","size_bytes":864},"server/db.ts":{"content":"import { Pool, neonConfig } from '@neondatabase/serverless';\nimport { drizzle } from 'drizzle-orm/neon-serverless';\nimport ws from \"ws\";\nimport * as schema from \"@shared/schema\";\n\nneonConfig.webSocketConstructor = ws;\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\n    \"DATABASE_URL must be set. Did you forget to provision a database?\",\n  );\n}\n\nexport const pool = new Pool({ connectionString: process.env.DATABASE_URL });\nexport const db = drizzle({ client: pool, schema });\n","size_bytes":483},"client/src/components/ui/command.tsx":{"content":"import * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","size_bytes":4885},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n          await import(\"@replit/vite-plugin-dev-banner\").then((m) =>\n            m.devBanner(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n  server: {\n    fs: {\n      strict: true,\n      deny: [\"**/.*\"],\n    },\n  },\n});\n","size_bytes":1080},"client/src/components/examples/SearchBar.tsx":{"content":"import { SearchBar } from '../SearchBar'\nimport { useState } from 'react'\n\nexport default function SearchBarExample() {\n  const [value, setValue] = useState('')\n  \n  return (\n    <div className=\"max-w-md\">\n      <SearchBar\n        value={value}\n        onChange={setValue}\n        placeholder=\"Search orders, patients, or ECPs...\"\n      />\n    </div>\n  )\n}\n","size_bytes":357},"client/src/components/ui/chart.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload.map((item, index) => {\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n            const indicatorColor = color || item.payload.fill || item.color\n\n            return (\n              <div\n                key={item.dataKey}\n                className={cn(\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                  indicator === \"dot\" && \"items-center\"\n                )}\n              >\n                {formatter && item?.value !== undefined && item.name ? (\n                  formatter(item.value, item.name, item, index, item.payload)\n                ) : (\n                  <>\n                    {itemConfig?.icon ? (\n                      <itemConfig.icon />\n                    ) : (\n                      !hideIndicator && (\n                        <div\n                          className={cn(\n                            \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                            {\n                              \"h-2.5 w-2.5\": indicator === \"dot\",\n                              \"w-1\": indicator === \"line\",\n                              \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                indicator === \"dashed\",\n                              \"my-0.5\": nestLabel && indicator === \"dashed\",\n                            }\n                          )}\n                          style={\n                            {\n                              \"--color-bg\": indicatorColor,\n                              \"--color-border\": indicatorColor,\n                            } as React.CSSProperties\n                          }\n                        />\n                      )\n                    )}\n                    <div\n                      className={cn(\n                        \"flex flex-1 justify-between leading-none\",\n                        nestLabel ? \"items-end\" : \"items-center\"\n                      )}\n                    >\n                      <div className=\"grid gap-1.5\">\n                        {nestLabel ? tooltipLabel : null}\n                        <span className=\"text-muted-foreground\">\n                          {itemConfig?.label || item.name}\n                        </span>\n                      </div>\n                      {item.value && (\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                          {item.value.toLocaleString()}\n                        </span>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload.map((item) => {\n          const key = `${nameKey || item.dataKey || \"value\"}`\n          const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n          return (\n            <div\n              key={item.value}\n              className={cn(\n                \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n              )}\n            >\n              {itemConfig?.icon && !hideIcon ? (\n                <itemConfig.icon />\n              ) : (\n                <div\n                  className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                  style={{\n                    backgroundColor: item.color,\n                  }}\n                />\n              )}\n              {itemConfig?.label}\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","size_bytes":10481},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3 min-w-10\",\n        sm: \"h-9 px-2.5 min-w-9\",\n        lg: \"h-11 px-5 min-w-11\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","size_bytes":1527},"client/src/pages/examples/SupplierDashboard.tsx":{"content":"import SupplierDashboard from '../SupplierDashboard'\n\nexport default function SupplierDashboardExample() {\n  return <SupplierDashboard />\n}\n","size_bytes":140},"client/src/components/ProgressStepper.tsx":{"content":"import { Check } from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\n\ninterface Step {\n  label: string;\n  description?: string;\n}\n\ninterface ProgressStepperProps {\n  steps: Step[];\n  currentStep: number;\n  className?: string;\n}\n\nexport function ProgressStepper({ steps, currentStep, className }: ProgressStepperProps) {\n  return (\n    <div className={cn(\"w-full\", className)}>\n      <div className=\"flex items-center justify-between\">\n        {steps.map((step, index) => {\n          const isCompleted = index < currentStep;\n          const isCurrent = index === currentStep;\n          const isLast = index === steps.length - 1;\n\n          return (\n            <div key={index} className=\"flex items-center flex-1\">\n              <div className=\"flex flex-col items-center\">\n                <div\n                  className={cn(\n                    \"w-10 h-10 rounded-full flex items-center justify-center border-2 transition-colors\",\n                    isCompleted && \"bg-primary border-primary text-primary-foreground\",\n                    isCurrent && \"border-primary text-primary bg-primary/10\",\n                    !isCompleted && !isCurrent && \"border-border text-muted-foreground\"\n                  )}\n                >\n                  {isCompleted ? (\n                    <Check className=\"h-5 w-5\" />\n                  ) : (\n                    <span className=\"font-semibold\">{index + 1}</span>\n                  )}\n                </div>\n                <div className=\"mt-2 text-center\">\n                  <p\n                    className={cn(\n                      \"text-sm font-medium\",\n                      (isCompleted || isCurrent) && \"text-foreground\",\n                      !isCompleted && !isCurrent && \"text-muted-foreground\"\n                    )}\n                  >\n                    {step.label}\n                  </p>\n                  {step.description && (\n                    <p className=\"text-xs text-muted-foreground mt-1\">\n                      {step.description}\n                    </p>\n                  )}\n                </div>\n              </div>\n              {!isLast && (\n                <div\n                  className={cn(\n                    \"flex-1 h-0.5 mx-4 transition-colors\",\n                    isCompleted ? \"bg-primary\" : \"bg-border\"\n                  )}\n                />\n              )}\n            </div>\n          );\n        })}\n      </div>\n    </div>\n  );\n}\n","size_bytes":2429},"server/vite.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\nexport async function setupVite(app: Express, server: Server) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server },\n    allowedHosts: true as const,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(import.meta.dirname, \"public\");\n\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","size_bytes":2263},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","size_bytes":1077},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","size_bytes":3895},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","size_bytes":261},"client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-4 w-full overflow-hidden rounded-full bg-secondary\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","size_bytes":791},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\" +\n  \" hover-elevate active-elevate-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"bg-primary text-primary-foreground border border-primary-border\",\n        destructive:\n          \"bg-destructive text-destructive-foreground border border-destructive-border\",\n        outline:\n          // Shows the background color of whatever card / sidebar / accent background it is inside of.\n          // Inherits the current text color.\n          \" border [border-color:var(--button-outline)]  shadow-xs active:shadow-none \",\n        secondary: \"border bg-secondary text-secondary-foreground border border-secondary-border \",\n        // Add a transparent border so that when someone toggles a border on later, it doesn't shift layout/size.\n        ghost: \"border border-transparent\",\n      },\n      // Heights are set as \"min\" heights, because sometimes Ai will place large amount of content\n      // inside buttons. With a min-height they will look appropriate with small amounts of content,\n      // but will expand to fit large amounts of content.\n      size: {\n        default: \"min-h-9 px-4 py-2\",\n        sm: \"min-h-8 rounded-md px-3 text-xs\",\n        lg: \"min-h-10 rounded-md px-8\",\n        icon: \"h-9 w-9\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  },\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  },\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","size_bytes":2359},"client/src/components/ui/dialog.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","size_bytes":3848},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","size_bytes":80},"server/storage.ts":{"content":"import { db } from \"../db\";\nimport { \n  users, \n  userRoles,\n  patients, \n  orders,\n  consultLogs,\n  purchaseOrders,\n  poLineItems,\n  technicalDocuments,\n  organizationSettings,\n  userPreferences,\n  eyeExaminations,\n  prescriptions,\n  products,\n  invoices,\n  invoiceLineItems,\n  type UpsertUser, \n  type User, \n  type UserWithRoles,\n  type InsertPatient, \n  type Patient, \n  type InsertOrder, \n  type Order, \n  type OrderWithDetails,\n  type InsertConsultLog,\n  type ConsultLog,\n  type InsertPurchaseOrder,\n  type PurchaseOrder,\n  type InsertPOLineItem,\n  type POLineItem,\n  type PurchaseOrderWithDetails,\n  type InsertTechnicalDocument,\n  type TechnicalDocument,\n  type TechnicalDocumentWithSupplier,\n  type UpdateOrganizationSettings,\n  type OrganizationSettings,\n  type UpdateUserPreferences,\n  type UserPreferences,\n  type InsertEyeExamination,\n  type EyeExamination,\n  type EyeExaminationWithDetails,\n  type InsertPrescription,\n  type Prescription,\n  type PrescriptionWithDetails,\n  type InsertProduct,\n  type Product,\n  type InsertInvoice,\n  type Invoice,\n  type InvoiceWithDetails,\n  type InsertInvoiceLineItem,\n  type InvoiceLineItem\n} from \"@shared/schema\";\nimport { eq, desc, and, or, like, sql } from \"drizzle-orm\";\n\nexport interface IStorage {\n  getUser(id: string): Promise<User | undefined>;\n  getUserWithRoles(id: string): Promise<UserWithRoles | undefined>;\n  getUserByEmail(email: string): Promise<User | undefined>;\n  upsertUser(user: UpsertUser): Promise<User>;\n  updateUser(id: string, updates: Partial<User>): Promise<User | undefined>;\n  getAllUsers(): Promise<User[]>;\n  getUserStats(): Promise<{ total: number; pending: number; active: number; suspended: number }>;\n  getSuppliers(): Promise<User[]>;\n  createSupplier(supplier: any): Promise<User>;\n  updateSupplier(id: string, updates: any): Promise<User | undefined>;\n  deleteSupplier(id: string): Promise<boolean>;\n  getUserAvailableRoles(userId: string): Promise<string[]>;\n  addUserRole(userId: string, role: string): Promise<void>;\n  removeUserRole(userId: string, role: string): Promise<void>;\n  switchUserRole(userId: string, newRole: string): Promise<User | undefined>;\n  \n  createPatient(patient: InsertPatient): Promise<Patient>;\n  getPatient(id: string): Promise<Patient | undefined>;\n  \n  createOrder(order: InsertOrder): Promise<Order>;\n  getOrder(id: string): Promise<OrderWithDetails | undefined>;\n  getOrders(filters?: {\n    ecpId?: string;\n    status?: string;\n    search?: string;\n    limit?: number;\n    offset?: number;\n  }): Promise<OrderWithDetails[]>;\n  updateOrderStatus(id: string, status: Order[\"status\"]): Promise<Order | undefined>;\n  markOrderAsShipped(id: string, trackingNumber: string): Promise<OrderWithDetails | undefined>;\n  getOrderStats(ecpId?: string): Promise<{\n    total: number;\n    pending: number;\n    inProduction: number;\n    completed: number;\n  }>;\n\n  createConsultLog(log: Omit<InsertConsultLog, 'ecpId'> & { ecpId: string }): Promise<ConsultLog>;\n  getConsultLogs(orderId: string): Promise<ConsultLog[]>;\n  getAllConsultLogs(ecpId?: string): Promise<ConsultLog[]>;\n  respondToConsultLog(id: string, response: string): Promise<ConsultLog | undefined>;\n\n  createPurchaseOrder(po: InsertPurchaseOrder & { lineItems: InsertPOLineItem[] }, createdById: string): Promise<PurchaseOrderWithDetails>;\n  getPurchaseOrder(id: string): Promise<PurchaseOrderWithDetails | undefined>;\n  getPurchaseOrderById(id: string): Promise<PurchaseOrderWithDetails | undefined>;\n  getPurchaseOrders(filters?: {\n    supplierId?: string;\n    status?: string;\n    limit?: number;\n    offset?: number;\n  }): Promise<PurchaseOrderWithDetails[]>;\n  updatePOStatus(id: string, status: PurchaseOrder[\"status\"], trackingNumber?: string, actualDeliveryDate?: Date): Promise<PurchaseOrder | undefined>;\n\n  createTechnicalDocument(doc: InsertTechnicalDocument, supplierId: string): Promise<TechnicalDocument>;\n  getTechnicalDocuments(supplierId?: string): Promise<TechnicalDocumentWithSupplier[]>;\n  deleteTechnicalDocument(id: string, supplierId: string): Promise<boolean>;\n\n  getOrganizationSettings(): Promise<OrganizationSettings | undefined>;\n  updateOrganizationSettings(settings: UpdateOrganizationSettings, updatedById: string): Promise<OrganizationSettings>;\n  \n  getUserPreferences(userId: string): Promise<UserPreferences | undefined>;\n  updateUserPreferences(userId: string, preferences: UpdateUserPreferences): Promise<UserPreferences>;\n\n  getPatients(ecpId: string): Promise<Patient[]>;\n  updatePatient(id: string, updates: Partial<Patient>): Promise<Patient | undefined>;\n\n  createEyeExamination(examination: InsertEyeExamination, ecpId: string): Promise<EyeExamination>;\n  getEyeExamination(id: string): Promise<EyeExaminationWithDetails | undefined>;\n  getEyeExaminations(ecpId: string): Promise<EyeExaminationWithDetails[]>;\n  getPatientExaminations(patientId: string): Promise<EyeExaminationWithDetails[]>;\n  updateEyeExamination(id: string, updates: Partial<EyeExamination>): Promise<EyeExamination | undefined>;\n  finalizeExamination(id: string, ecpId: string): Promise<EyeExamination | undefined>;\n\n  createPrescription(prescription: InsertPrescription, ecpId: string): Promise<Prescription>;\n  getPrescription(id: string): Promise<PrescriptionWithDetails | undefined>;\n  getPrescriptions(ecpId: string): Promise<PrescriptionWithDetails[]>;\n  signPrescription(id: string, ecpId: string, signature: string): Promise<Prescription | undefined>;\n\n  createProduct(product: InsertProduct, ecpId: string): Promise<Product>;\n  getProduct(id: string): Promise<Product | undefined>;\n  getProducts(ecpId: string): Promise<Product[]>;\n  updateProduct(id: string, updates: Partial<Product>): Promise<Product | undefined>;\n  deleteProduct(id: string): Promise<boolean>;\n\n  createInvoice(invoice: InsertInvoice & { lineItems: InsertInvoiceLineItem[] }, ecpId: string): Promise<InvoiceWithDetails>;\n  getInvoice(id: string): Promise<InvoiceWithDetails | undefined>;\n  getInvoices(ecpId: string): Promise<InvoiceWithDetails[]>;\n  updateInvoiceStatus(id: string, status: Invoice[\"status\"]): Promise<Invoice | undefined>;\n  recordPayment(id: string, amount: string): Promise<Invoice | undefined>;\n}\n\nexport class DbStorage implements IStorage {\n  async getUser(id: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.id, id));\n    return user;\n  }\n\n  async getUserByEmail(email: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.email, email));\n    return user;\n  }\n\n  async upsertUser(userData: UpsertUser): Promise<User> {\n    const [user] = await db\n      .insert(users)\n      .values(userData)\n      .onConflictDoUpdate({\n        target: users.id,\n        set: {\n          ...userData,\n          updatedAt: new Date(),\n        },\n      })\n      .returning();\n    return user;\n  }\n\n  async updateUser(id: string, updates: Partial<User>): Promise<User | undefined> {\n    const [user] = await db\n      .update(users)\n      .set({\n        ...updates,\n        updatedAt: new Date(),\n      })\n      .where(eq(users.id, id))\n      .returning();\n    return user;\n  }\n\n  async getAllUsers(): Promise<User[]> {\n    const allUsers = await db\n      .select()\n      .from(users)\n      .orderBy(desc(users.createdAt));\n    return allUsers;\n  }\n\n  async getUserStats(): Promise<{ total: number; pending: number; active: number; suspended: number }> {\n    const allUsers = await this.getAllUsers();\n    \n    const stats = {\n      total: allUsers.length,\n      pending: allUsers.filter(u => u.accountStatus === 'pending').length,\n      active: allUsers.filter(u => u.accountStatus === 'active').length,\n      suspended: allUsers.filter(u => u.accountStatus === 'suspended').length,\n    };\n    \n    return stats;\n  }\n\n  async getSuppliers(): Promise<User[]> {\n    const suppliers = await db\n      .select()\n      .from(users)\n      .where(eq(users.role, 'supplier'))\n      .orderBy(users.organizationName, users.lastName);\n    return suppliers;\n  }\n\n  async createSupplier(supplier: any): Promise<User> {\n    const [newSupplier] = await db\n      .insert(users)\n      .values({\n        ...supplier,\n        role: 'supplier',\n        createdAt: new Date(),\n        updatedAt: new Date(),\n      } as any)\n      .returning();\n    return newSupplier;\n  }\n\n  async updateSupplier(id: string, updates: any): Promise<User | undefined> {\n    const [updatedSupplier] = await db\n      .update(users)\n      .set({\n        ...updates,\n        updatedAt: new Date(),\n      })\n      .where(and(eq(users.id, id), eq(users.role, 'supplier')))\n      .returning();\n    return updatedSupplier;\n  }\n\n  async deleteSupplier(id: string): Promise<boolean> {\n    const result = await db\n      .delete(users)\n      .where(and(eq(users.id, id), eq(users.role, 'supplier')))\n      .returning();\n    return result.length > 0;\n  }\n\n  async getUserWithRoles(id: string): Promise<UserWithRoles | undefined> {\n    const user = await this.getUser(id);\n    if (!user) return undefined;\n\n    const roles = await this.getUserAvailableRoles(id);\n    return {\n      ...user,\n      availableRoles: roles\n    };\n  }\n\n  async getUserAvailableRoles(userId: string): Promise<string[]> {\n    const roles = await db\n      .select()\n      .from(userRoles)\n      .where(eq(userRoles.userId, userId));\n    \n    // Return unique roles, including the current active role if not already in the list\n    const user = await this.getUser(userId);\n    const roleSet = new Set(roles.map(r => r.role));\n    if (user?.role) {\n      roleSet.add(user.role);\n    }\n    \n    return Array.from(roleSet);\n  }\n\n  async addUserRole(userId: string, role: string): Promise<void> {\n    // Check if role already exists\n    const existing = await db\n      .select()\n      .from(userRoles)\n      .where(and(eq(userRoles.userId, userId), eq(userRoles.role, role as any)));\n    \n    if (existing.length === 0) {\n      await db.insert(userRoles).values({\n        userId,\n        role: role as any,\n      });\n    }\n  }\n\n  async removeUserRole(userId: string, role: string): Promise<void> {\n    await db\n      .delete(userRoles)\n      .where(and(eq(userRoles.userId, userId), eq(userRoles.role, role as any)));\n  }\n\n  async switchUserRole(userId: string, newRole: string): Promise<User | undefined> {\n    // Verify the user has access to this role\n    const availableRoles = await this.getUserAvailableRoles(userId);\n    \n    if (!availableRoles.includes(newRole)) {\n      throw new Error(`User does not have access to role: ${newRole}`);\n    }\n\n    // Update the user's active role\n    return await this.updateUser(userId, { role: newRole as any });\n  }\n\n  async createPatient(insertPatient: InsertPatient): Promise<Patient> {\n    const [patient] = await db.insert(patients).values(insertPatient).returning();\n    return patient;\n  }\n\n  async getPatient(id: string): Promise<Patient | undefined> {\n    const [patient] = await db.select().from(patients).where(eq(patients.id, id));\n    return patient;\n  }\n\n  async createOrder(insertOrder: InsertOrder): Promise<Order> {\n    const orderNumber = `ORD-${new Date().getFullYear()}-${Date.now().toString().slice(-6)}`;\n    \n    const [order] = await db.insert(orders).values({\n      ...insertOrder,\n      orderNumber,\n    } as any).returning();\n\n    return order;\n  }\n\n  async getOrder(id: string): Promise<OrderWithDetails | undefined> {\n    const result = await db\n      .select({\n        order: orders,\n        patient: patients,\n        ecp: {\n          id: users.id,\n          firstName: users.firstName,\n          lastName: users.lastName,\n          organizationName: users.organizationName,\n        },\n      })\n      .from(orders)\n      .innerJoin(patients, eq(orders.patientId, patients.id))\n      .innerJoin(users, eq(orders.ecpId, users.id))\n      .where(eq(orders.id, id))\n      .limit(1);\n\n    if (!result.length) return undefined;\n\n    return {\n      ...result[0].order,\n      patient: result[0].patient,\n      ecp: result[0].ecp,\n    };\n  }\n\n  async getOrders(filters: {\n    ecpId?: string;\n    status?: string;\n    search?: string;\n    limit?: number;\n    offset?: number;\n  } = {}): Promise<OrderWithDetails[]> {\n    const { ecpId, status, search, limit = 50, offset = 0 } = filters;\n\n    let conditions = [];\n    \n    if (ecpId) {\n      conditions.push(eq(orders.ecpId, ecpId));\n    }\n    \n    if (status && status !== \"all\") {\n      conditions.push(eq(orders.status, status as Order[\"status\"]));\n    }\n    \n    if (search) {\n      conditions.push(\n        or(\n          like(orders.orderNumber, `%${search}%`),\n          like(patients.name, `%${search}%`)\n        )\n      );\n    }\n\n    const whereClause = conditions.length > 0 ? and(...conditions) : undefined;\n\n    const results = await db\n      .select({\n        order: orders,\n        patient: patients,\n        ecp: {\n          id: users.id,\n          firstName: users.firstName,\n          lastName: users.lastName,\n          organizationName: users.organizationName,\n        },\n      })\n      .from(orders)\n      .innerJoin(patients, eq(orders.patientId, patients.id))\n      .innerJoin(users, eq(orders.ecpId, users.id))\n      .where(whereClause)\n      .orderBy(desc(orders.orderDate))\n      .limit(limit)\n      .offset(offset);\n\n    return results.map(r => ({\n      ...r.order,\n      patient: r.patient,\n      ecp: r.ecp,\n    }));\n  }\n\n  async updateOrderStatus(id: string, status: Order[\"status\"]): Promise<Order | undefined> {\n    const [order] = await db\n      .update(orders)\n      .set({ \n        status,\n        completedAt: status === \"completed\" ? new Date() : undefined,\n      })\n      .where(eq(orders.id, id))\n      .returning();\n    \n    return order;\n  }\n\n  async updateOrder(id: string, updates: Partial<Order>): Promise<Order | undefined> {\n    const [order] = await db\n      .update(orders)\n      .set(updates)\n      .where(eq(orders.id, id))\n      .returning();\n    \n    return order;\n  }\n\n  async markOrderAsShipped(id: string, trackingNumber: string): Promise<OrderWithDetails | undefined> {\n    const [order] = await db\n      .update(orders)\n      .set({ \n        status: \"shipped\",\n        trackingNumber,\n        shippedAt: new Date(),\n      })\n      .where(eq(orders.id, id))\n      .returning();\n    \n    if (!order) return undefined;\n\n    return await this.getOrder(id);\n  }\n\n  async getOrderStats(ecpId?: string): Promise<{\n    total: number;\n    pending: number;\n    inProduction: number;\n    completed: number;\n  }> {\n    const whereClause = ecpId ? eq(orders.ecpId, ecpId) : undefined;\n\n    const [stats] = await db\n      .select({\n        total: sql<number>`count(*)::int`,\n        pending: sql<number>`count(*) filter (where status = 'pending')::int`,\n        inProduction: sql<number>`count(*) filter (where status = 'in_production')::int`,\n        completed: sql<number>`count(*) filter (where status = 'completed')::int`,\n      })\n      .from(orders)\n      .where(whereClause);\n\n    return stats || { total: 0, pending: 0, inProduction: 0, completed: 0 };\n  }\n\n  async createConsultLog(insertLog: Omit<InsertConsultLog, 'ecpId'> & { ecpId: string }): Promise<ConsultLog> {\n    const [log] = await db.insert(consultLogs).values(insertLog as any).returning();\n    return log;\n  }\n\n  async getConsultLogs(orderId: string): Promise<ConsultLog[]> {\n    return await db\n      .select()\n      .from(consultLogs)\n      .where(eq(consultLogs.orderId, orderId))\n      .orderBy(desc(consultLogs.createdAt));\n  }\n\n  async getAllConsultLogs(ecpId?: string): Promise<ConsultLog[]> {\n    const query = db.select().from(consultLogs);\n    \n    if (ecpId) {\n      return await query\n        .where(eq(consultLogs.ecpId, ecpId))\n        .orderBy(desc(consultLogs.createdAt));\n    }\n    \n    return await query.orderBy(desc(consultLogs.createdAt));\n  }\n\n  async respondToConsultLog(id: string, response: string): Promise<ConsultLog | undefined> {\n    const [log] = await db\n      .update(consultLogs)\n      .set({ \n        labResponse: response,\n        status: \"resolved\",\n        respondedAt: new Date(),\n      })\n      .where(eq(consultLogs.id, id))\n      .returning();\n    \n    return log;\n  }\n\n  async createPurchaseOrder(poData: InsertPurchaseOrder & { lineItems: InsertPOLineItem[] }, createdById: string): Promise<PurchaseOrderWithDetails> {\n    const poNumber = `PO-${new Date().getFullYear()}-${Date.now().toString().slice(-6)}`;\n    \n    const { lineItems, ...poFields } = poData;\n\n    const [po] = await db.insert(purchaseOrders).values({\n      ...poFields,\n      poNumber,\n      createdById,\n    }).returning();\n\n    const insertedLineItems = await db.insert(poLineItems).values(\n      lineItems.map(item => ({\n        ...item,\n        purchaseOrderId: po.id,\n      }))\n    ).returning();\n\n    const supplier = await this.getUser(po.supplierId);\n    const createdBy = await this.getUser(createdById);\n\n    return {\n      ...po,\n      supplier: {\n        id: supplier?.id || po.supplierId,\n        organizationName: supplier?.organizationName || null,\n        email: supplier?.email || null,\n        accountNumber: supplier?.accountNumber || null,\n        contactEmail: supplier?.contactEmail || null,\n        contactPhone: supplier?.contactPhone || null,\n      },\n      createdBy: {\n        id: createdBy?.id || createdById,\n        firstName: createdBy?.firstName || null,\n        lastName: createdBy?.lastName || null,\n      },\n      lineItems: insertedLineItems,\n    };\n  }\n\n  async getPurchaseOrder(id: string): Promise<PurchaseOrderWithDetails | undefined> {\n    const [po] = await db\n      .select()\n      .from(purchaseOrders)\n      .where(eq(purchaseOrders.id, id));\n\n    if (!po) return undefined;\n\n    const items = await db\n      .select()\n      .from(poLineItems)\n      .where(eq(poLineItems.purchaseOrderId, id));\n\n    const supplier = await this.getUser(po.supplierId);\n    const createdBy = await this.getUser(po.createdById);\n\n    return {\n      ...po,\n      supplier: {\n        id: supplier?.id || po.supplierId,\n        organizationName: supplier?.organizationName || null,\n        email: supplier?.email || null,\n        accountNumber: supplier?.accountNumber || null,\n        contactEmail: supplier?.contactEmail || null,\n        contactPhone: supplier?.contactPhone || null,\n      },\n      createdBy: {\n        id: createdBy?.id || po.createdById,\n        firstName: createdBy?.firstName || null,\n        lastName: createdBy?.lastName || null,\n      },\n      lineItems: items,\n    };\n  }\n\n  async getPurchaseOrderById(id: string): Promise<PurchaseOrderWithDetails | undefined> {\n    return await this.getPurchaseOrder(id);\n  }\n\n  async getPurchaseOrders(filters: {\n    supplierId?: string;\n    status?: string;\n    limit?: number;\n    offset?: number;\n  } = {}): Promise<PurchaseOrderWithDetails[]> {\n    const { supplierId, status, limit = 50, offset = 0 } = filters;\n\n    let conditions = [];\n    \n    if (supplierId) {\n      conditions.push(eq(purchaseOrders.supplierId, supplierId));\n    }\n    \n    if (status && status !== \"all\") {\n      conditions.push(eq(purchaseOrders.status, status as PurchaseOrder[\"status\"]));\n    }\n\n    const whereClause = conditions.length > 0 ? and(...conditions) : undefined;\n\n    const pos = await db\n      .select()\n      .from(purchaseOrders)\n      .where(whereClause)\n      .orderBy(desc(purchaseOrders.createdAt))\n      .limit(limit)\n      .offset(offset);\n\n    const results: PurchaseOrderWithDetails[] = [];\n\n    for (const po of pos) {\n      const items = await db\n        .select()\n        .from(poLineItems)\n        .where(eq(poLineItems.purchaseOrderId, po.id));\n\n      const supplier = await this.getUser(po.supplierId);\n      const createdBy = await this.getUser(po.createdById);\n\n      results.push({\n        ...po,\n        supplier: {\n          id: supplier?.id || po.supplierId,\n          organizationName: supplier?.organizationName || null,\n          email: supplier?.email || null,\n          accountNumber: supplier?.accountNumber || null,\n          contactEmail: supplier?.contactEmail || null,\n          contactPhone: supplier?.contactPhone || null,\n        },\n        createdBy: {\n          id: createdBy?.id || po.createdById,\n          firstName: createdBy?.firstName || null,\n          lastName: createdBy?.lastName || null,\n        },\n        lineItems: items,\n      });\n    }\n\n    return results;\n  }\n\n  async updatePOStatus(id: string, status: PurchaseOrder[\"status\"], trackingNumber?: string, actualDeliveryDate?: Date): Promise<PurchaseOrder | undefined> {\n    const updateData: any = { \n      status,\n      updatedAt: new Date(),\n    };\n\n    if (trackingNumber) {\n      updateData.trackingNumber = trackingNumber;\n    }\n\n    if (actualDeliveryDate) {\n      updateData.actualDeliveryDate = actualDeliveryDate;\n    }\n\n    const [po] = await db\n      .update(purchaseOrders)\n      .set(updateData)\n      .where(eq(purchaseOrders.id, id))\n      .returning();\n    \n    return po;\n  }\n\n  async createTechnicalDocument(insertDoc: InsertTechnicalDocument, supplierId: string): Promise<TechnicalDocument> {\n    const [doc] = await db.insert(technicalDocuments).values({\n      ...insertDoc,\n      supplierId,\n    }).returning();\n    return doc;\n  }\n\n  async getTechnicalDocuments(supplierId?: string): Promise<TechnicalDocumentWithSupplier[]> {\n    const whereClause = supplierId ? eq(technicalDocuments.supplierId, supplierId) : undefined;\n\n    const results = await db\n      .select({\n        doc: technicalDocuments,\n        supplier: {\n          id: users.id,\n          organizationName: users.organizationName,\n        },\n      })\n      .from(technicalDocuments)\n      .innerJoin(users, eq(technicalDocuments.supplierId, users.id))\n      .where(whereClause)\n      .orderBy(desc(technicalDocuments.uploadedAt));\n\n    return results.map(r => ({\n      ...r.doc,\n      supplier: r.supplier,\n    }));\n  }\n\n  async deleteTechnicalDocument(id: string, supplierId: string): Promise<boolean> {\n    const result = await db\n      .delete(technicalDocuments)\n      .where(and(\n        eq(technicalDocuments.id, id),\n        eq(technicalDocuments.supplierId, supplierId)\n      ))\n      .returning();\n    \n    return result.length > 0;\n  }\n\n  async getOrganizationSettings(): Promise<OrganizationSettings | undefined> {\n    const [settings] = await db\n      .select()\n      .from(organizationSettings)\n      .limit(1);\n    \n    return settings;\n  }\n\n  async updateOrganizationSettings(settingsData: UpdateOrganizationSettings, updatedById: string): Promise<OrganizationSettings> {\n    const existing = await this.getOrganizationSettings();\n\n    if (existing) {\n      const [updated] = await db\n        .update(organizationSettings)\n        .set({\n          ...settingsData,\n          updatedAt: new Date(),\n          updatedById,\n        })\n        .where(eq(organizationSettings.id, existing.id))\n        .returning();\n      \n      return updated;\n    } else {\n      const [created] = await db\n        .insert(organizationSettings)\n        .values({\n          ...settingsData,\n          updatedById,\n        })\n        .returning();\n      \n      return created;\n    }\n  }\n\n  async getUserPreferences(userId: string): Promise<UserPreferences | undefined> {\n    const [prefs] = await db\n      .select()\n      .from(userPreferences)\n      .where(eq(userPreferences.userId, userId))\n      .limit(1);\n    \n    return prefs;\n  }\n\n  async updateUserPreferences(userId: string, preferencesData: UpdateUserPreferences): Promise<UserPreferences> {\n    const existing = await this.getUserPreferences(userId);\n\n    if (existing) {\n      const [updated] = await db\n        .update(userPreferences)\n        .set({\n          ...preferencesData,\n          updatedAt: new Date(),\n        })\n        .where(eq(userPreferences.userId, userId))\n        .returning();\n      \n      return updated;\n    } else {\n      const [created] = await db\n        .insert(userPreferences)\n        .values({\n          ...preferencesData,\n          userId,\n        })\n        .returning();\n      \n      return created;\n    }\n  }\n\n  async getPatients(ecpId: string): Promise<Patient[]> {\n    return await db\n      .select()\n      .from(patients)\n      .where(eq(patients.ecpId, ecpId))\n      .orderBy(desc(patients.createdAt));\n  }\n\n  async updatePatient(id: string, updates: Partial<Patient>): Promise<Patient | undefined> {\n    const [patient] = await db\n      .update(patients)\n      .set(updates)\n      .where(eq(patients.id, id))\n      .returning();\n    \n    return patient;\n  }\n\n  async createEyeExamination(insertExamination: InsertEyeExamination, ecpId: string): Promise<EyeExamination> {\n    const [examination] = await db.insert(eyeExaminations).values({\n      ...insertExamination,\n      ecpId,\n    } as any).returning();\n    return examination;\n  }\n\n  async getEyeExamination(id: string): Promise<EyeExaminationWithDetails | undefined> {\n    const result = await db\n      .select({\n        examination: eyeExaminations,\n        patient: patients,\n        ecp: {\n          id: users.id,\n          firstName: users.firstName,\n          lastName: users.lastName,\n        },\n      })\n      .from(eyeExaminations)\n      .innerJoin(patients, eq(eyeExaminations.patientId, patients.id))\n      .innerJoin(users, eq(eyeExaminations.ecpId, users.id))\n      .where(eq(eyeExaminations.id, id))\n      .limit(1);\n\n    if (!result.length) return undefined;\n\n    return {\n      ...result[0].examination,\n      patient: result[0].patient,\n      ecp: result[0].ecp,\n    };\n  }\n\n  async getEyeExaminations(ecpId: string): Promise<EyeExaminationWithDetails[]> {\n    const results = await db\n      .select({\n        examination: eyeExaminations,\n        patient: patients,\n        ecp: {\n          id: users.id,\n          firstName: users.firstName,\n          lastName: users.lastName,\n        },\n      })\n      .from(eyeExaminations)\n      .innerJoin(patients, eq(eyeExaminations.patientId, patients.id))\n      .innerJoin(users, eq(eyeExaminations.ecpId, users.id))\n      .where(eq(eyeExaminations.ecpId, ecpId))\n      .orderBy(desc(eyeExaminations.examinationDate));\n\n    return results.map(r => ({\n      ...r.examination,\n      patient: r.patient,\n      ecp: r.ecp,\n    }));\n  }\n\n  async getPatientExaminations(patientId: string): Promise<EyeExaminationWithDetails[]> {\n    const results = await db\n      .select({\n        examination: eyeExaminations,\n        patient: patients,\n        ecp: {\n          id: users.id,\n          firstName: users.firstName,\n          lastName: users.lastName,\n        },\n      })\n      .from(eyeExaminations)\n      .innerJoin(patients, eq(eyeExaminations.patientId, patients.id))\n      .innerJoin(users, eq(eyeExaminations.ecpId, users.id))\n      .where(eq(eyeExaminations.patientId, patientId))\n      .orderBy(desc(eyeExaminations.examinationDate));\n\n    return results.map(r => ({\n      ...r.examination,\n      patient: r.patient,\n      ecp: r.ecp,\n    }));\n  }\n\n  async updateEyeExamination(id: string, updates: Partial<EyeExamination>): Promise<EyeExamination | undefined> {\n    const [examination] = await db\n      .update(eyeExaminations)\n      .set({\n        ...updates,\n        updatedAt: new Date(),\n      })\n      .where(eq(eyeExaminations.id, id))\n      .returning();\n    \n    return examination;\n  }\n\n  async finalizeExamination(id: string, ecpId: string): Promise<EyeExamination | undefined> {\n    const [examination] = await db\n      .update(eyeExaminations)\n      .set({\n        status: 'finalized',\n        updatedAt: new Date(),\n      })\n      .where(and(eq(eyeExaminations.id, id), eq(eyeExaminations.ecpId, ecpId)))\n      .returning();\n    \n    return examination;\n  }\n\n  async createPrescription(insertPrescription: InsertPrescription, ecpId: string): Promise<Prescription> {\n    const [prescription] = await db.insert(prescriptions).values({\n      ...insertPrescription,\n      ecpId,\n    } as any).returning();\n    return prescription;\n  }\n\n  async getPrescription(id: string): Promise<PrescriptionWithDetails | undefined> {\n    const result = await db\n      .select({\n        prescription: prescriptions,\n        patient: patients,\n        ecp: {\n          id: users.id,\n          firstName: users.firstName,\n          lastName: users.lastName,\n        },\n        examination: eyeExaminations,\n      })\n      .from(prescriptions)\n      .innerJoin(patients, eq(prescriptions.patientId, patients.id))\n      .innerJoin(users, eq(prescriptions.ecpId, users.id))\n      .leftJoin(eyeExaminations, eq(prescriptions.examinationId, eyeExaminations.id))\n      .where(eq(prescriptions.id, id))\n      .limit(1);\n\n    if (!result.length) return undefined;\n\n    return {\n      ...result[0].prescription,\n      patient: result[0].patient,\n      ecp: result[0].ecp,\n      examination: result[0].examination || undefined,\n    };\n  }\n\n  async getPrescriptions(ecpId: string): Promise<PrescriptionWithDetails[]> {\n    const results = await db\n      .select({\n        prescription: prescriptions,\n        patient: patients,\n        ecp: {\n          id: users.id,\n          firstName: users.firstName,\n          lastName: users.lastName,\n        },\n        examination: eyeExaminations,\n      })\n      .from(prescriptions)\n      .innerJoin(patients, eq(prescriptions.patientId, patients.id))\n      .innerJoin(users, eq(prescriptions.ecpId, users.id))\n      .leftJoin(eyeExaminations, eq(prescriptions.examinationId, eyeExaminations.id))\n      .where(eq(prescriptions.ecpId, ecpId))\n      .orderBy(desc(prescriptions.issueDate));\n\n    return results.map(r => ({\n      ...r.prescription,\n      patient: r.patient,\n      ecp: r.ecp,\n      examination: r.examination || undefined,\n    }));\n  }\n\n  async signPrescription(id: string, ecpId: string, signature: string): Promise<Prescription | undefined> {\n    const [prescription] = await db\n      .update(prescriptions)\n      .set({\n        isSigned: true,\n        signedByEcpId: ecpId,\n        digitalSignature: signature,\n        signedAt: new Date(),\n      })\n      .where(eq(prescriptions.id, id))\n      .returning();\n    \n    return prescription;\n  }\n\n  async createProduct(insertProduct: InsertProduct, ecpId: string): Promise<Product> {\n    const [product] = await db.insert(products).values({\n      ...insertProduct,\n      ecpId,\n    }).returning();\n    return product;\n  }\n\n  async getProduct(id: string): Promise<Product | undefined> {\n    const [product] = await db\n      .select()\n      .from(products)\n      .where(eq(products.id, id))\n      .limit(1);\n    \n    return product;\n  }\n\n  async getProducts(ecpId: string): Promise<Product[]> {\n    return await db\n      .select()\n      .from(products)\n      .where(eq(products.ecpId, ecpId))\n      .orderBy(products.productType, products.brand, products.model);\n  }\n\n  async updateProduct(id: string, updates: Partial<Product>): Promise<Product | undefined> {\n    const [product] = await db\n      .update(products)\n      .set({\n        ...updates,\n        updatedAt: new Date(),\n      })\n      .where(eq(products.id, id))\n      .returning();\n    \n    return product;\n  }\n\n  async deleteProduct(id: string): Promise<boolean> {\n    const result = await db\n      .delete(products)\n      .where(eq(products.id, id))\n      .returning();\n    \n    return result.length > 0;\n  }\n\n  async createInvoice(invoiceData: InsertInvoice & { lineItems: InsertInvoiceLineItem[] }, ecpId: string): Promise<InvoiceWithDetails> {\n    const invoiceNumber = `INV-${new Date().getFullYear()}-${Date.now().toString().slice(-6)}`;\n    \n    const { lineItems, ...invoiceFields } = invoiceData;\n\n    const [invoice] = await db.insert(invoices).values({\n      ...invoiceFields,\n      invoiceNumber,\n      ecpId,\n    }).returning();\n\n    const insertedLineItems = await db.insert(invoiceLineItems).values(\n      lineItems.map(item => ({\n        ...item,\n        invoiceId: invoice.id,\n      }))\n    ).returning();\n\n    let patient: Patient | undefined = undefined;\n    if (invoice.patientId) {\n      patient = await this.getPatient(invoice.patientId);\n    }\n\n    const ecp = await this.getUser(ecpId);\n\n    return {\n      ...invoice,\n      patient: patient,\n      ecp: {\n        id: ecp?.id || ecpId,\n        firstName: ecp?.firstName || null,\n        lastName: ecp?.lastName || null,\n      },\n      lineItems: insertedLineItems,\n    };\n  }\n\n  async getInvoice(id: string): Promise<InvoiceWithDetails | undefined> {\n    const [invoice] = await db\n      .select()\n      .from(invoices)\n      .where(eq(invoices.id, id));\n\n    if (!invoice) return undefined;\n\n    const items = await db\n      .select()\n      .from(invoiceLineItems)\n      .where(eq(invoiceLineItems.invoiceId, id));\n\n    let patient: Patient | undefined = undefined;\n    if (invoice.patientId) {\n      patient = await this.getPatient(invoice.patientId);\n    }\n\n    const ecp = await this.getUser(invoice.ecpId);\n\n    return {\n      ...invoice,\n      patient: patient,\n      ecp: {\n        id: ecp?.id || invoice.ecpId,\n        firstName: ecp?.firstName || null,\n        lastName: ecp?.lastName || null,\n      },\n      lineItems: items,\n    };\n  }\n\n  async getInvoices(ecpId: string): Promise<InvoiceWithDetails[]> {\n    const invoicesList = await db\n      .select()\n      .from(invoices)\n      .where(eq(invoices.ecpId, ecpId))\n      .orderBy(desc(invoices.invoiceDate));\n\n    const invoicesWithDetails = await Promise.all(\n      invoicesList.map(async (invoice) => {\n        const items = await db\n          .select()\n          .from(invoiceLineItems)\n          .where(eq(invoiceLineItems.invoiceId, invoice.id));\n\n        let patient: Patient | undefined = undefined;\n        if (invoice.patientId) {\n          patient = await this.getPatient(invoice.patientId);\n        }\n\n        const ecp = await this.getUser(ecpId);\n\n        return {\n          ...invoice,\n          patient: patient,\n          ecp: {\n            id: ecp?.id || ecpId,\n            firstName: ecp?.firstName || null,\n            lastName: ecp?.lastName || null,\n          },\n          lineItems: items,\n        };\n      })\n    );\n\n    return invoicesWithDetails;\n  }\n\n  async updateInvoiceStatus(id: string, status: Invoice[\"status\"]): Promise<Invoice | undefined> {\n    const [invoice] = await db\n      .update(invoices)\n      .set({\n        status,\n        updatedAt: new Date(),\n      })\n      .where(eq(invoices.id, id))\n      .returning();\n    \n    return invoice;\n  }\n\n  async recordPayment(id: string, amount: string): Promise<Invoice | undefined> {\n    const invoice = await this.getInvoice(id);\n    if (!invoice) return undefined;\n\n    const currentPaid = parseFloat(invoice.amountPaid);\n    const paymentAmount = parseFloat(amount);\n    const newAmountPaid = (currentPaid + paymentAmount).toFixed(2);\n    const total = parseFloat(invoice.totalAmount);\n\n    const newStatus = parseFloat(newAmountPaid) >= total ? 'paid' : 'draft';\n\n    const [updated] = await db\n      .update(invoices)\n      .set({\n        amountPaid: newAmountPaid,\n        status: newStatus as Invoice[\"status\"],\n        updatedAt: new Date(),\n      })\n      .where(eq(invoices.id, id))\n      .returning();\n    \n    return updated;\n  }\n}\n\nexport const storage = new DbStorage();\n","size_bytes":35070},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","size_bytes":140},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-2.5 w-2.5 fill-current text-current\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","size_bytes":1467},"client/src/components/ui/calendar.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        nav_button: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\n        ),\n        nav_button_previous: \"absolute left-1\",\n        nav_button_next: \"absolute right-1\",\n        table: \"w-full border-collapse space-y-1\",\n        head_row: \"flex\",\n        head_cell:\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\n        row: \"flex w-full mt-2\",\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        day_range_end: \"day-range-end\",\n        day_selected:\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        day_today: \"bg-accent text-accent-foreground\",\n        day_outside:\n          \"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ className, ...props }) => (\n          <ChevronLeft className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n        IconRight: ({ className, ...props }) => (\n          <ChevronRight className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }\n","size_bytes":2695},"client/src/lib/authUtils.ts":{"content":"export function isUnauthorizedError(error: Error): boolean {\n  return /^401: .*Unauthorized/.test(error.message);\n}\n\nexport function getUserDisplayName(user: { firstName: string | null; lastName: string | null; email: string | null }): string {\n  if (user.firstName && user.lastName) {\n    return `${user.firstName} ${user.lastName}`;\n  }\n  if (user.firstName) return user.firstName;\n  if (user.lastName) return user.lastName;\n  return user.email || \"User\";\n}\n\nexport function getUserInitials(user: { firstName: string | null; lastName: string | null; email: string | null }): string {\n  if (user.firstName && user.lastName) {\n    return `${user.firstName[0]}${user.lastName[0]}`.toUpperCase();\n  }\n  if (user.firstName) return user.firstName.slice(0, 2).toUpperCase();\n  if (user.email) return user.email.slice(0, 2).toUpperCase();\n  return \"U\";\n}\n","size_bytes":849},"server/routes.ts":{"content":"import type { Express } from \"express\";\nimport { createServer, type Server } from \"http\";\nimport { storage } from \"./storage\";\nimport { setupAuth, isAuthenticated } from \"./replitAuth\";\nimport { hashPassword } from \"./localAuth\";\nimport passport from \"passport\";\nimport { \n  insertOrderSchema, \n  updateOrderStatusSchema,\n  insertConsultLogSchema,\n  insertPurchaseOrderSchema,\n  insertPOLineItemSchema,\n  insertTechnicalDocumentSchema,\n  updatePOStatusSchema,\n  insertSupplierSchema,\n  updateSupplierSchema,\n  updateOrganizationSettingsSchema,\n  updateUserPreferencesSchema,\n  insertEyeExaminationSchema,\n  insertPrescriptionSchema,\n  insertProductSchema,\n  insertInvoiceSchema,\n  insertInvoiceLineItemSchema,\n  insertPatientSchema\n} from \"@shared/schema\";\nimport { fromZodError } from \"zod-validation-error\";\nimport { generatePurchaseOrderPDF } from \"./pdfService\";\nimport { sendPurchaseOrderEmail, sendShipmentNotificationEmail } from \"./emailService\";\nimport { z } from \"zod\";\nimport { parseOMAFile, isValidOMAFile } from \"@shared/omaParser\";\n\nexport async function registerRoutes(app: Express): Promise<Server> {\n  // Health check endpoint for deployment monitoring\n  app.get('/health', (_req, res) => {\n    res.status(200).json({ \n      status: 'healthy',\n      timestamp: new Date().toISOString(),\n      environment: process.env.NODE_ENV || 'development'\n    });\n  });\n\n  await setupAuth(app);\n\n  // Auth routes\n  app.get('/api/auth/user', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUserWithRoles(userId);\n      res.json(user);\n    } catch (error) {\n      console.error(\"Error fetching user:\", error);\n      res.status(500).json({ message: \"Failed to fetch user\" });\n    }\n  });\n\n  // Bootstrap endpoint - returns user and role-based redirect path\n  app.get('/api/auth/bootstrap', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUserWithRoles(userId);\n      \n      if (!user) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n\n      // Check if user needs to complete signup\n      if (!user.role) {\n        return res.json({\n          user,\n          redirectPath: '/signup',\n          requiresSetup: true\n        });\n      }\n\n      // Check account status\n      if (user.accountStatus === 'pending') {\n        return res.json({\n          user,\n          redirectPath: '/pending-approval',\n          isPending: true\n        });\n      }\n\n      if (user.accountStatus === 'suspended') {\n        return res.json({\n          user,\n          redirectPath: '/account-suspended',\n          isSuspended: true,\n          suspensionReason: user.statusReason\n        });\n      }\n\n      // Determine redirect path based on user role\n      let redirectPath = '/';\n      switch (user.role) {\n        case 'ecp':\n          redirectPath = '/ecp/dashboard';\n          break;\n        case 'lab_tech':\n        case 'engineer':\n          redirectPath = '/lab/dashboard';\n          break;\n        case 'supplier':\n          redirectPath = '/supplier/dashboard';\n          break;\n        case 'admin':\n          redirectPath = '/admin/dashboard';\n          break;\n        default:\n          redirectPath = '/';\n      }\n\n      res.json({\n        user,\n        redirectPath\n      });\n    } catch (error) {\n      console.error(\"Error in bootstrap:\", error);\n      res.status(500).json({ message: \"Failed to bootstrap\" });\n    }\n  });\n\n  // Complete signup endpoint\n  app.post('/api/auth/complete-signup', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n\n      // Check if user already has a role\n      if (user.role) {\n        return res.status(400).json({ message: \"User already has a role assigned\" });\n      }\n\n      const { role, organizationName, adminSetupKey } = req.body;\n      \n      if (!role || !['ecp', 'lab_tech', 'engineer', 'supplier', 'admin'].includes(role)) {\n        return res.status(400).json({ message: \"Valid role is required\" });\n      }\n\n      // Handle admin signup with key verification\n      if (role === 'admin') {\n        const expectedKey = process.env.ADMIN_SETUP_KEY;\n        \n        if (!expectedKey) {\n          return res.status(500).json({ message: \"Admin setup is not configured on this system\" });\n        }\n        \n        if (!adminSetupKey || adminSetupKey !== expectedKey) {\n          return res.status(403).json({ message: \"Invalid admin setup key\" });\n        }\n\n        // Admin accounts are auto-approved\n        const updatedUser = await storage.updateUser(userId, {\n          role: 'admin',\n          organizationName: organizationName || null,\n          accountStatus: 'active'\n        });\n\n        // Initialize user roles\n        await storage.addUserRole(userId, 'admin');\n\n        return res.json(updatedUser);\n      }\n\n      // Update user with role and organization, set status to pending\n      const updatedUser = await storage.updateUser(userId, {\n        role,\n        organizationName: organizationName || null,\n        accountStatus: 'pending'\n      });\n\n      // Initialize user roles\n      await storage.addUserRole(userId, role);\n\n      res.json(updatedUser);\n    } catch (error) {\n      console.error(\"Error completing signup:\", error);\n      res.status(500).json({ message: \"Failed to complete signup\" });\n    }\n  });\n\n  // Get user's available roles\n  app.get('/api/auth/available-roles', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const roles = await storage.getUserAvailableRoles(userId);\n      res.json({ roles });\n    } catch (error) {\n      console.error(\"Error fetching available roles:\", error);\n      res.status(500).json({ message: \"Failed to fetch available roles\" });\n    }\n  });\n\n  // Add a role to user\n  app.post('/api/auth/add-role', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { role } = req.body;\n      \n      const user = await storage.getUser(userId);\n      \n      if (!user) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n\n      // Security check: only active users can add roles\n      if (user.accountStatus !== 'active') {\n        return res.status(403).json({ message: \"Only active accounts can add additional roles\" });\n      }\n\n      if (!role || !['ecp', 'lab_tech', 'engineer', 'supplier', 'admin'].includes(role)) {\n        return res.status(400).json({ message: \"Valid role is required\" });\n      }\n\n      // Only allow adding lab_tech/engineer or ecp roles\n      if (!['ecp', 'lab_tech', 'engineer'].includes(role)) {\n        return res.status(403).json({ message: \"Cannot add this role type\" });\n      }\n\n      // Check if user already has this role\n      const existingRoles = await storage.getUserAvailableRoles(userId);\n      if (existingRoles.includes(role)) {\n        return res.status(400).json({ message: \"Role already assigned to this user\" });\n      }\n\n      await storage.addUserRole(userId, role);\n      const updatedUser = await storage.getUserWithRoles(userId);\n      res.json(updatedUser);\n    } catch (error) {\n      console.error(\"Error adding role:\", error);\n      res.status(500).json({ message: \"Failed to add role\" });\n    }\n  });\n\n  // Switch active role\n  app.post('/api/auth/switch-role', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { role } = req.body;\n\n      if (!role || !['ecp', 'lab_tech', 'engineer', 'supplier', 'admin'].includes(role)) {\n        return res.status(400).json({ message: \"Valid role is required\" });\n      }\n\n      const updatedUser = await storage.switchUserRole(userId, role);\n      \n      if (!updatedUser) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n\n      res.json(updatedUser);\n    } catch (error) {\n      console.error(\"Error switching role:\", error);\n      if (error instanceof Error && error.message.includes(\"does not have access\")) {\n        res.status(403).json({ message: error.message });\n      } else {\n        res.status(500).json({ message: \"Failed to switch role\" });\n      }\n    }\n  });\n\n  // Email/Password Signup\n  app.post('/api/auth/signup-email', async (req, res) => {\n    try {\n      const { email, password, firstName, lastName, role, organizationName, adminSetupKey } = req.body;\n\n      // Validation\n      if (!email || !password || !firstName || !lastName || !role) {\n        return res.status(400).json({ message: \"Email, password, first name, last name, and role are required\" });\n      }\n\n      if (!['ecp', 'lab_tech', 'engineer', 'supplier', 'admin'].includes(role)) {\n        return res.status(400).json({ message: \"Invalid role\" });\n      }\n\n      if (password.length < 8) {\n        return res.status(400).json({ message: \"Password must be at least 8 characters long\" });\n      }\n\n      // Check if email already exists\n      const existingUser = await storage.getUserByEmail(email);\n      if (existingUser) {\n        return res.status(400).json({ message: \"Email already registered\" });\n      }\n\n      // Handle admin signup with key verification\n      let accountStatus: 'pending' | 'active' = 'pending';\n      if (role === 'admin') {\n        const expectedKey = process.env.ADMIN_SETUP_KEY;\n        \n        if (!expectedKey) {\n          return res.status(500).json({ message: \"Admin setup is not configured on this system\" });\n        }\n        \n        if (!adminSetupKey || adminSetupKey !== expectedKey) {\n          return res.status(403).json({ message: \"Invalid admin setup key\" });\n        }\n\n        // Admin accounts are auto-approved\n        accountStatus = 'active';\n      }\n\n      // Hash password\n      const hashedPassword = await hashPassword(password);\n\n      // Create user\n      const newUser = await storage.upsertUser({\n        email,\n        password: hashedPassword,\n        firstName,\n        lastName,\n        role,\n        organizationName: organizationName || null,\n        accountStatus,\n      } as any);\n\n      // Create session\n      req.login({\n        claims: {\n          sub: newUser.id,\n          email: newUser.email,\n          first_name: newUser.firstName,\n          last_name: newUser.lastName,\n          profile_image_url: newUser.profileImageUrl,\n        },\n        local: true,\n      }, (err) => {\n        if (err) {\n          console.error(\"Session creation error:\", err);\n          return res.status(500).json({ message: \"Failed to create session\" });\n        }\n        \n        res.status(201).json({\n          message: \"Account created successfully\",\n          user: {\n            id: newUser.id,\n            email: newUser.email,\n            firstName: newUser.firstName,\n            lastName: newUser.lastName,\n            role: newUser.role,\n            accountStatus: newUser.accountStatus,\n          }\n        });\n      });\n    } catch (error) {\n      console.error(\"Email signup error:\", error);\n      res.status(500).json({ message: \"Failed to create account\" });\n    }\n  });\n\n  // Email/Password Login\n  app.post('/api/auth/login-email', (req, res, next) => {\n    passport.authenticate('local', (err: any, user: any, info: any) => {\n      if (err) {\n        console.error(\"Login error:\", err);\n        return res.status(500).json({ message: \"Internal server error\" });\n      }\n      \n      if (!user) {\n        return res.status(401).json({ message: info?.message || \"Invalid credentials\" });\n      }\n\n      req.login(user, (loginErr) => {\n        if (loginErr) {\n          console.error(\"Session error:\", loginErr);\n          return res.status(500).json({ message: \"Failed to create session\" });\n        }\n\n        // Fetch full user from database\n        storage.getUser(user.claims.sub).then((dbUser) => {\n          if (!dbUser) {\n            return res.status(404).json({ message: \"User not found\" });\n          }\n\n          res.json({\n            message: \"Login successful\",\n            user: {\n              id: dbUser.id,\n              email: dbUser.email,\n              firstName: dbUser.firstName,\n              lastName: dbUser.lastName,\n              role: dbUser.role,\n              accountStatus: dbUser.accountStatus,\n            }\n          });\n        }).catch((dbErr) => {\n          console.error(\"Database error:\", dbErr);\n          res.status(500).json({ message: \"Failed to fetch user data\" });\n        });\n      });\n    })(req, res, next);\n  });\n\n  // Logout (works for both Replit and local auth)\n  app.post('/api/auth/logout-local', (req, res) => {\n    req.logout((err) => {\n      if (err) {\n        console.error(\"Logout error:\", err);\n        return res.status(500).json({ message: \"Failed to logout\" });\n      }\n      res.json({ message: \"Logged out successfully\" });\n    });\n  });\n\n  // Order routes\n  app.post('/api/orders', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'ecp') {\n        return res.status(403).json({ message: \"Only ECPs can create orders\" });\n      }\n\n      const validation = insertOrderSchema.safeParse(req.body);\n      if (!validation.success) {\n        const validationError = fromZodError(validation.error);\n        return res.status(400).json({ message: validationError.message, errors: validation.error.issues });\n      }\n\n      // Create patient record\n      const { patientName, patientDOB, omaFileContent, omaFilename, ...orderData } = validation.data as any;\n      \n      const patient = await storage.createPatient({\n        name: patientName,\n        dateOfBirth: patientDOB || null,\n        ecpId: userId,\n      });\n\n      // Parse OMA file if provided\n      let omaParsedData = null;\n      if (omaFileContent && isValidOMAFile(omaFileContent)) {\n        omaParsedData = parseOMAFile(omaFileContent);\n      }\n\n      // Create order with patient ID and ECP ID\n      const order = await storage.createOrder({\n        ...orderData,\n        patientId: patient.id,\n        ecpId: userId,\n        omaFileContent: omaFileContent || null,\n        omaFilename: omaFilename || null,\n        omaParsedData: omaParsedData as any,\n      } as any);\n\n      res.status(201).json(order);\n    } catch (error) {\n      console.error(\"Error creating order:\", error);\n      res.status(500).json({ message: \"Failed to create order\" });\n    }\n  });\n\n  app.get('/api/orders', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n\n      // Only ECPs, lab techs, and engineers can access orders\n      if (user.role !== 'ecp' && user.role !== 'lab_tech' && user.role !== 'engineer') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const { status, search, limit, offset } = req.query;\n      \n      const filters: any = {\n        status: status as string,\n        search: search as string,\n        limit: limit ? parseInt(limit as string) : undefined,\n        offset: offset ? parseInt(offset as string) : undefined,\n      };\n\n      // ECPs can only see their own orders\n      if (user.role === 'ecp') {\n        filters.ecpId = userId;\n      }\n\n      const orders = await storage.getOrders(filters);\n      res.json(orders);\n    } catch (error) {\n      console.error(\"Error fetching orders:\", error);\n      res.status(500).json({ message: \"Failed to fetch orders\" });\n    }\n  });\n\n  app.get('/api/orders/:id', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n\n      // Only ECPs, lab techs, and engineers can access orders\n      if (user.role !== 'ecp' && user.role !== 'lab_tech' && user.role !== 'engineer') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const order = await storage.getOrder(req.params.id);\n      \n      if (!order) {\n        return res.status(404).json({ message: \"Order not found\" });\n      }\n      \n      // ECPs can only see their own orders\n      if (user.role === 'ecp' && order.ecpId !== userId) {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      res.json(order);\n    } catch (error) {\n      console.error(\"Error fetching order:\", error);\n      res.status(500).json({ message: \"Failed to fetch order\" });\n    }\n  });\n\n  // OMA file upload endpoint\n  app.patch('/api/orders/:id/oma', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n\n      // Only ECPs, lab techs, and engineers can upload OMA files\n      if (user.role !== 'ecp' && user.role !== 'lab_tech' && user.role !== 'engineer') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const order = await storage.getOrder(req.params.id);\n      \n      if (!order) {\n        return res.status(404).json({ message: \"Order not found\" });\n      }\n      \n      // ECPs can only upload to their own orders\n      if (user.role === 'ecp' && order.ecpId !== userId) {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const { fileContent, filename } = req.body;\n      \n      if (!fileContent || !filename) {\n        return res.status(400).json({ message: \"File content and filename are required\" });\n      }\n\n      // Validate OMA file\n      if (!isValidOMAFile(fileContent)) {\n        return res.status(400).json({ message: \"Invalid OMA file format\" });\n      }\n\n      // Parse OMA file\n      const parsedData = parseOMAFile(fileContent);\n\n      // Update order with OMA file data\n      const updatedOrder = await storage.updateOrder(req.params.id, {\n        omaFileContent: fileContent,\n        omaFilename: filename,\n        omaParsedData: parsedData as any,\n      });\n\n      if (!updatedOrder) {\n        return res.status(404).json({ message: \"Order not found\" });\n      }\n\n      res.json(updatedOrder);\n    } catch (error) {\n      console.error(\"Error uploading OMA file:\", error);\n      res.status(500).json({ message: \"Failed to upload OMA file\" });\n    }\n  });\n\n  // Get OMA file endpoint\n  app.get('/api/orders/:id/oma', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n\n      // Only ECPs, lab techs, and engineers can access OMA files\n      if (user.role !== 'ecp' && user.role !== 'lab_tech' && user.role !== 'engineer') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const order = await storage.getOrder(req.params.id);\n      \n      if (!order) {\n        return res.status(404).json({ message: \"Order not found\" });\n      }\n      \n      // ECPs can only access their own orders\n      if (user.role === 'ecp' && order.ecpId !== userId) {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      if (!order.omaFileContent) {\n        return res.status(404).json({ message: \"No OMA file attached to this order\" });\n      }\n\n      // Return OMA file data\n      res.json({\n        filename: order.omaFilename,\n        content: order.omaFileContent,\n        parsedData: order.omaParsedData,\n      });\n    } catch (error) {\n      console.error(\"Error fetching OMA file:\", error);\n      res.status(500).json({ message: \"Failed to fetch OMA file\" });\n    }\n  });\n\n  // Delete OMA file endpoint\n  app.delete('/api/orders/:id/oma', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n\n      // Only ECPs, lab techs, and engineers can delete OMA files\n      if (user.role !== 'ecp' && user.role !== 'lab_tech' && user.role !== 'engineer') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const order = await storage.getOrder(req.params.id);\n      \n      if (!order) {\n        return res.status(404).json({ message: \"Order not found\" });\n      }\n      \n      // ECPs can only delete from their own orders\n      if (user.role === 'ecp' && order.ecpId !== userId) {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      // Remove OMA file data\n      const updatedOrder = await storage.updateOrder(req.params.id, {\n        omaFileContent: null,\n        omaFilename: null,\n        omaParsedData: null,\n      });\n\n      if (!updatedOrder) {\n        return res.status(404).json({ message: \"Order not found\" });\n      }\n\n      res.json({ message: \"OMA file deleted successfully\" });\n    } catch (error) {\n      console.error(\"Error deleting OMA file:\", error);\n      res.status(500).json({ message: \"Failed to delete OMA file\" });\n    }\n  });\n\n  app.patch('/api/orders/:id/status', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n\n      // Suppliers don't have access to order data in Phase 1\n      if (user.role === 'supplier') {\n        return res.status(403).json({ message: \"Access denied. Purchase order functionality coming in Phase 2.\" });\n      }\n      \n      // Only lab techs and engineers can update order status\n      if (user.role !== 'lab_tech' && user.role !== 'engineer') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const validation = updateOrderStatusSchema.safeParse(req.body);\n      if (!validation.success) {\n        const validationError = fromZodError(validation.error);\n        return res.status(400).json({ message: validationError.message });\n      }\n\n      const order = await storage.updateOrderStatus(req.params.id, validation.data.status);\n      \n      if (!order) {\n        return res.status(404).json({ message: \"Order not found\" });\n      }\n\n      res.json(order);\n    } catch (error) {\n      console.error(\"Error updating order status:\", error);\n      res.status(500).json({ message: \"Failed to update order status\" });\n    }\n  });\n\n  // Suppliers routes\n  app.get('/api/suppliers', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user || (user.role !== 'lab_tech' && user.role !== 'engineer')) {\n        return res.status(403).json({ message: \"Only lab staff can view suppliers\" });\n      }\n\n      const suppliers = await storage.getSuppliers();\n      res.json(suppliers);\n    } catch (error) {\n      console.error(\"Error fetching suppliers:\", error);\n      res.status(500).json({ message: \"Failed to fetch suppliers\" });\n    }\n  });\n\n  app.post('/api/suppliers', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user || (user.role !== 'lab_tech' && user.role !== 'engineer')) {\n        return res.status(403).json({ message: \"Only lab staff can create suppliers\" });\n      }\n\n      const validation = insertSupplierSchema.safeParse(req.body);\n      if (!validation.success) {\n        const validationError = fromZodError(validation.error);\n        return res.status(400).json({ message: validationError.message });\n      }\n\n      const supplier = await storage.createSupplier(validation.data);\n      res.status(201).json(supplier);\n    } catch (error) {\n      console.error(\"Error creating supplier:\", error);\n      res.status(500).json({ message: \"Failed to create supplier\" });\n    }\n  });\n\n  app.patch('/api/suppliers/:id', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user || (user.role !== 'lab_tech' && user.role !== 'engineer')) {\n        return res.status(403).json({ message: \"Only lab staff can update suppliers\" });\n      }\n\n      const validation = updateSupplierSchema.safeParse(req.body);\n      if (!validation.success) {\n        const validationError = fromZodError(validation.error);\n        return res.status(400).json({ message: validationError.message });\n      }\n\n      const supplier = await storage.updateSupplier(req.params.id, validation.data);\n      \n      if (!supplier) {\n        return res.status(404).json({ message: \"Supplier not found\" });\n      }\n\n      res.json(supplier);\n    } catch (error) {\n      console.error(\"Error updating supplier:\", error);\n      res.status(500).json({ message: \"Failed to update supplier\" });\n    }\n  });\n\n  app.delete('/api/suppliers/:id', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user || (user.role !== 'lab_tech' && user.role !== 'engineer')) {\n        return res.status(403).json({ message: \"Only lab staff can delete suppliers\" });\n      }\n\n      const deleted = await storage.deleteSupplier(req.params.id);\n      \n      if (!deleted) {\n        return res.status(404).json({ message: \"Supplier not found\" });\n      }\n\n      res.json({ message: \"Supplier deleted successfully\" });\n    } catch (error) {\n      console.error(\"Error deleting supplier:\", error);\n      res.status(500).json({ message: \"Failed to delete supplier\" });\n    }\n  });\n\n  // Stats routes\n  app.get('/api/stats', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n\n      // Only ECPs, lab techs, and engineers can access stats\n      if (user.role !== 'ecp' && user.role !== 'lab_tech' && user.role !== 'engineer') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      // ECPs get stats for their own orders\n      const ecpId = user.role === 'ecp' ? userId : undefined;\n      const stats = await storage.getOrderStats(ecpId);\n      \n      res.json(stats);\n    } catch (error) {\n      console.error(\"Error fetching stats:\", error);\n      res.status(500).json({ message: \"Failed to fetch stats\" });\n    }\n  });\n\n  // Consult Log routes (Phase 2)\n  app.post('/api/consult-logs', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'ecp') {\n        return res.status(403).json({ message: \"Only ECPs can create consult logs\" });\n      }\n\n      const validation = insertConsultLogSchema.safeParse(req.body);\n      if (!validation.success) {\n        const validationError = fromZodError(validation.error);\n        return res.status(400).json({ message: validationError.message });\n      }\n\n      const log = await storage.createConsultLog({\n        ...validation.data,\n        ecpId: userId,\n      });\n\n      res.status(201).json(log);\n    } catch (error) {\n      console.error(\"Error creating consult log:\", error);\n      res.status(500).json({ message: \"Failed to create consult log\" });\n    }\n  });\n\n  app.get('/api/consult-logs', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n\n      // Only ECPs, lab techs, and engineers can view consult logs\n      if (user.role !== 'ecp' && user.role !== 'lab_tech' && user.role !== 'engineer') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const logs = await storage.getAllConsultLogs(user.role === 'ecp' ? userId : undefined);\n      res.json(logs);\n    } catch (error) {\n      console.error(\"Error fetching consult logs:\", error);\n      res.status(500).json({ message: \"Failed to fetch consult logs\" });\n    }\n  });\n\n  app.get('/api/orders/:orderId/consult-logs', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n\n      // Only ECPs, lab techs, and engineers can view consult logs\n      if (user.role !== 'ecp' && user.role !== 'lab_tech' && user.role !== 'engineer') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const logs = await storage.getConsultLogs(req.params.orderId);\n      res.json(logs);\n    } catch (error) {\n      console.error(\"Error fetching consult logs:\", error);\n      res.status(500).json({ message: \"Failed to fetch consult logs\" });\n    }\n  });\n\n  app.patch('/api/consult-logs/:id/respond', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user || (user.role !== 'lab_tech' && user.role !== 'engineer')) {\n        return res.status(403).json({ message: \"Only lab staff can respond to consult logs\" });\n      }\n\n      const { response } = req.body;\n      if (!response || typeof response !== 'string') {\n        return res.status(400).json({ message: \"Response is required\" });\n      }\n\n      const log = await storage.respondToConsultLog(req.params.id, response);\n      \n      if (!log) {\n        return res.status(404).json({ message: \"Consult log not found\" });\n      }\n\n      res.json(log);\n    } catch (error) {\n      console.error(\"Error responding to consult log:\", error);\n      res.status(500).json({ message: \"Failed to respond to consult log\" });\n    }\n  });\n\n  // Purchase Order routes (Phase 2)\n  app.post('/api/purchase-orders', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user || (user.role !== 'lab_tech' && user.role !== 'engineer')) {\n        return res.status(403).json({ message: \"Only lab staff can create purchase orders\" });\n      }\n\n      const { lineItems, ...poData } = req.body;\n      \n      if (!lineItems || !Array.isArray(lineItems) || lineItems.length === 0) {\n        return res.status(400).json({ message: \"At least one line item is required\" });\n      }\n\n      const poValidation = insertPurchaseOrderSchema.safeParse(poData);\n      if (!poValidation.success) {\n        const validationError = fromZodError(poValidation.error);\n        return res.status(400).json({ message: validationError.message });\n      }\n\n      const po = await storage.createPurchaseOrder({\n        ...poValidation.data,\n        lineItems,\n      }, userId);\n\n      res.status(201).json(po);\n    } catch (error) {\n      console.error(\"Error creating purchase order:\", error);\n      res.status(500).json({ message: \"Failed to create purchase order\" });\n    }\n  });\n\n  app.get('/api/purchase-orders', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n\n      const { status, limit, offset } = req.query;\n      \n      const filters: any = {\n        status: status as string,\n        limit: limit ? parseInt(limit as string) : undefined,\n        offset: offset ? parseInt(offset as string) : undefined,\n      };\n\n      // Suppliers can only see their own POs\n      if (user.role === 'supplier') {\n        filters.supplierId = userId;\n      }\n\n      const pos = await storage.getPurchaseOrders(filters);\n      res.json(pos);\n    } catch (error) {\n      console.error(\"Error fetching purchase orders:\", error);\n      res.status(500).json({ message: \"Failed to fetch purchase orders\" });\n    }\n  });\n\n  app.get('/api/purchase-orders/:id', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n\n      const po = await storage.getPurchaseOrder(req.params.id);\n      \n      if (!po) {\n        return res.status(404).json({ message: \"Purchase order not found\" });\n      }\n      \n      // Suppliers can only see their own POs\n      if (user.role === 'supplier' && po.supplierId !== userId) {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      res.json(po);\n    } catch (error) {\n      console.error(\"Error fetching purchase order:\", error);\n      res.status(500).json({ message: \"Failed to fetch purchase order\" });\n    }\n  });\n\n  app.patch('/api/purchase-orders/:id/status', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n\n      const validation = updatePOStatusSchema.safeParse(req.body);\n      if (!validation.success) {\n        const validationError = fromZodError(validation.error);\n        return res.status(400).json({ message: validationError.message });\n      }\n\n      const { status, trackingNumber, actualDeliveryDate } = validation.data;\n\n      const po = await storage.updatePOStatus(\n        req.params.id, \n        status,\n        trackingNumber,\n        actualDeliveryDate ? new Date(actualDeliveryDate) : undefined\n      );\n      \n      if (!po) {\n        return res.status(404).json({ message: \"Purchase order not found\" });\n      }\n\n      res.json(po);\n    } catch (error) {\n      console.error(\"Error updating purchase order status:\", error);\n      res.status(500).json({ message: \"Failed to update purchase order status\" });\n    }\n  });\n\n  // Technical Document routes (Phase 2)\n  app.post('/api/technical-documents', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'supplier') {\n        return res.status(403).json({ message: \"Only suppliers can upload technical documents\" });\n      }\n\n      const validation = insertTechnicalDocumentSchema.safeParse(req.body);\n      if (!validation.success) {\n        const validationError = fromZodError(validation.error);\n        return res.status(400).json({ message: validationError.message });\n      }\n\n      const doc = await storage.createTechnicalDocument(validation.data, userId);\n\n      res.status(201).json(doc);\n    } catch (error) {\n      console.error(\"Error creating technical document:\", error);\n      res.status(500).json({ message: \"Failed to create technical document\" });\n    }\n  });\n\n  app.get('/api/technical-documents', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n\n      // Suppliers can only see their own documents\n      const supplierId = user.role === 'supplier' ? userId : undefined;\n      const docs = await storage.getTechnicalDocuments(supplierId);\n      \n      res.json(docs);\n    } catch (error) {\n      console.error(\"Error fetching technical documents:\", error);\n      res.status(500).json({ message: \"Failed to fetch technical documents\" });\n    }\n  });\n\n  app.delete('/api/technical-documents/:id', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'supplier') {\n        return res.status(403).json({ message: \"Only suppliers can delete their own documents\" });\n      }\n\n      const deleted = await storage.deleteTechnicalDocument(req.params.id, userId);\n      \n      if (!deleted) {\n        return res.status(404).json({ message: \"Technical document not found or access denied\" });\n      }\n\n      res.status(204).send();\n    } catch (error) {\n      console.error(\"Error deleting technical document:\", error);\n      res.status(500).json({ message: \"Failed to delete technical document\" });\n    }\n  });\n\n  // PDF and Email routes\n  app.get('/api/purchase-orders/:id/pdf', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user || (user.role !== 'lab_tech' && user.role !== 'engineer' && user.role !== 'supplier')) {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const po = await storage.getPurchaseOrderById(req.params.id);\n      \n      if (!po) {\n        return res.status(404).json({ message: \"Purchase order not found\" });\n      }\n\n      // Suppliers can only access their own POs\n      if (user.role === 'supplier' && po.supplierId !== userId) {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const pdfDoc = generatePurchaseOrderPDF(po as any);\n      \n      res.setHeader('Content-Type', 'application/pdf');\n      res.setHeader('Content-Disposition', `attachment; filename=\"PO-${po.poNumber}.pdf\"`);\n      \n      pdfDoc.pipe(res);\n    } catch (error) {\n      console.error(\"Error generating PDF:\", error);\n      res.status(500).json({ message: \"Failed to generate PDF\" });\n    }\n  });\n\n  app.post('/api/purchase-orders/:id/email', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user || (user.role !== 'lab_tech' && user.role !== 'engineer')) {\n        return res.status(403).json({ message: \"Only lab staff can email purchase orders\" });\n      }\n\n      const po = await storage.getPurchaseOrderById(req.params.id);\n      \n      if (!po) {\n        return res.status(404).json({ message: \"Purchase order not found\" });\n      }\n\n      if (!po.supplier.email) {\n        return res.status(400).json({ message: \"Supplier email not found\" });\n      }\n\n      // Generate PDF as buffer\n      const pdfDoc = generatePurchaseOrderPDF(po as any);\n      const chunks: Buffer[] = [];\n      \n      pdfDoc.on('data', (chunk) => chunks.push(chunk));\n      \n      await new Promise<void>((resolve, reject) => {\n        pdfDoc.on('end', () => resolve());\n        pdfDoc.on('error', reject);\n      });\n\n      const pdfBuffer = Buffer.concat(chunks);\n\n      await sendPurchaseOrderEmail(\n        po.supplier.email,\n        po.supplier.organizationName || 'Supplier',\n        po.poNumber,\n        pdfBuffer,\n        po.supplier.accountNumber || undefined\n      );\n\n      res.json({ message: \"Email sent successfully\" });\n    } catch (error) {\n      console.error(\"Error sending email:\", error);\n      res.status(500).json({ message: \"Failed to send email\" });\n    }\n  });\n\n  const markOrderShippedSchema = z.object({\n    trackingNumber: z.string().min(1, \"Tracking number is required\"),\n  });\n\n  app.patch('/api/orders/:id/ship', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user || (user.role !== 'lab_tech' && user.role !== 'engineer')) {\n        return res.status(403).json({ message: \"Only lab staff can mark orders as shipped\" });\n      }\n\n      const validation = markOrderShippedSchema.safeParse(req.body);\n      if (!validation.success) {\n        const validationError = fromZodError(validation.error);\n        return res.status(400).json({ message: validationError.message });\n      }\n\n      const order = await storage.markOrderAsShipped(req.params.id, validation.data.trackingNumber);\n      \n      if (!order) {\n        return res.status(404).json({ message: \"Order not found\" });\n      }\n\n      // Send email to ECP\n      const ecp = await storage.getUser(order.ecpId);\n      if (ecp && ecp.email) {\n        await sendShipmentNotificationEmail(\n          ecp.email,\n          `${ecp.firstName || ''} ${ecp.lastName || ''}`.trim() || 'Customer',\n          order.orderNumber,\n          order.patient.name,\n          validation.data.trackingNumber\n        );\n      }\n\n      res.json(order);\n    } catch (error) {\n      console.error(\"Error marking order as shipped:\", error);\n      res.status(500).json({ message: \"Failed to mark order as shipped\" });\n    }\n  });\n\n  // Settings routes\n  app.get('/api/settings/organization', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user || (user.role !== 'lab_tech' && user.role !== 'engineer')) {\n        return res.status(403).json({ message: \"Only lab staff can view organization settings\" });\n      }\n\n      const settings = await storage.getOrganizationSettings();\n      res.json(settings || {});\n    } catch (error) {\n      console.error(\"Error fetching organization settings:\", error);\n      res.status(500).json({ message: \"Failed to fetch organization settings\" });\n    }\n  });\n\n  app.put('/api/settings/organization', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user || (user.role !== 'lab_tech' && user.role !== 'engineer')) {\n        return res.status(403).json({ message: \"Only lab staff can update organization settings\" });\n      }\n\n      const validation = updateOrganizationSettingsSchema.safeParse(req.body);\n      if (!validation.success) {\n        const validationError = fromZodError(validation.error);\n        return res.status(400).json({ message: validationError.message });\n      }\n\n      const settings = await storage.updateOrganizationSettings(validation.data, userId);\n      res.json(settings);\n    } catch (error) {\n      console.error(\"Error updating organization settings:\", error);\n      res.status(500).json({ message: \"Failed to update organization settings\" });\n    }\n  });\n\n  app.get('/api/settings/preferences', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const preferences = await storage.getUserPreferences(userId);\n      res.json(preferences || {});\n    } catch (error) {\n      console.error(\"Error fetching user preferences:\", error);\n      res.status(500).json({ message: \"Failed to fetch user preferences\" });\n    }\n  });\n\n  app.put('/api/settings/preferences', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      \n      const validation = updateUserPreferencesSchema.safeParse(req.body);\n      if (!validation.success) {\n        const validationError = fromZodError(validation.error);\n        return res.status(400).json({ message: validationError.message });\n      }\n\n      const preferences = await storage.updateUserPreferences(userId, validation.data);\n      res.json(preferences);\n    } catch (error) {\n      console.error(\"Error updating user preferences:\", error);\n      res.status(500).json({ message: \"Failed to update user preferences\" });\n    }\n  });\n\n  // Admin routes\n  app.get('/api/admin/users', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'admin') {\n        return res.status(403).json({ message: \"Admin access required\" });\n      }\n\n      const users = await storage.getAllUsers();\n      res.json(users);\n    } catch (error) {\n      console.error(\"Error fetching all users:\", error);\n      res.status(500).json({ message: \"Failed to fetch users\" });\n    }\n  });\n\n  app.get('/api/admin/stats', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'admin') {\n        return res.status(403).json({ message: \"Admin access required\" });\n      }\n\n      const stats = await storage.getUserStats();\n      res.json(stats);\n    } catch (error) {\n      console.error(\"Error fetching user stats:\", error);\n      res.status(500).json({ message: \"Failed to fetch stats\" });\n    }\n  });\n\n  app.patch('/api/admin/users/:id', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'admin') {\n        return res.status(403).json({ message: \"Admin access required\" });\n      }\n\n      const targetUserId = req.params.id;\n      const { role, accountStatus, statusReason } = req.body;\n\n      // Validate updates\n      const updates: any = {};\n      if (role !== undefined && role !== null) {\n        if (!['ecp', 'lab_tech', 'engineer', 'supplier', 'admin'].includes(role)) {\n          return res.status(400).json({ message: \"Invalid role\" });\n        }\n        updates.role = role;\n      }\n      if (accountStatus !== undefined && accountStatus !== null) {\n        if (!['pending', 'active', 'suspended'].includes(accountStatus)) {\n          return res.status(400).json({ message: \"Invalid account status\" });\n        }\n        updates.accountStatus = accountStatus;\n      }\n      if (statusReason !== undefined) {\n        updates.statusReason = statusReason;\n      }\n\n      const updatedUser = await storage.updateUser(targetUserId, updates);\n      if (!updatedUser) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n\n      res.json(updatedUser);\n    } catch (error) {\n      console.error(\"Error updating user:\", error);\n      res.status(500).json({ message: \"Failed to update user\" });\n    }\n  });\n\n  // ==================== Phase 7: ECP Clinical & Retail Module ====================\n  \n  // Patient routes\n  app.get('/api/patients', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'ecp') {\n        return res.status(403).json({ message: \"Only ECPs can view patients\" });\n      }\n\n      const patients = await storage.getPatients(userId);\n      res.json(patients);\n    } catch (error) {\n      console.error(\"Error fetching patients:\", error);\n      res.status(500).json({ message: \"Failed to fetch patients\" });\n    }\n  });\n\n  app.get('/api/patients/:id', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'ecp') {\n        return res.status(403).json({ message: \"Only ECPs can view patients\" });\n      }\n\n      const patient = await storage.getPatient(req.params.id);\n      \n      if (!patient) {\n        return res.status(404).json({ message: \"Patient not found\" });\n      }\n      \n      if (patient.ecpId !== userId) {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      res.json(patient);\n    } catch (error) {\n      console.error(\"Error fetching patient:\", error);\n      res.status(500).json({ message: \"Failed to fetch patient\" });\n    }\n  });\n\n  app.patch('/api/patients/:id', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'ecp') {\n        return res.status(403).json({ message: \"Only ECPs can update patients\" });\n      }\n\n      const patient = await storage.getPatient(req.params.id);\n      \n      if (!patient) {\n        return res.status(404).json({ message: \"Patient not found\" });\n      }\n      \n      if (patient.ecpId !== userId) {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const updatedPatient = await storage.updatePatient(req.params.id, req.body);\n      res.json(updatedPatient);\n    } catch (error) {\n      console.error(\"Error updating patient:\", error);\n      res.status(500).json({ message: \"Failed to update patient\" });\n    }\n  });\n\n  // Eye Examination routes\n  app.get('/api/examinations', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'ecp') {\n        return res.status(403).json({ message: \"Only ECPs can view examinations\" });\n      }\n\n      const examinations = await storage.getEyeExaminations(userId);\n      res.json(examinations);\n    } catch (error) {\n      console.error(\"Error fetching examinations:\", error);\n      res.status(500).json({ message: \"Failed to fetch examinations\" });\n    }\n  });\n\n  app.get('/api/examinations/:id', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'ecp') {\n        return res.status(403).json({ message: \"Only ECPs can view examinations\" });\n      }\n\n      const examination = await storage.getEyeExamination(req.params.id);\n      \n      if (!examination) {\n        return res.status(404).json({ message: \"Examination not found\" });\n      }\n      \n      if (examination.ecpId !== userId) {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      res.json(examination);\n    } catch (error) {\n      console.error(\"Error fetching examination:\", error);\n      res.status(500).json({ message: \"Failed to fetch examination\" });\n    }\n  });\n\n  app.get('/api/patients/:id/examinations', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'ecp') {\n        return res.status(403).json({ message: \"Only ECPs can view examinations\" });\n      }\n\n      const patient = await storage.getPatient(req.params.id);\n      \n      if (!patient) {\n        return res.status(404).json({ message: \"Patient not found\" });\n      }\n      \n      if (patient.ecpId !== userId) {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const examinations = await storage.getPatientExaminations(req.params.id);\n      res.json(examinations);\n    } catch (error) {\n      console.error(\"Error fetching patient examinations:\", error);\n      res.status(500).json({ message: \"Failed to fetch patient examinations\" });\n    }\n  });\n\n  app.post('/api/examinations', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'ecp') {\n        return res.status(403).json({ message: \"Only ECPs can create examinations\" });\n      }\n\n      const validation = insertEyeExaminationSchema.safeParse(req.body);\n      if (!validation.success) {\n        const validationError = fromZodError(validation.error);\n        return res.status(400).json({ message: validationError.message, errors: validation.error.issues });\n      }\n\n      const examination = await storage.createEyeExamination(validation.data, userId);\n      res.status(201).json(examination);\n    } catch (error) {\n      console.error(\"Error creating examination:\", error);\n      res.status(500).json({ message: \"Failed to create examination\" });\n    }\n  });\n\n  app.patch('/api/examinations/:id', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'ecp') {\n        return res.status(403).json({ message: \"Only ECPs can update examinations\" });\n      }\n\n      const examination = await storage.getEyeExamination(req.params.id);\n      \n      if (!examination) {\n        return res.status(404).json({ message: \"Examination not found\" });\n      }\n      \n      if (examination.ecpId !== userId) {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const updatedExamination = await storage.updateEyeExamination(req.params.id, req.body);\n      res.json(updatedExamination);\n    } catch (error) {\n      console.error(\"Error updating examination:\", error);\n      res.status(500).json({ message: \"Failed to update examination\" });\n    }\n  });\n\n  app.post('/api/examinations/:id/finalize', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'ecp') {\n        return res.status(403).json({ message: \"Only ECPs can finalize examinations\" });\n      }\n\n      const examination = await storage.getEyeExamination(req.params.id);\n      \n      if (!examination) {\n        return res.status(404).json({ message: \"Examination not found\" });\n      }\n      \n      if (examination.ecpId !== userId) {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      if (examination.status === 'finalized') {\n        return res.status(400).json({ message: \"Examination is already finalized\" });\n      }\n\n      const finalizedExamination = await storage.finalizeExamination(req.params.id, userId);\n      res.json(finalizedExamination);\n    } catch (error) {\n      console.error(\"Error finalizing examination:\", error);\n      res.status(500).json({ message: \"Failed to finalize examination\" });\n    }\n  });\n\n  // Prescription routes\n  app.get('/api/prescriptions', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'ecp') {\n        return res.status(403).json({ message: \"Only ECPs can view prescriptions\" });\n      }\n\n      const prescriptions = await storage.getPrescriptions(userId);\n      res.json(prescriptions);\n    } catch (error) {\n      console.error(\"Error fetching prescriptions:\", error);\n      res.status(500).json({ message: \"Failed to fetch prescriptions\" });\n    }\n  });\n\n  app.get('/api/prescriptions/:id', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'ecp') {\n        return res.status(403).json({ message: \"Only ECPs can view prescriptions\" });\n      }\n\n      const prescription = await storage.getPrescription(req.params.id);\n      \n      if (!prescription) {\n        return res.status(404).json({ message: \"Prescription not found\" });\n      }\n      \n      if (prescription.ecpId !== userId) {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      res.json(prescription);\n    } catch (error) {\n      console.error(\"Error fetching prescription:\", error);\n      res.status(500).json({ message: \"Failed to fetch prescription\" });\n    }\n  });\n\n  app.post('/api/prescriptions', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'ecp') {\n        return res.status(403).json({ message: \"Only ECPs can create prescriptions\" });\n      }\n\n      const validation = insertPrescriptionSchema.safeParse(req.body);\n      if (!validation.success) {\n        const validationError = fromZodError(validation.error);\n        return res.status(400).json({ message: validationError.message, errors: validation.error.issues });\n      }\n\n      const prescription = await storage.createPrescription(validation.data, userId);\n      res.status(201).json(prescription);\n    } catch (error) {\n      console.error(\"Error creating prescription:\", error);\n      res.status(500).json({ message: \"Failed to create prescription\" });\n    }\n  });\n\n  app.post('/api/prescriptions/:id/sign', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'ecp') {\n        return res.status(403).json({ message: \"Only ECPs can sign prescriptions\" });\n      }\n\n      const prescription = await storage.getPrescription(req.params.id);\n      \n      if (!prescription) {\n        return res.status(404).json({ message: \"Prescription not found\" });\n      }\n      \n      if (prescription.ecpId !== userId) {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      if (prescription.isSigned) {\n        return res.status(400).json({ message: \"Prescription is already signed\" });\n      }\n\n      const { signature } = req.body;\n      if (!signature) {\n        return res.status(400).json({ message: \"Signature is required\" });\n      }\n\n      const signedPrescription = await storage.signPrescription(req.params.id, userId, signature);\n      res.json(signedPrescription);\n    } catch (error) {\n      console.error(\"Error signing prescription:\", error);\n      res.status(500).json({ message: \"Failed to sign prescription\" });\n    }\n  });\n\n  app.get('/api/prescriptions/:id/pdf', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'ecp') {\n        return res.status(403).json({ message: \"Only ECPs can download prescriptions\" });\n      }\n\n      const prescription = await storage.getPrescription(req.params.id);\n      \n      if (!prescription) {\n        return res.status(404).json({ message: \"Prescription not found\" });\n      }\n      \n      if (prescription.ecpId !== userId) {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const { generatePrescriptionPDF } = await import('./pdfService');\n      const pdfBuffer = await generatePrescriptionPDF(prescription);\n\n      res.setHeader('Content-Type', 'application/pdf');\n      res.setHeader('Content-Disposition', `attachment; filename=\"prescription-${prescription.id}.pdf\"`);\n      res.send(pdfBuffer);\n    } catch (error) {\n      console.error(\"Error generating prescription PDF:\", error);\n      res.status(500).json({ message: \"Failed to generate prescription PDF\" });\n    }\n  });\n\n  app.post('/api/prescriptions/:id/email', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'ecp') {\n        return res.status(403).json({ message: \"Only ECPs can email prescriptions\" });\n      }\n\n      const prescription = await storage.getPrescription(req.params.id);\n      \n      if (!prescription) {\n        return res.status(404).json({ message: \"Prescription not found\" });\n      }\n      \n      if (prescription.ecpId !== userId) {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      if (!prescription.patient.email) {\n        return res.status(400).json({ message: \"Patient email not found\" });\n      }\n\n      const { sendPrescriptionEmail } = await import('./emailService');\n      await sendPrescriptionEmail(prescription);\n\n      res.json({ message: \"Prescription sent successfully\" });\n    } catch (error) {\n      console.error(\"Error sending prescription:\", error);\n      res.status(500).json({ message: \"Failed to send prescription\" });\n    }\n  });\n\n  // Product routes\n  app.get('/api/products', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'ecp') {\n        return res.status(403).json({ message: \"Only ECPs can view products\" });\n      }\n\n      const products = await storage.getProducts(userId);\n      res.json(products);\n    } catch (error) {\n      console.error(\"Error fetching products:\", error);\n      res.status(500).json({ message: \"Failed to fetch products\" });\n    }\n  });\n\n  app.get('/api/products/:id', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'ecp') {\n        return res.status(403).json({ message: \"Only ECPs can view products\" });\n      }\n\n      const product = await storage.getProduct(req.params.id);\n      \n      if (!product) {\n        return res.status(404).json({ message: \"Product not found\" });\n      }\n      \n      if (product.ecpId !== userId) {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      res.json(product);\n    } catch (error) {\n      console.error(\"Error fetching product:\", error);\n      res.status(500).json({ message: \"Failed to fetch product\" });\n    }\n  });\n\n  app.post('/api/products', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'ecp') {\n        return res.status(403).json({ message: \"Only ECPs can create products\" });\n      }\n\n      const validation = insertProductSchema.safeParse(req.body);\n      if (!validation.success) {\n        const validationError = fromZodError(validation.error);\n        return res.status(400).json({ message: validationError.message, errors: validation.error.issues });\n      }\n\n      const product = await storage.createProduct(validation.data, userId);\n      res.status(201).json(product);\n    } catch (error) {\n      console.error(\"Error creating product:\", error);\n      res.status(500).json({ message: \"Failed to create product\" });\n    }\n  });\n\n  app.patch('/api/products/:id', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'ecp') {\n        return res.status(403).json({ message: \"Only ECPs can update products\" });\n      }\n\n      const product = await storage.getProduct(req.params.id);\n      \n      if (!product) {\n        return res.status(404).json({ message: \"Product not found\" });\n      }\n      \n      if (product.ecpId !== userId) {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const updatedProduct = await storage.updateProduct(req.params.id, req.body);\n      res.json(updatedProduct);\n    } catch (error) {\n      console.error(\"Error updating product:\", error);\n      res.status(500).json({ message: \"Failed to update product\" });\n    }\n  });\n\n  app.delete('/api/products/:id', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'ecp') {\n        return res.status(403).json({ message: \"Only ECPs can delete products\" });\n      }\n\n      const product = await storage.getProduct(req.params.id);\n      \n      if (!product) {\n        return res.status(404).json({ message: \"Product not found\" });\n      }\n      \n      if (product.ecpId !== userId) {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const deleted = await storage.deleteProduct(req.params.id);\n      \n      if (!deleted) {\n        return res.status(404).json({ message: \"Product not found\" });\n      }\n\n      res.json({ message: \"Product deleted successfully\" });\n    } catch (error) {\n      console.error(\"Error deleting product:\", error);\n      res.status(500).json({ message: \"Failed to delete product\" });\n    }\n  });\n\n  // Invoice routes\n  app.get('/api/invoices', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'ecp') {\n        return res.status(403).json({ message: \"Only ECPs can view invoices\" });\n      }\n\n      const invoices = await storage.getInvoices(userId);\n      res.json(invoices);\n    } catch (error) {\n      console.error(\"Error fetching invoices:\", error);\n      res.status(500).json({ message: \"Failed to fetch invoices\" });\n    }\n  });\n\n  app.get('/api/invoices/:id', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'ecp') {\n        return res.status(403).json({ message: \"Only ECPs can view invoices\" });\n      }\n\n      const invoice = await storage.getInvoice(req.params.id);\n      \n      if (!invoice) {\n        return res.status(404).json({ message: \"Invoice not found\" });\n      }\n      \n      if (invoice.ecpId !== userId) {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      res.json(invoice);\n    } catch (error) {\n      console.error(\"Error fetching invoice:\", error);\n      res.status(500).json({ message: \"Failed to fetch invoice\" });\n    }\n  });\n\n  app.post('/api/invoices', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'ecp') {\n        return res.status(403).json({ message: \"Only ECPs can create invoices\" });\n      }\n\n      const { lineItems, ...invoiceData } = req.body;\n\n      if (!lineItems || !Array.isArray(lineItems) || lineItems.length === 0) {\n        return res.status(400).json({ message: \"Invoice must have at least one line item\" });\n      }\n\n      const invoice = await storage.createInvoice({ ...invoiceData, lineItems }, userId);\n      res.status(201).json(invoice);\n    } catch (error) {\n      console.error(\"Error creating invoice:\", error);\n      res.status(500).json({ message: \"Failed to create invoice\" });\n    }\n  });\n\n  app.patch('/api/invoices/:id/status', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'ecp') {\n        return res.status(403).json({ message: \"Only ECPs can update invoice status\" });\n      }\n\n      const invoice = await storage.getInvoice(req.params.id);\n      \n      if (!invoice) {\n        return res.status(404).json({ message: \"Invoice not found\" });\n      }\n      \n      if (invoice.ecpId !== userId) {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const { status } = req.body;\n      if (!status || !['draft', 'paid', 'void'].includes(status)) {\n        return res.status(400).json({ message: \"Invalid status\" });\n      }\n\n      const updatedInvoice = await storage.updateInvoiceStatus(req.params.id, status);\n      res.json(updatedInvoice);\n    } catch (error) {\n      console.error(\"Error updating invoice status:\", error);\n      res.status(500).json({ message: \"Failed to update invoice status\" });\n    }\n  });\n\n  app.post('/api/invoices/:id/payment', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'ecp') {\n        return res.status(403).json({ message: \"Only ECPs can record payments\" });\n      }\n\n      const invoice = await storage.getInvoice(req.params.id);\n      \n      if (!invoice) {\n        return res.status(404).json({ message: \"Invoice not found\" });\n      }\n      \n      if (invoice.ecpId !== userId) {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const { amount } = req.body;\n      if (!amount || parseFloat(amount) <= 0) {\n        return res.status(400).json({ message: \"Invalid payment amount\" });\n      }\n\n      const updatedInvoice = await storage.recordPayment(req.params.id, amount);\n      res.json(updatedInvoice);\n    } catch (error) {\n      console.error(\"Error recording payment:\", error);\n      res.status(500).json({ message: \"Failed to record payment\" });\n    }\n  });\n\n  // GitHub routes\n  app.get('/api/github/user', async (req, res) => {\n    try {\n      const { getAuthenticatedUser } = await import('./github-helper');\n      const user = await getAuthenticatedUser();\n      res.json(user);\n    } catch (error: any) {\n      console.error(\"Error fetching GitHub user:\", error);\n      res.status(500).json({ message: error.message || \"Failed to fetch GitHub user\" });\n    }\n  });\n\n  app.post('/api/github/create-repo', async (req, res) => {\n    try {\n      const { createGitHubRepo } = await import('./github-helper');\n      const { name, isPrivate, description } = req.body;\n      \n      if (!name) {\n        return res.status(400).json({ message: \"Repository name is required\" });\n      }\n\n      const repo = await createGitHubRepo(name, isPrivate || false, description);\n      res.json(repo);\n    } catch (error: any) {\n      console.error(\"Error creating GitHub repo:\", error);\n      res.status(500).json({ message: error.message || \"Failed to create repository\" });\n    }\n  });\n\n  const httpServer = createServer(app);\n  return httpServer;\n}\n","size_bytes":69459},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\nasync function throwIfResNotOk(res: Response, clearCacheOnAuthFailure = true) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    \n    // Clear all cached data on authorization failures to prevent showing PHI to unauthorized users\n    if (clearCacheOnAuthFailure && (res.status === 401 || res.status === 403)) {\n      queryClient.clear();\n    }\n    \n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n): Promise<Response> {\n  const res = await fetch(url, {\n    method,\n    headers: data ? { \"Content-Type\": \"application/json\" } : {},\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const res = await fetch(queryKey.join(\"/\") as string, {\n      credentials: \"include\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","size_bytes":1639},"client/src/components/ui/drawer.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","size_bytes":3021},"client/src/components/SearchBar.tsx":{"content":"import { Search } from \"lucide-react\";\nimport { Input } from \"@/components/ui/input\";\nimport { cn } from \"@/lib/utils\";\n\ninterface SearchBarProps {\n  placeholder?: string;\n  value?: string;\n  onChange?: (value: string) => void;\n  className?: string;\n}\n\nexport function SearchBar({\n  placeholder = \"Search orders...\",\n  value,\n  onChange,\n  className,\n}: SearchBarProps) {\n  return (\n    <div className={cn(\"relative flex-1\", className)}>\n      <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n      <Input\n        type=\"search\"\n        placeholder={placeholder}\n        value={value}\n        onChange={(e) => onChange?.(e.target.value)}\n        className=\"pl-9\"\n        data-testid=\"input-search\"\n      />\n    </div>\n  );\n}\n","size_bytes":779},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","size_bytes":5128},"client/src/components/ui/dropdown-menu.tsx":{"content":"import * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","size_bytes":7609},"client/src/pages/examples/ECPDashboard.tsx":{"content":"import ECPDashboard from '../ECPDashboard'\n\nexport default function ECPDashboardExample() {\n  return <ECPDashboard />\n}\n","size_bytes":120},"client/src/components/ui/menubar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-10 items-center space-x-1 rounded-md border bg-background p-1\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","size_bytes":8605},"client/src/components/examples/AppSidebar.tsx":{"content":"import { AppSidebar } from '../AppSidebar'\nimport { SidebarProvider } from '@/components/ui/sidebar'\n\nexport default function AppSidebarExample() {\n  const style = {\n    \"--sidebar-width\": \"16rem\",\n  };\n\n  return (\n    <SidebarProvider style={style as React.CSSProperties}>\n      <div className=\"flex h-screen w-full\">\n        <AppSidebar userRole=\"lab\" />\n        <main className=\"flex-1 overflow-auto p-8\">\n          <h1 className=\"text-2xl font-semibold\">Main Content Area</h1>\n          <p className=\"text-muted-foreground mt-2\">The sidebar navigation is on the left.</p>\n        </main>\n      </div>\n    </SidebarProvider>\n  )\n}\n","size_bytes":634},"design_guidelines.md":{"content":"# Integrated Lens System (ILS) Design Guidelines\n\n## Design Approach\n**System:** Material Design with enterprise data focus\n**Rationale:** This is a utility-focused, information-dense enterprise platform requiring clarity, efficiency, and professional presentation. Material Design provides robust patterns for forms, tables, and dashboards while maintaining modern aesthetics.\n\n## Typography System\n\n**Font Family:** Inter (via Google Fonts) for all UI elements\n- Primary: Inter (400, 500, 600, 700 weights)\n- Monospace: JetBrains Mono for technical data (Rx values, measurements)\n\n**Type Scale:**\n- Page Titles: 2xl (24px), font-semibold\n- Section Headers: xl (20px), font-semibold\n- Card/Panel Titles: lg (18px), font-medium\n- Body Text: base (16px), font-normal\n- Labels/Metadata: sm (14px), font-medium\n- Technical Data: sm (14px), font-mono\n- Helper Text: xs (12px), font-normal\n\n## Layout System\n\n**Spacing Units:** Tailwind units of 2, 4, 6, 8, 12, 16\n- Component padding: p-4 to p-6\n- Section spacing: space-y-6 to space-y-8\n- Card margins: m-4\n- Form field gaps: gap-4\n- Grid gaps: gap-6\n\n**Container Strategy:**\n- Application shell: Full-width with fixed sidebar (w-64)\n- Content area: max-w-7xl with px-6 to px-8\n- Forms: max-w-4xl for optimal field width\n- Data tables: Full-width within content area\n- Modals: max-w-2xl to max-w-4xl based on complexity\n\n## Core Component Library\n\n### Navigation\n**Sidebar Navigation (Primary):**\n- Fixed left sidebar, full-height, w-64\n- Logo/branding at top with p-6\n- Role indicator badge below logo\n- Navigation sections with dividers\n- Active state: Full-width highlight with left border accent\n- Icons from Heroicons (outline for inactive, solid for active)\n- Collapsible sections for complex hierarchies\n\n**Top Bar:**\n- Fixed across top, h-16\n- Right-aligned utilities: notifications bell, user profile dropdown, quick actions\n- Breadcrumb navigation for deep pages (left-aligned)\n- Role switcher if applicable\n\n### Dashboard Components\n**Stat Cards:**\n- Grid layout: grid-cols-1 md:grid-cols-2 lg:grid-cols-4\n- Each card: Rounded-lg with subtle shadow, p-6\n- Structure: Large number (text-3xl, font-bold), label below (text-sm), optional icon\n- Trend indicators with directional arrows\n\n**Data Tables:**\n- Full-width within container, rounded-lg container with shadow\n- Sticky header row with font-medium labels\n- Alternating row treatment for readability\n- Row hover state for interactivity\n- Action column (right-aligned) with icon buttons\n- Pagination controls at bottom-right\n- Search/filter bar above table with gap-4 between controls\n\n**Order Queue Workbench:**\n- Split view: Filterable list (left 40%) + Detail panel (right 60%)\n- List items: Compact cards with key info (order #, ECP, status badge, timestamp)\n- Detail panel: Tabbed interface (Overview, Prescription, Frame Data, Production Log)\n- Status workflow visualizer: Horizontal stepper component showing order progress\n\n### Forms & Input\n**Order Entry Form:**\n- Multi-step wizard layout with progress indicator at top\n- Steps: Patient Info  Prescription  Frame & Lens  Coating & Options  Review\n- Each step: max-w-3xl, generous spacing (space-y-6)\n- Field groups with clear section headers (text-lg, font-semibold, mb-4)\n- Label above input pattern, required indicators with asterisk\n- Inline validation messages below fields\n- Navigation: Back/Next buttons at bottom-right, Save Draft at bottom-left\n\n**Input Fields:**\n- Standard height: h-10 for text inputs\n- Rounded-md borders\n- Focus rings for accessibility\n- Prescription inputs: Grid layout (OD/OS rows, SPH/CYL/AXIS/ADD columns)\n- Dropdowns: Full-width with chevron icon\n- Radio/Checkbox groups: Vertical stack with gap-3\n\n**Search & Filters:**\n- Toolbar layout: Flex row with gap-4\n- Search input with magnifying glass icon (left-aligned, flex-1)\n- Filter dropdowns (fixed widths w-48 to w-64)\n- Clear all filters button (text-sm, font-medium)\n\n### Data Display\n**Order Cards (ECP Portal):**\n- Rounded-lg with shadow, p-6\n- Header: Order number + status badge (right-aligned)\n- Grid layout for key details (2-column on desktop)\n- Timeline component showing order milestones\n- Action buttons at bottom\n\n**Prescription Display:**\n- Table format with clear OD/OS row labels\n- Monospace font for numerical values\n- Add emphasis to non-zero values\n- Frame measurements in separate section below\n\n**Supplier Technical Data:**\n- Accordion layout for material specs\n- Document list with download icons\n- Batch/lot tracking table with search\n\n### Status & Feedback\n**Status Badges:**\n- Rounded-full, px-3, py-1, text-xs, font-semibold\n- Visual distinction through styling patterns\n- Position: Inline with headers or right-aligned in lists\n\n**Notifications:**\n- Toast style: Fixed top-right, slide-in animation\n- Icon + message + close button layout\n- Auto-dismiss after 5 seconds with progress bar\n\n**Loading States:**\n- Skeleton loaders for tables and cards\n- Spinner for form submissions\n- Progress bars for multi-step processes\n\n### Modals & Overlays\n**Confirmation Dialogs:**\n- Centered overlay with backdrop blur\n- max-w-md, rounded-lg, p-6\n- Icon at top (centered), title, description, action buttons\n- Primary action right-aligned, cancel left-aligned\n\n**Detail Drawers:**\n- Slide-in from right, w-96 to w-1/2\n- Close button top-right\n- Scrollable content area\n- Fixed action footer if needed\n\n## Images\n\n**Dashboard Illustrations:**\n- Empty state graphics for zero-order queue (centered, max-w-sm)\n- No results found illustrations for filtered views\n- Success confirmation graphics in modals\n\n**User Avatars:**\n- Circle format, w-10 h-10 for top bar, w-8 h-8 for lists\n- Initials fallback for users without photos\n\n**Technical Documentation:**\n- Placeholder areas in supplier portal for spec sheet thumbnails\n- PDF preview icons with document type indicators\n\n## Animations\nUse sparingly - only for essential feedback:\n- Page transitions: Subtle fade-in\n- Modal/drawer: Slide and fade\n- Toast notifications: Slide from top\n- Loading spinners: Rotation only\n- No decorative animations","size_bytes":6075},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","size_bytes":1209},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n}\n","size_bytes":2751},"client/src/components/AppSidebar.tsx":{"content":"import {\n  Sidebar,\n  SidebarContent,\n  SidebarGroup,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarMenu,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarHeader,\n  SidebarFooter,\n} from \"@/components/ui/sidebar\";\nimport { \n  Home, \n  Package, \n  ClipboardList, \n  TrendingUp,\n  Settings,\n  HelpCircle,\n  Beaker,\n  LogOut,\n  Shield,\n  Users,\n} from \"lucide-react\";\nimport { Link, useLocation } from \"wouter\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { getUserDisplayName, getUserInitials } from \"@/lib/authUtils\";\n\ninterface AppSidebarProps {\n  userRole?: \"ecp\" | \"lab_tech\" | \"supplier\" | \"engineer\" | \"admin\";\n}\n\nconst menuItems = {\n  ecp: [\n    { title: \"Dashboard\", url: \"/ecp/dashboard\", icon: Home },\n    { title: \"New Order\", url: \"/ecp/new-order\", icon: Package },\n    { title: \"My Orders\", url: \"/ecp/orders\", icon: ClipboardList },\n    { title: \"Returns\", url: \"/ecp/returns\", icon: TrendingUp },\n  ],\n  lab_tech: [\n    { title: \"Dashboard\", url: \"/lab/dashboard\", icon: Home },\n    { title: \"Order Queue\", url: \"/lab/queue\", icon: ClipboardList },\n    { title: \"Production\", url: \"/lab/production\", icon: Package },\n    { title: \"Quality Control\", url: \"/lab/quality\", icon: Beaker },\n  ],\n  supplier: [\n    { title: \"Dashboard\", url: \"/supplier/dashboard\", icon: Home },\n    { title: \"Purchase Orders\", url: \"/supplier/orders\", icon: ClipboardList },\n    { title: \"Technical Library\", url: \"/supplier/library\", icon: Package },\n  ],\n  engineer: [\n    { title: \"Dashboard\", url: \"/lab/dashboard\", icon: Home },\n    { title: \"Analytics Hub\", url: \"/lab/analytics\", icon: TrendingUp },\n    { title: \"Equipment\", url: \"/lab/equipment\", icon: Settings },\n    { title: \"R&D Projects\", url: \"/lab/rnd\", icon: Beaker },\n  ],\n  admin: [\n    { title: \"Dashboard\", url: \"/admin/dashboard\", icon: Home },\n    { title: \"User Management\", url: \"/admin/users\", icon: Users },\n    { title: \"Platform Settings\", url: \"/admin/platform\", icon: Shield },\n  ],\n};\n\nconst roleLabels = {\n  ecp: \"Eye Care Professional\",\n  lab_tech: \"Lab Technician\",\n  supplier: \"Supplier\",\n  engineer: \"Principal Engineer\",\n  admin: \"Administrator\",\n};\n\nexport function AppSidebar({ userRole = \"lab_tech\" }: AppSidebarProps) {\n  const [location] = useLocation();\n  const { user } = useAuth();\n  const items = menuItems[userRole];\n\n  const handleLogout = () => {\n    window.location.href = \"/api/logout\";\n  };\n\n  return (\n    <Sidebar>\n      <SidebarHeader className=\"p-6\">\n        <div className=\"flex items-center gap-3\">\n          <div className=\"w-10 h-10 rounded-md bg-primary flex items-center justify-center\">\n            <span className=\"text-primary-foreground font-bold text-lg\">ILS</span>\n          </div>\n          <div className=\"flex-1\">\n            <h1 className=\"font-semibold text-lg\">Lens System</h1>\n            <Badge variant=\"outline\" className=\"text-xs mt-1\">\n              {roleLabels[userRole]}\n            </Badge>\n          </div>\n        </div>\n      </SidebarHeader>\n      \n      <SidebarContent>\n        <SidebarGroup>\n          <SidebarGroupLabel>Navigation</SidebarGroupLabel>\n          <SidebarGroupContent>\n            <SidebarMenu>\n              {items.map((item) => (\n                <SidebarMenuItem key={item.title}>\n                  <SidebarMenuButton\n                    asChild\n                    isActive={location === item.url}\n                    data-testid={`nav-${item.title.toLowerCase().replace(/\\s+/g, '-')}`}\n                  >\n                    <Link href={item.url}>\n                      <item.icon className=\"h-4 w-4\" />\n                      <span>{item.title}</span>\n                    </Link>\n                  </SidebarMenuButton>\n                </SidebarMenuItem>\n              ))}\n            </SidebarMenu>\n          </SidebarGroupContent>\n        </SidebarGroup>\n\n        <SidebarGroup>\n          <SidebarGroupLabel>Support</SidebarGroupLabel>\n          <SidebarGroupContent>\n            <SidebarMenu>\n              <SidebarMenuItem>\n                <SidebarMenuButton asChild data-testid=\"nav-settings\">\n                  <Link href=\"/settings\">\n                    <Settings className=\"h-4 w-4\" />\n                    <span>Settings</span>\n                  </Link>\n                </SidebarMenuButton>\n              </SidebarMenuItem>\n              <SidebarMenuItem>\n                <SidebarMenuButton asChild data-testid=\"nav-help\">\n                  <Link href=\"/help\">\n                    <HelpCircle className=\"h-4 w-4\" />\n                    <span>Help</span>\n                  </Link>\n                </SidebarMenuButton>\n              </SidebarMenuItem>\n            </SidebarMenu>\n          </SidebarGroupContent>\n        </SidebarGroup>\n      </SidebarContent>\n\n      <SidebarFooter className=\"p-4\">\n        {user && (\n          <div className=\"space-y-2\">\n            <div className=\"flex items-center gap-3 p-2 rounded-md\">\n              <Avatar className=\"h-8 w-8\">\n                {user.profileImageUrl && <AvatarImage src={user.profileImageUrl} />}\n                <AvatarFallback className=\"bg-primary text-primary-foreground text-sm\">\n                  {getUserInitials(user)}\n                </AvatarFallback>\n              </Avatar>\n              <div className=\"flex-1 min-w-0\">\n                <p className=\"text-sm font-medium truncate\" data-testid=\"text-user-name\">\n                  {getUserDisplayName(user)}\n                </p>\n                <p className=\"text-xs text-muted-foreground truncate\" data-testid=\"text-user-email\">\n                  {user.email || \"No email\"}\n                </p>\n              </div>\n            </div>\n            <Button \n              variant=\"ghost\" \n              size=\"sm\" \n              className=\"w-full justify-start\"\n              onClick={handleLogout}\n              data-testid=\"button-logout-sidebar\"\n            >\n              <LogOut className=\"h-4 w-4 mr-2\" />\n              <span>Logout</span>\n            </Button>\n          </div>\n        )}\n      </SidebarFooter>\n    </Sidebar>\n  );\n}\n","size_bytes":6198},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n","size_bytes":1280},"client/src/components/ui/form.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-sm text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-sm font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","size_bytes":4120},"client/src/index.css":{"content":"@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n/* LIGHT MODE */\n:root {\n  --button-outline: rgba(0,0,0, .10);\n  --badge-outline: rgba(0,0,0, .05);\n\n  /* Automatic computation of border around primary / danger buttons */\n  --opaque-button-border-intensity: -8; /* In terms of percentages */\n\n  /* Backgrounds applied on top of other backgrounds when hovered/active */\n  --elevate-1: rgba(0,0,0, .03);\n  --elevate-2: rgba(0,0,0, .08);\n\n  --background: 210 5% 98%;\n\n  --foreground: 210 6% 12%;\n\n  --border: 210 5% 88%;\n\n  --card: 210 5% 96%;\n\n  --card-foreground: 210 6% 12%;\n\n  --card-border: 210 5% 91%;\n\n  --sidebar: 210 5% 94%;\n\n  --sidebar-foreground: 210 6% 12%;\n\n  --sidebar-border: 210 5% 87%;\n\n  --sidebar-primary: 32 81% 36%;\n\n  --sidebar-primary-foreground: 32 81% 98%;\n\n  --sidebar-accent: 210 8% 88%;\n\n  --sidebar-accent-foreground: 210 6% 12%;\n\n  --sidebar-ring: 32 81% 45%;\n\n  --popover: 210 5% 93%;\n\n  --popover-foreground: 210 6% 12%;\n\n  --popover-border: 210 5% 86%;\n\n  --primary: 32 81% 36%;\n\n  --primary-foreground: 32 81% 98%;\n\n  --secondary: 210 6% 90%;\n\n  --secondary-foreground: 210 6% 12%;\n\n  --muted: 210 8% 92%;\n\n  --muted-foreground: 210 6% 35%;\n\n  --accent: 210 10% 90%;\n\n  --accent-foreground: 210 6% 12%;\n\n  --destructive: 0 84% 35%;\n\n  --destructive-foreground: 0 84% 98%;\n\n  --input: 210 8% 75%;\n  --ring: 32 81% 45%;\n  --chart-1: 32 81% 36%;\n  --chart-2: 173 80% 28%;\n  --chart-3: 200 75% 42%;\n  --chart-4: 280 75% 35%;\n  --chart-5: 340 82% 38%;\n\n  --font-sans: Inter, sans-serif;\n  --font-serif: Georgia, serif;\n  --font-mono: JetBrains Mono, monospace;\n  --radius: .5rem;\n  --shadow-2xs: 0px 1px 2px 0px hsl(210 10% 23% / 0.05);\n  --shadow-xs: 0px 1px 2px 0px hsl(210 10% 23% / 0.06);\n  --shadow-sm: 0px 1px 2px 0px hsl(210 10% 23% / 0.06), 0px 1px 3px 0px hsl(210 10% 23% / 0.1);\n  --shadow: 0px 1px 2px 0px hsl(210 10% 23% / 0.06), 0px 1px 3px 0px hsl(210 10% 23% / 0.1);\n  --shadow-md: 0px 2px 4px -1px hsl(210 10% 23% / 0.06), 0px 4px 6px -1px hsl(210 10% 23% / 0.1);\n  --shadow-lg: 0px 4px 6px -2px hsl(210 10% 23% / 0.05), 0px 10px 15px -3px hsl(210 10% 23% / 0.1);\n  --shadow-xl: 0px 10px 10px -5px hsl(210 10% 23% / 0.04), 0px 20px 25px -5px hsl(210 10% 23% / 0.1);\n  --shadow-2xl: 0px 25px 50px -12px hsl(210 10% 23% / 0.25);\n  --tracking-normal: 0em;\n  --spacing: 0.25rem;\n\n  /* Automatically computed borders - intensity can be controlled by the user by the --opaque-button-border-intensity setting */\n\n  /* Fallback for older browsers */\n  --sidebar-primary-border: hsl(var(--sidebar-primary));\n  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --sidebar-accent-border: hsl(var(--sidebar-accent));\n  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --primary-border: hsl(var(--primary));\n  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --secondary-border: hsl(var(--secondary));\n  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --muted-border: hsl(var(--muted));\n  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --accent-border: hsl(var(--accent));\n  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --destructive-border: hsl(var(--destructive));\n  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n}\n\n.dark {\n  --button-outline: rgba(255,255,255, .10);\n  --badge-outline: rgba(255,255,255, .05);\n\n  --opaque-button-border-intensity: 9;  /* In terms of percentages */\n\n  /* Backgrounds applied on top of other backgrounds when hovered/active */\n  --elevate-1: rgba(255,255,255, .04);\n  --elevate-2: rgba(255,255,255, .09);\n\n  --background: 210 5% 8%;\n\n  --foreground: 210 5% 95%;\n\n  --border: 210 5% 18%;\n\n  --card: 210 5% 11%;\n\n  --card-foreground: 210 5% 95%;\n\n  --card-border: 210 5% 16%;\n\n  --sidebar: 210 5% 13%;\n\n  --sidebar-foreground: 210 5% 95%;\n\n  --sidebar-border: 210 5% 19%;\n\n  --sidebar-primary: 32 81% 55%;\n\n  --sidebar-primary-foreground: 32 81% 98%;\n\n  --sidebar-accent: 210 8% 18%;\n\n  --sidebar-accent-foreground: 210 5% 95%;\n\n  --sidebar-ring: 32 81% 65%;\n\n  --popover: 210 5% 14%;\n\n  --popover-foreground: 210 5% 95%;\n\n  --popover-border: 210 5% 20%;\n\n  --primary: 32 81% 55%;\n\n  --primary-foreground: 32 81% 98%;\n\n  --secondary: 210 6% 20%;\n\n  --secondary-foreground: 210 5% 95%;\n\n  --muted: 210 8% 16%;\n\n  --muted-foreground: 210 5% 70%;\n\n  --accent: 210 10% 18%;\n\n  --accent-foreground: 210 5% 95%;\n\n  --destructive: 0 75% 42%;\n\n  --destructive-foreground: 0 75% 98%;\n\n  --input: 210 8% 30%;\n  --ring: 32 81% 65%;\n  --chart-1: 32 81% 60%;\n  --chart-2: 173 70% 55%;\n  --chart-3: 200 75% 60%;\n  --chart-4: 280 70% 60%;\n  --chart-5: 340 75% 58%;\n\n  --shadow-2xs: 0px 1px 2px 0px hsl(210 10% 3% / 0.3);\n  --shadow-xs: 0px 1px 2px 0px hsl(210 10% 3% / 0.4);\n  --shadow-sm: 0px 1px 2px 0px hsl(210 10% 3% / 0.4), 0px 1px 3px 0px hsl(210 10% 3% / 0.5);\n  --shadow: 0px 1px 2px 0px hsl(210 10% 3% / 0.4), 0px 1px 3px 0px hsl(210 10% 3% / 0.5);\n  --shadow-md: 0px 2px 4px -1px hsl(210 10% 3% / 0.4), 0px 4px 6px -1px hsl(210 10% 3% / 0.5);\n  --shadow-lg: 0px 4px 6px -2px hsl(210 10% 3% / 0.3), 0px 10px 15px -3px hsl(210 10% 3% / 0.5);\n  --shadow-xl: 0px 10px 10px -5px hsl(210 10% 3% / 0.3), 0px 20px 25px -5px hsl(210 10% 3% / 0.5);\n  --shadow-2xl: 0px 25px 50px -12px hsl(210 10% 3% / 0.6);\n\n  /* Fallback for older browsers */\n  --sidebar-primary-border: hsl(var(--sidebar-primary));\n  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --sidebar-accent-border: hsl(var(--sidebar-accent));\n  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --primary-border: hsl(var(--primary));\n  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --secondary-border: hsl(var(--secondary));\n  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --muted-border: hsl(var(--muted));\n  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --accent-border: hsl(var(--accent));\n  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --destructive-border: hsl(var(--destructive));\n  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n}\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n\n  body {\n    @apply font-sans antialiased bg-background text-foreground;\n  }\n}\n\n/**\n * Using the elevate system.\n * Automatic contrast adjustment.\n *\n * <element className=\"hover-elevate\" />\n * <element className=\"active-elevate-2\" />\n *\n * // Using the tailwind utility when a data attribute is \"on\"\n * <element className=\"toggle-elevate data-[state=on]:toggle-elevated\" />\n * // Or manually controlling the toggle state\n * <element className=\"toggle-elevate toggle-elevated\" />\n *\n * Elevation systems have to handle many states.\n * - not-hovered, vs. hovered vs. active  (three mutually exclusive states)\n * - toggled or not\n * - focused or not (this is not handled with these utilities)\n *\n * Even without handling focused or not, this is six possible combinations that\n * need to be distinguished from eachother visually.\n */\n@layer utilities {\n\n  /* Hide ugly search cancel button in Chrome until we can style it properly */\n  input[type=\"search\"]::-webkit-search-cancel-button {\n    @apply hidden;\n  }\n\n  /* Placeholder styling for contentEditable div */\n  [contenteditable][data-placeholder]:empty::before {\n    content: attr(data-placeholder);\n    color: hsl(var(--muted-foreground));\n    pointer-events: none;\n  }\n\n  /* .no-default-hover-elevate/no-default-active-elevate is an escape hatch so consumers of\n   * buttons/badges can remove the automatic brightness adjustment on interactions\n   * and program their own. */\n  .no-default-hover-elevate {}\n\n  .no-default-active-elevate {}\n\n\n  /**\n   * Toggleable backgrounds go behind the content. Hoverable/active goes on top.\n   * This way they can stack/compound. Both will overlap the parent's borders!\n   * So borders will be automatically adjusted both on toggle, and hover/active,\n   * and they will be compounded.\n   */\n  .toggle-elevate::before,\n  .toggle-elevate-2::before {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    /*border-radius: inherit;   match rounded corners */\n    border-radius: inherit;\n    z-index: -1;\n    /* sits behind content but above backdrop */\n  }\n\n  .toggle-elevate.toggle-elevated::before {\n    background-color: var(--elevate-2);\n  }\n\n  /* If there's a 1px border, adjust the inset so that it covers that parent's border */\n  .border.toggle-elevate::before {\n    inset: -1px;\n  }\n\n  /* Does not work on elements with overflow:hidden! */\n  .hover-elevate:not(.no-default-hover-elevate),\n  .active-elevate:not(.no-default-active-elevate),\n  .hover-elevate-2:not(.no-default-hover-elevate),\n  .active-elevate-2:not(.no-default-active-elevate) {\n    position: relative;\n    z-index: 0;\n  }\n\n  .hover-elevate:not(.no-default-hover-elevate)::after,\n  .active-elevate:not(.no-default-active-elevate)::after,\n  .hover-elevate-2:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:not(.no-default-active-elevate)::after {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    /*border-radius: inherit;   match rounded corners */\n    border-radius: inherit;\n    z-index: 999;\n    /* sits in front of content */\n  }\n\n  .hover-elevate:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-1);\n  }\n\n  .hover-elevate-2:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-2);\n  }\n\n  /* If there's a 1px border, adjust the inset so that it covers that parent's border */\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate-2:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate-2:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after {\n    inset: -1px;\n  }\n}","size_bytes":11198},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","size_bytes":2712},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","size_bytes":4845},"client/src/components/examples/ThemeToggle.tsx":{"content":"import { ThemeToggle } from '../ThemeToggle'\n\nexport default function ThemeToggleExample() {\n  return <ThemeToggle />\n}\n","size_bytes":120},"client/src/pages/NewOrderPage.tsx":{"content":"import { ProgressStepper } from \"@/components/ProgressStepper\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { useState } from \"react\";\nimport { ChevronLeft, ChevronRight } from \"lucide-react\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useLocation } from \"wouter\";\nimport { isUnauthorizedError } from \"@/lib/authUtils\";\nimport { OMAFileUpload } from \"@/components/OMAFileUpload\";\n\nconst steps = [\n  { label: \"Patient Info\", description: \"Basic details\" },\n  { label: \"Prescription\", description: \"Rx values\" },\n  { label: \"Lens & Frame\", description: \"Product selection\" },\n  { label: \"Review\", description: \"Confirm order\" },\n];\n\nexport default function NewOrderPage() {\n  const [currentStep, setCurrentStep] = useState(0);\n  const { toast } = useToast();\n  const [, setLocation] = useLocation();\n  \n  const [formData, setFormData] = useState({\n    patientName: \"\",\n    patientDOB: \"\",\n    customerReferenceNumber: \"\",\n    odSphere: \"\",\n    odCylinder: \"\",\n    odAxis: \"\",\n    odAdd: \"\",\n    osSphere: \"\",\n    osCylinder: \"\",\n    osAxis: \"\",\n    osAdd: \"\",\n    pd: \"\",\n    traceFileUrl: \"\",\n    lensType: \"\",\n    lensMaterial: \"\",\n    coating: \"\",\n    frameType: \"\",\n    notes: \"\",\n    omaFileContent: \"\",\n    omaFilename: \"\",\n  });\n\n  const createOrderMutation = useMutation({\n    mutationFn: async (data: Record<string, unknown>) => {\n      const response = await apiRequest(\"POST\", \"/api/orders\", data);\n      return await response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/orders'] });\n      toast({\n        title: \"Order created successfully\",\n        description: \"Your lens order has been submitted.\",\n      });\n      setLocation(\"/ecp/dashboard\");\n    },\n    onError: (error: Error) => {\n      if (isUnauthorizedError(error)) {\n        toast({\n          title: \"Session expired\",\n          description: \"Please log in again to continue.\",\n          variant: \"destructive\",\n        });\n        window.location.href = \"/api/login\";\n      } else {\n        toast({\n          title: \"Failed to create order\",\n          description: error.message,\n          variant: \"destructive\",\n        });\n      }\n    },\n  });\n\n  const handleNext = () => {\n    if (currentStep < steps.length - 1) {\n      setCurrentStep(currentStep + 1);\n    } else {\n      handleSubmit();\n    }\n  };\n\n  const handleBack = () => {\n    if (currentStep > 0) {\n      setCurrentStep(currentStep - 1);\n    }\n  };\n\n  const handleSubmit = () => {\n    if (!formData.patientName || !formData.lensType || !formData.lensMaterial || !formData.coating) {\n      toast({\n        title: \"Missing required fields\",\n        description: \"Please fill in all required fields.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    const orderData = {\n      patientName: formData.patientName,\n      patientDOB: formData.patientDOB || undefined,\n      customerReferenceNumber: formData.customerReferenceNumber || undefined,\n      odSphere: formData.odSphere || undefined,\n      odCylinder: formData.odCylinder || undefined,\n      odAxis: formData.odAxis || undefined,\n      odAdd: formData.odAdd || undefined,\n      osSphere: formData.osSphere || undefined,\n      osCylinder: formData.osCylinder || undefined,\n      osAxis: formData.osAxis || undefined,\n      osAdd: formData.osAdd || undefined,\n      pd: formData.pd || undefined,\n      traceFileUrl: formData.traceFileUrl || undefined,\n      lensType: formData.lensType,\n      lensMaterial: formData.lensMaterial,\n      coating: formData.coating,\n      frameType: formData.frameType || undefined,\n      notes: formData.notes || undefined,\n      omaFileContent: formData.omaFileContent || undefined,\n      omaFilename: formData.omaFilename || undefined,\n      status: \"pending\" as const,\n    };\n\n    createOrderMutation.mutate(orderData);\n  };\n\n  const updateFormData = (field: string, value: string) => {\n    setFormData({ ...formData, [field]: value });\n  };\n\n  return (\n    <div className=\"max-w-4xl mx-auto space-y-8\">\n      <div>\n        <h1 className=\"text-2xl font-semibold\">Create New Order</h1>\n        <p className=\"text-muted-foreground mt-1\">\n          Complete the form to submit a new lens order.\n        </p>\n      </div>\n\n      <ProgressStepper steps={steps} currentStep={currentStep} />\n\n      <Card>\n        <CardHeader>\n          <CardTitle>{steps[currentStep].label}</CardTitle>\n        </CardHeader>\n        <CardContent className=\"space-y-6\">\n          {currentStep === 0 && (\n            <div className=\"space-y-4\">\n              <div>\n                <Label htmlFor=\"patient-name\">Patient Name *</Label>\n                <Input\n                  id=\"patient-name\"\n                  value={formData.patientName}\n                  onChange={(e) => updateFormData(\"patientName\", e.target.value)}\n                  placeholder=\"Enter patient full name\"\n                  data-testid=\"input-patient-name\"\n                />\n              </div>\n              <div>\n                <Label htmlFor=\"patient-dob\">Date of Birth</Label>\n                <Input\n                  id=\"patient-dob\"\n                  type=\"date\"\n                  value={formData.patientDOB}\n                  onChange={(e) => updateFormData(\"patientDOB\", e.target.value)}\n                  data-testid=\"input-patient-dob\"\n                />\n              </div>\n              <div>\n                <Label htmlFor=\"customer-reference\">Customer Reference</Label>\n                <Input\n                  id=\"customer-reference\"\n                  value={formData.customerReferenceNumber}\n                  onChange={(e) => updateFormData(\"customerReferenceNumber\", e.target.value)}\n                  placeholder=\"Enter your internal reference number (optional)\"\n                  data-testid=\"input-customer-reference\"\n                />\n                <p className=\"text-xs text-muted-foreground mt-1\">\n                  Add your own reference number or ID to track this order in your system.\n                </p>\n              </div>\n            </div>\n          )}\n\n          {currentStep === 1 && (\n            <div className=\"space-y-6\">\n              <div>\n                <h3 className=\"font-semibold mb-4\">OD (Right Eye)</h3>\n                <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n                  <div>\n                    <Label htmlFor=\"od-sphere\">Sphere</Label>\n                    <Input\n                      id=\"od-sphere\"\n                      value={formData.odSphere}\n                      onChange={(e) => updateFormData(\"odSphere\", e.target.value)}\n                      placeholder=\"e.g., -2.50\"\n                      className=\"font-mono\"\n                      data-testid=\"input-od-sphere\"\n                    />\n                  </div>\n                  <div>\n                    <Label htmlFor=\"od-cylinder\">Cylinder</Label>\n                    <Input\n                      id=\"od-cylinder\"\n                      value={formData.odCylinder}\n                      onChange={(e) => updateFormData(\"odCylinder\", e.target.value)}\n                      placeholder=\"e.g., -0.75\"\n                      className=\"font-mono\"\n                      data-testid=\"input-od-cylinder\"\n                    />\n                  </div>\n                  <div>\n                    <Label htmlFor=\"od-axis\">Axis</Label>\n                    <Input\n                      id=\"od-axis\"\n                      value={formData.odAxis}\n                      onChange={(e) => updateFormData(\"odAxis\", e.target.value)}\n                      placeholder=\"e.g., 180\"\n                      className=\"font-mono\"\n                      data-testid=\"input-od-axis\"\n                    />\n                  </div>\n                  <div>\n                    <Label htmlFor=\"od-add\">Add</Label>\n                    <Input\n                      id=\"od-add\"\n                      value={formData.odAdd}\n                      onChange={(e) => updateFormData(\"odAdd\", e.target.value)}\n                      placeholder=\"e.g., +2.00\"\n                      className=\"font-mono\"\n                      data-testid=\"input-od-add\"\n                    />\n                  </div>\n                </div>\n              </div>\n\n              <div>\n                <h3 className=\"font-semibold mb-4\">OS (Left Eye)</h3>\n                <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n                  <div>\n                    <Label htmlFor=\"os-sphere\">Sphere</Label>\n                    <Input\n                      id=\"os-sphere\"\n                      value={formData.osSphere}\n                      onChange={(e) => updateFormData(\"osSphere\", e.target.value)}\n                      placeholder=\"e.g., -2.25\"\n                      className=\"font-mono\"\n                      data-testid=\"input-os-sphere\"\n                    />\n                  </div>\n                  <div>\n                    <Label htmlFor=\"os-cylinder\">Cylinder</Label>\n                    <Input\n                      id=\"os-cylinder\"\n                      value={formData.osCylinder}\n                      onChange={(e) => updateFormData(\"osCylinder\", e.target.value)}\n                      placeholder=\"e.g., -0.50\"\n                      className=\"font-mono\"\n                      data-testid=\"input-os-cylinder\"\n                    />\n                  </div>\n                  <div>\n                    <Label htmlFor=\"os-axis\">Axis</Label>\n                    <Input\n                      id=\"os-axis\"\n                      value={formData.osAxis}\n                      onChange={(e) => updateFormData(\"osAxis\", e.target.value)}\n                      placeholder=\"e.g., 90\"\n                      className=\"font-mono\"\n                      data-testid=\"input-os-axis\"\n                    />\n                  </div>\n                  <div>\n                    <Label htmlFor=\"os-add\">Add</Label>\n                    <Input\n                      id=\"os-add\"\n                      value={formData.osAdd}\n                      onChange={(e) => updateFormData(\"osAdd\", e.target.value)}\n                      placeholder=\"e.g., +2.00\"\n                      className=\"font-mono\"\n                      data-testid=\"input-os-add\"\n                    />\n                  </div>\n                </div>\n              </div>\n\n              <div>\n                <Label htmlFor=\"pd\">Pupillary Distance (PD)</Label>\n                <Input\n                  id=\"pd\"\n                  value={formData.pd}\n                  onChange={(e) => updateFormData(\"pd\", e.target.value)}\n                  placeholder=\"e.g., 63\"\n                  className=\"font-mono max-w-32\"\n                  data-testid=\"input-pd\"\n                />\n              </div>\n\n              <div className=\"pt-4 border-t\">\n                <h3 className=\"font-semibold mb-2\">Digital Trace File (Optional)</h3>\n                <p className=\"text-sm text-muted-foreground mb-4\">\n                  Upload a digital trace file from your edging system for precision frame measurements.\n                </p>\n                <div>\n                  <Label htmlFor=\"trace-file\">Trace File URL</Label>\n                  <Input\n                    id=\"trace-file\"\n                    value={formData.traceFileUrl}\n                    onChange={(e) => updateFormData(\"traceFileUrl\", e.target.value)}\n                    placeholder=\"https://example.com/trace-files/trace123.xml\"\n                    data-testid=\"input-trace-file\"\n                  />\n                  <p className=\"text-xs text-muted-foreground mt-1\">\n                    Enter the URL of the uploaded trace file (OMA, XML, or CSV format).\n                  </p>\n                </div>\n              </div>\n            </div>\n          )}\n\n          {currentStep === 2 && (\n            <div className=\"space-y-4\">\n              <div>\n                <Label htmlFor=\"lens-type\">Lens Type *</Label>\n                <Select\n                  value={formData.lensType}\n                  onValueChange={(value) => updateFormData(\"lensType\", value)}\n                >\n                  <SelectTrigger id=\"lens-type\" data-testid=\"select-lens-type\">\n                    <SelectValue placeholder=\"Select lens type\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"Single Vision\">Single Vision</SelectItem>\n                    <SelectItem value=\"Bifocal\">Bifocal</SelectItem>\n                    <SelectItem value=\"Progressive\">Progressive</SelectItem>\n                    <SelectItem value=\"Reading\">Reading</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n\n              <div>\n                <Label htmlFor=\"lens-material\">Lens Material *</Label>\n                <Select\n                  value={formData.lensMaterial}\n                  onValueChange={(value) => updateFormData(\"lensMaterial\", value)}\n                >\n                  <SelectTrigger id=\"lens-material\" data-testid=\"select-lens-material\">\n                    <SelectValue placeholder=\"Select material\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"CR-39\">CR-39 (Standard Plastic)</SelectItem>\n                    <SelectItem value=\"Polycarbonate\">Polycarbonate</SelectItem>\n                    <SelectItem value=\"Trivex\">Trivex</SelectItem>\n                    <SelectItem value=\"High-Index 1.67\">High-Index 1.67</SelectItem>\n                    <SelectItem value=\"High-Index 1.74\">High-Index 1.74</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n\n              <div>\n                <Label htmlFor=\"coating\">Coating *</Label>\n                <Select\n                  value={formData.coating}\n                  onValueChange={(value) => updateFormData(\"coating\", value)}\n                >\n                  <SelectTrigger id=\"coating\" data-testid=\"select-coating\">\n                    <SelectValue placeholder=\"Select coating\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"None\">None</SelectItem>\n                    <SelectItem value=\"Anti-Reflective\">Anti-Reflective</SelectItem>\n                    <SelectItem value=\"Scratch Resistant\">Scratch Resistant</SelectItem>\n                    <SelectItem value=\"Blue Light Filter\">Blue Light Filter</SelectItem>\n                    <SelectItem value=\"Photochromic\">Photochromic (Transitions)</SelectItem>\n                    <SelectItem value=\"Polarized\">Polarized</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n\n              <div>\n                <Label htmlFor=\"frame-type\">Frame Type</Label>\n                <Select\n                  value={formData.frameType}\n                  onValueChange={(value) => updateFormData(\"frameType\", value)}\n                >\n                  <SelectTrigger id=\"frame-type\" data-testid=\"select-frame-type\">\n                    <SelectValue placeholder=\"Select frame type\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"Full Rim\">Full Rim</SelectItem>\n                    <SelectItem value=\"Semi-Rimless\">Semi-Rimless</SelectItem>\n                    <SelectItem value=\"Rimless\">Rimless</SelectItem>\n                    <SelectItem value=\"Sport\">Sport</SelectItem>\n                    <SelectItem value=\"Safety\">Safety</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n\n              <div className=\"pt-4 border-t\">\n                <h3 className=\"font-semibold mb-2\">OMA File (Optional)</h3>\n                <p className=\"text-sm text-muted-foreground mb-4\">\n                  Upload an OMA file from your tracer for precise prescription and frame measurements.\n                </p>\n                <OMAFileUpload\n                  showInline={true}\n                  onFileSelect={(content, filename) => {\n                    updateFormData(\"omaFileContent\", content);\n                    updateFormData(\"omaFilename\", filename);\n                  }}\n                />\n              </div>\n            </div>\n          )}\n\n          {currentStep === 3 && (\n            <div className=\"space-y-6\">\n              <div>\n                <h3 className=\"font-semibold mb-2\">Patient Information</h3>\n                <div className=\"text-sm space-y-1\">\n                  <p><span className=\"text-muted-foreground\">Name:</span> {formData.patientName}</p>\n                  {formData.patientDOB && <p><span className=\"text-muted-foreground\">DOB:</span> {formData.patientDOB}</p>}\n                  {formData.customerReferenceNumber && <p><span className=\"text-muted-foreground\">Customer Reference:</span> {formData.customerReferenceNumber}</p>}\n                </div>\n              </div>\n\n              <div>\n                <h3 className=\"font-semibold mb-2\">Prescription</h3>\n                <div className=\"text-sm font-mono space-y-1\">\n                  {(formData.odSphere || formData.odCylinder || formData.odAxis || formData.odAdd) && (\n                    <p><span className=\"text-muted-foreground\">OD:</span> SPH {formData.odSphere || \"\"} CYL {formData.odCylinder || \"\"} AXIS {formData.odAxis || \"\"} ADD {formData.odAdd || \"\"}</p>\n                  )}\n                  {(formData.osSphere || formData.osCylinder || formData.osAxis || formData.osAdd) && (\n                    <p><span className=\"text-muted-foreground\">OS:</span> SPH {formData.osSphere || \"\"} CYL {formData.osCylinder || \"\"} AXIS {formData.osAxis || \"\"} ADD {formData.osAdd || \"\"}</p>\n                  )}\n                  {formData.pd && <p><span className=\"text-muted-foreground\">PD:</span> {formData.pd}</p>}\n                </div>\n              </div>\n\n              <div>\n                <h3 className=\"font-semibold mb-2\">Lens Specifications</h3>\n                <div className=\"text-sm space-y-1\">\n                  <p><span className=\"text-muted-foreground\">Type:</span> {formData.lensType}</p>\n                  <p><span className=\"text-muted-foreground\">Material:</span> {formData.lensMaterial}</p>\n                  <p><span className=\"text-muted-foreground\">Coating:</span> {formData.coating}</p>\n                  {formData.frameType && <p><span className=\"text-muted-foreground\">Frame:</span> {formData.frameType}</p>}\n                </div>\n              </div>\n\n              <div>\n                <Label htmlFor=\"notes\">Additional Notes</Label>\n                <Textarea\n                  id=\"notes\"\n                  value={formData.notes}\n                  onChange={(e) => updateFormData(\"notes\", e.target.value)}\n                  placeholder=\"Any special instructions or notes...\"\n                  rows={4}\n                  data-testid=\"textarea-notes\"\n                />\n              </div>\n            </div>\n          )}\n\n          <div className=\"flex justify-between pt-4\">\n            <Button\n              variant=\"outline\"\n              onClick={handleBack}\n              disabled={currentStep === 0}\n              data-testid=\"button-back\"\n            >\n              <ChevronLeft className=\"h-4 w-4 mr-2\" />\n              Back\n            </Button>\n            <Button\n              onClick={handleNext}\n              disabled={createOrderMutation.isPending}\n              data-testid=\"button-next\"\n            >\n              {createOrderMutation.isPending ? (\n                <>Submitting...</>\n              ) : currentStep === steps.length - 1 ? (\n                <>Submit Order</>\n              ) : (\n                <>\n                  Next\n                  <ChevronRight className=\"h-4 w-4 ml-2\" />\n                </>\n              )}\n            </Button>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":20297},"client/src/components/PrescriptionDisplay.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\n\ninterface PrescriptionData {\n  od: {\n    sphere: string;\n    cylinder: string;\n    axis: string;\n    add?: string;\n  };\n  os: {\n    sphere: string;\n    cylinder: string;\n    axis: string;\n    add?: string;\n  };\n  pd?: string;\n}\n\ninterface PrescriptionDisplayProps {\n  prescription: PrescriptionData;\n  className?: string;\n}\n\nexport function PrescriptionDisplay({ prescription, className }: PrescriptionDisplayProps) {\n  return (\n    <Card className={className}>\n      <CardHeader>\n        <CardTitle className=\"text-lg\">Prescription Details</CardTitle>\n      </CardHeader>\n      <CardContent>\n        <div className=\"rounded-md border border-border\">\n          <Table>\n            <TableHeader>\n              <TableRow>\n                <TableHead className=\"font-semibold\">Eye</TableHead>\n                <TableHead className=\"font-semibold text-center\">SPH</TableHead>\n                <TableHead className=\"font-semibold text-center\">CYL</TableHead>\n                <TableHead className=\"font-semibold text-center\">AXIS</TableHead>\n                {prescription.od.add && (\n                  <TableHead className=\"font-semibold text-center\">ADD</TableHead>\n                )}\n              </TableRow>\n            </TableHeader>\n            <TableBody>\n              <TableRow>\n                <TableCell className=\"font-medium\">OD (Right)</TableCell>\n                <TableCell className=\"text-center font-mono\">{prescription.od.sphere}</TableCell>\n                <TableCell className=\"text-center font-mono\">{prescription.od.cylinder}</TableCell>\n                <TableCell className=\"text-center font-mono\">{prescription.od.axis}</TableCell>\n                {prescription.od.add && (\n                  <TableCell className=\"text-center font-mono\">{prescription.od.add}</TableCell>\n                )}\n              </TableRow>\n              <TableRow>\n                <TableCell className=\"font-medium\">OS (Left)</TableCell>\n                <TableCell className=\"text-center font-mono\">{prescription.os.sphere}</TableCell>\n                <TableCell className=\"text-center font-mono\">{prescription.os.cylinder}</TableCell>\n                <TableCell className=\"text-center font-mono\">{prescription.os.axis}</TableCell>\n                {prescription.os.add && (\n                  <TableCell className=\"text-center font-mono\">{prescription.os.add}</TableCell>\n                )}\n              </TableRow>\n            </TableBody>\n          </Table>\n        </div>\n        {prescription.pd && (\n          <div className=\"mt-4 flex items-center gap-2\">\n            <span className=\"text-sm font-medium\">Pupillary Distance (PD):</span>\n            <span className=\"text-sm font-mono\">{prescription.pd} mm</span>\n          </div>\n        )}\n      </CardContent>\n    </Card>\n  );\n}\n","size_bytes":2977},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(`\n      after:content-[''] after:block after:absolute after:inset-0 after:rounded-full after:pointer-events-none after:border after:border-black/10 dark:after:border-white/10\n      relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full`,\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","size_bytes":1592},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","size_bytes":1584},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    // h-9 to match icon buttons and default buttons.\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","size_bytes":844},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n","size_bytes":157},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"shadcn-card rounded-xl border bg-card border-card-border text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n));\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n));\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n));\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\nexport {\n  Card,\n  CardHeader,\n  CardFooter,\n  CardTitle,\n  CardDescription,\n  CardContent,\n}\n","size_bytes":1904},"client/src/components/examples/OrderCard.tsx":{"content":"import { OrderCard } from '../OrderCard'\n\nexport default function OrderCardExample() {\n  return (\n    <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 max-w-6xl\">\n      <OrderCard\n        orderId=\"ORD-2024-1001\"\n        patientName=\"John Smith\"\n        ecp=\"Vision Care Center\"\n        status=\"in_production\"\n        orderDate=\"2024-10-20\"\n        lensType=\"Progressive\"\n        coating=\"Anti-Reflective\"\n        onViewDetails={() => console.log('View details clicked')}\n      />\n      <OrderCard\n        orderId=\"ORD-2024-1002\"\n        patientName=\"Sarah Johnson\"\n        ecp=\"Eye Health Associates\"\n        status=\"quality_check\"\n        orderDate=\"2024-10-21\"\n        lensType=\"Single Vision\"\n        coating=\"Blue Light Filter\"\n        onViewDetails={() => console.log('View details clicked')}\n      />\n      <OrderCard\n        orderId=\"ORD-2024-1003\"\n        patientName=\"Michael Chen\"\n        ecp=\"Clarity Optical\"\n        status=\"shipped\"\n        orderDate=\"2024-10-19\"\n        lensType=\"Bifocal\"\n        coating=\"Scratch Resistant\"\n        onViewDetails={() => console.log('View details clicked')}\n      />\n    </div>\n  )\n}\n","size_bytes":1152},"client/src/components/OrderCard.tsx":{"content":"import { Card, CardContent, CardHeader } from \"@/components/ui/card\";\nimport { StatusBadge, type OrderStatus } from \"./StatusBadge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Eye, Download } from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\n\ninterface OrderCardProps {\n  orderId: string;\n  patientName: string;\n  ecp: string;\n  status: OrderStatus;\n  orderDate: string;\n  lensType?: string;\n  coating?: string;\n  onViewDetails?: () => void;\n  className?: string;\n}\n\nexport function OrderCard({\n  orderId,\n  patientName,\n  ecp,\n  status,\n  orderDate,\n  lensType,\n  coating,\n  onViewDetails,\n  className,\n}: OrderCardProps) {\n  return (\n    <Card className={cn(\"hover-elevate\", className)} data-testid={`card-order-${orderId}`}>\n      <CardHeader className=\"flex flex-row items-center justify-between gap-4 space-y-0 pb-2\">\n        <div className=\"flex-1 min-w-0\">\n          <h3 className=\"font-semibold text-lg\" data-testid={`text-order-id-${orderId}`}>\n            Order #{orderId}\n          </h3>\n          <p className=\"text-sm text-muted-foreground truncate\" data-testid={`text-patient-${orderId}`}>\n            {patientName}\n          </p>\n        </div>\n        <StatusBadge status={status} />\n      </CardHeader>\n      <CardContent>\n        <div className=\"grid grid-cols-2 gap-4 text-sm\">\n          <div>\n            <p className=\"text-muted-foreground\">ECP</p>\n            <p className=\"font-medium\" data-testid={`text-ecp-${orderId}`}>{ecp}</p>\n          </div>\n          <div>\n            <p className=\"text-muted-foreground\">Order Date</p>\n            <p className=\"font-medium\">{orderDate}</p>\n          </div>\n          {lensType && (\n            <div>\n              <p className=\"text-muted-foreground\">Lens Type</p>\n              <p className=\"font-medium\">{lensType}</p>\n            </div>\n          )}\n          {coating && (\n            <div>\n              <p className=\"text-muted-foreground\">Coating</p>\n              <p className=\"font-medium\">{coating}</p>\n            </div>\n          )}\n        </div>\n        <div className=\"flex gap-2 mt-4\">\n          <Button\n            variant=\"outline\"\n            size=\"sm\"\n            className=\"flex-1\"\n            onClick={onViewDetails}\n            data-testid={`button-view-order-${orderId}`}\n          >\n            <Eye className=\"h-4 w-4 mr-2\" />\n            View Details\n          </Button>\n          <Button\n            variant=\"ghost\"\n            size=\"sm\"\n            data-testid={`button-download-${orderId}`}\n          >\n            <Download className=\"h-4 w-4\" />\n          </Button>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","size_bytes":2640},"client/src/components/ui/sidebar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, VariantProps } from \"class-variance-authority\"\nimport { PanelLeftIcon } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nfunction SidebarProvider({\n  defaultOpen = true,\n  open: openProp,\n  onOpenChange: setOpenProp,\n  className,\n  style,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  defaultOpen?: boolean\n  open?: boolean\n  onOpenChange?: (open: boolean) => void\n}) {\n  const isMobile = useIsMobile()\n  const [openMobile, setOpenMobile] = React.useState(false)\n\n  // This is the internal state of the sidebar.\n  // We use openProp and setOpenProp for control from outside the component.\n  const [_open, _setOpen] = React.useState(defaultOpen)\n  const open = openProp ?? _open\n  const setOpen = React.useCallback(\n    (value: boolean | ((value: boolean) => boolean)) => {\n      const openState = typeof value === \"function\" ? value(open) : value\n      if (setOpenProp) {\n        setOpenProp(openState)\n      } else {\n        _setOpen(openState)\n      }\n\n      // This sets the cookie to keep the sidebar state.\n      document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n    },\n    [setOpenProp, open]\n  )\n\n  // Helper to toggle the sidebar.\n  const toggleSidebar = React.useCallback(() => {\n    return isMobile ? setOpenMobile((open) => !open) : setOpen((open) => !open)\n  }, [isMobile, setOpen, setOpenMobile])\n\n  // Adds a keyboard shortcut to toggle the sidebar.\n  React.useEffect(() => {\n    const handleKeyDown = (event: KeyboardEvent) => {\n      if (\n        event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n        (event.metaKey || event.ctrlKey)\n      ) {\n        event.preventDefault()\n        toggleSidebar()\n      }\n    }\n\n    window.addEventListener(\"keydown\", handleKeyDown)\n    return () => window.removeEventListener(\"keydown\", handleKeyDown)\n  }, [toggleSidebar])\n\n  // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n  // This makes it easier to style the sidebar with Tailwind classes.\n  const state = open ? \"expanded\" : \"collapsed\"\n\n  const contextValue = React.useMemo<SidebarContextProps>(\n    () => ({\n      state,\n      open,\n      setOpen,\n      isMobile,\n      openMobile,\n      setOpenMobile,\n      toggleSidebar,\n    }),\n    [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n  )\n\n  return (\n    <SidebarContext.Provider value={contextValue}>\n      <TooltipProvider delayDuration={0}>\n        <div\n          data-slot=\"sidebar-wrapper\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH,\n              \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n              ...style,\n            } as React.CSSProperties\n          }\n          className={cn(\n            \"group/sidebar-wrapper has-data-[variant=inset]:bg-sidebar flex min-h-svh w-full\",\n            className\n          )}\n          {...props}\n        >\n          {children}\n        </div>\n      </TooltipProvider>\n    </SidebarContext.Provider>\n  )\n}\n\nfunction Sidebar({\n  side = \"left\",\n  variant = \"sidebar\",\n  collapsible = \"offcanvas\",\n  className,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  side?: \"left\" | \"right\"\n  variant?: \"sidebar\" | \"floating\" | \"inset\"\n  collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n}) {\n  const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n  if (collapsible === \"none\") {\n    return (\n      <div\n        data-slot=\"sidebar\"\n        className={cn(\n          \"bg-sidebar text-sidebar-foreground flex h-full w-[var(--sidebar-width)] flex-col\",\n          className\n        )}\n        {...props}\n      >\n        {children}\n      </div>\n    )\n  }\n\n  if (isMobile) {\n    return (\n      <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n        <SheetContent\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar\"\n          data-mobile=\"true\"\n          className=\"bg-sidebar text-sidebar-foreground w-[var(--sidebar-width)] p-0 [&>button]:hidden\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n            } as React.CSSProperties\n          }\n          side={side}\n        >\n          <SheetHeader className=\"sr-only\">\n            <SheetTitle>Sidebar</SheetTitle>\n            <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n          </SheetHeader>\n          <div className=\"flex h-full w-full flex-col\">{children}</div>\n        </SheetContent>\n      </Sheet>\n    )\n  }\n\n  return (\n    <div\n      className=\"group peer text-sidebar-foreground hidden md:block\"\n      data-state={state}\n      data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n      data-variant={variant}\n      data-side={side}\n      data-slot=\"sidebar\"\n    >\n      {/* This is what handles the sidebar gap on desktop */}\n      <div\n        data-slot=\"sidebar-gap\"\n        className={cn(\n          \"relative w-[var(--sidebar-width)] bg-transparent transition-[width] duration-200 ease-linear\",\n          \"group-data-[collapsible=offcanvas]:w-0\",\n          \"group-data-[side=right]:rotate-180\",\n          variant === \"floating\" || variant === \"inset\"\n            ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4))]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)]\"\n        )}\n      />\n      <div\n        data-slot=\"sidebar-container\"\n        className={cn(\n          \"fixed inset-y-0 z-10 hidden h-svh w-[var(--sidebar-width)] transition-[left,right,width] duration-200 ease-linear md:flex\",\n          side === \"left\"\n            ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n            : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n          // Adjust the padding for floating and inset variants.\n          variant === \"floating\" || variant === \"inset\"\n            ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4)+2px)]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n          className\n        )}\n        {...props}\n      >\n        <div\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar-inner\"\n          className=\"bg-sidebar group-data-[variant=floating]:border-sidebar-border flex h-full w-full flex-col group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:shadow-sm\"\n        >\n          {children}\n        </div>\n      </div>\n    </div>\n  )\n}\n\nfunction SidebarTrigger({\n  className,\n  onClick,\n  ...props\n}: React.ComponentProps<typeof Button>) {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      data-sidebar=\"trigger\"\n      data-slot=\"sidebar-trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeftIcon />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n}\n\nfunction SidebarRail({ className, ...props }: React.ComponentProps<\"button\">) {\n  const { toggleSidebar } = useSidebar()\n\n  // Note: Tailwind v3.4 doesn't support \"in-\" selectors. So the rail won't work perfectly.\n  return (\n    <button\n      data-sidebar=\"rail\"\n      data-slot=\"sidebar-rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"hover:after:bg-sidebar-border absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear group-data-[side=left]:-right-4 group-data-[side=right]:left-0 after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] sm:flex\",\n        \"in-data-[side=left]:cursor-w-resize in-data-[side=right]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"hover:group-data-[collapsible=offcanvas]:bg-sidebar group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInset({ className, ...props }: React.ComponentProps<\"main\">) {\n  return (\n    <main\n      data-slot=\"sidebar-inset\"\n      className={cn(\n        \"bg-background relative flex w-full flex-1 flex-col\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow-sm md:peer-data-[variant=inset]:peer-data-[state=collapsed]:ml-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInput({\n  className,\n  ...props\n}: React.ComponentProps<typeof Input>) {\n  return (\n    <Input\n      data-slot=\"sidebar-input\"\n      data-sidebar=\"input\"\n      className={cn(\"bg-background h-8 w-full shadow-none\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-header\"\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarFooter({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-footer\"\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarSeparator({\n  className,\n  ...props\n}: React.ComponentProps<typeof Separator>) {\n  return (\n    <Separator\n      data-slot=\"sidebar-separator\"\n      data-sidebar=\"separator\"\n      className={cn(\"bg-sidebar-border mx-2 w-auto\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-content\"\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group\"\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupLabel({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"div\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-label\"\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"text-sidebar-foreground/70 ring-sidebar-ring flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium outline-hidden transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:h-4 [&>svg]:w-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupAction({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"button\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-action\"\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground absolute top-3.5 right-3 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupContent({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group-content\"\n      data-sidebar=\"group-content\"\n      className={cn(\"w-full text-sm\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenu({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu\"\n      data-sidebar=\"menu\"\n      className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuItem({ className, ...props }: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-item\"\n      data-sidebar=\"menu-item\"\n      className={cn(\"group/menu-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-hidden ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-data-[sidebar=menu-action]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:w-8! group-data-[collapsible=icon]:h-8! group-data-[collapsible=icon]:p-2! [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:p-0!\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nfunction SidebarMenuButton({\n  asChild = false,\n  isActive = false,\n  variant = \"default\",\n  size = \"default\",\n  tooltip,\n  className,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  isActive?: boolean\n  tooltip?: string | React.ComponentProps<typeof TooltipContent>\n} & VariantProps<typeof sidebarMenuButtonVariants>) {\n  const Comp = asChild ? Slot : \"button\"\n  const { isMobile, state } = useSidebar()\n\n  const button = (\n    <Comp\n      data-slot=\"sidebar-menu-button\"\n      data-sidebar=\"menu-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n      {...props}\n    />\n  )\n\n  if (!tooltip) {\n    return button\n  }\n\n  if (typeof tooltip === \"string\") {\n    tooltip = {\n      children: tooltip,\n    }\n  }\n\n  return (\n    <Tooltip>\n      <TooltipTrigger asChild>{button}</TooltipTrigger>\n      <TooltipContent\n        side=\"right\"\n        align=\"center\"\n        hidden={state !== \"collapsed\" || isMobile}\n        {...tooltip}\n      />\n    </Tooltip>\n  )\n}\n\nfunction SidebarMenuAction({\n  className,\n  asChild = false,\n  showOnHover = false,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  showOnHover?: boolean\n}) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-action\"\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground peer-hover/menu-button:text-sidebar-accent-foreground absolute top-1.5 right-1 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"peer-data-[active=true]/menu-button:text-sidebar-accent-foreground group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuBadge({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-menu-badge\"\n      data-sidebar=\"menu-badge\"\n      className={cn(\n        \"text-sidebar-foreground pointer-events-none absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums select-none\",\n        \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSkeleton({\n  className,\n  showIcon = false,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  showIcon?: boolean\n}) {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      data-slot=\"sidebar-menu-skeleton\"\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[var(--skeleton-width)] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n}\n\nfunction SidebarMenuSub({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu-sub\"\n      data-sidebar=\"menu-sub\"\n      className={cn(\n        \"border-sidebar-border mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l px-2.5 py-0.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubItem({\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-sub-item\"\n      data-sidebar=\"menu-sub-item\"\n      className={cn(\"group/menu-sub-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubButton({\n  asChild = false,\n  size = \"md\",\n  isActive = false,\n  className,\n  ...props\n}: React.ComponentProps<\"a\"> & {\n  asChild?: boolean\n  size?: \"sm\" | \"md\"\n  isActive?: boolean\n}) {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-sub-button\"\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground active:bg-sidebar-accent active:text-sidebar-accent-foreground [&>svg]:text-sidebar-accent-foreground flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 outline outline-2 outline-transparent outline-offset-2 focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","size_bytes":21846},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","size_bytes":1056},"client/src/pages/ECPDashboard.tsx":{"content":"import { StatCard } from \"@/components/StatCard\";\nimport { OrderCard } from \"@/components/OrderCard\";\nimport { SearchBar } from \"@/components/SearchBar\";\nimport { ConsultLogManager } from \"@/components/ConsultLogManager\";\nimport { Button } from \"@/components/ui/button\";\nimport { Package, Clock, CheckCircle, AlertCircle, Plus } from \"lucide-react\";\nimport { useState, useEffect } from \"react\";\nimport { Link, useLocation } from \"wouter\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { isUnauthorizedError } from \"@/lib/authUtils\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport type { OrderWithDetails } from \"@shared/schema\";\n\ninterface OrderStats {\n  total: number;\n  pending: number;\n  inProduction: number;\n  completed: number;\n}\n\nexport default function ECPDashboard() {\n  const [searchValue, setSearchValue] = useState(\"\");\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n\n  const { data: stats, isLoading: statsLoading, error: statsError } = useQuery<OrderStats>({\n    queryKey: [\"/api/stats\"],\n  });\n\n  const { data: orders, isLoading: ordersLoading, error: ordersError } = useQuery<OrderWithDetails[]>({\n    queryKey: [\"/api/orders\"],\n  });\n\n  useEffect(() => {\n    if (statsError && isUnauthorizedError(statsError as Error)) {\n      toast({\n        title: \"Session expired\",\n        description: \"Please log in again to continue.\",\n        variant: \"destructive\",\n      });\n      window.location.href = \"/api/login\";\n    }\n  }, [statsError, toast]);\n\n  useEffect(() => {\n    if (ordersError && isUnauthorizedError(ordersError as Error)) {\n      toast({\n        title: \"Session expired\",\n        description: \"Please log in again to continue.\",\n        variant: \"destructive\",\n      });\n      window.location.href = \"/api/login\";\n    }\n  }, [ordersError, toast]);\n\n  const recentOrders = orders?.slice(0, 6) || [];\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex flex-wrap items-center justify-between gap-4\">\n        <div>\n          <h1 className=\"text-2xl font-semibold\">Dashboard</h1>\n          <p className=\"text-muted-foreground mt-1\">\n            Welcome back! Here's your order overview.\n          </p>\n        </div>\n        <Link href=\"/ecp/new-order\">\n          <Button data-testid=\"button-new-order\">\n            <Plus className=\"h-4 w-4 mr-2\" />\n            New Order\n          </Button>\n        </Link>\n      </div>\n\n      {statsLoading ? (\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\n          {[1, 2, 3, 4].map((i) => (\n            <div key={i} className=\"h-32 bg-card rounded-md animate-pulse\" />\n          ))}\n        </div>\n      ) : (\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\n          <StatCard\n            title=\"Total Orders\"\n            value={stats?.total.toString() || \"0\"}\n            icon={Package}\n          />\n          <StatCard\n            title=\"In Production\"\n            value={stats?.inProduction.toString() || \"0\"}\n            icon={Clock}\n          />\n          <StatCard\n            title=\"Completed\"\n            value={stats?.completed.toString() || \"0\"}\n            icon={CheckCircle}\n          />\n          <StatCard\n            title=\"Pending\"\n            value={stats?.pending.toString() || \"0\"}\n            icon={AlertCircle}\n          />\n        </div>\n      )}\n\n      <div className=\"space-y-4\">\n        <div className=\"flex items-center justify-between\">\n          <h2 className=\"text-xl font-semibold\">Recent Orders</h2>\n          <SearchBar\n            value={searchValue}\n            onChange={setSearchValue}\n            placeholder=\"Search orders...\"\n            className=\"max-w-sm\"\n          />\n        </div>\n\n        {ordersLoading ? (\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n            {[1, 2, 3].map((i) => (\n              <div key={i} className=\"h-48 bg-card rounded-md animate-pulse\" />\n            ))}\n          </div>\n        ) : recentOrders.length === 0 ? (\n          <div className=\"text-center py-12\">\n            <Package className=\"h-12 w-12 mx-auto text-muted-foreground mb-4\" />\n            <h3 className=\"text-lg font-semibold mb-2\">No orders yet</h3>\n            <p className=\"text-muted-foreground mb-4\">\n              Get started by creating your first lens order.\n            </p>\n            <Link href=\"/ecp/new-order\">\n              <Button>\n                <Plus className=\"h-4 w-4 mr-2\" />\n                Create Order\n              </Button>\n            </Link>\n          </div>\n        ) : (\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n            {recentOrders.map((order) => (\n              <OrderCard\n                key={order.id}\n                orderId={order.orderNumber}\n                patientName={order.patient.name}\n                ecp={order.ecp.organizationName || `${order.ecp.firstName} ${order.ecp.lastName}`}\n                status={order.status}\n                orderDate={new Date(order.orderDate).toISOString().split('T')[0]}\n                lensType={order.lensType}\n                coating={order.coating}\n                onViewDetails={() => setLocation(`/order/${order.id}`)}\n              />\n            ))}\n          </div>\n        )}\n      </div>\n\n      <ConsultLogManager />\n    </div>\n  );\n}\n","size_bytes":5332},"client/src/components/OrderTable.tsx":{"content":"import {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { StatusBadge, type OrderStatus } from \"./StatusBadge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Eye, MoreVertical } from \"lucide-react\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\n\ninterface Order {\n  id: string;\n  patientName: string;\n  ecp: string;\n  status: OrderStatus;\n  orderDate: string;\n  lensType: string;\n}\n\ninterface OrderTableProps {\n  orders: Order[];\n  onViewDetails?: (orderId: string) => void;\n  onUpdateStatus?: (orderId: string, status: OrderStatus) => void;\n  onShipOrder?: (orderId: string) => void;\n}\n\nexport function OrderTable({ orders, onViewDetails, onUpdateStatus, onShipOrder }: OrderTableProps) {\n  return (\n    <div className=\"rounded-md border border-border bg-card\">\n      <Table>\n        <TableHeader>\n          <TableRow>\n            <TableHead className=\"font-semibold\">Order ID</TableHead>\n            <TableHead className=\"font-semibold\">Patient</TableHead>\n            <TableHead className=\"font-semibold\">ECP</TableHead>\n            <TableHead className=\"font-semibold\">Lens Type</TableHead>\n            <TableHead className=\"font-semibold\">Order Date</TableHead>\n            <TableHead className=\"font-semibold\">Status</TableHead>\n            <TableHead className=\"font-semibold text-right\">Actions</TableHead>\n          </TableRow>\n        </TableHeader>\n        <TableBody>\n          {orders.map((order) => (\n            <TableRow\n              key={order.id}\n              className=\"hover-elevate\"\n              data-testid={`row-order-${order.id}`}\n            >\n              <TableCell className=\"font-mono text-sm font-medium\">\n                {order.id}\n              </TableCell>\n              <TableCell>{order.patientName}</TableCell>\n              <TableCell className=\"text-muted-foreground\">{order.ecp}</TableCell>\n              <TableCell>{order.lensType}</TableCell>\n              <TableCell className=\"text-muted-foreground\">{order.orderDate}</TableCell>\n              <TableCell>\n                <StatusBadge status={order.status} />\n              </TableCell>\n              <TableCell className=\"text-right\">\n                <div className=\"flex items-center justify-end gap-2\">\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    onClick={() => onViewDetails?.(order.id)}\n                    data-testid={`button-view-${order.id}`}\n                  >\n                    <Eye className=\"h-4 w-4 mr-2\" />\n                    View\n                  </Button>\n                  <DropdownMenu>\n                    <DropdownMenuTrigger asChild>\n                      <Button\n                        variant=\"ghost\"\n                        size=\"icon\"\n                        data-testid={`button-menu-${order.id}`}\n                      >\n                        <MoreVertical className=\"h-4 w-4\" />\n                      </Button>\n                    </DropdownMenuTrigger>\n                    <DropdownMenuContent align=\"end\">\n                      <DropdownMenuItem onClick={() => onUpdateStatus?.(order.id, \"in_production\")}>\n                        Start Production\n                      </DropdownMenuItem>\n                      <DropdownMenuItem onClick={() => onUpdateStatus?.(order.id, \"quality_check\")}>\n                        Move to QC\n                      </DropdownMenuItem>\n                      <DropdownMenuItem onClick={() => onShipOrder?.(order.id)}>\n                        Mark as Shipped\n                      </DropdownMenuItem>\n                      <DropdownMenuItem onClick={() => onUpdateStatus?.(order.id, \"on_hold\")}>\n                        Put on Hold\n                      </DropdownMenuItem>\n                    </DropdownMenuContent>\n                  </DropdownMenu>\n                </div>\n              </TableCell>\n            </TableRow>\n          ))}\n        </TableBody>\n      </Table>\n    </div>\n  );\n}\n","size_bytes":4091},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","size_bytes":1977},"shared/schema.ts":{"content":"import { sql } from \"drizzle-orm\";\nimport { pgTable, text, varchar, timestamp, jsonb, index, pgEnum, integer, decimal, boolean } from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\n\n// Session storage table for Replit Auth\nexport const sessions = pgTable(\n  \"sessions\",\n  {\n    sid: varchar(\"sid\").primaryKey(),\n    sess: jsonb(\"sess\").notNull(),\n    expire: timestamp(\"expire\").notNull(),\n  },\n  (table) => [index(\"IDX_session_expire\").on(table.expire)],\n);\n\nexport const userRoleEnum = pgEnum(\"user_role\", [\"ecp\", \"lab_tech\", \"engineer\", \"supplier\", \"admin\"]);\nexport const accountStatusEnum = pgEnum(\"account_status\", [\"pending\", \"active\", \"suspended\"]);\nexport const orderStatusEnum = pgEnum(\"order_status\", [\n  \"pending\",\n  \"in_production\",\n  \"quality_check\",\n  \"shipped\",\n  \"completed\",\n  \"on_hold\",\n  \"cancelled\"\n]);\n\nexport const poStatusEnum = pgEnum(\"po_status\", [\n  \"draft\",\n  \"sent\",\n  \"acknowledged\",\n  \"in_transit\",\n  \"delivered\",\n  \"cancelled\"\n]);\n\nexport const documentTypeEnum = pgEnum(\"document_type\", [\n  \"spec_sheet\",\n  \"certificate\",\n  \"sds\",\n  \"compliance\",\n  \"other\"\n]);\n\nexport const consultPriorityEnum = pgEnum(\"consult_priority\", [\n  \"normal\",\n  \"high\",\n  \"urgent\"\n]);\n\nexport const examinationStatusEnum = pgEnum(\"examination_status\", [\n  \"in_progress\",\n  \"finalized\"\n]);\n\nexport const invoiceStatusEnum = pgEnum(\"invoice_status\", [\n  \"draft\",\n  \"paid\",\n  \"void\"\n]);\n\nexport const productTypeEnum = pgEnum(\"product_type\", [\n  \"frame\",\n  \"contact_lens\",\n  \"solution\",\n  \"service\"\n]);\n\n// User storage table with Replit Auth fields and local auth support\nexport const users = pgTable(\"users\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  email: varchar(\"email\").unique(),\n  password: text(\"password\"), // For local email/password authentication\n  firstName: varchar(\"first_name\"),\n  lastName: varchar(\"last_name\"),\n  profileImageUrl: varchar(\"profile_image_url\"),\n  role: userRoleEnum(\"role\"), // Primary/active role for backward compatibility\n  accountStatus: accountStatusEnum(\"account_status\").default(\"pending\").notNull(),\n  statusReason: text(\"status_reason\"),\n  organizationName: text(\"organization_name\"),\n  accountNumber: text(\"account_number\"),\n  contactEmail: text(\"contact_email\"),\n  contactPhone: text(\"contact_phone\"),\n  address: jsonb(\"address\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\n// Junction table to support multiple roles per user\nexport const userRoles = pgTable(\"user_roles\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull().references(() => users.id, { onDelete: 'cascade' }),\n  role: userRoleEnum(\"role\").notNull(),\n  assignedAt: timestamp(\"assigned_at\").defaultNow().notNull(),\n}, (table) => [\n  index(\"idx_user_roles_user_id\").on(table.userId),\n]);\n\nexport const patients = pgTable(\"patients\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  name: text(\"name\").notNull(),\n  dateOfBirth: text(\"date_of_birth\"),\n  email: varchar(\"email\"),\n  nhsNumber: varchar(\"nhs_number\"),\n  fullAddress: jsonb(\"full_address\"),\n  customerReferenceLabel: text(\"customer_reference_label\"),\n  customerReferenceNumber: text(\"customer_reference_number\"),\n  ecpId: varchar(\"ecp_id\").notNull().references(() => users.id),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const orders = pgTable(\"orders\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  orderNumber: text(\"order_number\").notNull().unique(),\n  patientId: varchar(\"patient_id\").notNull().references(() => patients.id),\n  ecpId: varchar(\"ecp_id\").notNull().references(() => users.id),\n  status: orderStatusEnum(\"status\").notNull().default(\"pending\"),\n  \n  odSphere: text(\"od_sphere\"),\n  odCylinder: text(\"od_cylinder\"),\n  odAxis: text(\"od_axis\"),\n  odAdd: text(\"od_add\"),\n  osSphere: text(\"os_sphere\"),\n  osCylinder: text(\"os_cylinder\"),\n  osAxis: text(\"os_axis\"),\n  osAdd: text(\"os_add\"),\n  pd: text(\"pd\"),\n  \n  lensType: text(\"lens_type\").notNull(),\n  lensMaterial: text(\"lens_material\").notNull(),\n  coating: text(\"coating\").notNull(),\n  frameType: text(\"frame_type\"),\n  \n  notes: text(\"notes\"),\n  traceFileUrl: text(\"trace_file_url\"),\n  trackingNumber: text(\"tracking_number\"),\n  shippedAt: timestamp(\"shipped_at\"),\n  \n  customerReferenceLabel: text(\"customer_reference_label\"),\n  customerReferenceNumber: text(\"customer_reference_number\"),\n  \n  omaFileContent: text(\"oma_file_content\"),\n  omaFilename: text(\"oma_filename\"),\n  omaParsedData: jsonb(\"oma_parsed_data\"),\n  \n  orderDate: timestamp(\"order_date\").defaultNow().notNull(),\n  dueDate: timestamp(\"due_date\"),\n  completedAt: timestamp(\"completed_at\"),\n});\n\nexport const consultLogs = pgTable(\"consult_logs\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  orderId: varchar(\"order_id\").notNull().references(() => orders.id),\n  ecpId: varchar(\"ecp_id\").notNull().references(() => users.id),\n  priority: consultPriorityEnum(\"priority\").notNull().default(\"normal\"),\n  subject: text(\"subject\").notNull(),\n  description: text(\"description\").notNull(),\n  status: text(\"status\").notNull().default(\"open\"),\n  labResponse: text(\"lab_response\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  respondedAt: timestamp(\"responded_at\"),\n});\n\nexport const purchaseOrders = pgTable(\"purchase_orders\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  poNumber: text(\"po_number\").notNull().unique(),\n  supplierId: varchar(\"supplier_id\").notNull().references(() => users.id),\n  createdById: varchar(\"created_by_id\").notNull().references(() => users.id),\n  status: poStatusEnum(\"status\").notNull().default(\"draft\"),\n  totalAmount: decimal(\"total_amount\", { precision: 10, scale: 2 }),\n  notes: text(\"notes\"),\n  expectedDeliveryDate: timestamp(\"expected_delivery_date\"),\n  actualDeliveryDate: timestamp(\"actual_delivery_date\"),\n  trackingNumber: text(\"tracking_number\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\nexport const poLineItems = pgTable(\"po_line_items\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  purchaseOrderId: varchar(\"purchase_order_id\").notNull().references(() => purchaseOrders.id),\n  itemName: text(\"item_name\").notNull(),\n  description: text(\"description\"),\n  quantity: integer(\"quantity\").notNull(),\n  unitPrice: decimal(\"unit_price\", { precision: 10, scale: 2 }).notNull(),\n  totalPrice: decimal(\"total_price\", { precision: 10, scale: 2 }).notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const technicalDocuments = pgTable(\"technical_documents\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  supplierId: varchar(\"supplier_id\").notNull().references(() => users.id),\n  documentType: documentTypeEnum(\"document_type\").notNull(),\n  title: text(\"title\").notNull(),\n  description: text(\"description\"),\n  fileUrl: text(\"file_url\").notNull(),\n  fileName: text(\"file_name\").notNull(),\n  fileSize: integer(\"file_size\"),\n  materialName: text(\"material_name\"),\n  uploadedAt: timestamp(\"uploaded_at\").defaultNow().notNull(),\n});\n\nexport const organizationSettings = pgTable(\"organization_settings\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  companyName: text(\"company_name\"),\n  logoUrl: text(\"logo_url\"),\n  contactEmail: text(\"contact_email\"),\n  contactPhone: text(\"contact_phone\"),\n  address: jsonb(\"address\"),\n  orderNumberPrefix: text(\"order_number_prefix\").default(\"ORD\"),\n  defaultLeadTimeDays: integer(\"default_lead_time_days\").default(7),\n  enableEmailNotifications: jsonb(\"enable_email_notifications\").default(sql`'{\"orderReceived\": true, \"orderShipped\": true, \"poCreated\": true}'::jsonb`),\n  businessHours: jsonb(\"business_hours\"),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n  updatedById: varchar(\"updated_by_id\").references(() => users.id),\n});\n\nexport const userPreferences = pgTable(\"user_preferences\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull().unique().references(() => users.id),\n  theme: text(\"theme\").default(\"light\"),\n  language: text(\"language\").default(\"en\"),\n  emailNotifications: jsonb(\"email_notifications\").default(sql`'{\"orderUpdates\": true, \"systemAlerts\": true}'::jsonb`),\n  dashboardLayout: jsonb(\"dashboard_layout\"),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\nexport const eyeExaminations = pgTable(\"eye_examinations\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  patientId: varchar(\"patient_id\").notNull().references(() => patients.id),\n  ecpId: varchar(\"ecp_id\").notNull().references(() => users.id),\n  examinationDate: timestamp(\"examination_date\").defaultNow().notNull(),\n  status: examinationStatusEnum(\"status\").notNull().default(\"in_progress\"),\n  reasonForVisit: text(\"reason_for_visit\"),\n  medicalHistory: jsonb(\"medical_history\"),\n  visualAcuity: jsonb(\"visual_acuity\"),\n  refraction: jsonb(\"refraction\"),\n  binocularVision: jsonb(\"binocular_vision\"),\n  eyeHealth: jsonb(\"eye_health\"),\n  gosFormType: text(\"gos_form_type\"),\n  nhsVoucherCode: text(\"nhs_voucher_code\"),\n  notes: text(\"notes\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\nexport const prescriptions = pgTable(\"prescriptions\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  examinationId: varchar(\"examination_id\").references(() => eyeExaminations.id),\n  patientId: varchar(\"patient_id\").notNull().references(() => patients.id),\n  ecpId: varchar(\"ecp_id\").notNull().references(() => users.id),\n  issueDate: timestamp(\"issue_date\").defaultNow().notNull(),\n  expiryDate: timestamp(\"expiry_date\"),\n  odSphere: text(\"od_sphere\"),\n  odCylinder: text(\"od_cylinder\"),\n  odAxis: text(\"od_axis\"),\n  odAdd: text(\"od_add\"),\n  osSphere: text(\"os_sphere\"),\n  osCylinder: text(\"os_cylinder\"),\n  osAxis: text(\"os_axis\"),\n  osAdd: text(\"os_add\"),\n  pd: text(\"pd\"),\n  isSigned: boolean(\"is_signed\").default(false).notNull(),\n  signedByEcpId: varchar(\"signed_by_ecp_id\").references(() => users.id),\n  digitalSignature: text(\"digital_signature\"),\n  signedAt: timestamp(\"signed_at\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const products = pgTable(\"products\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  ecpId: varchar(\"ecp_id\").notNull().references(() => users.id),\n  productType: productTypeEnum(\"product_type\").notNull(),\n  sku: text(\"sku\"),\n  brand: text(\"brand\"),\n  model: text(\"model\"),\n  stockQuantity: integer(\"stock_quantity\").default(0).notNull(),\n  unitPrice: decimal(\"unit_price\", { precision: 10, scale: 2 }).notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\nexport const invoices = pgTable(\"invoices\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  invoiceNumber: text(\"invoice_number\").notNull().unique(),\n  patientId: varchar(\"patient_id\").references(() => patients.id),\n  ecpId: varchar(\"ecp_id\").notNull().references(() => users.id),\n  status: invoiceStatusEnum(\"status\").notNull().default(\"draft\"),\n  totalAmount: decimal(\"total_amount\", { precision: 10, scale: 2 }).notNull(),\n  amountPaid: decimal(\"amount_paid\", { precision: 10, scale: 2 }).default(\"0\").notNull(),\n  invoiceDate: timestamp(\"invoice_date\").defaultNow().notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\nexport const invoiceLineItems = pgTable(\"invoice_line_items\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  invoiceId: varchar(\"invoice_id\").notNull().references(() => invoices.id),\n  productId: varchar(\"product_id\").references(() => products.id),\n  description: text(\"description\").notNull(),\n  quantity: integer(\"quantity\").notNull(),\n  unitPrice: decimal(\"unit_price\", { precision: 10, scale: 2 }).notNull(),\n  totalPrice: decimal(\"total_price\", { precision: 10, scale: 2 }).notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const upsertUserSchema = createInsertSchema(users);\nexport const insertPatientSchema = createInsertSchema(patients).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertOrderSchema = createInsertSchema(orders).omit({\n  id: true,\n  orderNumber: true,\n  orderDate: true,\n  completedAt: true,\n  patientId: true,\n  ecpId: true,\n}).extend({\n  patientName: z.string().min(1, \"Patient name is required\"),\n  patientDOB: z.string().optional(),\n});\n\nexport const updateOrderStatusSchema = z.object({\n  status: z.enum([\"pending\", \"in_production\", \"quality_check\", \"shipped\", \"completed\", \"on_hold\", \"cancelled\"]),\n});\n\nexport const insertConsultLogSchema = createInsertSchema(consultLogs).omit({\n  id: true,\n  createdAt: true,\n  respondedAt: true,\n  labResponse: true,\n  status: true,\n  ecpId: true,\n});\n\nexport const insertPurchaseOrderSchema = createInsertSchema(purchaseOrders).omit({\n  id: true,\n  poNumber: true,\n  createdAt: true,\n  updatedAt: true,\n  createdById: true,\n});\n\nexport const insertPOLineItemSchema = createInsertSchema(poLineItems).omit({\n  id: true,\n  createdAt: true,\n  purchaseOrderId: true,\n});\n\nexport const insertTechnicalDocumentSchema = createInsertSchema(technicalDocuments).omit({\n  id: true,\n  uploadedAt: true,\n  supplierId: true,\n});\n\nexport const updatePOStatusSchema = z.object({\n  status: z.enum([\"draft\", \"sent\", \"acknowledged\", \"in_transit\", \"delivered\", \"cancelled\"]),\n  trackingNumber: z.string().optional(),\n  actualDeliveryDate: z.string().optional(),\n});\n\nexport const insertSupplierSchema = z.object({\n  organizationName: z.string().min(1, \"Organization name is required\"),\n  email: z.string().email(\"Valid email is required\").optional(),\n  accountNumber: z.string().optional(),\n  contactEmail: z.string().email(\"Valid contact email required\").optional(),\n  contactPhone: z.string().optional(),\n  address: z.object({\n    street: z.string().optional(),\n    city: z.string().optional(),\n    state: z.string().optional(),\n    zipCode: z.string().optional(),\n    country: z.string().optional(),\n  }).optional(),\n});\n\nexport const updateSupplierSchema = insertSupplierSchema.partial();\n\nexport const updateOrganizationSettingsSchema = createInsertSchema(organizationSettings).omit({\n  id: true,\n  updatedAt: true,\n  updatedById: true,\n}).extend({\n  address: z.object({\n    street: z.string().optional(),\n    city: z.string().optional(),\n    state: z.string().optional(),\n    zipCode: z.string().optional(),\n    country: z.string().optional(),\n  }).optional(),\n});\n\nexport const updateUserPreferencesSchema = createInsertSchema(userPreferences).omit({\n  id: true,\n  userId: true,\n  updatedAt: true,\n});\n\nexport const insertEyeExaminationSchema = createInsertSchema(eyeExaminations).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n  ecpId: true,\n});\n\nexport const insertPrescriptionSchema = createInsertSchema(prescriptions).omit({\n  id: true,\n  createdAt: true,\n  ecpId: true,\n  isSigned: true,\n  signedByEcpId: true,\n  digitalSignature: true,\n  signedAt: true,\n});\n\nexport const insertProductSchema = createInsertSchema(products).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n  ecpId: true,\n});\n\nexport const insertInvoiceSchema = createInsertSchema(invoices).omit({\n  id: true,\n  invoiceNumber: true,\n  createdAt: true,\n  updatedAt: true,\n  ecpId: true,\n});\n\nexport const insertInvoiceLineItemSchema = createInsertSchema(invoiceLineItems).omit({\n  id: true,\n  createdAt: true,\n  invoiceId: true,\n});\n\nexport type UpsertUser = z.infer<typeof upsertUserSchema>;\nexport type User = typeof users.$inferSelect;\n\nexport type InsertPatient = z.infer<typeof insertPatientSchema>;\nexport type Patient = typeof patients.$inferSelect;\n\nexport type InsertOrder = z.infer<typeof insertOrderSchema>;\nexport type Order = typeof orders.$inferSelect;\n\nexport type OrderWithDetails = Order & {\n  patient: Patient;\n  ecp: {\n    id: string;\n    firstName: string | null;\n    lastName: string | null;\n    organizationName: string | null;\n  };\n};\n\nexport type InsertConsultLog = z.infer<typeof insertConsultLogSchema>;\nexport type ConsultLog = typeof consultLogs.$inferSelect;\n\nexport type InsertPurchaseOrder = z.infer<typeof insertPurchaseOrderSchema>;\nexport type PurchaseOrder = typeof purchaseOrders.$inferSelect;\n\nexport type InsertPOLineItem = z.infer<typeof insertPOLineItemSchema>;\nexport type POLineItem = typeof poLineItems.$inferSelect;\n\nexport type PurchaseOrderWithDetails = PurchaseOrder & {\n  supplier: {\n    id: string;\n    organizationName: string | null;\n    email: string | null;\n    accountNumber: string | null;\n    contactEmail: string | null;\n    contactPhone: string | null;\n  };\n  createdBy: {\n    id: string;\n    firstName: string | null;\n    lastName: string | null;\n  };\n  lineItems: POLineItem[];\n};\n\nexport type InsertTechnicalDocument = z.infer<typeof insertTechnicalDocumentSchema>;\nexport type TechnicalDocument = typeof technicalDocuments.$inferSelect;\n\nexport type TechnicalDocumentWithSupplier = TechnicalDocument & {\n  supplier: {\n    id: string;\n    organizationName: string | null;\n  };\n};\n\nexport type InsertSupplier = z.infer<typeof insertSupplierSchema>;\nexport type UpdateSupplier = z.infer<typeof updateSupplierSchema>;\n\nexport type UpdateOrganizationSettings = z.infer<typeof updateOrganizationSettingsSchema>;\nexport type OrganizationSettings = typeof organizationSettings.$inferSelect;\n\nexport type UpdateUserPreferences = z.infer<typeof updateUserPreferencesSchema>;\nexport type UserPreferences = typeof userPreferences.$inferSelect;\n\nexport type UserRole = typeof userRoles.$inferSelect;\nexport type UserWithRoles = User & {\n  availableRoles: string[];\n};\n\nexport type InsertEyeExamination = z.infer<typeof insertEyeExaminationSchema>;\nexport type EyeExamination = typeof eyeExaminations.$inferSelect;\n\nexport type EyeExaminationWithDetails = EyeExamination & {\n  patient: Patient;\n  ecp: {\n    id: string;\n    firstName: string | null;\n    lastName: string | null;\n  };\n};\n\nexport type InsertPrescription = z.infer<typeof insertPrescriptionSchema>;\nexport type Prescription = typeof prescriptions.$inferSelect;\n\nexport type PrescriptionWithDetails = Prescription & {\n  patient: Patient;\n  ecp: {\n    id: string;\n    firstName: string | null;\n    lastName: string | null;\n  };\n  examination?: EyeExamination;\n};\n\nexport type InsertProduct = z.infer<typeof insertProductSchema>;\nexport type Product = typeof products.$inferSelect;\n\nexport type InsertInvoice = z.infer<typeof insertInvoiceSchema>;\nexport type Invoice = typeof invoices.$inferSelect;\n\nexport type InsertInvoiceLineItem = z.infer<typeof insertInvoiceLineItemSchema>;\nexport type InvoiceLineItem = typeof invoiceLineItems.$inferSelect;\n\nexport type InvoiceWithDetails = Invoice & {\n  patient?: Patient;\n  ecp: {\n    id: string;\n    firstName: string | null;\n    lastName: string | null;\n  };\n  lineItems: InvoiceLineItem[];\n};\n","size_bytes":19217},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","size_bytes":329},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","size_bytes":1883},"client/src/components/ThemeToggle.tsx":{"content":"import { Moon, Sun } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { useEffect, useState } from \"react\";\n\nexport function ThemeToggle() {\n  const [theme, setTheme] = useState<\"light\" | \"dark\">(\"light\");\n\n  useEffect(() => {\n    const stored = localStorage.getItem(\"theme\") as \"light\" | \"dark\" | null;\n    const initial = stored || \"light\";\n    setTheme(initial);\n    document.documentElement.classList.toggle(\"dark\", initial === \"dark\");\n  }, []);\n\n  const toggleTheme = () => {\n    const newTheme = theme === \"light\" ? \"dark\" : \"light\";\n    setTheme(newTheme);\n    localStorage.setItem(\"theme\", newTheme);\n    document.documentElement.classList.toggle(\"dark\", newTheme === \"dark\");\n  };\n\n  return (\n    <Button\n      variant=\"ghost\"\n      size=\"icon\"\n      onClick={toggleTheme}\n      data-testid=\"button-theme-toggle\"\n      className=\"toggle-elevate\"\n    >\n      {theme === \"light\" ? (\n        <Moon className=\"h-5 w-5\" />\n      ) : (\n        <Sun className=\"h-5 w-5\" />\n      )}\n      <span className=\"sr-only\">Toggle theme</span>\n    </Button>\n  );\n}\n","size_bytes":1086},"client/src/components/FilterBar.tsx":{"content":"import { Button } from \"@/components/ui/button\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { X } from \"lucide-react\";\n\ninterface FilterBarProps {\n  statusFilter?: string;\n  onStatusChange?: (value: string) => void;\n  ecpFilter?: string;\n  onEcpChange?: (value: string) => void;\n  onClearFilters?: () => void;\n}\n\nexport function FilterBar({\n  statusFilter,\n  onStatusChange,\n  ecpFilter,\n  onEcpChange,\n  onClearFilters,\n}: FilterBarProps) {\n  const hasFilters = statusFilter || ecpFilter;\n\n  return (\n    <div className=\"flex flex-wrap items-center gap-4\">\n      <Select value={statusFilter} onValueChange={onStatusChange}>\n        <SelectTrigger className=\"w-48\" data-testid=\"select-status-filter\">\n          <SelectValue placeholder=\"Filter by Status\" />\n        </SelectTrigger>\n        <SelectContent>\n          <SelectItem value=\"all\">All Statuses</SelectItem>\n          <SelectItem value=\"pending\">Pending</SelectItem>\n          <SelectItem value=\"in_production\">In Production</SelectItem>\n          <SelectItem value=\"quality_check\">Quality Check</SelectItem>\n          <SelectItem value=\"shipped\">Shipped</SelectItem>\n          <SelectItem value=\"completed\">Completed</SelectItem>\n        </SelectContent>\n      </Select>\n\n      <Select value={ecpFilter} onValueChange={onEcpChange}>\n        <SelectTrigger className=\"w-48\" data-testid=\"select-ecp-filter\">\n          <SelectValue placeholder=\"Filter by ECP\" />\n        </SelectTrigger>\n        <SelectContent>\n          <SelectItem value=\"all\">All ECPs</SelectItem>\n          <SelectItem value=\"vision-care\">Vision Care Center</SelectItem>\n          <SelectItem value=\"eye-health\">Eye Health Associates</SelectItem>\n          <SelectItem value=\"clarity\">Clarity Optical</SelectItem>\n          <SelectItem value=\"perfect-vision\">Perfect Vision Clinic</SelectItem>\n        </SelectContent>\n      </Select>\n\n      {hasFilters && (\n        <Button\n          variant=\"ghost\"\n          size=\"sm\"\n          onClick={onClearFilters}\n          data-testid=\"button-clear-filters\"\n        >\n          <X className=\"h-4 w-4 mr-2\" />\n          Clear Filters\n        </Button>\n      )}\n    </div>\n  );\n}\n","size_bytes":2228},"client/src/components/ui/hover-card.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","size_bytes":1251},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","size_bytes":565},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n","size_bytes":166},"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","size_bytes":325},"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","size_bytes":1723},"client/src/pages/examples/LabDashboard.tsx":{"content":"import LabDashboard from '../LabDashboard'\n\nexport default function LabDashboardExample() {\n  return <LabDashboard />\n}\n","size_bytes":120},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","size_bytes":7428},"client/src/components/examples/ProgressStepper.tsx":{"content":"import { ProgressStepper } from '../ProgressStepper'\n\nexport default function ProgressStepperExample() {\n  const steps = [\n    { label: \"Patient Info\", description: \"Basic details\" },\n    { label: \"Prescription\", description: \"Rx values\" },\n    { label: \"Lens & Frame\", description: \"Product selection\" },\n    { label: \"Review\", description: \"Confirm order\" },\n  ];\n\n  return (\n    <div className=\"max-w-4xl p-8\">\n      <ProgressStepper steps={steps} currentStep={1} />\n    </div>\n  )\n}\n","size_bytes":487},"client/src/components/examples/OrderTable.tsx":{"content":"import { OrderTable } from '../OrderTable'\n\nexport default function OrderTableExample() {\n  const orders = [\n    {\n      id: \"ORD-2024-1001\",\n      patientName: \"John Smith\",\n      ecp: \"Vision Care Center\",\n      status: \"in_production\" as const,\n      orderDate: \"2024-10-20\",\n      lensType: \"Progressive\",\n    },\n    {\n      id: \"ORD-2024-1002\",\n      patientName: \"Sarah Johnson\",\n      ecp: \"Eye Health Associates\",\n      status: \"quality_check\" as const,\n      orderDate: \"2024-10-21\",\n      lensType: \"Single Vision\",\n    },\n    {\n      id: \"ORD-2024-1003\",\n      patientName: \"Michael Chen\",\n      ecp: \"Clarity Optical\",\n      status: \"pending\" as const,\n      orderDate: \"2024-10-22\",\n      lensType: \"Bifocal\",\n    },\n    {\n      id: \"ORD-2024-1004\",\n      patientName: \"Emily Davis\",\n      ecp: \"Perfect Vision Clinic\",\n      status: \"shipped\" as const,\n      orderDate: \"2024-10-19\",\n      lensType: \"Progressive\",\n    },\n  ];\n\n  return (\n    <OrderTable\n      orders={orders}\n      onViewDetails={(id) => console.log('View details for', id)}\n      onUpdateStatus={(id, status) => console.log('Update status', id, status)}\n    />\n  )\n}\n","size_bytes":1150},"server/index.ts":{"content":"import express, { type Request, Response, NextFunction } from \"express\";\nimport { registerRoutes } from \"./routes\";\nimport { setupVite, serveStatic, log } from \"./vite\";\n\nconst app = express();\n\ndeclare module 'http' {\n  interface IncomingMessage {\n    rawBody: unknown\n  }\n}\napp.use(express.json({\n  verify: (req, _res, buf) => {\n    req.rawBody = buf;\n  }\n}));\napp.use(express.urlencoded({ extended: false }));\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      if (logLine.length > 80) {\n        logLine = logLine.slice(0, 79) + \"\";\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n(async () => {\n  try {\n    // Validate required environment variables\n    if (!process.env.DATABASE_URL) {\n      console.error(\"FATAL ERROR: DATABASE_URL environment variable is not set\");\n      console.error(\"Please configure DATABASE_URL in your deployment secrets\");\n      process.exit(1);\n    }\n\n    log(\"Starting server initialization...\");\n    \n    const server = await registerRoutes(app);\n    log(\"Routes registered successfully\");\n\n    app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n      const status = err.status || err.statusCode || 500;\n      const message = err.message || \"Internal Server Error\";\n\n      console.error(\"Error handler caught:\", err);\n      res.status(status).json({ message });\n    });\n\n    // importantly only setup vite in development and after\n    // setting up all the other routes so the catch-all route\n    // doesn't interfere with the other routes\n    if (app.get(\"env\") === \"development\") {\n      await setupVite(app, server);\n      log(\"Vite setup completed for development\");\n    } else {\n      serveStatic(app);\n      log(\"Static file serving configured for production\");\n    }\n\n    // ALWAYS serve the app on the port specified in the environment variable PORT\n    // Other ports are firewalled. Default to 5000 if not specified.\n    // this serves both the API and the client.\n    // It is the only port that is not firewalled.\n    const port = parseInt(process.env.PORT || '5000', 10);\n    \n    server.listen({\n      port,\n      host: \"0.0.0.0\",\n      reusePort: true,\n    }, () => {\n      log(`Server successfully started on port ${port}`);\n      log(`Environment: ${app.get(\"env\")}`);\n      log(`Ready to accept connections`);\n    });\n\n    // Handle server errors\n    server.on('error', (error: NodeJS.ErrnoException) => {\n      console.error(\"Server error:\", error);\n      if (error.code === 'EADDRINUSE') {\n        console.error(`Port ${port} is already in use`);\n      }\n      process.exit(1);\n    });\n\n  } catch (error) {\n    console.error(\"FATAL ERROR during server initialization:\");\n    console.error(error);\n    \n    // Provide helpful error messages based on error type\n    if (error instanceof Error) {\n      console.error(\"Error message:\", error.message);\n      console.error(\"Error stack:\", error.stack);\n      \n      if (error.message.includes(\"DATABASE_URL\")) {\n        console.error(\"\\nPlease ensure DATABASE_URL is configured in deployment secrets\");\n      }\n    }\n    \n    process.exit(1);\n  }\n})();\n","size_bytes":3676},"client/src/components/StatusBadge.tsx":{"content":"import { Badge } from \"@/components/ui/badge\";\nimport { cn } from \"@/lib/utils\";\n\nexport type OrderStatus = \n  | \"pending\" \n  | \"in_production\" \n  | \"quality_check\" \n  | \"shipped\" \n  | \"completed\"\n  | \"on_hold\"\n  | \"cancelled\";\n\ninterface StatusBadgeProps {\n  status: OrderStatus;\n  className?: string;\n}\n\nconst statusConfig: Record<OrderStatus, { label: string; className: string }> = {\n  pending: {\n    label: \"Pending\",\n    className: \"bg-yellow-500/10 text-yellow-700 dark:text-yellow-400 border-yellow-500/20\",\n  },\n  in_production: {\n    label: \"In Production\",\n    className: \"bg-blue-500/10 text-blue-700 dark:text-blue-400 border-blue-500/20\",\n  },\n  quality_check: {\n    label: \"Quality Check\",\n    className: \"bg-purple-500/10 text-purple-700 dark:text-purple-400 border-purple-500/20\",\n  },\n  shipped: {\n    label: \"Shipped\",\n    className: \"bg-emerald-500/10 text-emerald-700 dark:text-emerald-400 border-emerald-500/20\",\n  },\n  completed: {\n    label: \"Completed\",\n    className: \"bg-green-500/10 text-green-700 dark:text-green-400 border-green-500/20\",\n  },\n  on_hold: {\n    label: \"On Hold\",\n    className: \"bg-orange-500/10 text-orange-700 dark:text-orange-400 border-orange-500/20\",\n  },\n  cancelled: {\n    label: \"Cancelled\",\n    className: \"bg-red-500/10 text-red-700 dark:text-red-400 border-red-500/20\",\n  },\n};\n\nexport function StatusBadge({ status, className }: StatusBadgeProps) {\n  const config = statusConfig[status];\n  \n  return (\n    <Badge\n      variant=\"outline\"\n      className={cn(\n        \"rounded-full px-3 py-1 text-xs font-semibold border\",\n        config.className,\n        className\n      )}\n      data-testid={`badge-status-${status}`}\n    >\n      {config.label}\n    </Badge>\n  );\n}\n","size_bytes":1723},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-9 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","size_bytes":5741},"client/src/pages/LabDashboard.tsx":{"content":"import { StatCard } from \"@/components/StatCard\";\nimport { OrderTable } from \"@/components/OrderTable\";\nimport { SearchBar } from \"@/components/SearchBar\";\nimport { FilterBar } from \"@/components/FilterBar\";\nimport { CreatePurchaseOrderDialog } from \"@/components/CreatePurchaseOrderDialog\";\nimport { ShipOrderDialog } from \"@/components/ShipOrderDialog\";\nimport { SuppliersTable } from \"@/components/SuppliersTable\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Package, Clock, CheckCircle, TrendingUp, Printer, Mail } from \"lucide-react\";\nimport { useState, useEffect } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useLocation } from \"wouter\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { isUnauthorizedError } from \"@/lib/authUtils\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { format } from \"date-fns\";\nimport type { OrderWithDetails, PurchaseOrderWithDetails } from \"@shared/schema\";\n\ninterface OrderStats {\n  total: number;\n  pending: number;\n  inProduction: number;\n  completed: number;\n}\n\nexport default function LabDashboard() {\n  const [searchValue, setSearchValue] = useState(\"\");\n  const [statusFilter, setStatusFilter] = useState(\"\");\n  const [ecpFilter, setEcpFilter] = useState(\"\");\n  const [shipDialogOpen, setShipDialogOpen] = useState(false);\n  const [selectedOrderId, setSelectedOrderId] = useState<string>(\"\");\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n\n  const { data: stats, isLoading: statsLoading, error: statsError } = useQuery<OrderStats>({\n    queryKey: [\"/api/stats\"],\n  });\n\n  const queryParams = new URLSearchParams();\n  if (statusFilter && statusFilter !== \"all\") queryParams.append(\"status\", statusFilter);\n  if (searchValue) queryParams.append(\"search\", searchValue);\n  \n  const queryString = queryParams.toString();\n  const ordersQueryKey = queryString ? [\"/api/orders\", `?${queryString}`] : [\"/api/orders\"];\n\n  const { data: orders, isLoading: ordersLoading, error: ordersError } = useQuery<OrderWithDetails[]>({\n    queryKey: ordersQueryKey,\n  });\n\n  const { data: purchaseOrders, isLoading: posLoading } = useQuery<PurchaseOrderWithDetails[]>({\n    queryKey: [\"/api/purchase-orders\"],\n  });\n\n  useEffect(() => {\n    if (statsError && isUnauthorizedError(statsError as Error)) {\n      toast({\n        title: \"Session expired\",\n        description: \"Please log in again to continue.\",\n        variant: \"destructive\",\n      });\n      window.location.href = \"/api/login\";\n    }\n  }, [statsError, toast]);\n\n  useEffect(() => {\n    if (ordersError && isUnauthorizedError(ordersError as Error)) {\n      toast({\n        title: \"Session expired\",\n        description: \"Please log in again to continue.\",\n        variant: \"destructive\",\n      });\n      window.location.href = \"/api/login\";\n    }\n  }, [ordersError, toast]);\n\n  const updateStatusMutation = useMutation({\n    mutationFn: async ({ id, status }: { id: string; status: string }) => {\n      const response = await apiRequest(\"PATCH\", `/api/orders/${id}/status`, { status });\n      return await response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/orders\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/stats\"] });\n      toast({\n        title: \"Status updated\",\n        description: \"Order status has been updated successfully.\",\n      });\n    },\n    onError: (error: Error) => {\n      if (isUnauthorizedError(error)) {\n        toast({\n          title: \"Session expired\",\n          description: \"Please log in again to continue.\",\n          variant: \"destructive\",\n        });\n        window.location.href = \"/api/login\";\n      } else {\n        toast({\n          title: \"Update failed\",\n          description: error.message,\n          variant: \"destructive\",\n        });\n      }\n    },\n  });\n\n  const handleUpdateStatus = (id: string, status: string) => {\n    updateStatusMutation.mutate({ id, status });\n  };\n\n  const handleShipOrder = (id: string) => {\n    setSelectedOrderId(id);\n    setShipDialogOpen(true);\n  };\n\n  const handlePrintPO = async (poId: string) => {\n    try {\n      window.open(`/api/purchase-orders/${poId}/pdf`, '_blank');\n    } catch (error) {\n      toast({\n        title: \"Error printing PO\",\n        description: \"Failed to generate PDF\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const emailPOMutation = useMutation({\n    mutationFn: async (poId: string) => {\n      const response = await apiRequest(\"POST\", `/api/purchase-orders/${poId}/email`, {});\n      return await response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Email sent\",\n        description: \"Purchase order has been emailed to the supplier.\",\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Error sending email\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const tableOrders = (orders || []).map((order: OrderWithDetails) => ({\n    id: order.id,\n    patientName: order.patient.name,\n    ecp: order.ecp.organizationName || `${order.ecp.firstName} ${order.ecp.lastName}`,\n    status: order.status,\n    orderDate: new Date(order.orderDate).toISOString().split('T')[0],\n    lensType: order.lensType,\n  }));\n\n  const efficiencyRate = stats?.total ? Math.round((stats.completed / stats.total) * 100) : 0;\n  const completedToday = stats?.completed || 0;\n\n  return (\n    <div className=\"space-y-6\">\n      <div>\n        <h1 className=\"text-2xl font-semibold\">Lab Dashboard</h1>\n        <p className=\"text-muted-foreground mt-1\">\n          Monitor production status and manage your order queue.\n        </p>\n      </div>\n\n      <Tabs defaultValue=\"orders\" className=\"w-full\">\n        <TabsList>\n          <TabsTrigger value=\"orders\" data-testid=\"tab-orders\">Orders</TabsTrigger>\n          <TabsTrigger value=\"purchase-orders\" data-testid=\"tab-purchase-orders\">Purchase Orders</TabsTrigger>\n          <TabsTrigger value=\"suppliers\" data-testid=\"tab-suppliers\">Suppliers</TabsTrigger>\n        </TabsList>\n\n        <TabsContent value=\"orders\" className=\"space-y-6 mt-6\">\n          {statsLoading ? (\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\n              {[1, 2, 3, 4].map((i) => (\n                <div key={i} className=\"h-32 bg-card rounded-md animate-pulse\" />\n              ))}\n            </div>\n          ) : (\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\n              <StatCard\n                title=\"Total Orders\"\n                value={stats?.total.toString() || \"0\"}\n                icon={Package}\n              />\n              <StatCard\n                title=\"In Production\"\n                value={stats?.inProduction.toString() || \"0\"}\n                icon={Clock}\n              />\n              <StatCard\n                title=\"Completed Today\"\n                value={completedToday.toString()}\n                icon={CheckCircle}\n              />\n              <StatCard\n                title=\"Efficiency Rate\"\n                value={`${efficiencyRate}%`}\n                icon={TrendingUp}\n              />\n            </div>\n          )}\n\n          <div className=\"space-y-4\">\n            <div className=\"flex flex-col sm:flex-row gap-4 items-start\">\n              <SearchBar\n                value={searchValue}\n                onChange={setSearchValue}\n                placeholder=\"Search orders, patients, or ECPs...\"\n              />\n              <CreatePurchaseOrderDialog />\n            </div>\n\n            <FilterBar\n              statusFilter={statusFilter}\n              onStatusChange={setStatusFilter}\n              ecpFilter={ecpFilter}\n              onEcpChange={setEcpFilter}\n              onClearFilters={() => {\n                setStatusFilter(\"\");\n                setEcpFilter(\"\");\n              }}\n            />\n\n            {ordersLoading ? (\n              <div className=\"h-96 bg-card rounded-md animate-pulse\" />\n            ) : tableOrders.length === 0 ? (\n              <div className=\"text-center py-12\">\n                <Package className=\"h-12 w-12 mx-auto text-muted-foreground mb-4\" />\n                <h3 className=\"text-lg font-semibold mb-2\">No orders found</h3>\n                <p className=\"text-muted-foreground\">\n                  {searchValue || statusFilter \n                    ? \"Try adjusting your search or filters.\" \n                    : \"Orders will appear here once they are created.\"}\n                </p>\n              </div>\n            ) : (\n              <OrderTable\n                orders={tableOrders}\n                onViewDetails={(id) => setLocation(`/order/${id}`)}\n                onUpdateStatus={handleUpdateStatus}\n                onShipOrder={handleShipOrder}\n              />\n            )}\n          </div>\n        </TabsContent>\n\n        <TabsContent value=\"purchase-orders\" className=\"space-y-6 mt-6\">\n          <div className=\"flex items-center justify-between\">\n            <p className=\"text-sm text-muted-foreground\">Manage purchase orders and send them to suppliers</p>\n            <CreatePurchaseOrderDialog />\n          </div>\n          \n          {purchaseOrders && purchaseOrders.length > 0 ? (\n            <Card>\n              <CardHeader>\n                <CardTitle>Purchase Orders</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <Table>\n                  <TableHeader>\n                    <TableRow>\n                      <TableHead>PO Number</TableHead>\n                      <TableHead>Supplier</TableHead>\n                      <TableHead>Date</TableHead>\n                      <TableHead>Total</TableHead>\n                      <TableHead>Actions</TableHead>\n                    </TableRow>\n                  </TableHeader>\n                  <TableBody>\n                    {purchaseOrders.map((po) => (\n                      <TableRow key={po.id} data-testid={`row-po-${po.id}`}>\n                        <TableCell className=\"font-medium\" data-testid={`text-po-number-${po.id}`}>\n                          {po.poNumber}\n                        </TableCell>\n                        <TableCell data-testid={`text-po-supplier-${po.id}`}>\n                          {po.supplier.organizationName || 'Unknown'}\n                        </TableCell>\n                        <TableCell data-testid={`text-po-date-${po.id}`}>\n                          {format(new Date(po.createdAt), \"MMM dd, yyyy\")}\n                        </TableCell>\n                        <TableCell data-testid={`text-po-total-${po.id}`}>\n                          ${parseFloat(po.totalAmount || \"0\").toFixed(2)}\n                        </TableCell>\n                        <TableCell>\n                          <div className=\"flex gap-2\">\n                            <Button\n                              variant=\"ghost\"\n                              size=\"sm\"\n                              onClick={() => handlePrintPO(po.id)}\n                              data-testid={`button-print-po-${po.id}`}\n                            >\n                              <Printer className=\"h-4 w-4\" />\n                            </Button>\n                            <Button\n                              variant=\"ghost\"\n                              size=\"sm\"\n                              onClick={() => emailPOMutation.mutate(po.id)}\n                              disabled={emailPOMutation.isPending}\n                              data-testid={`button-email-po-${po.id}`}\n                            >\n                              <Mail className=\"h-4 w-4\" />\n                            </Button>\n                          </div>\n                        </TableCell>\n                      </TableRow>\n                    ))}\n                  </TableBody>\n                </Table>\n              </CardContent>\n            </Card>\n          ) : (\n            <Card>\n              <CardContent className=\"py-12\">\n                <div className=\"text-center\">\n                  <Package className=\"h-12 w-12 mx-auto text-muted-foreground mb-4\" />\n                  <h3 className=\"text-lg font-semibold mb-2\">No Purchase Orders</h3>\n                  <p className=\"text-muted-foreground mb-4\">Create your first purchase order to get started.</p>\n                  <CreatePurchaseOrderDialog />\n                </div>\n              </CardContent>\n            </Card>\n          )}\n        </TabsContent>\n\n        <TabsContent value=\"suppliers\" className=\"space-y-6 mt-6\">\n          <SuppliersTable />\n        </TabsContent>\n      </Tabs>\n\n      <ShipOrderDialog\n        orderId={selectedOrderId}\n        open={shipDialogOpen}\n        onOpenChange={setShipDialogOpen}\n      />\n    </div>\n  );\n}\n","size_bytes":12994},"client/src/hooks/useAuth.ts":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { getQueryFn } from \"@/lib/queryClient\";\nimport type { User } from \"@shared/schema\";\n\nexport function useAuth() {\n  const { data: user, isLoading } = useQuery<User | null>({\n    queryKey: [\"/api/auth/user\"],\n    queryFn: getQueryFn({ on401: \"returnNull\" }),\n    retry: false,\n  });\n\n  return {\n    user: user ?? undefined,\n    isLoading,\n    isAuthenticated: !!user,\n  };\n}\n","size_bytes":431},"client/src/pages/Landing.tsx":{"content":"import { Button } from \"@/components/ui/button\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Glasses, Package, Users, TrendingUp, CheckCircle2, Zap, Shield, BarChart3, Mail } from \"lucide-react\";\nimport { useLocation } from \"wouter\";\nimport { SiReplit } from \"react-icons/si\";\n\nexport default function Landing() {\n  const [, setLocation] = useLocation();\n\n  const handleReplitLogin = () => {\n    window.location.href = \"/api/login\";\n  };\n\n  const handleEmailLogin = () => {\n    setLocation(\"/email-login\");\n  };\n\n  const handleEmailSignup = () => {\n    setLocation(\"/email-signup\");\n  };\n\n  return (\n    <div className=\"min-h-screen flex flex-col bg-gradient-to-b from-background via-background to-muted/20\">\n      <header className=\"border-b border-border backdrop-blur-sm bg-background/80 sticky top-0 z-50\">\n        <div className=\"max-w-7xl mx-auto flex items-center justify-between px-6 py-4 gap-4 flex-wrap\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"w-11 h-11 rounded-lg bg-primary flex items-center justify-center shadow-lg shadow-primary/20\">\n              <span className=\"text-primary-foreground font-bold text-xl\">ILS</span>\n            </div>\n            <div>\n              <h1 className=\"font-bold text-lg leading-none\">Integrated Lens System</h1>\n              <p className=\"text-xs text-muted-foreground\">Enterprise Lens Management</p>\n            </div>\n          </div>\n          <div className=\"flex items-center gap-2 flex-wrap\">\n            <Button onClick={handleEmailLogin} variant=\"outline\" data-testid=\"button-email-login\">\n              <Mail className=\"h-4 w-4 mr-2\" />\n              Email Sign In\n            </Button>\n            <Button onClick={handleReplitLogin} data-testid=\"button-replit-login\" className=\"shadow-md\">\n              <SiReplit className=\"h-4 w-4 mr-2\" />\n              Replit Sign In\n            </Button>\n          </div>\n        </div>\n      </header>\n\n      <main className=\"flex-1\">\n        <section className=\"relative py-20 px-6 overflow-hidden\">\n          <div className=\"absolute inset-0 bg-grid-pattern opacity-5\"></div>\n          <div className=\"max-w-7xl mx-auto relative\">\n            <div className=\"text-center space-y-6 max-w-4xl mx-auto\">\n              <div className=\"inline-flex items-center gap-2 px-4 py-2 rounded-full bg-primary/10 border border-primary/20 text-sm font-medium text-primary mb-4\">\n                <Zap className=\"h-4 w-4\" />\n                Streamline Your Lens Production Workflow\n              </div>\n              <h2 className=\"text-5xl md:text-6xl font-bold tracking-tight bg-gradient-to-r from-foreground to-foreground/70 bg-clip-text text-transparent\">\n                Welcome to the Future of Lens Management\n              </h2>\n              <p className=\"text-xl md:text-2xl text-muted-foreground max-w-3xl mx-auto leading-relaxed\">\n                A unified platform for managing lens orders, production workflows, and quality control across eye care professionals, labs, and suppliers.\n              </p>\n              <div className=\"flex flex-col sm:flex-row items-center justify-center gap-4 pt-6\">\n                <Button size=\"lg\" onClick={handleEmailSignup} data-testid=\"button-signup-cta\" className=\"shadow-lg text-lg px-8 h-12\">\n                  <Mail className=\"h-5 w-5 mr-2\" />\n                  Sign Up with Email\n                </Button>\n                <Button size=\"lg\" variant=\"outline\" onClick={handleReplitLogin} className=\"text-lg px-8 h-12 shadow-md\" data-testid=\"button-replit-cta\">\n                  <SiReplit className=\"h-5 w-5 mr-2\" />\n                  Sign Up with Replit\n                </Button>\n              </div>\n              <div className=\"text-sm text-muted-foreground pt-2\">\n                Already have an account? <button onClick={handleEmailLogin} className=\"text-primary hover:underline font-medium\" data-testid=\"link-email-login\">Sign in with email</button> or <button onClick={handleReplitLogin} className=\"text-primary hover:underline font-medium\" data-testid=\"link-replit-login\">Replit</button>\n              </div>\n              <div className=\"flex flex-wrap items-center justify-center gap-6 pt-8 text-sm text-muted-foreground\">\n                <div className=\"flex items-center gap-2\">\n                  <CheckCircle2 className=\"h-4 w-4 text-primary\" />\n                  Real-time Tracking\n                </div>\n                <div className=\"flex items-center gap-2\">\n                  <CheckCircle2 className=\"h-4 w-4 text-primary\" />\n                  Quality Control\n                </div>\n                <div className=\"flex items-center gap-2\">\n                  <CheckCircle2 className=\"h-4 w-4 text-primary\" />\n                  Secure & Compliant\n                </div>\n              </div>\n            </div>\n          </div>\n        </section>\n\n        <section id=\"features\" className=\"py-20 px-6 bg-muted/30\">\n          <div className=\"max-w-7xl mx-auto\">\n            <div className=\"text-center mb-16\">\n              <h3 className=\"text-3xl md:text-4xl font-bold mb-4\">Built for Every Role</h3>\n              <p className=\"text-lg text-muted-foreground max-w-2xl mx-auto\">\n                Comprehensive tools tailored to each stakeholder in the lens production ecosystem\n              </p>\n            </div>\n\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\n              <Card className=\"hover-elevate border-2 transition-all duration-300\">\n                <CardContent className=\"p-6 space-y-4\">\n                  <div className=\"w-14 h-14 rounded-lg bg-gradient-to-br from-primary/20 to-primary/5 flex items-center justify-center\">\n                    <Glasses className=\"h-7 w-7 text-primary\" />\n                  </div>\n                  <div>\n                    <h3 className=\"font-bold text-xl mb-2\">Eye Care Professionals</h3>\n                    <p className=\"text-sm text-muted-foreground leading-relaxed\">\n                      Submit and track lens orders with real-time production updates and seamless communication.\n                    </p>\n                  </div>\n                </CardContent>\n              </Card>\n\n              <Card className=\"hover-elevate border-2 transition-all duration-300\">\n                <CardContent className=\"p-6 space-y-4\">\n                  <div className=\"w-14 h-14 rounded-lg bg-gradient-to-br from-primary/20 to-primary/5 flex items-center justify-center\">\n                    <Package className=\"h-7 w-7 text-primary\" />\n                  </div>\n                  <div>\n                    <h3 className=\"font-bold text-xl mb-2\">Lab Technicians</h3>\n                    <p className=\"text-sm text-muted-foreground leading-relaxed\">\n                      Manage production queue and quality control workflows with efficiency and precision.\n                    </p>\n                  </div>\n                </CardContent>\n              </Card>\n\n              <Card className=\"hover-elevate border-2 transition-all duration-300\">\n                <CardContent className=\"p-6 space-y-4\">\n                  <div className=\"w-14 h-14 rounded-lg bg-gradient-to-br from-primary/20 to-primary/5 flex items-center justify-center\">\n                    <TrendingUp className=\"h-7 w-7 text-primary\" />\n                  </div>\n                  <div>\n                    <h3 className=\"font-bold text-xl mb-2\">Engineers</h3>\n                    <p className=\"text-sm text-muted-foreground leading-relaxed\">\n                      Access analytics, equipment tracking, and comprehensive R&D project management tools.\n                    </p>\n                  </div>\n                </CardContent>\n              </Card>\n\n              <Card className=\"hover-elevate border-2 transition-all duration-300\">\n                <CardContent className=\"p-6 space-y-4\">\n                  <div className=\"w-14 h-14 rounded-lg bg-gradient-to-br from-primary/20 to-primary/5 flex items-center justify-center\">\n                    <Users className=\"h-7 w-7 text-primary\" />\n                  </div>\n                  <div>\n                    <h3 className=\"font-bold text-xl mb-2\">Suppliers</h3>\n                    <p className=\"text-sm text-muted-foreground leading-relaxed\">\n                      Manage purchase orders and maintain a comprehensive technical documentation library.\n                    </p>\n                  </div>\n                </CardContent>\n              </Card>\n            </div>\n          </div>\n        </section>\n\n        <section className=\"py-20 px-6\">\n          <div className=\"max-w-7xl mx-auto\">\n            <div className=\"text-center mb-16\">\n              <h3 className=\"text-3xl md:text-4xl font-bold mb-4\">Why Choose ILS?</h3>\n              <p className=\"text-lg text-muted-foreground max-w-2xl mx-auto\">\n                Powerful features designed to streamline your entire lens production workflow\n              </p>\n            </div>\n\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-8\">\n              <div className=\"text-center space-y-4\">\n                <div className=\"w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center mx-auto\">\n                  <Zap className=\"h-8 w-8 text-primary\" />\n                </div>\n                <h4 className=\"font-bold text-xl\">Lightning Fast</h4>\n                <p className=\"text-muted-foreground leading-relaxed\">\n                  Real-time updates and instant notifications keep everyone in sync across your entire operation.\n                </p>\n              </div>\n\n              <div className=\"text-center space-y-4\">\n                <div className=\"w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center mx-auto\">\n                  <Shield className=\"h-8 w-8 text-primary\" />\n                </div>\n                <h4 className=\"font-bold text-xl\">Secure & Reliable</h4>\n                <p className=\"text-muted-foreground leading-relaxed\">\n                  Enterprise-grade security with role-based access control and comprehensive audit trails.\n                </p>\n              </div>\n\n              <div className=\"text-center space-y-4\">\n                <div className=\"w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center mx-auto\">\n                  <BarChart3 className=\"h-8 w-8 text-primary\" />\n                </div>\n                <h4 className=\"font-bold text-xl\">Data-Driven Insights</h4>\n                <p className=\"text-muted-foreground leading-relaxed\">\n                  Advanced analytics and reporting help you make informed decisions and optimize production.\n                </p>\n              </div>\n            </div>\n          </div>\n        </section>\n\n        <section className=\"py-20 px-6 bg-gradient-to-b from-primary/5 to-background border-y border-border\">\n          <div className=\"max-w-4xl mx-auto text-center space-y-6\">\n            <h3 className=\"text-3xl md:text-4xl font-bold\">Ready to Transform Your Workflow?</h3>\n            <p className=\"text-lg text-muted-foreground\">\n              Join leading lens manufacturers and eye care professionals who trust ILS for their production management.\n            </p>\n            <div className=\"flex flex-col sm:flex-row items-center justify-center gap-4 pt-4\">\n              <Button size=\"lg\" onClick={handleEmailSignup} className=\"shadow-lg text-lg px-10 h-12\" data-testid=\"button-signup-bottom\">\n                <Mail className=\"h-5 w-5 mr-2\" />\n                Create Account\n              </Button>\n              <Button size=\"lg\" variant=\"outline\" onClick={handleReplitLogin} className=\"text-lg px-10 h-12 shadow-md\" data-testid=\"button-replit-bottom\">\n                <SiReplit className=\"h-5 w-5 mr-2\" />\n                Sign In with Replit\n              </Button>\n            </div>\n          </div>\n        </section>\n      </main>\n\n      <footer className=\"border-t border-border py-8 px-6 bg-muted/30\">\n        <div className=\"max-w-7xl mx-auto\">\n          <div className=\"flex flex-col md:flex-row items-center justify-between gap-4\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"w-8 h-8 rounded-md bg-primary flex items-center justify-center\">\n                <span className=\"text-primary-foreground font-bold text-sm\">ILS</span>\n              </div>\n              <span className=\"text-sm text-muted-foreground\">\n                &copy; {new Date().getFullYear()} Integrated Lens System. All rights reserved.\n              </span>\n            </div>\n            <div className=\"flex items-center gap-6 text-sm text-muted-foreground\">\n              <a href=\"#\" className=\"hover:text-foreground transition-colors\" data-testid=\"link-privacy\">Privacy Policy</a>\n              <a href=\"#\" className=\"hover:text-foreground transition-colors\" data-testid=\"link-terms\">Terms of Service</a>\n              <a href=\"#\" className=\"hover:text-foreground transition-colors\" data-testid=\"link-contact\">Contact</a>\n            </div>\n          </div>\n        </div>\n      </footer>\n    </div>\n  );\n}\n","size_bytes":13074},"replit.md":{"content":"# Integrated Lens System (ILS)\n\n## Overview\n\nThe Integrated Lens System (ILS) is an enterprise-grade web application designed to streamline optical lab operations. It provides a unified platform for managing lens orders, production workflows, and quality control across three primary stakeholder groups: Eye Care Professionals (ECPs), Lab Technicians, and Suppliers. The system enables ECPs to submit and track lens orders, allows lab technicians to manage production queues and quality control, and facilitates supplier coordination for materials and purchase orders.\n\nThe application is built as a modern, cloud-native platform with a focus on data clarity, professional presentation, and efficient workflows for information-dense enterprise operations.\n\n## Recent Changes\n\n**October 26, 2025 - Phase 6 Complete: OMA File Support for Lab Workflows**\n- Extended orders schema with OMA file storage: omaFileContent (text), omaFilename (varchar), omaParsedData (JSONB)\n- Created OMA parser utility (`shared/omaParser.ts`) to extract prescription data and frame tracing from text-based OMA files\n- Built OMAFileUpload component with drag-and-drop support and real-time parsing preview\n- Created OMAViewer component to display parsed prescription, frame measurements, and tracing data\n- Integrated OMA upload into NewOrderPage (step 2: Lens & Frame) with inline preview\n- Built comprehensive OrderDetailsPage showing all order information with OMA viewer when present\n- Added role-based back navigation (ECP  /ecp/dashboard, Lab  /lab/dashboard)\n- Updated ECPDashboard and LabDashboard to navigate to /order/:id on \"View details\" click\n- API endpoints: PATCH /api/orders/:id/oma (upload), GET /api/orders/:id/oma (download), DELETE /api/orders/:id/oma (remove)\n- Order creation endpoint automatically parses and stores OMA files when provided\n- End-to-end flow: order creation with OMA  storage  viewing works seamlessly\n\n**October 26, 2025 - Phase 5 Complete: User Signup & Admin Dashboard**\n- Added \"admin\" role to user_role enum and account_status field (pending/active/suspended)\n- Built SignupPage for new users to register with role selection (ecp/lab_tech/engineer/supplier) and organization details\n- Implemented PendingApprovalPage for users awaiting admin approval\n- Created AccountSuspendedPage displaying suspension reason for suspended accounts\n- Built comprehensive AdminDashboard with user statistics, searchable user table, and management actions\n- Admin features: approve pending users, suspend/activate accounts, change user roles (including admin promotion)\n- Full admin API endpoints with admin-only authorization guards (/api/admin/users, /api/admin/stats)\n- App.tsx routing enforces account status checks before role-based dashboard access\n- End-to-end testing validated complete signup flow, role changes, and account status workflows\n\n**October 26, 2025 - Phase 4 Complete: Settings Management System**\n- Created comprehensive settings database schema with `organizationSettings` and `userPreferences` tables\n- Implemented organization settings: company info, contact details, address, order configuration (prefix, lead times)\n- Built user preferences system: theme selection, language, email notification controls\n- Added role-based access control: organization settings restricted to lab staff, preferences available to all users\n- Created tabbed Settings UI with forms for organization and user preferences\n- Full CRUD API endpoints with Zod validation and proper authorization guards\n- End-to-end testing verified: settings persistence, role-based access, and UI data flow\n\n**October 26, 2025 - Phase 3 Complete: Customer Reference & PO Enhancement**\n- Added `customerReferenceNumber` field to order creation form (NewOrderPage) for better order tracking\n- Enhanced PO PDF generation to display supplier contact details (account number, email, phone)\n- Updated PO email templates to include supplier account number\n- Extended `PurchaseOrderWithDetails` TypeScript type with supplier contact fields for type safety\n- Verified end-to-end flow: customer reference field  database  API with comprehensive testing\n- All changes handle null values gracefully and maintain backward compatibility\n\n**October 26, 2025 - Phase 2 Complete: Supplier Management System**\n- Extended `users` table with supplier contact fields: `accountNumber`, `contactEmail`, `contactPhone`, and `address` (JSONB)\n- Added customer reference fields to `patients` and `orders` tables for better tracking\n- Implemented full CRUD API for supplier management (`/api/suppliers`) with lab-tech/engineer role guards\n- Built comprehensive Supplier Management UI with dialog forms and table views\n- Reorganized Lab Dashboard with tabbed interface (Orders, Purchase Orders, Suppliers)\n- All supplier operations use Zod validation and proper error handling\n\n## User Preferences\n\nPreferred communication style: Simple, everyday language.\n\n## System Architecture\n\n### Frontend Architecture\n\n**Framework and Tooling:**\n- **React with TypeScript**: Primary UI framework using functional components and hooks\n- **Vite**: Build tool and development server providing fast HMR (Hot Module Replacement)\n- **Wouter**: Lightweight routing library for client-side navigation\n- **TanStack Query (React Query)**: Server state management for data fetching, caching, and synchronization\n\n**UI Component System:**\n- **shadcn/ui with Radix UI**: Component library built on Radix UI primitives, configured in \"new-york\" style\n- **Tailwind CSS**: Utility-first CSS framework with custom design tokens\n- **Material Design Principles**: Design system focused on enterprise data presentation with clarity and efficiency\n- **Typography**: Inter font family for UI elements, JetBrains Mono for technical/monospace data\n- **Theme System**: Light/dark mode support with CSS custom properties\n\n**State Management:**\n- Server state managed via TanStack Query with aggressive caching (staleTime: Infinity)\n- Local UI state managed with React hooks (useState, useEffect)\n- Authentication state synchronized with server sessions\n\n**Key Design Decisions:**\n- Component-based architecture with reusable UI components (StatCard, OrderCard, OrderTable, etc.)\n- Path aliases configured for clean imports (@/ for client, @shared/ for shared types)\n- Responsive design with mobile-first approach using Tailwind breakpoints\n- Accessibility-first components via Radix UI primitives\n\n### Backend Architecture\n\n**Framework and Runtime:**\n- **Node.js with Express**: REST API server using Express framework\n- **TypeScript with ESM**: Type-safe backend code using ES modules\n\n**API Design:**\n- RESTful endpoints under `/api` namespace\n- Request/response middleware for JSON parsing with raw body preservation\n- Request logging middleware tracking method, path, status code, and duration\n- Structured error handling with HTTP status codes\n\n**Session Management:**\n- Express sessions with PostgreSQL storage (connect-pg-simple)\n- 7-day session TTL (time-to-live)\n- Secure, HTTP-only cookies for session tokens\n\n**Code Organization:**\n- Route handlers separated in `server/routes.ts`\n- Database access layer abstracted in `server/storage.ts` implementing IStorage interface\n- Shared types and schemas in `shared/schema.ts` for type safety across client and server\n\n### Authentication and Authorization\n\n**Replit Auth (OpenID Connect):**\n- OpenID Connect integration with Replit's authentication service\n- Passport.js strategy for OAuth flows\n- User claims stored in session with automatic token refresh\n- Memoized OIDC configuration for performance\n\n**Role-Based Access Control:**\n- Five user roles: `ecp`, `lab_tech`, `engineer`, `supplier`, `admin`\n- Account status controls access: `pending` (awaiting approval), `active` (full access), `suspended` (blocked)\n- New users default to pending status and must be approved by admin before accessing the system\n- Role stored in user profile and enforced in API endpoints\n- Frontend routing and UI adapted based on user role and account status\n- Middleware `isAuthenticated` ensures protected routes require valid sessions\n- Admin-only endpoints enforce admin role requirement for user management operations\n\n**Session Security:**\n- Sessions stored in PostgreSQL for persistence and scalability\n- Secure cookies with httpOnly and secure flags\n- Environment-based session secrets\n- Automatic session expiration and cleanup\n\n### Data Storage\n\n**Database:**\n- **PostgreSQL**: Primary relational database via Neon serverless\n- **Drizzle ORM**: Type-safe ORM with schema-first approach\n- **Connection Pooling**: Neon serverless with WebSocket support for serverless environments\n\n**Schema Design:**\n- `users`: User profiles with role, organization, account status, Replit Auth fields, and supplier contact information (accountNumber, contactEmail, contactPhone, address as JSONB, statusReason for suspensions)\n- `patients`: Patient records linked to ECPs with optional customer reference field\n- `orders`: Lens orders with prescription data, status tracking, relationships, and optional customer reference field\n- `organizationSettings`: Global organization configuration (company info, contact details, order preferences)\n- `userPreferences`: Individual user preferences (theme, language, notification settings)\n- `sessions`: Express session storage table\n- PostgreSQL enums for controlled vocabularies (user_role, order_status, account_status)\n\n**Data Access Pattern:**\n- Repository pattern via IStorage interface in `server/storage.ts`\n- Drizzle ORM provides type-safe queries with TypeScript inference\n- Shared Zod schemas (drizzle-zod) for runtime validation and type generation\n- Database migrations managed via `drizzle-kit`\n\n**Key Schema Decisions:**\n- UUID primary keys via `gen_random_uuid()` for distributed scalability\n- JSONB fields for flexible prescription data storage\n- Indexed session expiration for efficient cleanup\n- Timestamp tracking (createdAt, updatedAt) on core entities\n\n### External Dependencies\n\n**Core Infrastructure:**\n- **Neon Database**: Serverless PostgreSQL hosting with WebSocket support\n- **Replit Auth**: OAuth/OIDC authentication provider\n- **Replit Deployment**: Cloud hosting platform with automatic HTTPS\n\n**NPM Packages:**\n- **@tanstack/react-query**: ^5.60.5 - Server state management\n- **drizzle-orm**: ^0.39.1 - Database ORM\n- **@neondatabase/serverless**: ^0.10.4 - Neon PostgreSQL client\n- **express**: REST API framework\n- **passport**: ^0.7.0 - Authentication middleware\n- **openid-client**: OIDC/OAuth client\n- **connect-pg-simple**: ^10.0.0 - PostgreSQL session store\n- **zod**: Schema validation library\n- **wouter**: Client-side routing\n- **lucide-react**: Icon library\n- **date-fns**: ^3.6.0 - Date manipulation utilities\n- **tailwindcss**: Utility CSS framework\n- **@radix-ui/***: Headless UI component primitives\n\n**Development Tools:**\n- **Vite**: Frontend build tool with plugins for Replit integration\n- **TypeScript**: Type checking across entire stack\n- **tsx**: TypeScript execution for development server\n- **esbuild**: Production bundling for backend\n\n**Third-Party Integrations:**\n- Google Fonts API: Inter and JetBrains Mono font families\n- Replit-specific Vite plugins: cartographer, dev-banner, runtime-error-modal","size_bytes":11277},"client/src/components/TechnicalDocumentManager.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { FileText, Plus, Trash2, Upload } from \"lucide-react\";\nimport { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { format } from \"date-fns\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport {\n  Form,\n  FormControl,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from \"@/components/ui/form\";\n\ninterface TechnicalDoc {\n  id: string;\n  documentType: string;\n  title: string;\n  description: string | null;\n  fileUrl: string;\n  fileName: string;\n  fileSize: number | null;\n  materialName: string | null;\n  uploadedAt: string;\n}\n\nconst uploadSchema = z.object({\n  documentType: z.enum([\"spec_sheet\", \"certificate\", \"sds\", \"compliance\", \"other\"]),\n  title: z.string().min(1, \"Title is required\"),\n  description: z.string().optional(),\n  fileUrl: z.string().url(\"Valid file URL is required\"),\n  fileName: z.string().min(1, \"File name is required\"),\n  fileSize: z.number().optional(),\n  materialName: z.string().optional(),\n});\n\nfunction UploadDocumentDialog() {\n  const [open, setOpen] = useState(false);\n  const { toast } = useToast();\n\n  const form = useForm({\n    resolver: zodResolver(uploadSchema),\n    defaultValues: {\n      documentType: \"spec_sheet\" as const,\n      title: \"\",\n      description: \"\",\n      fileUrl: \"\",\n      fileName: \"\",\n      materialName: \"\",\n    },\n  });\n\n  const uploadMutation = useMutation({\n    mutationFn: async (data: z.infer<typeof uploadSchema>) => {\n      const response = await apiRequest(\"POST\", \"/api/technical-documents\", data);\n      return await response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/technical-documents\"] });\n      toast({\n        title: \"Document uploaded\",\n        description: \"The technical document has been uploaded successfully.\",\n      });\n      setOpen(false);\n      form.reset();\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Error uploading document\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const onSubmit = (data: z.infer<typeof uploadSchema>) => {\n    uploadMutation.mutate(data);\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={setOpen}>\n      <DialogTrigger asChild>\n        <Button data-testid=\"button-upload-document\">\n          <Plus className=\"h-4 w-4 mr-2\" />\n          Upload Document\n        </Button>\n      </DialogTrigger>\n      <DialogContent className=\"max-w-2xl\">\n        <Form {...form}>\n          <form onSubmit={form.handleSubmit(onSubmit)}>\n            <DialogHeader>\n              <DialogTitle>Upload Technical Document</DialogTitle>\n              <DialogDescription>\n                Upload technical specifications, certificates, or compliance documents.\n              </DialogDescription>\n            </DialogHeader>\n            <div className=\"space-y-4 py-4\">\n              <FormField\n                control={form.control}\n                name=\"documentType\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Document Type</FormLabel>\n                    <Select onValueChange={field.onChange} defaultValue={field.value}>\n                      <FormControl>\n                        <SelectTrigger data-testid=\"select-document-type\">\n                          <SelectValue />\n                        </SelectTrigger>\n                      </FormControl>\n                      <SelectContent>\n                        <SelectItem value=\"spec_sheet\">Specification Sheet</SelectItem>\n                        <SelectItem value=\"certificate\">Certificate</SelectItem>\n                        <SelectItem value=\"sds\">Safety Data Sheet (SDS)</SelectItem>\n                        <SelectItem value=\"compliance\">Compliance Document</SelectItem>\n                        <SelectItem value=\"other\">Other</SelectItem>\n                      </SelectContent>\n                    </Select>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"title\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Title</FormLabel>\n                    <FormControl>\n                      <Input {...field} placeholder=\"Document title\" data-testid=\"input-doc-title\" />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"materialName\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Material Name (Optional)</FormLabel>\n                    <FormControl>\n                      <Input {...field} placeholder=\"e.g., Polycarbonate 1.59 Index\" data-testid=\"input-material-name\" />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"description\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Description (Optional)</FormLabel>\n                    <FormControl>\n                      <Textarea {...field} placeholder=\"Additional details about this document\" data-testid=\"input-doc-description\" />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"fileUrl\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>File URL</FormLabel>\n                    <FormControl>\n                      <Input {...field} placeholder=\"https://example.com/document.pdf\" data-testid=\"input-file-url\" />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"fileName\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>File Name</FormLabel>\n                    <FormControl>\n                      <Input {...field} placeholder=\"document.pdf\" data-testid=\"input-file-name\" />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n            </div>\n            <DialogFooter>\n              <Button\n                type=\"button\"\n                variant=\"outline\"\n                onClick={() => setOpen(false)}\n                data-testid=\"button-cancel-upload\"\n              >\n                Cancel\n              </Button>\n              <Button type=\"submit\" disabled={uploadMutation.isPending} data-testid=\"button-save-document\">\n                {uploadMutation.isPending ? \"Uploading...\" : \"Upload Document\"}\n              </Button>\n            </DialogFooter>\n          </form>\n        </Form>\n      </DialogContent>\n    </Dialog>\n  );\n}\n\nexport function TechnicalDocumentManager() {\n  const { toast } = useToast();\n\n  const { data: documents, isLoading } = useQuery<TechnicalDoc[]>({\n    queryKey: [\"/api/technical-documents\"],\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (id: string) => {\n      await apiRequest(\"DELETE\", `/api/technical-documents/${id}`, {});\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/technical-documents\"] });\n      toast({\n        title: \"Document deleted\",\n        description: \"The technical document has been deleted successfully.\",\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Error deleting document\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const getDocumentTypeBadge = (type: string) => {\n    const colors: Record<string, string> = {\n      spec_sheet: \"bg-blue-500\",\n      certificate: \"bg-green-500\",\n      sds: \"bg-orange-500\",\n      compliance: \"bg-purple-500\",\n      other: \"bg-gray-500\",\n    };\n    return colors[type] || colors.other;\n  };\n\n  return (\n    <Card>\n      <CardHeader className=\"flex flex-row items-center justify-between gap-2 flex-wrap\">\n        <CardTitle>Technical Document Library</CardTitle>\n        <UploadDocumentDialog />\n      </CardHeader>\n      <CardContent>\n        {isLoading ? (\n          <div className=\"flex items-center justify-center py-8\">\n            <div className=\"w-8 h-8 border-4 border-primary border-t-transparent rounded-full animate-spin\"></div>\n          </div>\n        ) : documents && documents.length > 0 ? (\n          <Table>\n            <TableHeader>\n              <TableRow>\n                <TableHead>Type</TableHead>\n                <TableHead>Title</TableHead>\n                <TableHead>Material</TableHead>\n                <TableHead>File Name</TableHead>\n                <TableHead>Uploaded</TableHead>\n                <TableHead>Actions</TableHead>\n              </TableRow>\n            </TableHeader>\n            <TableBody>\n              {documents.map((doc) => (\n                <TableRow key={doc.id} data-testid={`row-doc-${doc.id}`}>\n                  <TableCell>\n                    <Badge className={`${getDocumentTypeBadge(doc.documentType)} text-white`}>\n                      {doc.documentType.replace(/_/g, \" \").toUpperCase()}\n                    </Badge>\n                  </TableCell>\n                  <TableCell className=\"font-medium\" data-testid={`text-doc-title-${doc.id}`}>\n                    {doc.title}\n                  </TableCell>\n                  <TableCell data-testid={`text-material-${doc.id}`}>\n                    {doc.materialName || \"-\"}\n                  </TableCell>\n                  <TableCell data-testid={`text-filename-${doc.id}`}>\n                    <a\n                      href={doc.fileUrl}\n                      target=\"_blank\"\n                      rel=\"noopener noreferrer\"\n                      className=\"text-primary hover:underline\"\n                    >\n                      {doc.fileName}\n                    </a>\n                  </TableCell>\n                  <TableCell data-testid={`text-uploaded-${doc.id}`}>\n                    {format(new Date(doc.uploadedAt), \"MMM dd, yyyy\")}\n                  </TableCell>\n                  <TableCell>\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      onClick={() => deleteMutation.mutate(doc.id)}\n                      disabled={deleteMutation.isPending}\n                      data-testid={`button-delete-doc-${doc.id}`}\n                    >\n                      <Trash2 className=\"h-4 w-4\" />\n                    </Button>\n                  </TableCell>\n                </TableRow>\n              ))}\n            </TableBody>\n          </Table>\n        ) : (\n          <div className=\"text-center py-8 text-muted-foreground\" data-testid=\"text-no-documents\">\n            No technical documents uploaded yet. Click \"Upload Document\" to add specifications, certificates, or compliance documents.\n          </div>\n        )}\n      </CardContent>\n    </Card>\n  );\n}\n","size_bytes":12224},"client/src/components/ConsultLogManager.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { MessageSquare, Plus, CheckCircle2, Clock } from \"lucide-react\";\nimport { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { format } from \"date-fns\";\n\ninterface ConsultLog {\n  id: string;\n  orderId: string;\n  ecpId: string;\n  priority: string;\n  subject: string;\n  description: string;\n  labResponse: string | null;\n  respondedAt: string | null;\n  createdAt: string;\n}\n\ninterface Order {\n  id: string;\n  orderNumber: string;\n  patient: { name: string };\n}\n\nfunction CreateConsultDialog({ orders }: { orders: Order[] }) {\n  const [open, setOpen] = useState(false);\n  const [orderId, setOrderId] = useState(\"\");\n  const [priority, setPriority] = useState(\"normal\");\n  const [subject, setSubject] = useState(\"\");\n  const [description, setDescription] = useState(\"\");\n  const { toast } = useToast();\n\n  const createMutation = useMutation({\n    mutationFn: async (data: any) => {\n      const response = await apiRequest(\"POST\", \"/api/consult-logs\", data);\n      return await response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Consult request submitted\",\n        description: \"The lab has been notified and will respond soon.\",\n      });\n      setOpen(false);\n      resetForm();\n      queryClient.invalidateQueries({ queryKey: [\"/api/consult-logs\"] });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Error submitting consult\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const resetForm = () => {\n    setOrderId(\"\");\n    setPriority(\"normal\");\n    setSubject(\"\");\n    setDescription(\"\");\n  };\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n\n    if (!orderId || !subject || !description) {\n      toast({\n        title: \"Missing required fields\",\n        description: \"Please fill in all required fields.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    createMutation.mutate({\n      orderId,\n      priority,\n      subject,\n      description,\n    });\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={setOpen}>\n      <DialogTrigger asChild>\n        <Button data-testid=\"button-create-consult\">\n          <Plus className=\"h-4 w-4 mr-2\" />\n          Request Lab Consult\n        </Button>\n      </DialogTrigger>\n      <DialogContent className=\"max-w-2xl\">\n        <form onSubmit={handleSubmit}>\n          <DialogHeader>\n            <DialogTitle>Request Lab Consultation</DialogTitle>\n            <DialogDescription>\n              Submit a question about a difficult dispense or complex prescription case.\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-4 py-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"order\">Order *</Label>\n              <Select value={orderId} onValueChange={setOrderId}>\n                <SelectTrigger id=\"order\" data-testid=\"select-consult-order\">\n                  <SelectValue placeholder=\"Select order\" />\n                </SelectTrigger>\n                <SelectContent>\n                  {orders.map((order) => (\n                    <SelectItem key={order.id} value={order.id}>\n                      {order.orderNumber} - {order.patient.name}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"priority\">Priority</Label>\n              <Select value={priority} onValueChange={setPriority}>\n                <SelectTrigger id=\"priority\" data-testid=\"select-consult-priority\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"normal\">Normal</SelectItem>\n                  <SelectItem value=\"high\">High</SelectItem>\n                  <SelectItem value=\"urgent\">Urgent</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"subject\">Subject *</Label>\n              <Input\n                id=\"subject\"\n                value={subject}\n                onChange={(e) => setSubject(e.target.value)}\n                placeholder=\"Brief description of the issue\"\n                data-testid=\"input-consult-subject\"\n              />\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"description\">Description *</Label>\n              <Textarea\n                id=\"description\"\n                value={description}\n                onChange={(e) => setDescription(e.target.value)}\n                placeholder=\"Detailed explanation of the issue, including patient concerns, fitting challenges, or technical questions\"\n                rows={6}\n                data-testid=\"input-consult-description\"\n              />\n            </div>\n          </div>\n          <DialogFooter>\n            <Button\n              type=\"button\"\n              variant=\"outline\"\n              onClick={() => setOpen(false)}\n              data-testid=\"button-cancel-consult\"\n            >\n              Cancel\n            </Button>\n            <Button type=\"submit\" disabled={createMutation.isPending} data-testid=\"button-submit-consult\">\n              {createMutation.isPending ? \"Submitting...\" : \"Submit Consult\"}\n            </Button>\n          </DialogFooter>\n        </form>\n      </DialogContent>\n    </Dialog>\n  );\n}\n\nfunction PriorityBadge({ priority }: { priority: string }) {\n  const colors: Record<string, string> = {\n    normal: \"bg-blue-500\",\n    high: \"bg-orange-500\",\n    urgent: \"bg-red-500\",\n  };\n\n  return (\n    <Badge className={`${colors[priority] || colors.normal} text-white`}>\n      {priority.toUpperCase()}\n    </Badge>\n  );\n}\n\nexport function ConsultLogManager() {\n  const { data: orders } = useQuery<Order[]>({\n    queryKey: [\"/api/orders\"],\n  });\n\n  const { data: consultLogs, isLoading } = useQuery<ConsultLog[]>({\n    queryKey: [\"/api/consult-logs\"],\n  });\n\n  const getOrderInfo = (orderId: string) => {\n    const order = orders?.find((o) => o.id === orderId);\n    return order ? `${order.orderNumber} - ${order.patient.name}` : \"Unknown Order\";\n  };\n\n  return (\n    <Card>\n      <CardHeader className=\"flex flex-row items-center justify-between gap-2 flex-wrap\">\n        <CardTitle>Lab Consultations</CardTitle>\n        <CreateConsultDialog orders={orders || []} />\n      </CardHeader>\n      <CardContent>\n        {isLoading ? (\n          <div className=\"flex items-center justify-center py-8\">\n            <div className=\"w-8 h-8 border-4 border-primary border-t-transparent rounded-full animate-spin\"></div>\n          </div>\n        ) : consultLogs && consultLogs.length > 0 ? (\n          <div className=\"space-y-4\">\n            {consultLogs.map((log) => (\n              <div\n                key={log.id}\n                className=\"border border-border rounded-md p-4 space-y-3\"\n                data-testid={`consult-log-${log.id}`}\n              >\n                <div className=\"flex items-start justify-between gap-4 flex-wrap\">\n                  <div className=\"flex-1 min-w-0\">\n                    <div className=\"flex items-center gap-2 mb-1 flex-wrap\">\n                      <h4 className=\"font-semibold\" data-testid={`consult-subject-${log.id}`}>\n                        {log.subject}\n                      </h4>\n                      <PriorityBadge priority={log.priority} />\n                      {log.labResponse ? (\n                        <Badge className=\"bg-green-500 text-white\">\n                          <CheckCircle2 className=\"h-3 w-3 mr-1\" />\n                          Answered\n                        </Badge>\n                      ) : (\n                        <Badge variant=\"outline\">\n                          <Clock className=\"h-3 w-3 mr-1\" />\n                          Pending\n                        </Badge>\n                      )}\n                    </div>\n                    <p className=\"text-sm text-muted-foreground\" data-testid={`consult-order-${log.id}`}>\n                      Order: {getOrderInfo(log.orderId)}\n                    </p>\n                  </div>\n                  <span className=\"text-xs text-muted-foreground whitespace-nowrap\" data-testid={`consult-date-${log.id}`}>\n                    {format(new Date(log.createdAt), \"MMM dd, yyyy\")}\n                  </span>\n                </div>\n\n                <div className=\"space-y-2\">\n                  <div className=\"bg-muted/50 rounded-md p-3\">\n                    <p className=\"text-sm font-medium mb-1\">Your Question:</p>\n                    <p className=\"text-sm\" data-testid={`consult-description-${log.id}`}>\n                      {log.description}\n                    </p>\n                  </div>\n\n                  {log.labResponse && (\n                    <div className=\"bg-primary/5 border border-primary/20 rounded-md p-3\">\n                      <p className=\"text-sm font-medium mb-1\">Lab Response:</p>\n                      <p className=\"text-sm\" data-testid={`consult-response-${log.id}`}>\n                        {log.labResponse}\n                      </p>\n                      {log.respondedAt && (\n                        <p className=\"text-xs text-muted-foreground mt-2\">\n                          Responded on {format(new Date(log.respondedAt), \"MMM dd, yyyy 'at' h:mm a\")}\n                        </p>\n                      )}\n                    </div>\n                  )}\n                </div>\n              </div>\n            ))}\n          </div>\n        ) : (\n          <div className=\"text-center py-8 text-muted-foreground\" data-testid=\"text-no-consults\">\n            <MessageSquare className=\"h-12 w-12 mx-auto mb-3 opacity-50\" />\n            <p>No consultations yet.</p>\n            <p className=\"text-sm mt-1\">\n              Request a lab consultation when you need help with complex prescriptions or difficult dispenses.\n            </p>\n          </div>\n        )}\n      </CardContent>\n    </Card>\n  );\n}\n","size_bytes":10718},"client/src/components/CreatePurchaseOrderDialog.tsx":{"content":"import { Button } from \"@/components/ui/button\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Plus, Trash2 } from \"lucide-react\";\nimport { useState } from \"react\";\nimport { useMutation, useQuery } from \"@tanstack/react-query\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ninterface LineItem {\n  id: string;\n  materialSKU: string;\n  description: string;\n  quantity: number;\n  unitPrice: string;\n}\n\ninterface Supplier {\n  id: string;\n  organizationName: string;\n  firstName: string;\n  lastName: string;\n}\n\nexport function CreatePurchaseOrderDialog() {\n  const [open, setOpen] = useState(false);\n  const [supplierId, setSupplierId] = useState(\"\");\n  const [notes, setNotes] = useState(\"\");\n  const [lineItems, setLineItems] = useState<LineItem[]>([\n    {\n      id: \"1\",\n      materialSKU: \"\",\n      description: \"\",\n      quantity: 1,\n      unitPrice: \"\",\n    },\n  ]);\n  const { toast } = useToast();\n\n  const { data: suppliers } = useQuery<Supplier[]>({\n    queryKey: [\"/api/suppliers\"],\n    enabled: open,\n  });\n\n  const createMutation = useMutation({\n    mutationFn: async (data: any) => {\n      const response = await apiRequest(\"POST\", \"/api/purchase-orders\", data);\n      return await response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Purchase order created\",\n        description: \"The purchase order has been sent to the supplier.\",\n      });\n      setOpen(false);\n      resetForm();\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Error creating purchase order\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const resetForm = () => {\n    setSupplierId(\"\");\n    setNotes(\"\");\n    setLineItems([\n      {\n        id: \"1\",\n        materialSKU: \"\",\n        description: \"\",\n        quantity: 1,\n        unitPrice: \"\",\n      },\n    ]);\n  };\n\n  const addLineItem = () => {\n    setLineItems([\n      ...lineItems,\n      {\n        id: Date.now().toString(),\n        materialSKU: \"\",\n        description: \"\",\n        quantity: 1,\n        unitPrice: \"\",\n      },\n    ]);\n  };\n\n  const removeLineItem = (id: string) => {\n    if (lineItems.length > 1) {\n      setLineItems(lineItems.filter((item) => item.id !== id));\n    }\n  };\n\n  const updateLineItem = (id: string, field: keyof LineItem, value: string | number) => {\n    setLineItems(\n      lineItems.map((item) => (item.id === id ? { ...item, [field]: value } : item))\n    );\n  };\n\n  const calculateTotal = () => {\n    return lineItems.reduce((sum, item) => {\n      const price = parseFloat(item.unitPrice) || 0;\n      return sum + price * item.quantity;\n    }, 0);\n  };\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n\n    if (!supplierId) {\n      toast({\n        title: \"Supplier required\",\n        description: \"Please select a supplier.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    const hasEmptyFields = lineItems.some(\n      (item) => !item.materialSKU || !item.description || !item.unitPrice\n    );\n\n    if (hasEmptyFields) {\n      toast({\n        title: \"Incomplete line items\",\n        description: \"Please fill in all fields for each line item.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    const total = calculateTotal();\n\n    createMutation.mutate({\n      supplierId,\n      notes: notes || null,\n      totalAmount: total.toFixed(2),\n      lineItems: lineItems.map((item) => ({\n        itemName: item.materialSKU,\n        description: item.description,\n        quantity: item.quantity,\n        unitPrice: item.unitPrice,\n        totalPrice: (item.quantity * parseFloat(item.unitPrice || \"0\")).toFixed(2),\n      })),\n    });\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={setOpen}>\n      <DialogTrigger asChild>\n        <Button data-testid=\"button-create-po\">\n          <Plus className=\"h-4 w-4 mr-2\" />\n          Create Purchase Order\n        </Button>\n      </DialogTrigger>\n      <DialogContent className=\"max-w-4xl max-h-[90vh] overflow-y-auto\">\n        <form onSubmit={handleSubmit}>\n          <DialogHeader>\n            <DialogTitle>Create Purchase Order</DialogTitle>\n            <DialogDescription>\n              Create a new purchase order to request materials from a supplier.\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-6 py-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"supplier\">Supplier</Label>\n              <Select value={supplierId} onValueChange={setSupplierId}>\n                <SelectTrigger id=\"supplier\" data-testid=\"select-supplier\">\n                  <SelectValue placeholder=\"Select supplier\" />\n                </SelectTrigger>\n                <SelectContent>\n                  {suppliers?.map((supplier) => (\n                    <SelectItem key={supplier.id} value={supplier.id}>\n                      {supplier.organizationName || `${supplier.firstName} ${supplier.lastName}`}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label>Line Items</Label>\n              <div className=\"space-y-3\">\n                {lineItems.map((item, index) => (\n                  <div\n                    key={item.id}\n                    className=\"border border-border rounded-md p-4 space-y-3\"\n                    data-testid={`line-item-${index}`}\n                  >\n                    <div className=\"flex items-center justify-between\">\n                      <span className=\"text-sm font-medium\">Item {index + 1}</span>\n                      {lineItems.length > 1 && (\n                        <Button\n                          type=\"button\"\n                          variant=\"outline\"\n                          size=\"sm\"\n                          onClick={() => removeLineItem(item.id)}\n                          data-testid={`button-remove-item-${index}`}\n                        >\n                          <Trash2 className=\"h-4 w-4\" />\n                        </Button>\n                      )}\n                    </div>\n                    <div className=\"grid grid-cols-2 gap-3\">\n                      <div className=\"space-y-2\">\n                        <Label>Material SKU</Label>\n                        <Input\n                          value={item.materialSKU}\n                          onChange={(e) => updateLineItem(item.id, \"materialSKU\", e.target.value)}\n                          placeholder=\"e.g., PC-159-CR\"\n                          data-testid={`input-sku-${index}`}\n                        />\n                      </div>\n                      <div className=\"space-y-2\">\n                        <Label>Description</Label>\n                        <Input\n                          value={item.description}\n                          onChange={(e) => updateLineItem(item.id, \"description\", e.target.value)}\n                          placeholder=\"e.g., Polycarbonate 1.59 w/ CR coating\"\n                          data-testid={`input-description-${index}`}\n                        />\n                      </div>\n                      <div className=\"space-y-2\">\n                        <Label>Quantity</Label>\n                        <Input\n                          type=\"number\"\n                          min=\"1\"\n                          value={item.quantity}\n                          onChange={(e) =>\n                            updateLineItem(item.id, \"quantity\", parseInt(e.target.value) || 1)\n                          }\n                          data-testid={`input-quantity-${index}`}\n                        />\n                      </div>\n                      <div className=\"space-y-2\">\n                        <Label>Unit Price ($)</Label>\n                        <Input\n                          type=\"number\"\n                          step=\"0.01\"\n                          min=\"0\"\n                          value={item.unitPrice}\n                          onChange={(e) => updateLineItem(item.id, \"unitPrice\", e.target.value)}\n                          placeholder=\"0.00\"\n                          data-testid={`input-price-${index}`}\n                        />\n                      </div>\n                    </div>\n                  </div>\n                ))}\n              </div>\n              <Button type=\"button\" variant=\"outline\" onClick={addLineItem} data-testid=\"button-add-item\">\n                <Plus className=\"h-4 w-4 mr-2\" />\n                Add Line Item\n              </Button>\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"notes\">Notes (Optional)</Label>\n              <Textarea\n                id=\"notes\"\n                value={notes}\n                onChange={(e) => setNotes(e.target.value)}\n                placeholder=\"Additional notes or special instructions\"\n                data-testid=\"input-notes\"\n              />\n            </div>\n\n            <div className=\"flex justify-between items-center pt-4 border-t\">\n              <span className=\"text-lg font-semibold\">Total Amount:</span>\n              <span className=\"text-2xl font-semibold\" data-testid=\"text-total-amount\">\n                ${calculateTotal().toFixed(2)}\n              </span>\n            </div>\n          </div>\n          <DialogFooter>\n            <Button\n              type=\"button\"\n              variant=\"outline\"\n              onClick={() => setOpen(false)}\n              data-testid=\"button-cancel-po\"\n            >\n              Cancel\n            </Button>\n            <Button type=\"submit\" disabled={createMutation.isPending} data-testid=\"button-submit-po\">\n              {createMutation.isPending ? \"Creating...\" : \"Create Purchase Order\"}\n            </Button>\n          </DialogFooter>\n        </form>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","size_bytes":10242},"client/src/components/ShipOrderDialog.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ninterface ShipOrderDialogProps {\n  orderId: string;\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n}\n\nexport function ShipOrderDialog({ orderId, open, onOpenChange }: ShipOrderDialogProps) {\n  const [trackingNumber, setTrackingNumber] = useState(\"\");\n  const { toast } = useToast();\n\n  // Reset tracking number when dialog opens\n  useEffect(() => {\n    if (open) {\n      setTrackingNumber(\"\");\n    }\n  }, [open]);\n\n  const shipMutation = useMutation({\n    mutationFn: async (data: { trackingNumber: string }) => {\n      const response = await apiRequest(\"PATCH\", `/api/orders/${orderId}/ship`, data);\n      return await response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/orders\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/stats\"] });\n      toast({\n        title: \"Order shipped\",\n        description: \"Order has been marked as shipped and customer notified.\",\n      });\n      setTrackingNumber(\"\");\n      onOpenChange(false);\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Error shipping order\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!trackingNumber.trim()) {\n      toast({\n        title: \"Tracking number required\",\n        description: \"Please enter a tracking number\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    shipMutation.mutate({ trackingNumber: trackingNumber.trim() });\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent>\n        <form onSubmit={handleSubmit}>\n          <DialogHeader>\n            <DialogTitle>Mark Order as Shipped</DialogTitle>\n            <DialogDescription>\n              Enter the tracking number to mark this order as shipped. The customer will be notified via email.\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-4 py-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"tracking\">Tracking Number</Label>\n              <Input\n                id=\"tracking\"\n                value={trackingNumber}\n                onChange={(e) => setTrackingNumber(e.target.value)}\n                placeholder=\"Enter tracking number\"\n                data-testid=\"input-tracking-number\"\n              />\n            </div>\n          </div>\n          <DialogFooter>\n            <Button\n              type=\"button\"\n              variant=\"outline\"\n              onClick={() => onOpenChange(false)}\n              data-testid=\"button-cancel-ship\"\n            >\n              Cancel\n            </Button>\n            <Button type=\"submit\" disabled={shipMutation.isPending} data-testid=\"button-ship-order\">\n              {shipMutation.isPending ? \"Shipping...\" : \"Ship Order\"}\n            </Button>\n          </DialogFooter>\n        </form>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","size_bytes":3445},"server/pdfService.ts":{"content":"import PDFDocument from \"pdfkit\";\n\ninterface POLineItem {\n  itemName: string;\n  description: string | null;\n  quantity: number;\n  unitPrice: string;\n  totalPrice: string;\n}\n\ninterface PurchaseOrder {\n  id: string;\n  poNumber: string;\n  status: string;\n  totalAmount: string | null;\n  notes: string | null;\n  expectedDeliveryDate: Date | null;\n  createdAt: Date;\n  supplier: {\n    organizationName: string | null;\n    email: string | null;\n    accountNumber: string | null;\n    contactEmail: string | null;\n    contactPhone: string | null;\n  };\n  createdBy: {\n    firstName: string | null;\n    lastName: string | null;\n  };\n  lineItems: POLineItem[];\n}\n\nexport function generatePurchaseOrderPDF(po: PurchaseOrder): PDFKit.PDFDocument {\n  const doc = new PDFDocument({ margin: 50, size: \"LETTER\" });\n\n  // Header\n  doc\n    .fontSize(24)\n    .font(\"Helvetica-Bold\")\n    .text(\"PURCHASE ORDER\", 50, 50);\n\n  // PO Number and Date\n  doc\n    .fontSize(10)\n    .font(\"Helvetica\")\n    .text(`PO Number: ${po.poNumber}`, 50, 90)\n    .text(`Date: ${new Date(po.createdAt).toLocaleDateString()}`, 50, 105)\n    .text(`Status: ${po.status.toUpperCase()}`, 50, 120);\n\n  // Supplier Information\n  doc\n    .fontSize(12)\n    .font(\"Helvetica-Bold\")\n    .text(\"SUPPLIER:\", 50, 160);\n\n  let supplierY = 180;\n  doc\n    .fontSize(10)\n    .font(\"Helvetica\")\n    .text(po.supplier.organizationName || \"N/A\", 50, supplierY);\n  \n  supplierY += 15;\n  if (po.supplier.accountNumber) {\n    doc.text(`Account: ${po.supplier.accountNumber}`, 50, supplierY);\n    supplierY += 15;\n  }\n  \n  if (po.supplier.contactEmail) {\n    doc.text(po.supplier.contactEmail, 50, supplierY);\n    supplierY += 15;\n  }\n  \n  if (po.supplier.contactPhone) {\n    doc.text(po.supplier.contactPhone, 50, supplierY);\n  }\n\n  // Lab Information\n  doc\n    .fontSize(12)\n    .font(\"Helvetica-Bold\")\n    .text(\"FROM:\", 350, 160);\n\n  doc\n    .fontSize(10)\n    .font(\"Helvetica\")\n    .text(\"Integrated Lens System\", 350, 180)\n    .text(`Created by: ${po.createdBy.firstName || \"\"} ${po.createdBy.lastName || \"\"}`, 350, 195);\n\n  // Line Items Table\n  const tableTop = 260;\n  const tableHeaders = [\"Item\", \"Description\", \"Qty\", \"Unit Price\", \"Total\"];\n  const columnWidths = [150, 150, 60, 80, 80];\n  const columnPositions = [50, 200, 350, 410, 490];\n\n  // Table Header\n  doc\n    .fontSize(10)\n    .font(\"Helvetica-Bold\")\n    .fillColor(\"#000000\");\n\n  tableHeaders.forEach((header, i) => {\n    doc.text(header, columnPositions[i], tableTop, {\n      width: columnWidths[i],\n      align: i >= 2 ? \"right\" : \"left\",\n    });\n  });\n\n  // Table Header Line\n  doc\n    .moveTo(50, tableTop + 15)\n    .lineTo(570, tableTop + 15)\n    .stroke();\n\n  // Line Items\n  let yPosition = tableTop + 25;\n  doc.font(\"Helvetica\").fontSize(9);\n\n  po.lineItems.forEach((item, index) => {\n    if (yPosition > 700) {\n      doc.addPage();\n      yPosition = 50;\n    }\n\n    doc.text(item.itemName, columnPositions[0], yPosition, {\n      width: columnWidths[0],\n    });\n\n    doc.text(item.description || \"-\", columnPositions[1], yPosition, {\n      width: columnWidths[1],\n    });\n\n    doc.text(String(item.quantity), columnPositions[2], yPosition, {\n      width: columnWidths[2],\n      align: \"right\",\n    });\n\n    doc.text(`$${parseFloat(item.unitPrice).toFixed(2)}`, columnPositions[3], yPosition, {\n      width: columnWidths[3],\n      align: \"right\",\n    });\n\n    doc.text(`$${parseFloat(item.totalPrice).toFixed(2)}`, columnPositions[4], yPosition, {\n      width: columnWidths[4],\n      align: \"right\",\n    });\n\n    yPosition += 20;\n  });\n\n  // Total\n  yPosition += 10;\n  doc\n    .moveTo(350, yPosition)\n    .lineTo(570, yPosition)\n    .stroke();\n\n  yPosition += 15;\n  doc\n    .fontSize(11)\n    .font(\"Helvetica-Bold\")\n    .text(\"TOTAL:\", 350, yPosition)\n    .text(`$${po.totalAmount ? parseFloat(po.totalAmount).toFixed(2) : \"0.00\"}`, 490, yPosition, {\n      width: 80,\n      align: \"right\",\n    });\n\n  // Notes\n  if (po.notes) {\n    yPosition += 40;\n    doc\n      .fontSize(10)\n      .font(\"Helvetica-Bold\")\n      .text(\"Notes:\", 50, yPosition);\n\n    yPosition += 15;\n    doc\n      .fontSize(9)\n      .font(\"Helvetica\")\n      .text(po.notes, 50, yPosition, {\n        width: 520,\n      });\n  }\n\n  // Expected Delivery Date\n  if (po.expectedDeliveryDate) {\n    yPosition += 30;\n    doc\n      .fontSize(10)\n      .font(\"Helvetica-Bold\")\n      .text(\"Expected Delivery:\", 50, yPosition);\n\n    doc\n      .font(\"Helvetica\")\n      .text(new Date(po.expectedDeliveryDate).toLocaleDateString(), 170, yPosition);\n  }\n\n  // Footer\n  doc\n    .fontSize(8)\n    .font(\"Helvetica\")\n    .fillColor(\"#666666\")\n    .text(\n      \"Thank you for your business\",\n      50,\n      750,\n      { align: \"center\", width: 520 }\n    );\n\n  doc.end();\n  return doc;\n}\n\ninterface PrescriptionData {\n  id: string;\n  issueDate: Date;\n  expiryDate: Date | null;\n  odSphere: string | null;\n  odCylinder: string | null;\n  odAxis: string | null;\n  odAdd: string | null;\n  osSphere: string | null;\n  osCylinder: string | null;\n  osAxis: string | null;\n  osAdd: string | null;\n  pd: string | null;\n  isSigned: boolean;\n  signedAt: Date | null;\n  patient: {\n    name: string;\n    dateOfBirth: string | null;\n    nhsNumber: string | null;\n  };\n  ecp: {\n    firstName: string | null;\n    lastName: string | null;\n  };\n}\n\nexport async function generatePrescriptionPDF(prescription: PrescriptionData): Promise<Buffer> {\n  return new Promise((resolve, reject) => {\n    const doc = new PDFDocument({ margin: 50, size: \"LETTER\" });\n    const chunks: Buffer[] = [];\n\n    doc.on('data', (chunk) => chunks.push(chunk));\n    doc.on('end', () => resolve(Buffer.concat(chunks)));\n    doc.on('error', reject);\n\n    // Header\n    doc\n      .fontSize(24)\n      .font(\"Helvetica-Bold\")\n      .text(\"OPTICAL PRESCRIPTION\", 50, 50);\n\n    // Issue Date and Expiry\n    doc\n      .fontSize(10)\n      .font(\"Helvetica\")\n      .text(`Issue Date: ${new Date(prescription.issueDate).toLocaleDateString()}`, 50, 90);\n    \n    if (prescription.expiryDate) {\n      doc.text(`Expiry Date: ${new Date(prescription.expiryDate).toLocaleDateString()}`, 50, 105);\n    }\n\n    // Patient Information\n    doc\n      .fontSize(12)\n      .font(\"Helvetica-Bold\")\n      .text(\"PATIENT INFORMATION:\", 50, 140);\n\n    let patientY = 160;\n    doc\n      .fontSize(10)\n      .font(\"Helvetica\")\n      .text(`Name: ${prescription.patient.name}`, 50, patientY);\n    \n    patientY += 15;\n    if (prescription.patient.dateOfBirth) {\n      doc.text(`Date of Birth: ${prescription.patient.dateOfBirth}`, 50, patientY);\n      patientY += 15;\n    }\n    \n    if (prescription.patient.nhsNumber) {\n      doc.text(`NHS Number: ${prescription.patient.nhsNumber}`, 50, patientY);\n      patientY += 15;\n    }\n\n    // Prescription Details\n    const prescriptionTop = patientY + 20;\n    doc\n      .fontSize(12)\n      .font(\"Helvetica-Bold\")\n      .text(\"PRESCRIPTION DETAILS:\", 50, prescriptionTop);\n\n    // Prescription Table\n    const tableTop = prescriptionTop + 30;\n    const headers = [\"\", \"Sphere\", \"Cylinder\", \"Axis\", \"Add\"];\n    const columnWidths = [60, 90, 90, 90, 90];\n    const columnPositions = [50, 110, 200, 290, 380];\n\n    // Table Header\n    doc\n      .fontSize(10)\n      .font(\"Helvetica-Bold\")\n      .fillColor(\"#000000\");\n\n    headers.forEach((header, i) => {\n      doc.text(header, columnPositions[i], tableTop, {\n        width: columnWidths[i],\n        align: i === 0 ? \"left\" : \"center\",\n      });\n    });\n\n    // Table Header Line\n    doc\n      .moveTo(50, tableTop + 15)\n      .lineTo(470, tableTop + 15)\n      .stroke();\n\n    // Right Eye (OD)\n    let yPosition = tableTop + 25;\n    doc\n      .font(\"Helvetica-Bold\")\n      .text(\"OD (Right)\", columnPositions[0], yPosition, { width: columnWidths[0] });\n\n    doc\n      .font(\"Helvetica\")\n      .text(prescription.odSphere || \"-\", columnPositions[1], yPosition, { width: columnWidths[1], align: \"center\" })\n      .text(prescription.odCylinder || \"-\", columnPositions[2], yPosition, { width: columnWidths[2], align: \"center\" })\n      .text(prescription.odAxis || \"-\", columnPositions[3], yPosition, { width: columnWidths[3], align: \"center\" })\n      .text(prescription.odAdd || \"-\", columnPositions[4], yPosition, { width: columnWidths[4], align: \"center\" });\n\n    // Left Eye (OS)\n    yPosition += 25;\n    doc\n      .font(\"Helvetica-Bold\")\n      .text(\"OS (Left)\", columnPositions[0], yPosition, { width: columnWidths[0] });\n\n    doc\n      .font(\"Helvetica\")\n      .text(prescription.osSphere || \"-\", columnPositions[1], yPosition, { width: columnWidths[1], align: \"center\" })\n      .text(prescription.osCylinder || \"-\", columnPositions[2], yPosition, { width: columnWidths[2], align: \"center\" })\n      .text(prescription.osAxis || \"-\", columnPositions[3], yPosition, { width: columnWidths[3], align: \"center\" })\n      .text(prescription.osAdd || \"-\", columnPositions[4], yPosition, { width: columnWidths[4], align: \"center\" });\n\n    // PD (Pupillary Distance)\n    yPosition += 30;\n    doc\n      .fontSize(10)\n      .font(\"Helvetica-Bold\")\n      .text(\"PD (Pupillary Distance):\", 50, yPosition);\n\n    doc\n      .font(\"Helvetica\")\n      .text(prescription.pd || \"Not specified\", 200, yPosition);\n\n    // Prescriber Information\n    yPosition += 50;\n    doc\n      .fontSize(12)\n      .font(\"Helvetica-Bold\")\n      .text(\"PRESCRIBER INFORMATION:\", 50, yPosition);\n\n    yPosition += 20;\n    doc\n      .fontSize(10)\n      .font(\"Helvetica\")\n      .text(`Prescribed by: ${prescription.ecp.firstName || \"\"} ${prescription.ecp.lastName || \"\"}`, 50, yPosition);\n\n    if (prescription.isSigned && prescription.signedAt) {\n      yPosition += 15;\n      doc.text(`Signed on: ${new Date(prescription.signedAt).toLocaleDateString()}`, 50, yPosition);\n    }\n\n    // Signature status\n    yPosition += 30;\n    if (prescription.isSigned) {\n      doc\n        .fontSize(10)\n        .font(\"Helvetica-Bold\")\n        .fillColor(\"#008000\")\n        .text(\" Digitally Signed\", 50, yPosition);\n    } else {\n      doc\n        .fontSize(10)\n        .font(\"Helvetica\")\n        .fillColor(\"#ff0000\")\n        .text(\" Not Signed\", 50, yPosition);\n    }\n\n    // Footer\n    doc\n      .fontSize(8)\n      .font(\"Helvetica\")\n      .fillColor(\"#666666\")\n      .text(\n        \"This prescription is valid for the period specified above. Please consult your eye care professional if you have any questions.\",\n        50,\n        750,\n        { align: \"center\", width: 520 }\n      );\n\n    doc.end();\n  });\n}\n","size_bytes":10447},"server/emailService.ts":{"content":"import { Resend } from 'resend';\n\nlet connectionSettings: any;\n\nasync function getCredentials() {\n  const hostname = process.env.REPLIT_CONNECTORS_HOSTNAME;\n  const xReplitToken = process.env.REPL_IDENTITY \n    ? 'repl ' + process.env.REPL_IDENTITY \n    : process.env.WEB_REPL_RENEWAL \n    ? 'depl ' + process.env.WEB_REPL_RENEWAL \n    : null;\n\n  if (!xReplitToken) {\n    throw new Error('X_REPLIT_TOKEN not found for repl/depl');\n  }\n\n  connectionSettings = await fetch(\n    'https://' + hostname + '/api/v2/connection?include_secrets=true&connector_names=resend',\n    {\n      headers: {\n        'Accept': 'application/json',\n        'X_REPLIT_TOKEN': xReplitToken\n      }\n    }\n  ).then(res => res.json()).then(data => data.items?.[0]);\n\n  if (!connectionSettings || (!connectionSettings.settings.api_key)) {\n    throw new Error('Resend not connected');\n  }\n  return {apiKey: connectionSettings.settings.api_key, fromEmail: connectionSettings.settings.from_email};\n}\n\nasync function getResendClient() {\n  const { apiKey, fromEmail } = await getCredentials();\n  return {\n    client: new Resend(apiKey),\n    fromEmail: fromEmail\n  };\n}\n\nexport async function sendPurchaseOrderEmail(\n  supplierEmail: string,\n  supplierName: string,\n  poNumber: string,\n  pdfBuffer: Buffer,\n  accountNumber?: string\n): Promise<void> {\n  const { client, fromEmail } = await getResendClient();\n\n  await client.emails.send({\n    from: fromEmail,\n    to: supplierEmail,\n    subject: `Purchase Order ${poNumber} - Integrated Lens System`,\n    html: `\n      <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;\">\n        <h2 style=\"color: #A76111;\">New Purchase Order</h2>\n        <p>Dear ${supplierName},</p>\n        ${accountNumber ? `<p style=\"color: #666; font-size: 14px;\">Account Number: <strong>${accountNumber}</strong></p>` : ''}\n        <p>Please find attached Purchase Order <strong>${poNumber}</strong> from Integrated Lens System.</p>\n        <p>Please review the attached PDF and confirm receipt at your earliest convenience.</p>\n        <p>If you have any questions, please contact us.</p>\n        <br/>\n        <p>Best regards,<br/>\n        <strong>Integrated Lens System</strong></p>\n      </div>\n    `,\n    attachments: [\n      {\n        filename: `PO-${poNumber}.pdf`,\n        content: pdfBuffer,\n      }\n    ],\n  });\n}\n\nexport async function sendShipmentNotificationEmail(\n  ecpEmail: string,\n  ecpName: string,\n  orderNumber: string,\n  patientName: string,\n  trackingNumber: string\n): Promise<void> {\n  const { client, fromEmail } = await getResendClient();\n\n  await client.emails.send({\n    from: fromEmail,\n    to: ecpEmail,\n    subject: `Order ${orderNumber} Shipped - Tracking Available`,\n    html: `\n      <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;\">\n        <h2 style=\"color: #A76111;\">Order Shipped</h2>\n        <p>Dear ${ecpName},</p>\n        <p>Great news! Order <strong>${orderNumber}</strong> for patient <strong>${patientName}</strong> has been shipped.</p>\n        <div style=\"background-color: #f5f5f5; padding: 15px; border-radius: 5px; margin: 20px 0;\">\n          <p style=\"margin: 0;\"><strong>Tracking Number:</strong></p>\n          <p style=\"font-size: 18px; color: #A76111; margin: 10px 0;\"><strong>${trackingNumber}</strong></p>\n        </div>\n        <p>You can use this tracking number to monitor the shipment status with your carrier.</p>\n        <p>The order should arrive within the estimated delivery timeframe.</p>\n        <br/>\n        <p>Best regards,<br/>\n        <strong>Integrated Lens System</strong></p>\n      </div>\n    `,\n  });\n}\n\ninterface PrescriptionEmailData {\n  id: string;\n  patient: {\n    name: string;\n    email: string | null;\n  };\n  ecp: {\n    firstName: string | null;\n    lastName: string | null;\n  };\n}\n\nexport async function sendPrescriptionEmail(prescription: PrescriptionEmailData): Promise<void> {\n  const { client, fromEmail } = await getResendClient();\n\n  if (!prescription.patient.email) {\n    throw new Error('Patient email is required');\n  }\n\n  const { generatePrescriptionPDF } = await import('./pdfService');\n  const pdfBuffer = await generatePrescriptionPDF(prescription as any);\n\n  const ecpName = `${prescription.ecp.firstName || \"\"} ${prescription.ecp.lastName || \"\"}`.trim() || \"Your Eye Care Professional\";\n\n  await client.emails.send({\n    from: fromEmail,\n    to: prescription.patient.email,\n    subject: `Your Optical Prescription - ${prescription.patient.name}`,\n    html: `\n      <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;\">\n        <h2 style=\"color: #A76111;\">Your Optical Prescription</h2>\n        <p>Dear ${prescription.patient.name},</p>\n        <p>Please find attached your optical prescription from <strong>${ecpName}</strong>.</p>\n        <p>This prescription has been prepared based on your recent eye examination.</p>\n        <div style=\"background-color: #f5f5f5; padding: 15px; border-radius: 5px; margin: 20px 0;\">\n          <p style=\"margin: 0; font-size: 14px;\"><strong>Important Notes:</strong></p>\n          <ul style=\"margin: 10px 0; padding-left: 20px; font-size: 14px;\">\n            <li>This prescription is valid for the period specified in the document</li>\n            <li>Keep this prescription for your records</li>\n            <li>Contact us if you have any questions or concerns</li>\n          </ul>\n        </div>\n        <p>If you need clarification or would like to discuss your prescription, please contact our practice.</p>\n        <br/>\n        <p>Best regards,<br/>\n        <strong>${ecpName}</strong></p>\n      </div>\n    `,\n    attachments: [\n      {\n        filename: `prescription-${prescription.id}.pdf`,\n        content: pdfBuffer,\n      }\n    ],\n  });\n}\n","size_bytes":5757},"client/src/components/SupplierManagementDialog.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { insertSupplierSchema, type InsertSupplier, type User } from \"@shared/schema\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport {\n  Form,\n  FormControl,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from \"@/components/ui/form\";\n\ninterface SupplierManagementDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  supplier?: User | null;\n}\n\nexport function SupplierManagementDialog({\n  open,\n  onOpenChange,\n  supplier,\n}: SupplierManagementDialogProps) {\n  const { toast } = useToast();\n  const isEditing = !!supplier;\n\n  const form = useForm<InsertSupplier>({\n    resolver: zodResolver(insertSupplierSchema),\n    defaultValues: {\n      organizationName: \"\",\n      email: \"\",\n      accountNumber: \"\",\n      contactEmail: \"\",\n      contactPhone: \"\",\n      address: {\n        street: \"\",\n        city: \"\",\n        state: \"\",\n        zipCode: \"\",\n        country: \"\",\n      },\n    },\n  });\n\n  useEffect(() => {\n    if (open && supplier) {\n      form.reset({\n        organizationName: supplier.organizationName || \"\",\n        email: supplier.email || \"\",\n        accountNumber: supplier.accountNumber || \"\",\n        contactEmail: supplier.contactEmail || \"\",\n        contactPhone: supplier.contactPhone || \"\",\n        address: supplier.address as any || {\n          street: \"\",\n          city: \"\",\n          state: \"\",\n          zipCode: \"\",\n          country: \"\",\n        },\n      });\n    } else if (open && !supplier) {\n      form.reset({\n        organizationName: \"\",\n        email: \"\",\n        accountNumber: \"\",\n        contactEmail: \"\",\n        contactPhone: \"\",\n        address: {\n          street: \"\",\n          city: \"\",\n          state: \"\",\n          zipCode: \"\",\n          country: \"\",\n        },\n      });\n    }\n  }, [open, supplier, form]);\n\n  const createMutation = useMutation({\n    mutationFn: async (data: InsertSupplier) => {\n      const response = await apiRequest(\"POST\", \"/api/suppliers\", data);\n      return await response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/suppliers\"] });\n      toast({\n        title: \"Supplier created\",\n        description: \"The supplier has been created successfully.\",\n      });\n      onOpenChange(false);\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Error creating supplier\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: async (data: InsertSupplier) => {\n      const response = await apiRequest(\"PATCH\", `/api/suppliers/${supplier?.id}`, data);\n      return await response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/suppliers\"] });\n      toast({\n        title: \"Supplier updated\",\n        description: \"The supplier has been updated successfully.\",\n      });\n      onOpenChange(false);\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Error updating supplier\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const onSubmit = (data: InsertSupplier) => {\n    if (isEditing) {\n      updateMutation.mutate(data);\n    } else {\n      createMutation.mutate(data);\n    }\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\" data-testid=\"dialog-supplier-management\">\n        <DialogHeader>\n          <DialogTitle data-testid=\"text-dialog-title\">\n            {isEditing ? \"Edit Supplier\" : \"Add New Supplier\"}\n          </DialogTitle>\n          <DialogDescription>\n            {isEditing\n              ? \"Update the supplier information below.\"\n              : \"Enter the details for the new supplier.\"}\n          </DialogDescription>\n        </DialogHeader>\n\n        <Form {...form}>\n          <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n            <FormField\n              control={form.control}\n              name=\"organizationName\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Organization Name *</FormLabel>\n                  <FormControl>\n                    <Input\n                      {...field}\n                      placeholder=\"ABC Lens Company\"\n                      data-testid=\"input-organization-name\"\n                    />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name=\"accountNumber\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Account Number</FormLabel>\n                  <FormControl>\n                    <Input\n                      {...field}\n                      placeholder=\"ACCT-12345\"\n                      data-testid=\"input-account-number\"\n                    />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <div className=\"grid grid-cols-2 gap-4\">\n              <FormField\n                control={form.control}\n                name=\"email\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Login Email</FormLabel>\n                    <FormControl>\n                      <Input\n                        {...field}\n                        type=\"email\"\n                        placeholder=\"supplier@example.com\"\n                        data-testid=\"input-email\"\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"contactEmail\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Contact Email</FormLabel>\n                    <FormControl>\n                      <Input\n                        {...field}\n                        type=\"email\"\n                        placeholder=\"orders@example.com\"\n                        data-testid=\"input-contact-email\"\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n            </div>\n\n            <FormField\n              control={form.control}\n              name=\"contactPhone\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Contact Phone</FormLabel>\n                  <FormControl>\n                    <Input\n                      {...field}\n                      placeholder=\"(555) 123-4567\"\n                      data-testid=\"input-contact-phone\"\n                    />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <div className=\"space-y-3\">\n              <Label>Address</Label>\n              <FormField\n                control={form.control}\n                name=\"address.street\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormControl>\n                      <Input\n                        {...field}\n                        placeholder=\"Street Address\"\n                        data-testid=\"input-address-street\"\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <div className=\"grid grid-cols-2 gap-4\">\n                <FormField\n                  control={form.control}\n                  name=\"address.city\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormControl>\n                        <Input\n                          {...field}\n                          placeholder=\"City\"\n                          data-testid=\"input-address-city\"\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"address.state\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormControl>\n                        <Input\n                          {...field}\n                          placeholder=\"State/Province\"\n                          data-testid=\"input-address-state\"\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              </div>\n\n              <div className=\"grid grid-cols-2 gap-4\">\n                <FormField\n                  control={form.control}\n                  name=\"address.zipCode\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormControl>\n                        <Input\n                          {...field}\n                          placeholder=\"Zip/Postal Code\"\n                          data-testid=\"input-address-zip\"\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"address.country\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormControl>\n                        <Input\n                          {...field}\n                          placeholder=\"Country\"\n                          data-testid=\"input-address-country\"\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              </div>\n            </div>\n\n            <DialogFooter>\n              <Button\n                type=\"button\"\n                variant=\"outline\"\n                onClick={() => onOpenChange(false)}\n                data-testid=\"button-cancel\"\n              >\n                Cancel\n              </Button>\n              <Button\n                type=\"submit\"\n                disabled={createMutation.isPending || updateMutation.isPending}\n                data-testid=\"button-save-supplier\"\n              >\n                {isEditing ? \"Update Supplier\" : \"Add Supplier\"}\n              </Button>\n            </DialogFooter>\n          </form>\n        </Form>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","size_bytes":11254},"client/src/components/SuppliersTable.tsx":{"content":"import { useState } from \"react\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport { Edit, Trash2, Plus } from \"lucide-react\";\nimport { useMutation, useQuery } from \"@tanstack/react-query\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { SupplierManagementDialog } from \"./SupplierManagementDialog\";\nimport type { User } from \"@shared/schema\";\n\nexport function SuppliersTable() {\n  const [dialogOpen, setDialogOpen] = useState(false);\n  const [selectedSupplier, setSelectedSupplier] = useState<User | null>(null);\n  const [deleteDialogOpen, setDeleteDialogOpen] = useState(false);\n  const [supplierToDelete, setSupplierToDelete] = useState<User | null>(null);\n  const { toast } = useToast();\n\n  const { data: suppliers, isLoading } = useQuery<User[]>({\n    queryKey: [\"/api/suppliers\"],\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (id: string) => {\n      const response = await apiRequest(\"DELETE\", `/api/suppliers/${id}`, {});\n      return await response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/suppliers\"] });\n      toast({\n        title: \"Supplier deleted\",\n        description: \"The supplier has been deleted successfully.\",\n      });\n      setDeleteDialogOpen(false);\n      setSupplierToDelete(null);\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Error deleting supplier\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleAddNew = () => {\n    setSelectedSupplier(null);\n    setDialogOpen(true);\n  };\n\n  const handleEdit = (supplier: User) => {\n    setSelectedSupplier(supplier);\n    setDialogOpen(true);\n  };\n\n  const handleDeleteClick = (supplier: User) => {\n    setSupplierToDelete(supplier);\n    setDeleteDialogOpen(true);\n  };\n\n  const handleDeleteConfirm = () => {\n    if (supplierToDelete) {\n      deleteMutation.mutate(supplierToDelete.id);\n    }\n  };\n\n  if (isLoading) {\n    return (\n      <Card>\n        <CardHeader>\n          <CardTitle>Suppliers</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"text-center py-8\">\n            <div className=\"w-8 h-8 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto\"></div>\n          </div>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <>\n      <Card>\n        <CardHeader className=\"flex flex-row items-center justify-between gap-2\">\n          <CardTitle>Suppliers</CardTitle>\n          <Button onClick={handleAddNew} data-testid=\"button-add-supplier\">\n            <Plus className=\"h-4 w-4 mr-2\" />\n            Add Supplier\n          </Button>\n        </CardHeader>\n        <CardContent>\n          {!suppliers || suppliers.length === 0 ? (\n            <div className=\"text-center py-8\">\n              <p className=\"text-muted-foreground\">No suppliers found. Add your first supplier to get started.</p>\n            </div>\n          ) : (\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead>Organization</TableHead>\n                  <TableHead>Account Number</TableHead>\n                  <TableHead>Contact Email</TableHead>\n                  <TableHead>Contact Phone</TableHead>\n                  <TableHead>Actions</TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {suppliers.map((supplier) => (\n                  <TableRow key={supplier.id} data-testid={`row-supplier-${supplier.id}`}>\n                    <TableCell className=\"font-medium\" data-testid={`text-org-name-${supplier.id}`}>\n                      {supplier.organizationName || \"N/A\"}\n                    </TableCell>\n                    <TableCell data-testid={`text-account-number-${supplier.id}`}>\n                      {supplier.accountNumber || \"N/A\"}\n                    </TableCell>\n                    <TableCell data-testid={`text-contact-email-${supplier.id}`}>\n                      {supplier.contactEmail || supplier.email || \"N/A\"}\n                    </TableCell>\n                    <TableCell data-testid={`text-contact-phone-${supplier.id}`}>\n                      {supplier.contactPhone || \"N/A\"}\n                    </TableCell>\n                    <TableCell>\n                      <div className=\"flex gap-2\">\n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          onClick={() => handleEdit(supplier)}\n                          data-testid={`button-edit-supplier-${supplier.id}`}\n                        >\n                          <Edit className=\"h-4 w-4\" />\n                        </Button>\n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          onClick={() => handleDeleteClick(supplier)}\n                          data-testid={`button-delete-supplier-${supplier.id}`}\n                        >\n                          <Trash2 className=\"h-4 w-4\" />\n                        </Button>\n                      </div>\n                    </TableCell>\n                  </TableRow>\n                ))}\n              </TableBody>\n            </Table>\n          )}\n        </CardContent>\n      </Card>\n\n      <SupplierManagementDialog\n        open={dialogOpen}\n        onOpenChange={setDialogOpen}\n        supplier={selectedSupplier}\n      />\n\n      <AlertDialog open={deleteDialogOpen} onOpenChange={setDeleteDialogOpen}>\n        <AlertDialogContent data-testid=\"dialog-delete-supplier\">\n          <AlertDialogHeader>\n            <AlertDialogTitle>Are you sure?</AlertDialogTitle>\n            <AlertDialogDescription>\n              This will permanently delete the supplier \"{supplierToDelete?.organizationName}\".\n              This action cannot be undone.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel data-testid=\"button-cancel-delete\">Cancel</AlertDialogCancel>\n            <AlertDialogAction\n              onClick={handleDeleteConfirm}\n              disabled={deleteMutation.isPending}\n              data-testid=\"button-confirm-delete\"\n            >\n              Delete\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </>\n  );\n}\n","size_bytes":6813},"client/src/pages/AccountSuspendedPage.tsx":{"content":"import { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { AlertTriangle, LogOut } from \"lucide-react\";\nimport { useLocation } from \"wouter\";\n\nexport default function AccountSuspendedPage() {\n  const [location] = useLocation();\n  const searchParams = new URLSearchParams(location.split('?')[1]);\n  const reason = searchParams.get('reason');\n\n  const handleLogout = () => {\n    window.location.href = '/api/auth/logout';\n  };\n\n  return (\n    <div className=\"flex items-center justify-center min-h-screen p-4\">\n      <Card className=\"w-full max-w-md border-destructive\">\n        <CardHeader className=\"text-center\">\n          <div className=\"mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full bg-destructive/10\">\n            <AlertTriangle className=\"h-8 w-8 text-destructive\" />\n          </div>\n          <CardTitle className=\"text-2xl\">Account Suspended</CardTitle>\n          <CardDescription>\n            Your account has been suspended by an administrator\n          </CardDescription>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          {reason && (\n            <div className=\"rounded-md bg-destructive/10 border border-destructive/20 p-4\">\n              <p className=\"text-sm font-medium mb-1\">Suspension Reason:</p>\n              <p className=\"text-sm text-muted-foreground\">{reason}</p>\n            </div>\n          )}\n          <div className=\"rounded-md bg-muted p-4\">\n            <p className=\"text-sm text-muted-foreground\">\n              If you believe this is a mistake, please contact support for assistance.\n            </p>\n          </div>\n          <div className=\"flex flex-col gap-2\">\n            <Button\n              variant=\"outline\"\n              onClick={handleLogout}\n              className=\"w-full\"\n              data-testid=\"button-logout\"\n            >\n              <LogOut className=\"mr-2 h-4 w-4\" />\n              Sign Out\n            </Button>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":2089},"client/src/pages/AdminDashboard.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Users, UserCheck, UserX, Clock, CheckCircle, XCircle, Ban, Shield } from \"lucide-react\";\n\ntype User = {\n  id: string;\n  email: string;\n  firstName: string | null;\n  lastName: string | null;\n  role: \"ecp\" | \"lab_tech\" | \"engineer\" | \"supplier\" | \"admin\" | null;\n  accountStatus: \"pending\" | \"active\" | \"suspended\";\n  statusReason: string | null;\n  organizationName: string | null;\n  createdAt: string;\n};\n\nexport default function AdminDashboard() {\n  const { toast } = useToast();\n  const [selectedUser, setSelectedUser] = useState<User | null>(null);\n  const [actionDialog, setActionDialog] = useState<{\n    type: \"approve\" | \"suspend\" | \"activate\" | \"change-role\" | null;\n    user: User | null;\n  }>({type: null, user: null});\n  const [suspensionReason, setSuspensionReason] = useState(\"\");\n  const [newRole, setNewRole] = useState<string>(\"\");\n\n  const { data: users = [], isLoading } = useQuery<User[]>({\n    queryKey: [\"/api/admin/users\"],\n  });\n\n  const { data: stats } = useQuery<{\n    total: number;\n    pending: number;\n    active: number;\n    suspended: number;\n  }>({\n    queryKey: [\"/api/admin/stats\"],\n  });\n\n  const updateUserMutation = useMutation({\n    mutationFn: async (data: { userId: string; updates: any }) => {\n      const response = await apiRequest(\"PATCH\", `/api/admin/users/${data.userId}`, data.updates);\n      return await response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/users\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/stats\"] });\n      setActionDialog({ type: null, user: null });\n      setSuspensionReason(\"\");\n      setNewRole(\"\");\n      toast({\n        title: \"User updated successfully\",\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Update failed\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleApprove = (user: User) => {\n    updateUserMutation.mutate({\n      userId: user.id,\n      updates: { accountStatus: \"active\" },\n    });\n  };\n\n  const handleSuspend = () => {\n    if (!actionDialog.user) return;\n    updateUserMutation.mutate({\n      userId: actionDialog.user.id,\n      updates: {\n        accountStatus: \"suspended\",\n        statusReason: suspensionReason || \"Suspended by administrator\",\n      },\n    });\n  };\n\n  const handleActivate = (user: User) => {\n    updateUserMutation.mutate({\n      userId: user.id,\n      updates: { accountStatus: \"active\", statusReason: null },\n    });\n  };\n\n  const handleChangeRole = () => {\n    if (!actionDialog.user || !newRole) return;\n    updateUserMutation.mutate({\n      userId: actionDialog.user.id,\n      updates: { role: newRole },\n    });\n  };\n\n  const getUserName = (user: User) => {\n    if (user.firstName && user.lastName) {\n      return `${user.firstName} ${user.lastName}`;\n    }\n    return user.email || \"Unknown User\";\n  };\n\n  const getStatusBadge = (status: string) => {\n    switch (status) {\n      case \"active\":\n        return <Badge variant=\"default\" className=\"bg-green-500\">Active</Badge>;\n      case \"pending\":\n        return <Badge variant=\"secondary\">Pending</Badge>;\n      case \"suspended\":\n        return <Badge variant=\"destructive\">Suspended</Badge>;\n      default:\n        return <Badge>{status}</Badge>;\n    }\n  };\n\n  const getRoleBadge = (role: string | null) => {\n    if (!role) return <Badge variant=\"outline\">No Role</Badge>;\n    \n    const roleLabels: Record<string, string> = {\n      ecp: \"ECP\",\n      lab_tech: \"Lab Tech\",\n      engineer: \"Engineer\",\n      supplier: \"Supplier\",\n      admin: \"Admin\",\n    };\n    \n    return <Badge variant=\"outline\">{roleLabels[role] || role}</Badge>;\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center p-12\">\n        <div className=\"text-center\">\n          <div className=\"w-16 h-16 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-4\"></div>\n          <p className=\"text-muted-foreground\">Loading users...</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <div>\n        <h1 className=\"text-3xl font-bold\" data-testid=\"text-page-title\">Admin Dashboard</h1>\n        <p className=\"text-muted-foreground\">Manage users and platform access</p>\n      </div>\n\n      {/* Statistics Cards */}\n      <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Total Users</CardTitle>\n            <Users className=\"h-4 w-4 text-muted-foreground\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\" data-testid=\"stat-total-users\">{stats?.total || 0}</div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Pending Approval</CardTitle>\n            <Clock className=\"h-4 w-4 text-yellow-500\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\" data-testid=\"stat-pending-users\">{stats?.pending || 0}</div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Active Users</CardTitle>\n            <UserCheck className=\"h-4 w-4 text-green-500\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\" data-testid=\"stat-active-users\">{stats?.active || 0}</div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Suspended</CardTitle>\n            <UserX className=\"h-4 w-4 text-destructive\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\" data-testid=\"stat-suspended-users\">{stats?.suspended || 0}</div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Users Table */}\n      <Card>\n        <CardHeader>\n          <CardTitle>All Users</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"overflow-x-auto\">\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead>Name</TableHead>\n                  <TableHead>Email</TableHead>\n                  <TableHead>Organization</TableHead>\n                  <TableHead>Role</TableHead>\n                  <TableHead>Status</TableHead>\n                  <TableHead>Registered</TableHead>\n                  <TableHead>Actions</TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {users.length === 0 ? (\n                  <TableRow>\n                    <TableCell colSpan={7} className=\"text-center text-muted-foreground\">\n                      No users found\n                    </TableCell>\n                  </TableRow>\n                ) : (\n                  users.map((user) => (\n                    <TableRow key={user.id} data-testid={`row-user-${user.id}`}>\n                      <TableCell className=\"font-medium\">{getUserName(user)}</TableCell>\n                      <TableCell>{user.email}</TableCell>\n                      <TableCell>{user.organizationName || \"-\"}</TableCell>\n                      <TableCell>{getRoleBadge(user.role)}</TableCell>\n                      <TableCell>{getStatusBadge(user.accountStatus)}</TableCell>\n                      <TableCell>{new Date(user.createdAt).toLocaleDateString()}</TableCell>\n                      <TableCell>\n                        <div className=\"flex gap-2 flex-wrap\">\n                          {user.accountStatus === \"pending\" && (\n                            <Button\n                              size=\"sm\"\n                              variant=\"default\"\n                              onClick={() => handleApprove(user)}\n                              data-testid={`button-approve-${user.id}`}\n                            >\n                              <CheckCircle className=\"h-4 w-4 mr-1\" />\n                              Approve\n                            </Button>\n                          )}\n                          \n                          {user.accountStatus === \"active\" && (\n                            <Button\n                              size=\"sm\"\n                              variant=\"destructive\"\n                              onClick={() => setActionDialog({ type: \"suspend\", user })}\n                              data-testid={`button-suspend-${user.id}`}\n                            >\n                              <Ban className=\"h-4 w-4 mr-1\" />\n                              Suspend\n                            </Button>\n                          )}\n                          \n                          {user.accountStatus === \"suspended\" && (\n                            <Button\n                              size=\"sm\"\n                              variant=\"default\"\n                              onClick={() => handleActivate(user)}\n                              data-testid={`button-activate-${user.id}`}\n                            >\n                              <CheckCircle className=\"h-4 w-4 mr-1\" />\n                              Activate\n                            </Button>\n                          )}\n                          \n                          {user.role && user.role !== \"admin\" && (\n                            <Button\n                              size=\"sm\"\n                              variant=\"outline\"\n                              onClick={() => {\n                                setNewRole(user.role || \"\");\n                                setActionDialog({ type: \"change-role\", user });\n                              }}\n                              data-testid={`button-change-role-${user.id}`}\n                            >\n                              <Shield className=\"h-4 w-4 mr-1\" />\n                              Change Role\n                            </Button>\n                          )}\n                        </div>\n                      </TableCell>\n                    </TableRow>\n                  ))\n                )}\n              </TableBody>\n            </Table>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Suspension Dialog */}\n      <Dialog open={actionDialog.type === \"suspend\"} onOpenChange={(open) => !open && setActionDialog({ type: null, user: null })}>\n        <DialogContent data-testid=\"dialog-suspend-user\">\n          <DialogHeader>\n            <DialogTitle>Suspend User Account</DialogTitle>\n            <DialogDescription>\n              This will suspend {actionDialog.user && getUserName(actionDialog.user)}'s account and prevent them from accessing the system.\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-4 py-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"suspension-reason\">Reason for Suspension</Label>\n              <Textarea\n                id=\"suspension-reason\"\n                placeholder=\"Enter reason for suspension...\"\n                value={suspensionReason}\n                onChange={(e) => setSuspensionReason(e.target.value)}\n                data-testid=\"input-suspension-reason\"\n              />\n            </div>\n          </div>\n          <DialogFooter>\n            <Button\n              variant=\"outline\"\n              onClick={() => setActionDialog({ type: null, user: null })}\n              data-testid=\"button-cancel-suspend\"\n            >\n              Cancel\n            </Button>\n            <Button\n              variant=\"destructive\"\n              onClick={handleSuspend}\n              disabled={updateUserMutation.isPending}\n              data-testid=\"button-confirm-suspend\"\n            >\n              Suspend Account\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* Change Role Dialog */}\n      <Dialog open={actionDialog.type === \"change-role\"} onOpenChange={(open) => !open && setActionDialog({ type: null, user: null })}>\n        <DialogContent data-testid=\"dialog-change-role\">\n          <DialogHeader>\n            <DialogTitle>Change User Role</DialogTitle>\n            <DialogDescription>\n              Update the role for {actionDialog.user && getUserName(actionDialog.user)}\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-4 py-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"new-role\">New Role</Label>\n              <Select value={newRole} onValueChange={setNewRole}>\n                <SelectTrigger id=\"new-role\" data-testid=\"select-new-role\">\n                  <SelectValue placeholder=\"Select new role\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"ecp\">Eye Care Professional</SelectItem>\n                  <SelectItem value=\"lab_tech\">Lab Technician</SelectItem>\n                  <SelectItem value=\"engineer\">Engineer</SelectItem>\n                  <SelectItem value=\"supplier\">Supplier</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n          </div>\n          <DialogFooter>\n            <Button\n              variant=\"outline\"\n              onClick={() => setActionDialog({ type: null, user: null })}\n              data-testid=\"button-cancel-role-change\"\n            >\n              Cancel\n            </Button>\n            <Button\n              onClick={handleChangeRole}\n              disabled={updateUserMutation.isPending || !newRole}\n              data-testid=\"button-confirm-role-change\"\n            >\n              Update Role\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","size_bytes":14857},"client/src/pages/SignupPage.tsx":{"content":"import { useState } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Loader2 } from \"lucide-react\";\n\nexport default function SignupPage() {\n  const { user, isLoading: authLoading } = useAuth();\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n\n  const [formData, setFormData] = useState({\n    role: \"\" as \"ecp\" | \"lab_tech\" | \"engineer\" | \"supplier\" | \"admin\" | \"\",\n    organizationName: \"\",\n    adminSetupKey: \"\",\n  });\n\n  const signupMutation = useMutation({\n    mutationFn: async (data: { role: string; organizationName: string; adminSetupKey?: string }) => {\n      const response = await apiRequest(\"POST\", \"/api/auth/complete-signup\", data);\n      return await response.json();\n    },\n    onSuccess: (data) => {\n      const isAdmin = formData.role === \"admin\";\n      toast({\n        title: \"Account created successfully\",\n        description: isAdmin \n          ? \"Your admin account has been activated. Redirecting to dashboard...\"\n          : \"Your account is pending approval. You'll be notified once it's activated.\",\n      });\n      setLocation(\"/\");\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Signup failed\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!formData.role) {\n      toast({\n        title: \"Role required\",\n        description: \"Please select your role\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    if (formData.role === \"admin\" && !formData.adminSetupKey) {\n      toast({\n        title: \"Admin setup key required\",\n        description: \"Please enter the admin setup key to create an admin account\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    \n    const submitData: any = {\n      role: formData.role,\n      organizationName: formData.organizationName,\n    };\n    \n    if (formData.role === \"admin\") {\n      submitData.adminSetupKey = formData.adminSetupKey;\n    }\n    \n    signupMutation.mutate(submitData);\n  };\n\n  if (authLoading) {\n    return (\n      <div className=\"flex items-center justify-center min-h-screen\">\n        <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\n      </div>\n    );\n  }\n\n  if (!user) {\n    return (\n      <div className=\"flex items-center justify-center min-h-screen\">\n        <Card className=\"w-full max-w-md\">\n          <CardHeader>\n            <CardTitle>Sign In Required</CardTitle>\n            <CardDescription>Please sign in with Replit to continue</CardDescription>\n          </CardHeader>\n          <CardContent>\n            <Button onClick={() => setLocation(\"/\")} className=\"w-full\" data-testid=\"button-go-home\">\n              Go to Home\n            </Button>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"flex items-center justify-center min-h-screen p-4\">\n      <Card className=\"w-full max-w-2xl\">\n        <CardHeader>\n          <CardTitle>Complete Your Account Setup</CardTitle>\n          <CardDescription>\n            Welcome! Please provide some additional information to complete your registration\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <form onSubmit={handleSubmit} className=\"space-y-6\">\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n              <div className=\"space-y-2\">\n                <Label>First Name</Label>\n                <Input\n                  value={user.firstName || \"\"}\n                  disabled\n                  data-testid=\"input-first-name\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label>Last Name</Label>\n                <Input\n                  value={user.lastName || \"\"}\n                  disabled\n                  data-testid=\"input-last-name\"\n                />\n              </div>\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label>Email</Label>\n              <Input\n                value={user.email || \"\"}\n                disabled\n                data-testid=\"input-email\"\n              />\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"role\">Role *</Label>\n              <Select\n                value={formData.role}\n                onValueChange={(value) =>\n                  setFormData({ ...formData, role: value as typeof formData.role })\n                }\n              >\n                <SelectTrigger id=\"role\" data-testid=\"select-role\">\n                  <SelectValue placeholder=\"Select your role\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"ecp\">Eye Care Professional (ECP)</SelectItem>\n                  <SelectItem value=\"lab_tech\">Lab Technician</SelectItem>\n                  <SelectItem value=\"engineer\">Engineer</SelectItem>\n                  <SelectItem value=\"supplier\">Supplier</SelectItem>\n                  <SelectItem value=\"admin\">Administrator</SelectItem>\n                </SelectContent>\n              </Select>\n              <p className=\"text-sm text-muted-foreground\">\n                Choose the role that best describes your position\n              </p>\n            </div>\n\n            {formData.role === \"admin\" && (\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"adminKey\">Admin Setup Key *</Label>\n                <Input\n                  id=\"adminKey\"\n                  type=\"password\"\n                  value={formData.adminSetupKey}\n                  onChange={(e) =>\n                    setFormData({ ...formData, adminSetupKey: e.target.value })\n                  }\n                  placeholder=\"Enter admin setup key\"\n                  data-testid=\"input-admin-key\"\n                />\n                <p className=\"text-sm text-muted-foreground\">\n                  Required: Contact your system administrator for the admin setup key\n                </p>\n              </div>\n            )}\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"orgName\">Organization Name</Label>\n              <Input\n                id=\"orgName\"\n                value={formData.organizationName}\n                onChange={(e) =>\n                  setFormData({ ...formData, organizationName: e.target.value })\n                }\n                placeholder=\"Enter your organization name\"\n                data-testid=\"input-organization-name\"\n              />\n              <p className=\"text-sm text-muted-foreground\">\n                Optional: The company or practice you work for\n              </p>\n            </div>\n\n            <div className=\"flex flex-col gap-3 pt-4\">\n              <Button\n                type=\"submit\"\n                disabled={signupMutation.isPending || !formData.role}\n                className=\"w-full\"\n                data-testid=\"button-submit-signup\"\n              >\n                {signupMutation.isPending ? (\n                  <>\n                    <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                    Creating Account...\n                  </>\n                ) : (\n                  \"Complete Registration\"\n                )}\n              </Button>\n              {formData.role !== \"admin\" && (\n                <p className=\"text-xs text-muted-foreground text-center\">\n                  Your account will be reviewed by an administrator before activation\n                </p>\n              )}\n              {formData.role === \"admin\" && (\n                <p className=\"text-xs text-muted-foreground text-center\">\n                  Admin accounts are activated immediately upon verification\n                </p>\n              )}\n            </div>\n          </form>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":8344},"client/src/pages/SettingsPage.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Button } from \"@/components/ui/button\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Loader2, Building2, User, Bell, Users, Beaker, Plus, Check } from \"lucide-react\";\nimport type { OrganizationSettings, UserPreferences } from \"@shared/schema\";\n\nexport default function SettingsPage() {\n  const { toast } = useToast();\n\n  const { data: orgSettings, isLoading: isLoadingOrg } = useQuery<OrganizationSettings>({\n    queryKey: [\"/api/settings/organization\"],\n  });\n\n  const { data: userPreferences, isLoading: isLoadingPrefs } = useQuery<UserPreferences>({\n    queryKey: [\"/api/settings/preferences\"],\n  });\n\n  const updateOrgMutation = useMutation({\n    mutationFn: async (data: Partial<OrganizationSettings>) => {\n      const response = await apiRequest(\"PUT\", \"/api/settings/organization\", data);\n      return await response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/settings/organization\"] });\n      toast({\n        title: \"Settings updated\",\n        description: \"Organization settings have been saved successfully.\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to update organization settings.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const updatePrefsMutation = useMutation({\n    mutationFn: async (data: Partial<UserPreferences>) => {\n      const response = await apiRequest(\"PUT\", \"/api/settings/preferences\", data);\n      return await response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/settings/preferences\"] });\n      toast({\n        title: \"Preferences updated\",\n        description: \"Your preferences have been saved successfully.\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to update preferences.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  return (\n    <div className=\"container mx-auto p-6 max-w-4xl\">\n      <div className=\"mb-6\">\n        <h1 className=\"text-3xl font-bold\">Settings</h1>\n        <p className=\"text-muted-foreground\">Manage your application settings and preferences</p>\n      </div>\n\n      <Tabs defaultValue=\"organization\" className=\"space-y-6\">\n        <TabsList className=\"grid w-full grid-cols-3\" data-testid=\"tabs-settings\">\n          <TabsTrigger value=\"organization\" data-testid=\"tab-organization\">\n            <Building2 className=\"mr-2 h-4 w-4\" />\n            Organization\n          </TabsTrigger>\n          <TabsTrigger value=\"roles\" data-testid=\"tab-roles\">\n            <Users className=\"mr-2 h-4 w-4\" />\n            Roles\n          </TabsTrigger>\n          <TabsTrigger value=\"preferences\" data-testid=\"tab-preferences\">\n            <User className=\"mr-2 h-4 w-4\" />\n            Preferences\n          </TabsTrigger>\n        </TabsList>\n\n        <TabsContent value=\"organization\" className=\"space-y-6\">\n          <OrganizationSettings\n            settings={orgSettings}\n            isLoading={isLoadingOrg}\n            onSave={(data) => updateOrgMutation.mutate(data)}\n            isSaving={updateOrgMutation.isPending}\n          />\n        </TabsContent>\n\n        <TabsContent value=\"roles\" className=\"space-y-6\">\n          <RoleManagement />\n        </TabsContent>\n\n        <TabsContent value=\"preferences\" className=\"space-y-6\">\n          <UserPreferencesSettings\n            preferences={userPreferences}\n            isLoading={isLoadingPrefs}\n            onSave={(data) => updatePrefsMutation.mutate(data)}\n            isSaving={updatePrefsMutation.isPending}\n          />\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n}\n\nfunction OrganizationSettings({ \n  settings, \n  isLoading, \n  onSave, \n  isSaving \n}: { \n  settings?: OrganizationSettings; \n  isLoading: boolean; \n  onSave: (data: any) => void; \n  isSaving: boolean;\n}) {\n  const [formData, setFormData] = useState({\n    companyName: settings?.companyName || \"\",\n    contactEmail: settings?.contactEmail || \"\",\n    contactPhone: settings?.contactPhone || \"\",\n    orderNumberPrefix: settings?.orderNumberPrefix || \"ORD\",\n    defaultLeadTimeDays: settings?.defaultLeadTimeDays?.toString() || \"7\",\n    address: {\n      street: (settings?.address as any)?.street || \"\",\n      city: (settings?.address as any)?.city || \"\",\n      state: (settings?.address as any)?.state || \"\",\n      zipCode: (settings?.address as any)?.zipCode || \"\",\n      country: (settings?.address as any)?.country || \"\",\n    },\n  });\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    onSave({\n      ...formData,\n      defaultLeadTimeDays: parseInt(formData.defaultLeadTimeDays) || 7,\n    });\n  };\n\n  if (isLoading) {\n    return (\n      <Card>\n        <CardContent className=\"flex items-center justify-center p-12\">\n          <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <form onSubmit={handleSubmit}>\n      <Card>\n        <CardHeader>\n          <CardTitle>Company Information</CardTitle>\n          <CardDescription>Update your organization details</CardDescription>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"companyName\">Company Name</Label>\n            <Input\n              id=\"companyName\"\n              data-testid=\"input-company-name\"\n              value={formData.companyName}\n              onChange={(e) => setFormData({ ...formData, companyName: e.target.value })}\n              placeholder=\"Optical Lab Inc.\"\n            />\n          </div>\n\n          <div className=\"grid grid-cols-2 gap-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"contactEmail\">Contact Email</Label>\n              <Input\n                id=\"contactEmail\"\n                data-testid=\"input-contact-email\"\n                type=\"email\"\n                value={formData.contactEmail}\n                onChange={(e) => setFormData({ ...formData, contactEmail: e.target.value })}\n                placeholder=\"contact@example.com\"\n              />\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"contactPhone\">Contact Phone</Label>\n              <Input\n                id=\"contactPhone\"\n                data-testid=\"input-contact-phone\"\n                value={formData.contactPhone}\n                onChange={(e) => setFormData({ ...formData, contactPhone: e.target.value })}\n                placeholder=\"(555) 123-4567\"\n              />\n            </div>\n          </div>\n\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"street\">Street Address</Label>\n            <Input\n              id=\"street\"\n              data-testid=\"input-street\"\n              value={formData.address.street}\n              onChange={(e) => setFormData({ ...formData, address: { ...formData.address, street: e.target.value } })}\n              placeholder=\"123 Main St\"\n            />\n          </div>\n\n          <div className=\"grid grid-cols-2 gap-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"city\">City</Label>\n              <Input\n                id=\"city\"\n                data-testid=\"input-city\"\n                value={formData.address.city}\n                onChange={(e) => setFormData({ ...formData, address: { ...formData.address, city: e.target.value } })}\n                placeholder=\"Portland\"\n              />\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"state\">State</Label>\n              <Input\n                id=\"state\"\n                data-testid=\"input-state\"\n                value={formData.address.state}\n                onChange={(e) => setFormData({ ...formData, address: { ...formData.address, state: e.target.value } })}\n                placeholder=\"OR\"\n              />\n            </div>\n          </div>\n\n          <div className=\"grid grid-cols-2 gap-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"zipCode\">Zip Code</Label>\n              <Input\n                id=\"zipCode\"\n                data-testid=\"input-zip-code\"\n                value={formData.address.zipCode}\n                onChange={(e) => setFormData({ ...formData, address: { ...formData.address, zipCode: e.target.value } })}\n                placeholder=\"97201\"\n              />\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"country\">Country</Label>\n              <Input\n                id=\"country\"\n                data-testid=\"input-country\"\n                value={formData.address.country}\n                onChange={(e) => setFormData({ ...formData, address: { ...formData.address, country: e.target.value } })}\n                placeholder=\"USA\"\n              />\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      <Card className=\"mt-6\">\n        <CardHeader>\n          <CardTitle>Order Configuration</CardTitle>\n          <CardDescription>Configure default order settings</CardDescription>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <div className=\"grid grid-cols-2 gap-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"orderNumberPrefix\">Order Number Prefix</Label>\n              <Input\n                id=\"orderNumberPrefix\"\n                data-testid=\"input-order-prefix\"\n                value={formData.orderNumberPrefix}\n                onChange={(e) => setFormData({ ...formData, orderNumberPrefix: e.target.value })}\n                placeholder=\"ORD\"\n              />\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"defaultLeadTimeDays\">Default Lead Time (Days)</Label>\n              <Input\n                id=\"defaultLeadTimeDays\"\n                data-testid=\"input-lead-time\"\n                type=\"number\"\n                min=\"1\"\n                value={formData.defaultLeadTimeDays}\n                onChange={(e) => setFormData({ ...formData, defaultLeadTimeDays: e.target.value })}\n                placeholder=\"7\"\n              />\n            </div>\n          </div>\n\n          <div className=\"flex justify-end pt-4\">\n            <Button \n              type=\"submit\" \n              disabled={isSaving}\n              data-testid=\"button-save-organization\"\n            >\n              {isSaving && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\n              Save Changes\n            </Button>\n          </div>\n        </CardContent>\n      </Card>\n    </form>\n  );\n}\n\nfunction UserPreferencesSettings({ \n  preferences, \n  isLoading, \n  onSave, \n  isSaving \n}: { \n  preferences?: UserPreferences; \n  isLoading: boolean; \n  onSave: (data: any) => void; \n  isSaving: boolean;\n}) {\n  const [theme, setTheme] = useState(preferences?.theme || \"light\");\n  const [language, setLanguage] = useState(preferences?.language || \"en\");\n  const [emailNotifications, setEmailNotifications] = useState({\n    orderUpdates: (preferences?.emailNotifications as any)?.orderUpdates ?? true,\n    systemAlerts: (preferences?.emailNotifications as any)?.systemAlerts ?? true,\n  });\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    onSave({\n      theme,\n      language,\n      emailNotifications,\n    });\n  };\n\n  if (isLoading) {\n    return (\n      <Card>\n        <CardContent className=\"flex items-center justify-center p-12\">\n          <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <form onSubmit={handleSubmit}>\n      <Card>\n        <CardHeader>\n          <CardTitle>Display Settings</CardTitle>\n          <CardDescription>Customize your application appearance</CardDescription>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"theme\">Theme</Label>\n            <select\n              id=\"theme\"\n              data-testid=\"select-theme\"\n              className=\"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring\"\n              value={theme}\n              onChange={(e) => setTheme(e.target.value)}\n            >\n              <option value=\"light\">Light</option>\n              <option value=\"dark\">Dark</option>\n              <option value=\"system\">System</option>\n            </select>\n          </div>\n\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"language\">Language</Label>\n            <select\n              id=\"language\"\n              data-testid=\"select-language\"\n              className=\"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring\"\n              value={language}\n              onChange={(e) => setLanguage(e.target.value)}\n            >\n              <option value=\"en\">English</option>\n              <option value=\"es\">Spanish</option>\n              <option value=\"fr\">French</option>\n            </select>\n          </div>\n        </CardContent>\n      </Card>\n\n      <Card className=\"mt-6\">\n        <CardHeader>\n          <CardTitle className=\"flex items-center\">\n            <Bell className=\"mr-2 h-5 w-5\" />\n            Notification Preferences\n          </CardTitle>\n          <CardDescription>Choose which notifications you want to receive</CardDescription>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"space-y-0.5\">\n              <Label htmlFor=\"orderUpdates\">Order Updates</Label>\n              <p className=\"text-sm text-muted-foreground\">Receive notifications about order status changes</p>\n            </div>\n            <Switch\n              id=\"orderUpdates\"\n              data-testid=\"switch-order-updates\"\n              checked={emailNotifications.orderUpdates}\n              onCheckedChange={(checked) => setEmailNotifications({ ...emailNotifications, orderUpdates: checked })}\n            />\n          </div>\n\n          <div className=\"flex items-center justify-between\">\n            <div className=\"space-y-0.5\">\n              <Label htmlFor=\"systemAlerts\">System Alerts</Label>\n              <p className=\"text-sm text-muted-foreground\">Receive important system notifications</p>\n            </div>\n            <Switch\n              id=\"systemAlerts\"\n              data-testid=\"switch-system-alerts\"\n              checked={emailNotifications.systemAlerts}\n              onCheckedChange={(checked) => setEmailNotifications({ ...emailNotifications, systemAlerts: checked })}\n            />\n          </div>\n\n          <div className=\"flex justify-end pt-4\">\n            <Button \n              type=\"submit\" \n              disabled={isSaving}\n              data-testid=\"button-save-preferences\"\n            >\n              {isSaving && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\n              Save Preferences\n            </Button>\n          </div>\n        </CardContent>\n      </Card>\n    </form>\n  );\n}\n\nfunction RoleManagement() {\n  const { user, isLoading } = useAuth();\n  const { toast } = useToast();\n\n  const availableRoles = (user as any)?.availableRoles || [];\n\n  const addRoleMutation = useMutation({\n    mutationFn: async (role: string) => {\n      const response = await apiRequest(\"POST\", \"/api/auth/add-role\", { role });\n      return await response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/auth/user\"] });\n      toast({\n        title: \"Role added\",\n        description: \"The role has been added to your account successfully.\",\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Error adding role\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const roles = [\n    {\n      id: \"ecp\",\n      name: \"Eye Care Professional\",\n      description: \"Submit and track lens orders for your patients\",\n      icon: Users,\n      color: \"bg-blue-500/10 text-blue-700 dark:text-blue-400 border-blue-500/20\",\n    },\n    {\n      id: \"lab_tech\",\n      name: \"Lab Technician\",\n      description: \"Manage production queue and quality control\",\n      icon: Beaker,\n      color: \"bg-emerald-500/10 text-emerald-700 dark:text-emerald-400 border-emerald-500/20\",\n    },\n  ];\n\n  if (isLoading) {\n    return (\n      <Card>\n        <CardContent className=\"flex items-center justify-center p-12\">\n          <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\n        </CardContent>\n      </Card>\n    );\n  }\n\n  const hasRole = (roleId: string) => availableRoles.includes(roleId);\n\n  return (\n    <div className=\"space-y-6\">\n      <Card>\n        <CardHeader>\n          <CardTitle>Role Management</CardTitle>\n          <CardDescription>\n            Add additional roles to your account to access different features\n          </CardDescription>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <div className=\"space-y-4\">\n            {roles.map((role) => {\n              const Icon = role.icon;\n              const hasThisRole = hasRole(role.id);\n\n              return (\n                <div\n                  key={role.id}\n                  className={`flex items-center justify-between p-4 rounded-md border ${role.color}`}\n                >\n                  <div className=\"flex items-start gap-4\">\n                    <div className=\"rounded-md bg-background p-2\">\n                      <Icon className=\"h-5 w-5\" />\n                    </div>\n                    <div className=\"space-y-1\">\n                      <div className=\"flex items-center gap-2\">\n                        <h3 className=\"font-semibold\">{role.name}</h3>\n                        {hasThisRole && (\n                          <Badge variant=\"outline\" className=\"gap-1\">\n                            <Check className=\"h-3 w-3\" />\n                            Active\n                          </Badge>\n                        )}\n                      </div>\n                      <p className=\"text-sm text-muted-foreground\">{role.description}</p>\n                    </div>\n                  </div>\n                  {!hasThisRole && (\n                    <Button\n                      size=\"sm\"\n                      onClick={() => addRoleMutation.mutate(role.id)}\n                      disabled={addRoleMutation.isPending}\n                      data-testid={`button-add-role-${role.id}`}\n                    >\n                      {addRoleMutation.isPending && <Loader2 className=\"mr-2 h-3 w-3 animate-spin\" />}\n                      <Plus className=\"h-4 w-4 mr-1\" />\n                      Add Role\n                    </Button>\n                  )}\n                </div>\n              );\n            })}\n          </div>\n\n          <div className=\"pt-4 border-t\">\n            <div className=\"flex items-start gap-2 text-sm text-muted-foreground\">\n              <Users className=\"h-4 w-4 mt-0.5\" />\n              <p>\n                You currently have access to {availableRoles.length || 0} role(s). \n                Use the role switcher in the header to switch between your roles.\n              </p>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":19965},"client/src/pages/PendingApprovalPage.tsx":{"content":"import { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Clock, LogOut } from \"lucide-react\";\n\nexport default function PendingApprovalPage() {\n  const handleLogout = () => {\n    window.location.href = '/api/auth/logout';\n  };\n\n  return (\n    <div className=\"flex items-center justify-center min-h-screen p-4\">\n      <Card className=\"w-full max-w-md\">\n        <CardHeader className=\"text-center\">\n          <div className=\"mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full bg-yellow-100 dark:bg-yellow-900/20\">\n            <Clock className=\"h-8 w-8 text-yellow-600 dark:text-yellow-500\" />\n          </div>\n          <CardTitle className=\"text-2xl\">Account Pending Approval</CardTitle>\n          <CardDescription>\n            Your account registration is being reviewed by our administrators\n          </CardDescription>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <div className=\"rounded-md bg-muted p-4\">\n            <p className=\"text-sm text-muted-foreground\">\n              Thank you for signing up! Your account is currently pending approval. \n              You'll receive an email notification once an administrator reviews and \n              activates your account.\n            </p>\n          </div>\n          <div className=\"flex flex-col gap-2\">\n            <Button\n              variant=\"outline\"\n              onClick={handleLogout}\n              className=\"w-full\"\n              data-testid=\"button-logout\"\n            >\n              <LogOut className=\"mr-2 h-4 w-4\" />\n              Sign Out\n            </Button>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":1750},"client/src/components/OMAFileUpload.tsx":{"content":"import { useState, useRef } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Upload, File, X, AlertCircle } from \"lucide-react\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\n\ninterface OMAFileUploadProps {\n  orderId?: string;\n  onUploadSuccess?: () => void;\n  onFileSelect?: (fileContent: string, filename: string) => void;\n  showInline?: boolean;\n}\n\nexport function OMAFileUpload({ orderId, onUploadSuccess, onFileSelect, showInline = false }: OMAFileUploadProps) {\n  const [selectedFile, setSelectedFile] = useState<{ name: string; content: string } | null>(null);\n  const [isUploading, setIsUploading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n\n  const handleFileSelect = (event: React.ChangeEvent<HTMLInputElement>) => {\n    const file = event.target.files?.[0];\n    if (!file) return;\n\n    // Check file extension\n    if (!file.name.toLowerCase().endsWith('.oma')) {\n      setError('Please select a valid .oma file');\n      return;\n    }\n\n    setError(null);\n    const reader = new FileReader();\n    \n    reader.onload = (e) => {\n      const content = e.target?.result as string;\n      setSelectedFile({ name: file.name, content });\n      \n      // If in inline mode, pass data to parent\n      if (showInline && onFileSelect) {\n        onFileSelect(content, file.name);\n      }\n    };\n    \n    reader.onerror = () => {\n      setError('Failed to read file');\n    };\n    \n    reader.readAsText(file);\n  };\n\n  const handleUpload = async () => {\n    if (!selectedFile || !orderId) return;\n\n    setIsUploading(true);\n    setError(null);\n\n    try {\n      const response = await fetch(`/api/orders/${orderId}/oma`, {\n        method: 'PATCH',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          fileContent: selectedFile.content,\n          filename: selectedFile.name,\n        }),\n      });\n\n      if (!response.ok) {\n        const data = await response.json();\n        throw new Error(data.message || 'Failed to upload file');\n      }\n\n      setSelectedFile(null);\n      if (fileInputRef.current) {\n        fileInputRef.current.value = '';\n      }\n      \n      if (onUploadSuccess) {\n        onUploadSuccess();\n      }\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Failed to upload file');\n    } finally {\n      setIsUploading(false);\n    }\n  };\n\n  const handleRemove = () => {\n    setSelectedFile(null);\n    setError(null);\n    if (fileInputRef.current) {\n      fileInputRef.current.value = '';\n    }\n    if (showInline && onFileSelect) {\n      onFileSelect('', '');\n    }\n  };\n\n  return (\n    <div className=\"space-y-4\">\n      <input\n        ref={fileInputRef}\n        type=\"file\"\n        accept=\".oma\"\n        onChange={handleFileSelect}\n        className=\"hidden\"\n        data-testid=\"input-oma-file\"\n      />\n\n      {!selectedFile ? (\n        <Card className=\"border-dashed hover-elevate active-elevate-2 cursor-pointer\" onClick={() => fileInputRef.current?.click()}>\n          <CardContent className=\"p-6 flex flex-col items-center justify-center gap-3\">\n            <Upload className=\"h-10 w-10 text-muted-foreground\" />\n            <div className=\"text-center\">\n              <p className=\"font-medium\">Upload OMA File</p>\n              <p className=\"text-sm text-muted-foreground\">\n                Click to select a .oma file or drag and drop\n              </p>\n            </div>\n          </CardContent>\n        </Card>\n      ) : (\n        <Card>\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center gap-3\">\n                <div className=\"h-10 w-10 rounded-md bg-primary/10 flex items-center justify-center\">\n                  <File className=\"h-5 w-5 text-primary\" />\n                </div>\n                <div>\n                  <p className=\"font-medium text-sm\">{selectedFile.name}</p>\n                  <p className=\"text-xs text-muted-foreground\">\n                    {(selectedFile.content.length / 1024).toFixed(2)} KB\n                  </p>\n                </div>\n              </div>\n              <div className=\"flex items-center gap-2\">\n                {!showInline && (\n                  <Button\n                    size=\"sm\"\n                    onClick={handleUpload}\n                    disabled={isUploading}\n                    data-testid=\"button-upload-oma\"\n                  >\n                    {isUploading ? 'Uploading...' : 'Upload'}\n                  </Button>\n                )}\n                <Button\n                  size=\"sm\"\n                  variant=\"ghost\"\n                  onClick={handleRemove}\n                  data-testid=\"button-remove-oma\"\n                >\n                  <X className=\"h-4 w-4\" />\n                </Button>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      {error && (\n        <Alert variant=\"destructive\">\n          <AlertCircle className=\"h-4 w-4\" />\n          <AlertDescription>{error}</AlertDescription>\n        </Alert>\n      )}\n    </div>\n  );\n}\n","size_bytes":5258},"client/src/components/OMAViewer.tsx":{"content":"import { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Download, Eye, EyeOff, FileText } from \"lucide-react\";\nimport { useState } from \"react\";\nimport type { OMAData } from \"@shared/omaParser\";\n\ninterface OMAViewerProps {\n  omaData: {\n    filename: string;\n    content: string;\n    parsedData: OMAData;\n  };\n  orderId?: string;\n}\n\nexport function OMAViewer({ omaData }: OMAViewerProps) {\n  const [showRawData, setShowRawData] = useState(false);\n  const { filename, content, parsedData } = omaData;\n\n  const handleDownload = () => {\n    const blob = new Blob([content], { type: 'text/plain' });\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement('a');\n    a.href = url;\n    a.download = filename;\n    document.body.appendChild(a);\n    a.click();\n    document.body.removeChild(a);\n    URL.revokeObjectURL(url);\n  };\n\n  return (\n    <div className=\"space-y-4\">\n      <Card>\n        <CardHeader>\n          <div className=\"flex items-center justify-between\">\n            <div className=\"space-y-1\">\n              <CardTitle className=\"flex items-center gap-2\">\n                <FileText className=\"h-5 w-5\" />\n                OMA File Attached\n              </CardTitle>\n              <CardDescription>{filename}</CardDescription>\n            </div>\n            <Button\n              variant=\"outline\"\n              size=\"sm\"\n              onClick={handleDownload}\n              data-testid=\"button-download-oma\"\n            >\n              <Download className=\"h-4 w-4 mr-2\" />\n              Download\n            </Button>\n          </div>\n        </CardHeader>\n      </Card>\n\n      {/* Prescription Data */}\n      {(parsedData.prescription?.rightEye || parsedData.prescription?.leftEye) && (\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"text-lg\">Prescription Data</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n              {/* Right Eye */}\n              {parsedData.prescription.rightEye && (\n                <div className=\"space-y-3\">\n                  <h4 className=\"font-semibold flex items-center gap-2\">\n                    <Badge variant=\"outline\">OD</Badge>\n                    Right Eye\n                  </h4>\n                  <div className=\"space-y-2 text-sm\">\n                    {parsedData.prescription.rightEye.sphere && (\n                      <div className=\"flex justify-between\">\n                        <span className=\"text-muted-foreground\">Sphere:</span>\n                        <span className=\"font-medium font-mono\">{parsedData.prescription.rightEye.sphere}</span>\n                      </div>\n                    )}\n                    {parsedData.prescription.rightEye.cylinder && (\n                      <div className=\"flex justify-between\">\n                        <span className=\"text-muted-foreground\">Cylinder:</span>\n                        <span className=\"font-medium font-mono\">{parsedData.prescription.rightEye.cylinder}</span>\n                      </div>\n                    )}\n                    {parsedData.prescription.rightEye.axis && (\n                      <div className=\"flex justify-between\">\n                        <span className=\"text-muted-foreground\">Axis:</span>\n                        <span className=\"font-medium font-mono\">{parsedData.prescription.rightEye.axis}</span>\n                      </div>\n                    )}\n                    {parsedData.prescription.rightEye.add && (\n                      <div className=\"flex justify-between\">\n                        <span className=\"text-muted-foreground\">Add:</span>\n                        <span className=\"font-medium font-mono\">{parsedData.prescription.rightEye.add}</span>\n                      </div>\n                    )}\n                  </div>\n                </div>\n              )}\n\n              {/* Left Eye */}\n              {parsedData.prescription.leftEye && (\n                <div className=\"space-y-3\">\n                  <h4 className=\"font-semibold flex items-center gap-2\">\n                    <Badge variant=\"outline\">OS</Badge>\n                    Left Eye\n                  </h4>\n                  <div className=\"space-y-2 text-sm\">\n                    {parsedData.prescription.leftEye.sphere && (\n                      <div className=\"flex justify-between\">\n                        <span className=\"text-muted-foreground\">Sphere:</span>\n                        <span className=\"font-medium font-mono\">{parsedData.prescription.leftEye.sphere}</span>\n                      </div>\n                    )}\n                    {parsedData.prescription.leftEye.cylinder && (\n                      <div className=\"flex justify-between\">\n                        <span className=\"text-muted-foreground\">Cylinder:</span>\n                        <span className=\"font-medium font-mono\">{parsedData.prescription.leftEye.cylinder}</span>\n                      </div>\n                    )}\n                    {parsedData.prescription.leftEye.axis && (\n                      <div className=\"flex justify-between\">\n                        <span className=\"text-muted-foreground\">Axis:</span>\n                        <span className=\"font-medium font-mono\">{parsedData.prescription.leftEye.axis}</span>\n                      </div>\n                    )}\n                    {parsedData.prescription.leftEye.add && (\n                      <div className=\"flex justify-between\">\n                        <span className=\"text-muted-foreground\">Add:</span>\n                        <span className=\"font-medium font-mono\">{parsedData.prescription.leftEye.add}</span>\n                      </div>\n                    )}\n                  </div>\n                </div>\n              )}\n            </div>\n\n            {parsedData.prescription.pd && (\n              <div className=\"mt-4 pt-4 border-t\">\n                <div className=\"flex justify-between text-sm\">\n                  <span className=\"text-muted-foreground\">Pupillary Distance (PD):</span>\n                  <span className=\"font-medium font-mono\">{parsedData.prescription.pd} mm</span>\n                </div>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n      )}\n\n      {/* Job Number */}\n      {parsedData.jobNumber && (\n        <Card>\n          <CardContent className=\"p-4\">\n            <div className=\"flex justify-between text-sm\">\n              <span className=\"text-muted-foreground\">Job Number:</span>\n              <span className=\"font-medium font-mono\">{parsedData.jobNumber}</span>\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      {/* Frame Information */}\n      {parsedData.frameInfo && (\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"text-lg\">Frame Information</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-2 text-sm\">\n              {parsedData.frameInfo.type && (\n                <div className=\"flex justify-between\">\n                  <span className=\"text-muted-foreground\">Type:</span>\n                  <span className=\"font-medium\">{parsedData.frameInfo.type}</span>\n                </div>\n              )}\n              {parsedData.frameInfo.size && (\n                <div className=\"flex justify-between\">\n                  <span className=\"text-muted-foreground\">Size:</span>\n                  <span className=\"font-medium font-mono\">{parsedData.frameInfo.size}</span>\n                </div>\n              )}\n              {parsedData.frameInfo.bridge && (\n                <div className=\"flex justify-between\">\n                  <span className=\"text-muted-foreground\">Bridge:</span>\n                  <span className=\"font-medium font-mono\">{parsedData.frameInfo.bridge}</span>\n                </div>\n              )}\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      {/* Tracing Data */}\n      {parsedData.tracing && (\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"text-lg\">Tracing Data</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-2 text-sm\">\n              {parsedData.tracing.side && (\n                <div className=\"flex justify-between\">\n                  <span className=\"text-muted-foreground\">Side:</span>\n                  <span className=\"font-medium\">{parsedData.tracing.side}</span>\n                </div>\n              )}\n              {parsedData.tracing.rawData && (\n                <div className=\"space-y-2\">\n                  <span className=\"text-muted-foreground\">Data Points:</span>\n                  <div className=\"bg-muted p-3 rounded-md font-mono text-xs overflow-x-auto\">\n                    {parsedData.tracing.rawData.substring(0, 200)}\n                    {parsedData.tracing.rawData.length > 200 && '...'}\n                  </div>\n                </div>\n              )}\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      {/* Raw OMA Data Toggle */}\n      <Card>\n        <CardContent className=\"p-4\">\n          <Button\n            variant=\"outline\"\n            size=\"sm\"\n            onClick={() => setShowRawData(!showRawData)}\n            className=\"w-full\"\n            data-testid=\"button-toggle-raw-data\"\n          >\n            {showRawData ? (\n              <>\n                <EyeOff className=\"h-4 w-4 mr-2\" />\n                Hide Raw Data\n              </>\n            ) : (\n              <>\n                <Eye className=\"h-4 w-4 mr-2\" />\n                Show Raw Data\n              </>\n            )}\n          </Button>\n\n          {showRawData && (\n            <div className=\"mt-4 space-y-2\">\n              <h4 className=\"font-semibold text-sm\">All Fields:</h4>\n              <div className=\"bg-muted p-3 rounded-md font-mono text-xs overflow-x-auto max-h-96 overflow-y-auto\">\n                <pre>{JSON.stringify(parsedData.raw, null, 2)}</pre>\n              </div>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":10166},"shared/omaParser.ts":{"content":"/**\n * OMA (Optical Manufacturers Association) File Parser\n * \n * Parses OMA files which contain optical prescription data and lens tracing information.\n * OMA files are text-based with key=value pairs.\n */\n\nexport interface OMAData {\n  jobNumber?: string;\n  prescription?: {\n    rightEye?: {\n      sphere?: string;\n      cylinder?: string;\n      axis?: string;\n      add?: string;\n    };\n    leftEye?: {\n      sphere?: string;\n      cylinder?: string;\n      axis?: string;\n      add?: string;\n    };\n    pd?: string;\n  };\n  tracing?: {\n    side?: string;\n    points?: string;\n    rawData?: string;\n  };\n  frameInfo?: {\n    type?: string;\n    size?: string;\n    bridge?: string;\n  };\n  raw: Record<string, string | string[]>;\n}\n\n/**\n * Parse an OMA file content\n */\nexport function parseOMAFile(content: string): OMAData {\n  const lines = content.split(/\\r?\\n/);\n  const raw: Record<string, string | string[]> = {};\n  \n  // Parse all key=value pairs\n  for (const line of lines) {\n    const trimmed = line.trim();\n    if (!trimmed || !trimmed.includes('=')) continue;\n    \n    const [key, value] = trimmed.split('=', 2);\n    const cleanKey = key.trim();\n    const cleanValue = value?.trim() || '';\n    \n    // Handle multiple values separated by semicolons\n    const values = cleanValue.split(';').map(v => v.trim()).filter(v => v);\n    raw[cleanKey] = values.length > 1 ? values : cleanValue;\n  }\n  \n  // Extract structured data\n  const result: OMAData = { raw };\n  \n  // Job number\n  if (raw.JOB) {\n    result.jobNumber = Array.isArray(raw.JOB) ? raw.JOB[0] : raw.JOB;\n  }\n  \n  // Prescription data\n  result.prescription = {};\n  \n  // Sphere (SPH) - typically [rightEye, leftEye]\n  if (raw.SPH) {\n    const sphValues = Array.isArray(raw.SPH) ? raw.SPH : [raw.SPH];\n    result.prescription.rightEye = { sphere: sphValues[0] };\n    result.prescription.leftEye = { sphere: sphValues[1] };\n  }\n  \n  // Cylinder (CYL) - typically [rightEye, leftEye]\n  if (raw.CYL) {\n    const cylValues = Array.isArray(raw.CYL) ? raw.CYL : [raw.CYL];\n    if (!result.prescription.rightEye) result.prescription.rightEye = {};\n    if (!result.prescription.leftEye) result.prescription.leftEye = {};\n    result.prescription.rightEye.cylinder = cylValues[0];\n    result.prescription.leftEye.cylinder = cylValues[1];\n  }\n  \n  // Axis - typically [rightEye, leftEye]\n  if (raw.AXIS) {\n    const axisValues = Array.isArray(raw.AXIS) ? raw.AXIS : [raw.AXIS];\n    if (!result.prescription.rightEye) result.prescription.rightEye = {};\n    if (!result.prescription.leftEye) result.prescription.leftEye = {};\n    result.prescription.rightEye.axis = axisValues[0];\n    result.prescription.leftEye.axis = axisValues[1];\n  }\n  \n  // Add power (ADD) - typically [rightEye, leftEye]\n  if (raw.ADD) {\n    const addValues = Array.isArray(raw.ADD) ? raw.ADD : [raw.ADD];\n    if (!result.prescription.rightEye) result.prescription.rightEye = {};\n    if (!result.prescription.leftEye) result.prescription.leftEye = {};\n    result.prescription.rightEye.add = addValues[0];\n    result.prescription.leftEye.add = addValues[1];\n  }\n  \n  // Pupillary Distance (PD)\n  if (raw.PD) {\n    result.prescription.pd = Array.isArray(raw.PD) ? raw.PD[0] : raw.PD;\n  }\n  \n  // Tracing data (TRAC)\n  if (raw.TRAC) {\n    const tracValue = Array.isArray(raw.TRAC) ? raw.TRAC.join(';') : raw.TRAC;\n    result.tracing = {\n      rawData: tracValue,\n      side: tracValue.includes('R') ? 'Right' : tracValue.includes('L') ? 'Left' : undefined,\n      points: tracValue,\n    };\n  }\n  \n  // Frame information\n  if (raw.FRAME || raw.SIZE || raw.BRIDGE) {\n    result.frameInfo = {\n      type: raw.FRAME ? (Array.isArray(raw.FRAME) ? raw.FRAME[0] : raw.FRAME) : undefined,\n      size: raw.SIZE ? (Array.isArray(raw.SIZE) ? raw.SIZE[0] : raw.SIZE) : undefined,\n      bridge: raw.BRIDGE ? (Array.isArray(raw.BRIDGE) ? raw.BRIDGE[0] : raw.BRIDGE) : undefined,\n    };\n  }\n  \n  return result;\n}\n\n/**\n * Validate if a file content looks like an OMA file\n */\nexport function isValidOMAFile(content: string): boolean {\n  if (!content || content.trim().length === 0) return false;\n  \n  const lines = content.split(/\\r?\\n/).filter(l => l.trim().length > 0);\n  if (lines.length === 0) return false;\n  \n  // Check if at least one line has key=value format\n  const hasKeyValue = lines.some(line => line.includes('='));\n  if (!hasKeyValue) return false;\n  \n  // Check for common OMA fields\n  const commonFields = ['SPH', 'CYL', 'AXIS', 'TRAC', 'JOB', 'PD'];\n  const hasCommonField = commonFields.some(field => \n    content.toUpperCase().includes(`${field}=`)\n  );\n  \n  return hasCommonField;\n}\n\n/**\n * Format OMA data for display\n */\nexport function formatOMAData(data: OMAData): string {\n  const lines: string[] = [];\n  \n  if (data.jobNumber) {\n    lines.push(`Job Number: ${data.jobNumber}`);\n  }\n  \n  if (data.prescription?.rightEye || data.prescription?.leftEye) {\n    lines.push('\\nPrescription:');\n    \n    if (data.prescription.rightEye) {\n      lines.push('  Right Eye (OD):');\n      if (data.prescription.rightEye.sphere) lines.push(`    Sphere: ${data.prescription.rightEye.sphere}`);\n      if (data.prescription.rightEye.cylinder) lines.push(`    Cylinder: ${data.prescription.rightEye.cylinder}`);\n      if (data.prescription.rightEye.axis) lines.push(`    Axis: ${data.prescription.rightEye.axis}`);\n      if (data.prescription.rightEye.add) lines.push(`    Add: ${data.prescription.rightEye.add}`);\n    }\n    \n    if (data.prescription.leftEye) {\n      lines.push('  Left Eye (OS):');\n      if (data.prescription.leftEye.sphere) lines.push(`    Sphere: ${data.prescription.leftEye.sphere}`);\n      if (data.prescription.leftEye.cylinder) lines.push(`    Cylinder: ${data.prescription.leftEye.cylinder}`);\n      if (data.prescription.leftEye.axis) lines.push(`    Axis: ${data.prescription.leftEye.axis}`);\n      if (data.prescription.leftEye.add) lines.push(`    Add: ${data.prescription.leftEye.add}`);\n    }\n    \n    if (data.prescription.pd) {\n      lines.push(`  PD: ${data.prescription.pd}`);\n    }\n  }\n  \n  if (data.frameInfo) {\n    lines.push('\\nFrame Information:');\n    if (data.frameInfo.type) lines.push(`  Type: ${data.frameInfo.type}`);\n    if (data.frameInfo.size) lines.push(`  Size: ${data.frameInfo.size}`);\n    if (data.frameInfo.bridge) lines.push(`  Bridge: ${data.frameInfo.bridge}`);\n  }\n  \n  if (data.tracing) {\n    lines.push('\\nTracing Data:');\n    if (data.tracing.side) lines.push(`  Side: ${data.tracing.side}`);\n    if (data.tracing.rawData) {\n      const truncated = data.tracing.rawData.length > 100 \n        ? data.tracing.rawData.substring(0, 100) + '...' \n        : data.tracing.rawData;\n      lines.push(`  Data: ${truncated}`);\n    }\n  }\n  \n  return lines.join('\\n');\n}\n","size_bytes":6735},"client/src/pages/OrderDetailsPage.tsx":{"content":"import { useRoute } from \"wouter\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { ChevronLeft } from \"lucide-react\";\nimport { Link } from \"wouter\";\nimport { OMAViewer } from \"@/components/OMAViewer\";\nimport { useAuth } from \"@/hooks/useAuth\";\n\ntype Order = {\n  id: string;\n  patientId: string;\n  ecpId: string;\n  status: string;\n  lensType: string;\n  lensMaterial: string;\n  coating: string;\n  frameType: string | null;\n  odSphere: string | null;\n  odCylinder: string | null;\n  odAxis: string | null;\n  odAdd: string | null;\n  osSphere: string | null;\n  osCylinder: string | null;\n  osAxis: string | null;\n  osAdd: string | null;\n  pd: string | null;\n  traceFileUrl: string | null;\n  notes: string | null;\n  customerReferenceNumber: string | null;\n  omaFileContent: string | null;\n  omaFilename: string | null;\n  omaParsedData: Record<string, unknown> | null;\n  createdAt: string;\n  updatedAt: string;\n  patient: {\n    name: string;\n    dateOfBirth: string | null;\n  };\n  ecp: {\n    organizationName: string | null;\n  };\n};\n\nexport default function OrderDetailsPage() {\n  const [, params] = useRoute<{ id: string }>(\"/order/:id\");\n  const orderId = params?.id;\n  const { user } = useAuth();\n\n  const { data: order, isLoading } = useQuery<Order>({\n    queryKey: ['/api/orders', orderId],\n    queryFn: async () => {\n      const response = await fetch(`/api/orders/${orderId}`);\n      if (!response.ok) {\n        throw new Error('Failed to fetch order');\n      }\n      return response.json();\n    },\n    enabled: !!orderId,\n  });\n\n  if (!orderId) {\n    return (\n      <div className=\"text-center py-12\">\n        <p className=\"text-muted-foreground\">Order ID not found</p>\n      </div>\n    );\n  }\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center py-12\">\n        <div className=\"text-center\">\n          <div className=\"w-16 h-16 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-4\"></div>\n          <p className=\"text-muted-foreground\">Loading order details...</p>\n        </div>\n      </div>\n    );\n  }\n\n  if (!order) {\n    return (\n      <div className=\"text-center py-12\">\n        <p className=\"text-muted-foreground\">Order not found</p>\n      </div>\n    );\n  }\n\n  const statusColors: Record<string, string> = {\n    pending: \"bg-yellow-500/20 text-yellow-700 dark:text-yellow-400\",\n    processing: \"bg-blue-500/20 text-blue-700 dark:text-blue-400\",\n    completed: \"bg-green-500/20 text-green-700 dark:text-green-400\",\n    cancelled: \"bg-red-500/20 text-red-700 dark:text-red-400\",\n  };\n\n  const getBackPath = () => {\n    if (!user?.role) return \"/\";\n    switch (user.role) {\n      case \"ecp\":\n        return \"/ecp/dashboard\";\n      case \"lab_tech\":\n      case \"engineer\":\n        return \"/lab/dashboard\";\n      default:\n        return \"/\";\n    }\n  };\n\n  return (\n    <div className=\"max-w-6xl mx-auto space-y-6\">\n      <div className=\"flex items-center justify-between\">\n        <div className=\"flex items-center gap-4\">\n          <Link href={getBackPath()}>\n            <Button variant=\"ghost\" size=\"icon\" data-testid=\"button-back\">\n              <ChevronLeft className=\"h-4 w-4\" />\n            </Button>\n          </Link>\n          <div>\n            <h1 className=\"text-2xl font-semibold\">Order Details</h1>\n            <p className=\"text-muted-foreground text-sm mt-1\">\n              Order #{orderId.slice(0, 8)}\n            </p>\n          </div>\n        </div>\n        <Badge className={statusColors[order.status] || \"\"} data-testid=\"badge-order-status\">\n          {order.status.toUpperCase()}\n        </Badge>\n      </div>\n\n      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n        <Card>\n          <CardHeader>\n            <CardTitle>Patient Information</CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-3\">\n            <div>\n              <p className=\"text-sm text-muted-foreground\">Name</p>\n              <p className=\"font-medium\" data-testid=\"text-patient-name\">{order.patient.name}</p>\n            </div>\n            {order.patient.dateOfBirth && (\n              <div>\n                <p className=\"text-sm text-muted-foreground\">Date of Birth</p>\n                <p className=\"font-medium\" data-testid=\"text-patient-dob\">{order.patient.dateOfBirth}</p>\n              </div>\n            )}\n            {order.customerReferenceNumber && (\n              <div>\n                <p className=\"text-sm text-muted-foreground\">Customer Reference</p>\n                <p className=\"font-medium font-mono\" data-testid=\"text-customer-reference\">{order.customerReferenceNumber}</p>\n              </div>\n            )}\n            <div>\n              <p className=\"text-sm text-muted-foreground\">Provider</p>\n              <p className=\"font-medium\" data-testid=\"text-provider\">{order.ecp.organizationName || \"N/A\"}</p>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <CardTitle>Lens Specifications</CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-3\">\n            <div>\n              <p className=\"text-sm text-muted-foreground\">Lens Type</p>\n              <p className=\"font-medium\" data-testid=\"text-lens-type\">{order.lensType}</p>\n            </div>\n            <div>\n              <p className=\"text-sm text-muted-foreground\">Material</p>\n              <p className=\"font-medium\" data-testid=\"text-lens-material\">{order.lensMaterial}</p>\n            </div>\n            <div>\n              <p className=\"text-sm text-muted-foreground\">Coating</p>\n              <p className=\"font-medium\" data-testid=\"text-coating\">{order.coating}</p>\n            </div>\n            {order.frameType && (\n              <div>\n                <p className=\"text-sm text-muted-foreground\">Frame Type</p>\n                <p className=\"font-medium\" data-testid=\"text-frame-type\">{order.frameType}</p>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n\n      <Card>\n        <CardHeader>\n          <CardTitle>Prescription</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n            <div>\n              <h3 className=\"font-semibold mb-3\">Right Eye (OD)</h3>\n              <div className=\"space-y-2 text-sm font-mono\">\n                {order.odSphere && <p data-testid=\"text-od-sphere\">Sphere: {order.odSphere}</p>}\n                {order.odCylinder && <p data-testid=\"text-od-cylinder\">Cylinder: {order.odCylinder}</p>}\n                {order.odAxis && <p data-testid=\"text-od-axis\">Axis: {order.odAxis}</p>}\n                {order.odAdd && <p data-testid=\"text-od-add\">Add: {order.odAdd}</p>}\n                {!order.odSphere && !order.odCylinder && !order.odAxis && !order.odAdd && (\n                  <p className=\"text-muted-foreground\">No data</p>\n                )}\n              </div>\n            </div>\n            <div>\n              <h3 className=\"font-semibold mb-3\">Left Eye (OS)</h3>\n              <div className=\"space-y-2 text-sm font-mono\">\n                {order.osSphere && <p data-testid=\"text-os-sphere\">Sphere: {order.osSphere}</p>}\n                {order.osCylinder && <p data-testid=\"text-os-cylinder\">Cylinder: {order.osCylinder}</p>}\n                {order.osAxis && <p data-testid=\"text-os-axis\">Axis: {order.osAxis}</p>}\n                {order.osAdd && <p data-testid=\"text-os-add\">Add: {order.osAdd}</p>}\n                {!order.osSphere && !order.osCylinder && !order.osAxis && !order.osAdd && (\n                  <p className=\"text-muted-foreground\">No data</p>\n                )}\n              </div>\n            </div>\n          </div>\n          {order.pd && (\n            <div className=\"mt-4 pt-4 border-t\">\n              <p className=\"text-sm font-mono\" data-testid=\"text-pd\">Pupillary Distance: {order.pd}</p>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n\n      {order.omaFileContent && order.omaParsedData && (\n        <OMAViewer\n          omaData={{\n            filename: order.omaFilename || \"oma-file.oma\",\n            content: order.omaFileContent,\n            parsedData: order.omaParsedData as any,\n          }}\n        />\n      )}\n\n      {order.notes && (\n        <Card>\n          <CardHeader>\n            <CardTitle>Additional Notes</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <p className=\"text-sm whitespace-pre-wrap\" data-testid=\"text-notes\">{order.notes}</p>\n          </CardContent>\n        </Card>\n      )}\n\n      <Card>\n        <CardHeader>\n          <CardTitle>Order Timeline</CardTitle>\n        </CardHeader>\n        <CardContent className=\"space-y-2\">\n          <div>\n            <p className=\"text-sm text-muted-foreground\">Created</p>\n            <p className=\"font-medium\" data-testid=\"text-created-at\">\n              {new Date(order.createdAt).toLocaleString()}\n            </p>\n          </div>\n          <div>\n            <p className=\"text-sm text-muted-foreground\">Last Updated</p>\n            <p className=\"font-medium\" data-testid=\"text-updated-at\">\n              {new Date(order.updatedAt).toLocaleString()}\n            </p>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":9396},"server/localAuth.ts":{"content":"import passport from \"passport\";\nimport { Strategy as LocalStrategy } from \"passport-local\";\nimport bcrypt from \"bcrypt\";\nimport { storage } from \"./storage\";\nimport type { User } from \"@shared/schema\";\n\n// Configure passport-local strategy for email/password authentication\nexport function setupLocalAuth() {\n  passport.use('local', new LocalStrategy(\n    {\n      usernameField: 'email',\n      passwordField: 'password',\n    },\n    async (email, password, done) => {\n      try {\n        const user = await storage.getUserByEmail(email);\n        \n        if (!user) {\n          return done(null, false, { message: \"Invalid email or password\" });\n        }\n\n        if (!user.password) {\n          return done(null, false, { message: \"This account uses Replit login. Please sign in with Replit.\" });\n        }\n\n        const isValidPassword = await bcrypt.compare(password, user.password);\n        \n        if (!isValidPassword) {\n          return done(null, false, { message: \"Invalid email or password\" });\n        }\n\n        // Create session user object similar to Replit Auth\n        const sessionUser = {\n          claims: {\n            sub: user.id,\n            email: user.email,\n            first_name: user.firstName,\n            last_name: user.lastName,\n            profile_image_url: user.profileImageUrl,\n          },\n          local: true, // Flag to identify local auth users\n        };\n\n        return done(null, sessionUser);\n      } catch (error) {\n        return done(error);\n      }\n    }\n  ));\n}\n\n// Helper function to hash passwords\nexport async function hashPassword(password: string): Promise<string> {\n  const saltRounds = 10;\n  return await bcrypt.hash(password, saltRounds);\n}\n\n// Middleware to check if user is authenticated (works with both Replit and local auth)\nexport function isAuthenticatedLocal(req: any, res: any, next: any) {\n  if (!req.isAuthenticated()) {\n    return res.status(401).json({ message: \"Unauthorized\" });\n  }\n  \n  // For local auth users, no token refresh needed\n  if (req.user.local) {\n    return next();\n  }\n  \n  // For Replit auth users, check token expiration\n  // (This will be handled by the existing isAuthenticated middleware)\n  return next();\n}\n","size_bytes":2206},"README.md":{"content":"# Integrated Lens System (ILS)\n\nEnterprise-grade web application for managing optical lab operations, lens orders, and production workflows.\n\n## Overview\n\nThe Integrated Lens System (ILS) provides a unified platform for managing lens orders, production workflows, and quality control across three primary stakeholder groups:\n\n- **Eye Care Professionals (ECPs)**: Submit and track lens orders\n- **Lab Technicians & Engineers**: Manage production queues and quality control\n- **Suppliers**: Coordinate materials and purchase orders\n- **Administrators**: Manage users and platform settings\n\n## Features\n\n### Phase 6: OMA File Support \n- OMA file upload and parsing for prescription data\n- Frame tracing visualization\n- Integrated file viewer in order details\n\n### Phase 5: User Management \n- Multi-role user system (ECP, Lab Tech, Engineer, Supplier, Admin)\n- Account approval workflow with pending/active/suspended states\n- Comprehensive admin dashboard for user management\n- Role-based access control throughout the application\n\n### Phase 4: Settings Management \n- Organization settings configuration\n- User preferences (theme, language, notifications)\n- Role-based access to settings\n\n### Phase 3: Customer Reference & PO Enhancement \n- Customer reference tracking in orders\n- Enhanced purchase order generation with supplier details\n- PDF generation and email notifications\n\n### Phase 2: Supplier Management \n- Full CRUD operations for supplier management\n- Supplier contact information and account tracking\n- Purchase order line item management\n\n### Phase 1: Core Order Management \n- Order creation and tracking\n- Patient management\n- Lab dashboard with production workflow\n- Consult logging system\n- Technical documentation library\n\n## Tech Stack\n\n### Frontend\n- **React** with TypeScript\n- **Vite** for fast development and building\n- **TanStack Query** (React Query) for server state management\n- **Wouter** for lightweight routing\n- **shadcn/ui** with Radix UI components\n- **Tailwind CSS** for styling\n- **Lucide React** for icons\n\n### Backend\n- **Node.js** with Express\n- **TypeScript** with ES modules\n- **PostgreSQL** (Neon serverless) for database\n- **Drizzle ORM** for type-safe database queries\n- **Passport.js** for authentication\n- **Replit Auth** (OpenID Connect) integration\n\n### Key Libraries\n- **Zod** for schema validation\n- **date-fns** for date manipulation\n- **PDFKit** for PDF generation\n- **Resend** for email notifications\n\n## Getting Started\n\n### Prerequisites\n- Node.js 18+ installed\n- PostgreSQL database (or use Replit's built-in database)\n\n### Installation\n\n1. Clone the repository:\n```bash\ngit clone https://github.com/newvantageco/integrated-lens-system.git\ncd integrated-lens-system\n```\n\n2. Install dependencies:\n```bash\nnpm install\n```\n\n3. Set up environment variables:\nCreate a `.env` file with the following variables:\n```\nDATABASE_URL=your_postgresql_connection_string\nSESSION_SECRET=your_session_secret\nADMIN_SETUP_KEY=your_admin_setup_key\n```\n\n4. Run database migrations:\n```bash\nnpm run db:push\n```\n\n5. Start the development server:\n```bash\nnpm run dev\n```\n\nThe application will be available at `http://localhost:5000`\n\n## Project Structure\n\n```\n client/                 # Frontend React application\n    src/\n       components/    # Reusable UI components\n       pages/         # Page components\n       hooks/         # Custom React hooks\n       lib/           # Utilities and helpers\n server/                # Backend Express application\n    routes.ts          # API route handlers\n    storage.ts         # Database access layer\n    replitAuth.ts      # Authentication setup\n shared/                # Shared types and schemas\n    schema.ts          # Database schema and Zod schemas\n db/                    # Database migrations and config\n```\n\n## Authentication\n\nThe application uses Replit Auth (OpenID Connect) for authentication with the following roles:\n\n- `ecp` - Eye Care Professional\n- `lab_tech` - Lab Technician\n- `engineer` - Lab Engineer\n- `supplier` - Supplier/Vendor\n- `admin` - System Administrator\n\nNew users must be approved by an administrator before gaining access to the system.\n\n## Development\n\n### Running Tests\n```bash\nnpm test\n```\n\n### Database Migrations\n```bash\nnpm run db:push\n```\n\n### Building for Production\n```bash\nnpm run build\n```\n\n## License\n\nCopyright  2025. All rights reserved.\n\n## Support\n\nFor support and questions, please contact the development team.\n","size_bytes":4609},"server/github-helper.ts":{"content":"import { Octokit } from '@octokit/rest';\n\nlet connectionSettings: any;\n\nasync function getAccessToken() {\n  if (connectionSettings && connectionSettings.settings.expires_at && new Date(connectionSettings.settings.expires_at).getTime() > Date.now()) {\n    return connectionSettings.settings.access_token;\n  }\n  \n  const hostname = process.env.REPLIT_CONNECTORS_HOSTNAME;\n  const xReplitToken = process.env.REPL_IDENTITY \n    ? 'repl ' + process.env.REPL_IDENTITY \n    : process.env.WEB_REPL_RENEWAL \n    ? 'depl ' + process.env.WEB_REPL_RENEWAL \n    : null;\n\n  if (!xReplitToken) {\n    throw new Error('X_REPLIT_TOKEN not found for repl/depl');\n  }\n\n  connectionSettings = await fetch(\n    'https://' + hostname + '/api/v2/connection?include_secrets=true&connector_names=github',\n    {\n      headers: {\n        'Accept': 'application/json',\n        'X_REPLIT_TOKEN': xReplitToken\n      }\n    }\n  ).then(res => res.json()).then(data => data.items?.[0]);\n\n  const accessToken = connectionSettings?.settings?.access_token || connectionSettings.settings?.oauth?.credentials?.access_token;\n\n  if (!connectionSettings || !accessToken) {\n    throw new Error('GitHub not connected');\n  }\n  return accessToken;\n}\n\nexport async function getUncachableGitHubClient() {\n  const accessToken = await getAccessToken();\n  return new Octokit({ auth: accessToken });\n}\n\nexport async function createGitHubRepo(repoName: string, isPrivate: boolean = false, description?: string) {\n  const octokit = await getUncachableGitHubClient();\n  \n  try {\n    const response = await octokit.repos.createForAuthenticatedUser({\n      name: repoName,\n      description: description || 'Replit project',\n      private: isPrivate,\n      auto_init: false\n    });\n    \n    return response.data;\n  } catch (error: any) {\n    if (error.status === 422) {\n      throw new Error('Repository already exists with that name');\n    }\n    throw error;\n  }\n}\n\nexport async function getAuthenticatedUser() {\n  const octokit = await getUncachableGitHubClient();\n  const { data } = await octokit.users.getAuthenticated();\n  return data;\n}\n","size_bytes":2085},"client/src/pages/github-push.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { CheckCircle2, Loader2, Copy, Github } from \"lucide-react\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\n\nexport default function GitHubPushPage() {\n  const { toast } = useToast();\n  const [repoName, setRepoName] = useState(\"\");\n  const [isPrivate, setIsPrivate] = useState(false);\n  const [description, setDescription] = useState(\"Replit project\");\n  const [createdRepo, setCreatedRepo] = useState<any>(null);\n\n  const { data: githubUser, isLoading: loadingUser } = useQuery({\n    queryKey: ['/api/github/user'],\n  });\n\n  const createRepoMutation = useMutation({\n    mutationFn: async () => {\n      const response = await fetch('/api/github/create-repo', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ name: repoName, isPrivate, description })\n      });\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.message || 'Failed to create repository');\n      }\n      return await response.json();\n    },\n    onSuccess: (data: any) => {\n      setCreatedRepo(data);\n      toast({\n        title: \"Repository created!\",\n        description: `Successfully created ${data.full_name}`,\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to create repository\",\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  const copyToClipboard = (text: string) => {\n    navigator.clipboard.writeText(text);\n    toast({\n      title: \"Copied!\",\n      description: \"Command copied to clipboard\",\n    });\n  };\n\n  const handleCreateRepo = () => {\n    if (!repoName.trim()) {\n      toast({\n        title: \"Error\",\n        description: \"Please enter a repository name\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    createRepoMutation.mutate();\n  };\n\n  if (loadingUser) {\n    return (\n      <div className=\"flex items-center justify-center h-screen\">\n        <Loader2 className=\"h-8 w-8 animate-spin\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"container max-w-4xl mx-auto p-6 space-y-6\">\n      <div className=\"space-y-2\">\n        <h1 className=\"text-3xl font-bold flex items-center gap-2\">\n          <Github className=\"h-8 w-8\" />\n          Push to GitHub\n        </h1>\n        <p className=\"text-muted-foreground\">\n          Create a new GitHub repository and push your code\n        </p>\n      </div>\n\n      {githubUser ? (\n        <Card>\n          <CardHeader>\n            <CardTitle>Connected GitHub Account</CardTitle>\n            <CardDescription>\n              Logged in as <strong>{(githubUser as any).login}</strong>\n            </CardDescription>\n          </CardHeader>\n        </Card>\n      ) : null}\n\n      {!createdRepo ? (\n        <Card>\n          <CardHeader>\n            <CardTitle>Create New Repository</CardTitle>\n            <CardDescription>\n              Create a new GitHub repository for this project\n            </CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"repo-name\">Repository Name</Label>\n              <Input\n                id=\"repo-name\"\n                data-testid=\"input-repo-name\"\n                placeholder=\"my-awesome-project\"\n                value={repoName}\n                onChange={(e) => setRepoName(e.target.value)}\n              />\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"description\">Description (optional)</Label>\n              <Input\n                id=\"description\"\n                data-testid=\"input-description\"\n                placeholder=\"A brief description of your project\"\n                value={description}\n                onChange={(e) => setDescription(e.target.value)}\n              />\n            </div>\n\n            <div className=\"flex items-center space-x-2\">\n              <Checkbox\n                id=\"private\"\n                data-testid=\"checkbox-private\"\n                checked={isPrivate}\n                onCheckedChange={(checked) => setIsPrivate(checked as boolean)}\n              />\n              <Label htmlFor=\"private\" className=\"cursor-pointer\">\n                Make this repository private\n              </Label>\n            </div>\n\n            <Button\n              data-testid=\"button-create-repo\"\n              onClick={handleCreateRepo}\n              disabled={createRepoMutation.isPending}\n              className=\"w-full\"\n            >\n              {createRepoMutation.isPending ? (\n                <>\n                  <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                  Creating Repository...\n                </>\n              ) : (\n                \"Create Repository\"\n              )}\n            </Button>\n          </CardContent>\n        </Card>\n      ) : (\n        <Card>\n          <CardHeader>\n            <div className=\"flex items-center gap-2\">\n              <CheckCircle2 className=\"h-6 w-6 text-green-500\" />\n              <CardTitle>Repository Created Successfully!</CardTitle>\n            </div>\n            <CardDescription>\n              Repository URL: <a href={createdRepo.html_url} target=\"_blank\" rel=\"noopener noreferrer\" className=\"text-primary hover:underline\">{createdRepo.html_url}</a>\n            </CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-6\">\n            <div className=\"space-y-3\">\n              <h3 className=\"font-semibold\">Next Steps: Push Your Code</h3>\n              <p className=\"text-sm text-muted-foreground\">\n                Run these commands in the Replit Shell to push your code to GitHub:\n              </p>\n\n              <div className=\"space-y-3\">\n                <div className=\"space-y-2\">\n                  <div className=\"flex items-center justify-between\">\n                    <Label className=\"text-xs text-muted-foreground\">1. Initialize git repository (if not already done)</Label>\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    <code className=\"flex-1 block p-3 bg-muted rounded text-sm font-mono\">\n                      git init\n                    </code>\n                    <Button\n                      size=\"icon\"\n                      variant=\"ghost\"\n                      onClick={() => copyToClipboard(\"git init\")}\n                      data-testid=\"button-copy-init\"\n                    >\n                      <Copy className=\"h-4 w-4\" />\n                    </Button>\n                  </div>\n                </div>\n\n                <div className=\"space-y-2\">\n                  <div className=\"flex items-center justify-between\">\n                    <Label className=\"text-xs text-muted-foreground\">2. Add all files to git</Label>\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    <code className=\"flex-1 block p-3 bg-muted rounded text-sm font-mono\">\n                      git add .\n                    </code>\n                    <Button\n                      size=\"icon\"\n                      variant=\"ghost\"\n                      onClick={() => copyToClipboard(\"git add .\")}\n                      data-testid=\"button-copy-add\"\n                    >\n                      <Copy className=\"h-4 w-4\" />\n                    </Button>\n                  </div>\n                </div>\n\n                <div className=\"space-y-2\">\n                  <div className=\"flex items-center justify-between\">\n                    <Label className=\"text-xs text-muted-foreground\">3. Commit your changes</Label>\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    <code className=\"flex-1 block p-3 bg-muted rounded text-sm font-mono\">\n                      git commit -m \"Initial commit\"\n                    </code>\n                    <Button\n                      size=\"icon\"\n                      variant=\"ghost\"\n                      onClick={() => copyToClipboard('git commit -m \"Initial commit\"')}\n                      data-testid=\"button-copy-commit\"\n                    >\n                      <Copy className=\"h-4 w-4\" />\n                    </Button>\n                  </div>\n                </div>\n\n                <div className=\"space-y-2\">\n                  <div className=\"flex items-center justify-between\">\n                    <Label className=\"text-xs text-muted-foreground\">4. Set the main branch</Label>\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    <code className=\"flex-1 block p-3 bg-muted rounded text-sm font-mono\">\n                      git branch -M main\n                    </code>\n                    <Button\n                      size=\"icon\"\n                      variant=\"ghost\"\n                      onClick={() => copyToClipboard(\"git branch -M main\")}\n                      data-testid=\"button-copy-branch\"\n                    >\n                      <Copy className=\"h-4 w-4\" />\n                    </Button>\n                  </div>\n                </div>\n\n                <div className=\"space-y-2\">\n                  <div className=\"flex items-center justify-between\">\n                    <Label className=\"text-xs text-muted-foreground\">5. Add the remote repository</Label>\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    <code className=\"flex-1 block p-3 bg-muted rounded text-sm font-mono break-all\">\n                      git remote add origin {createdRepo.clone_url}\n                    </code>\n                    <Button\n                      size=\"icon\"\n                      variant=\"ghost\"\n                      onClick={() => copyToClipboard(`git remote add origin ${createdRepo.clone_url}`)}\n                      data-testid=\"button-copy-remote\"\n                    >\n                      <Copy className=\"h-4 w-4\" />\n                    </Button>\n                  </div>\n                </div>\n\n                <div className=\"space-y-2\">\n                  <div className=\"flex items-center justify-between\">\n                    <Label className=\"text-xs text-muted-foreground\">6. Push to GitHub</Label>\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    <code className=\"flex-1 block p-3 bg-muted rounded text-sm font-mono\">\n                      git push -u origin main\n                    </code>\n                    <Button\n                      size=\"icon\"\n                      variant=\"ghost\"\n                      onClick={() => copyToClipboard(\"git push -u origin main\")}\n                      data-testid=\"button-copy-push\"\n                    >\n                      <Copy className=\"h-4 w-4\" />\n                    </Button>\n                  </div>\n                </div>\n              </div>\n\n              <div className=\"mt-4 p-4 bg-muted rounded\">\n                <p className=\"text-sm\">\n                  <strong>Note:</strong> You can run these commands in the Replit Shell. Open the Shell tab and paste each command one at a time.\n                </p>\n              </div>\n            </div>\n\n            <div className=\"flex gap-2\">\n              <Button\n                data-testid=\"button-view-repo\"\n                onClick={() => window.open(createdRepo.html_url, '_blank')}\n                variant=\"default\"\n              >\n                View Repository on GitHub\n              </Button>\n              <Button\n                data-testid=\"button-create-another\"\n                onClick={() => {\n                  setCreatedRepo(null);\n                  setRepoName(\"\");\n                  setDescription(\"Replit project\");\n                  setIsPrivate(false);\n                }}\n                variant=\"outline\"\n              >\n                Create Another Repository\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n      )}\n    </div>\n  );\n}\n","size_bytes":12431},"client/src/pages/EmailLoginPage.tsx":{"content":"import { useState } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Mail, Lock, AlertCircle, ArrowLeft } from \"lucide-react\";\nimport { apiRequest } from \"@/lib/queryClient\";\n\nexport default function EmailLoginPage() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const [email, setEmail] = useState(\"\");\n  const [password, setPassword] = useState(\"\");\n  const [isLoading, setIsLoading] = useState(false);\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setIsLoading(true);\n\n    try {\n      const response = await apiRequest(\"POST\", \"/api/auth/login-email\", { email, password });\n      const data = await response.json() as { message: string; user: any };\n\n      toast({\n        title: \"Login successful\",\n        description: \"Welcome back to ILS\",\n      });\n\n      // Redirect based on account status and role\n      const user = data.user;\n      \n      if (user.accountStatus === 'pending') {\n        setLocation('/pending-approval');\n      } else if (user.accountStatus === 'suspended') {\n        setLocation('/account-suspended');\n      } else {\n        // Active user - redirect to appropriate dashboard\n        switch (user.role) {\n          case 'ecp':\n            setLocation('/ecp-dashboard');\n            break;\n          case 'lab_tech':\n          case 'engineer':\n            setLocation('/lab-dashboard');\n            break;\n          case 'supplier':\n            setLocation('/supplier-dashboard');\n            break;\n          case 'admin':\n            setLocation('/admin-dashboard');\n            break;\n          default:\n            setLocation('/');\n        }\n      }\n    } catch (error: any) {\n      toast({\n        title: \"Login failed\",\n        description: error.message || \"Invalid email or password\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center bg-gradient-to-br from-background via-background to-muted/20 p-4\">\n      <Card className=\"w-full max-w-md\">\n        <CardHeader className=\"space-y-1\">\n          <div className=\"flex items-center gap-2 mb-2\">\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={() => setLocation('/')}\n              data-testid=\"button-back-to-home\"\n              className=\"h-8\"\n            >\n              <ArrowLeft className=\"h-4 w-4 mr-1\" />\n              Back\n            </Button>\n          </div>\n          <CardTitle className=\"text-2xl font-bold\">Sign in to ILS</CardTitle>\n          <CardDescription>\n            Enter your email and password to access your account\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <form onSubmit={handleSubmit} className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"email\">Email</Label>\n              <div className=\"relative\">\n                <Mail className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n                <Input\n                  id=\"email\"\n                  type=\"email\"\n                  placeholder=\"your.email@example.com\"\n                  value={email}\n                  onChange={(e) => setEmail(e.target.value)}\n                  required\n                  className=\"pl-9\"\n                  data-testid=\"input-email\"\n                  disabled={isLoading}\n                />\n              </div>\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"password\">Password</Label>\n              <div className=\"relative\">\n                <Lock className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n                <Input\n                  id=\"password\"\n                  type=\"password\"\n                  placeholder=\"Enter your password\"\n                  value={password}\n                  onChange={(e) => setPassword(e.target.value)}\n                  required\n                  className=\"pl-9\"\n                  data-testid=\"input-password\"\n                  disabled={isLoading}\n                />\n              </div>\n            </div>\n\n            <Button\n              type=\"submit\"\n              className=\"w-full\"\n              disabled={isLoading}\n              data-testid=\"button-login\"\n            >\n              {isLoading ? \"Signing in...\" : \"Sign in\"}\n            </Button>\n\n            <div className=\"relative\">\n              <div className=\"absolute inset-0 flex items-center\">\n                <span className=\"w-full border-t\" />\n              </div>\n              <div className=\"relative flex justify-center text-xs uppercase\">\n                <span className=\"bg-card px-2 text-muted-foreground\">\n                  Don't have an account?\n                </span>\n              </div>\n            </div>\n\n            <Button\n              type=\"button\"\n              variant=\"outline\"\n              className=\"w-full\"\n              onClick={() => setLocation('/email-signup')}\n              data-testid=\"button-create-account\"\n            >\n              Create an account\n            </Button>\n          </form>\n\n          <div className=\"mt-6 p-3 bg-muted/50 rounded-md\">\n            <div className=\"flex gap-2 text-sm text-muted-foreground\">\n              <AlertCircle className=\"h-4 w-4 flex-shrink-0 mt-0.5\" />\n              <div>\n                <p className=\"font-medium text-foreground mb-1\">Alternative login options:</p>\n                <p>You can also sign in using Replit authentication from the home page.</p>\n              </div>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":5989},"client/src/pages/EmailSignupPage.tsx":{"content":"import { useState } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Mail, Lock, User, Building2, ArrowLeft, Key, AlertCircle } from \"lucide-react\";\nimport { apiRequest } from \"@/lib/queryClient\";\n\nexport default function EmailSignupPage() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const [formData, setFormData] = useState({\n    email: \"\",\n    password: \"\",\n    confirmPassword: \"\",\n    firstName: \"\",\n    lastName: \"\",\n    role: \"\",\n    organizationName: \"\",\n    adminSetupKey: \"\",\n  });\n  const [isLoading, setIsLoading] = useState(false);\n\n  const handleInputChange = (field: string, value: string) => {\n    setFormData(prev => ({ ...prev, [field]: value }));\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n\n    // Validation\n    if (formData.password !== formData.confirmPassword) {\n      toast({\n        title: \"Password mismatch\",\n        description: \"Passwords do not match\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (formData.password.length < 8) {\n      toast({\n        title: \"Password too short\",\n        description: \"Password must be at least 8 characters long\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (formData.role === 'admin' && !formData.adminSetupKey) {\n      toast({\n        title: \"Admin key required\",\n        description: \"Admin setup key is required for admin accounts\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    setIsLoading(true);\n\n    try {\n      const response = await apiRequest(\"POST\", \"/api/auth/signup-email\", {\n        email: formData.email,\n        password: formData.password,\n        firstName: formData.firstName,\n        lastName: formData.lastName,\n        role: formData.role,\n        organizationName: formData.organizationName || null,\n        adminSetupKey: formData.role === 'admin' ? formData.adminSetupKey : undefined,\n      });\n\n      const data = await response.json() as { message: string; user: any };\n\n      toast({\n        title: \"Account created\",\n        description: data.user.accountStatus === 'active' \n          ? \"Your account has been created and activated\"\n          : \"Your account is pending approval\",\n      });\n\n      // Redirect based on account status\n      if (data.user.accountStatus === 'pending') {\n        setLocation('/pending-approval');\n      } else {\n        // Active user (admin) - redirect to dashboard\n        setLocation('/admin-dashboard');\n      }\n    } catch (error: any) {\n      toast({\n        title: \"Signup failed\",\n        description: error.message || \"Failed to create account\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center bg-gradient-to-br from-background via-background to-muted/20 p-4\">\n      <Card className=\"w-full max-w-md\">\n        <CardHeader className=\"space-y-1\">\n          <div className=\"flex items-center gap-2 mb-2\">\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={() => setLocation('/')}\n              data-testid=\"button-back-to-home\"\n              className=\"h-8\"\n            >\n              <ArrowLeft className=\"h-4 w-4 mr-1\" />\n              Back\n            </Button>\n          </div>\n          <CardTitle className=\"text-2xl font-bold\">Create your ILS account</CardTitle>\n          <CardDescription>\n            Sign up with your email to get started\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <form onSubmit={handleSubmit} className=\"space-y-4\">\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"firstName\">First Name</Label>\n                <div className=\"relative\">\n                  <User className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n                  <Input\n                    id=\"firstName\"\n                    type=\"text\"\n                    placeholder=\"John\"\n                    value={formData.firstName}\n                    onChange={(e) => handleInputChange('firstName', e.target.value)}\n                    required\n                    className=\"pl-9\"\n                    data-testid=\"input-firstname\"\n                    disabled={isLoading}\n                  />\n                </div>\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"lastName\">Last Name</Label>\n                <div className=\"relative\">\n                  <User className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n                  <Input\n                    id=\"lastName\"\n                    type=\"text\"\n                    placeholder=\"Doe\"\n                    value={formData.lastName}\n                    onChange={(e) => handleInputChange('lastName', e.target.value)}\n                    required\n                    className=\"pl-9\"\n                    data-testid=\"input-lastname\"\n                    disabled={isLoading}\n                  />\n                </div>\n              </div>\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"email\">Email</Label>\n              <div className=\"relative\">\n                <Mail className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n                <Input\n                  id=\"email\"\n                  type=\"email\"\n                  placeholder=\"your.email@example.com\"\n                  value={formData.email}\n                  onChange={(e) => handleInputChange('email', e.target.value)}\n                  required\n                  className=\"pl-9\"\n                  data-testid=\"input-email\"\n                  disabled={isLoading}\n                />\n              </div>\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"password\">Password</Label>\n              <div className=\"relative\">\n                <Lock className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n                <Input\n                  id=\"password\"\n                  type=\"password\"\n                  placeholder=\"Min. 8 characters\"\n                  value={formData.password}\n                  onChange={(e) => handleInputChange('password', e.target.value)}\n                  required\n                  className=\"pl-9\"\n                  data-testid=\"input-password\"\n                  disabled={isLoading}\n                />\n              </div>\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"confirmPassword\">Confirm Password</Label>\n              <div className=\"relative\">\n                <Lock className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n                <Input\n                  id=\"confirmPassword\"\n                  type=\"password\"\n                  placeholder=\"Confirm your password\"\n                  value={formData.confirmPassword}\n                  onChange={(e) => handleInputChange('confirmPassword', e.target.value)}\n                  required\n                  className=\"pl-9\"\n                  data-testid=\"input-confirm-password\"\n                  disabled={isLoading}\n                />\n              </div>\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"role\">Role</Label>\n              <Select\n                value={formData.role}\n                onValueChange={(value) => handleInputChange('role', value)}\n                required\n                disabled={isLoading}\n              >\n                <SelectTrigger id=\"role\" data-testid=\"select-role\">\n                  <SelectValue placeholder=\"Select your role\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"ecp\">Eye Care Professional</SelectItem>\n                  <SelectItem value=\"lab_tech\">Lab Technician</SelectItem>\n                  <SelectItem value=\"engineer\">Engineer</SelectItem>\n                  <SelectItem value=\"supplier\">Supplier</SelectItem>\n                  <SelectItem value=\"admin\">Administrator</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"organizationName\">Organization Name (Optional)</Label>\n              <div className=\"relative\">\n                <Building2 className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n                <Input\n                  id=\"organizationName\"\n                  type=\"text\"\n                  placeholder=\"Your organization\"\n                  value={formData.organizationName}\n                  onChange={(e) => handleInputChange('organizationName', e.target.value)}\n                  className=\"pl-9\"\n                  data-testid=\"input-organization\"\n                  disabled={isLoading}\n                />\n              </div>\n            </div>\n\n            {formData.role === 'admin' && (\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"adminSetupKey\">Admin Setup Key</Label>\n                <div className=\"relative\">\n                  <Key className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n                  <Input\n                    id=\"adminSetupKey\"\n                    type=\"password\"\n                    placeholder=\"Enter admin setup key\"\n                    value={formData.adminSetupKey}\n                    onChange={(e) => handleInputChange('adminSetupKey', e.target.value)}\n                    required\n                    className=\"pl-9\"\n                    data-testid=\"input-admin-key\"\n                    disabled={isLoading}\n                  />\n                </div>\n                <p className=\"text-xs text-muted-foreground\">\n                  Required for administrator accounts. Contact your system administrator for the key.\n                </p>\n              </div>\n            )}\n\n            <Button\n              type=\"submit\"\n              className=\"w-full\"\n              disabled={isLoading}\n              data-testid=\"button-signup\"\n            >\n              {isLoading ? \"Creating account...\" : \"Create account\"}\n            </Button>\n\n            <div className=\"relative\">\n              <div className=\"absolute inset-0 flex items-center\">\n                <span className=\"w-full border-t\" />\n              </div>\n              <div className=\"relative flex justify-center text-xs uppercase\">\n                <span className=\"bg-card px-2 text-muted-foreground\">\n                  Already have an account?\n                </span>\n              </div>\n            </div>\n\n            <Button\n              type=\"button\"\n              variant=\"outline\"\n              className=\"w-full\"\n              onClick={() => setLocation('/email-login')}\n              data-testid=\"button-go-to-login\"\n            >\n              Sign in instead\n            </Button>\n          </form>\n\n          <div className=\"mt-6 p-3 bg-muted/50 rounded-md\">\n            <div className=\"flex gap-2 text-sm text-muted-foreground\">\n              <AlertCircle className=\"h-4 w-4 flex-shrink-0 mt-0.5\" />\n              <div>\n                <p className=\"font-medium text-foreground mb-1\">Account approval required</p>\n                <p>Non-admin accounts require approval before accessing the system. Admins are activated immediately with the correct setup key.</p>\n              </div>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":12077},"client/src/components/RoleSwitcherDropdown.tsx":{"content":"import { useState } from \"react\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { useMutation, useQuery } from \"@tanstack/react-query\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useLocation } from \"wouter\";\nimport type { User } from \"@shared/schema\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Users, Beaker, ChevronDown, Check, Package, Shield } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\n\nconst roleConfig: Record<string, { label: string; icon: any; color: string }> = {\n  ecp: {\n    label: \"Eye Care Professional\",\n    icon: Users,\n    color: \"bg-blue-500/10 text-blue-700 dark:text-blue-400\",\n  },\n  lab_tech: {\n    label: \"Lab Technician\",\n    icon: Beaker,\n    color: \"bg-emerald-500/10 text-emerald-700 dark:text-emerald-400\",\n  },\n  engineer: {\n    label: \"Principal Engineer\",\n    icon: Beaker,\n    color: \"bg-purple-500/10 text-purple-700 dark:text-purple-400\",\n  },\n  supplier: {\n    label: \"Supplier\",\n    icon: Package,\n    color: \"bg-orange-500/10 text-orange-700 dark:text-orange-400\",\n  },\n  admin: {\n    label: \"Administrator\",\n    icon: Shield,\n    color: \"bg-red-500/10 text-red-700 dark:text-red-400\",\n  },\n};\n\nexport function RoleSwitcherDropdown() {\n  const { user } = useAuth();\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n\n  // Get available roles from the user object which now includes availableRoles\n  const availableRoles = (user as any)?.availableRoles || [];\n\n  const switchRoleMutation = useMutation({\n    mutationFn: async (role: string) => {\n      const res = await apiRequest(\"POST\", \"/api/auth/switch-role\", { role });\n      return await res.json() as User;\n    },\n    onSuccess: (data: User) => {\n      // Redirect to appropriate dashboard with full page reload to refresh session\n      const role = data.role;\n      if (!role) return;\n      \n      let path = \"/\";\n      if (role === \"ecp\") path = \"/ecp/dashboard\";\n      else if (role === \"lab_tech\" || role === \"engineer\") path = \"/lab/dashboard\";\n      else if (role === \"supplier\") path = \"/supplier/dashboard\";\n      else if (role === \"admin\") path = \"/admin/dashboard\";\n      \n      toast({\n        title: \"Role switched\",\n        description: `You are now viewing as ${roleConfig[role]?.label || role}`,\n      });\n      \n      // Full page reload to refresh session and avoid stale auth state\n      setTimeout(() => {\n        window.location.href = path;\n      }, 500);\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Failed to switch role\",\n        description: error.message || \"Please try again\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  if (!user || !availableRoles || availableRoles.length <= 1) {\n    return null; // Don't show if user has only one role\n  }\n\n  const currentRole = user.role || 'ecp';\n  const config = roleConfig[currentRole];\n  const CurrentIcon = config?.icon || Users;\n\n  return (\n    <DropdownMenu>\n      <DropdownMenuTrigger asChild>\n        <Button \n          variant=\"outline\" \n          size=\"sm\" \n          className=\"gap-2\"\n          data-testid=\"button-role-switcher\"\n        >\n          <CurrentIcon className=\"h-4 w-4\" />\n          <span className=\"hidden sm:inline\">\n            {config?.label || currentRole}\n          </span>\n          <ChevronDown className=\"h-3 w-3 opacity-50\" />\n        </Button>\n      </DropdownMenuTrigger>\n      <DropdownMenuContent align=\"end\" className=\"w-56\">\n        <DropdownMenuLabel>Switch Role</DropdownMenuLabel>\n        <DropdownMenuSeparator />\n        {availableRoles.map((role: string) => {\n          const roleConf = roleConfig[role];\n          if (!roleConf) return null;\n          \n          const RoleIcon = roleConf.icon;\n          const isActive = role === user.role;\n\n          return (\n            <DropdownMenuItem\n              key={role}\n              onClick={() => !isActive && switchRoleMutation.mutate(role)}\n              disabled={isActive || switchRoleMutation.isPending}\n              className=\"gap-2 cursor-pointer\"\n              data-testid={`menu-item-switch-${role}`}\n            >\n              <RoleIcon className=\"h-4 w-4\" />\n              <span className=\"flex-1\">{roleConf.label}</span>\n              {isActive && <Check className=\"h-4 w-4 text-primary\" />}\n            </DropdownMenuItem>\n          );\n        })}\n      </DropdownMenuContent>\n    </DropdownMenu>\n  );\n}\n","size_bytes":4629}},"version":2}