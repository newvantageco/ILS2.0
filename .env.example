# ILS 2.0 - Environment Variables Configuration
# Copy this file to `.env` and fill in values for your environment
# ⚠️ NEVER commit the actual .env file with secrets to version control!

# ================================
# CORE APPLICATION
# ================================

# Database - PostgreSQL (Neon recommended)
# Example: postgresql://user:pass@host:5432/dbname?sslmode=require
DATABASE_URL=

# Server Configuration
NODE_ENV=development
PORT=5000
HOST=0.0.0.0
APP_URL=http://localhost:5000

# ================================
# SECURITY & AUTHENTICATION
# ================================

# Session Secret (REQUIRED in production)
# Generate with: openssl rand -hex 32
SESSION_SECRET=

# CSRF Protection (optional, defaults to SESSION_SECRET)
# Generate with: openssl rand -hex 32
CSRF_SECRET=

# CSRF toggle (optional, default: enabled)
CSRF_ENABLED=true

# Database Field Encryption (REQUIRED for NHS number encryption)
# Generate with: openssl rand -base64 32
# ⚠️ CRITICAL: Store securely - loss of key = loss of encrypted data
DB_ENCRYPTION_KEY=
DB_ENCRYPTION_KEY_VERSION=v1

# CORS Configuration (REQUIRED in production)
# Set to your frontend domain
CORS_ORIGIN=http://localhost:3000

# Admin Setup Key (optional - for initial admin setup)
ADMIN_SETUP_KEY=

# JWT Authentication Configuration (optional - token-based auth)
# Generate secret with: openssl rand -hex 32
JWT_SECRET=
JWT_EXPIRES_IN=7d
JWT_REFRESH_EXPIRES_IN=30d
# Feature flags for gradual JWT rollout
JWT_AUTH_ENABLED=true
JWT_AUTH_REQUIRED=false

# OAuth / OIDC Configuration (optional)
AUTH_PROVIDER=local
AUTH_CLIENT_ID=
AUTH_CLIENT_SECRET=
AUTH_ISSUER=
AUTH_JWKS_URL=
AUTH_AUDIENCE=
FORCE_NEW_AUTH=false
LEGACY_AUTH_ENABLED=true

# Google OAuth Configuration (Sign in with Google)
# Get credentials from: https://console.cloud.google.com/apis/credentials
GOOGLE_CLIENT_ID=
GOOGLE_CLIENT_SECRET=

# ================================
# BOOTSTRAP MASTER USER (OPTIONAL)
# ================================
# Auto-creates platform admin on FIRST RUN ONLY
# Password must be minimum 12 characters
#
# ⚠️  SECURITY WARNING:
# - These credentials bootstrap an admin account ONCE on first-time setup
# - REMOVE these environment variables immediately after first deployment
# - Leaving them set is a SECURITY RISK if credentials are leaked
# - The system only creates the user if no admin users exist
# - Prominent warnings will be logged on every startup if variables remain set
#
# For Railway deployment:
# 1. Set these variables before first deploy
# 2. After successful deploy, remove them from Railway dashboard
# 3. Verify removal by checking logs for security warnings

MASTER_USER_EMAIL=
MASTER_USER_PASSWORD=
MASTER_USER_FIRST_NAME=
MASTER_USER_LAST_NAME=
MASTER_USER_ORGANIZATION=

# ================================
# REDIS (OPTIONAL)
# ================================
# Used for: Sessions, BullMQ job queue, caching
# Falls back to in-memory if not configured

# Option 1: Connection URL (Railway provides this)
REDIS_URL=

# Option 2: Connection details
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB=0

# ================================
# WORKERS & BACKGROUND JOBS
# ================================

WORKERS_ENABLED=true

# ================================
# EMAIL CONFIGURATION
# ================================

# Resend (recommended)
RESEND_API_KEY=
MAIL_FROM=hello@yourdomain.com

# SMTP (alternative to Resend)
EMAIL_HOST=
EMAIL_PORT=587
EMAIL_USER=
EMAIL_PASSWORD=
EMAIL_SECURE=true

# Ethereal (for testing)
ETHEREAL_USER=
ETHEREAL_PASS=

# Alternative SMTP configuration
SMTP_HOST=
SMTP_PASSWORD=
SMTP_FROM_EMAIL=
SMTP_FROM_NAME=

# ================================
# SMS & WHATSAPP (TWILIO)
# ================================
# Get credentials from: https://console.twilio.com
# WhatsApp setup: https://www.twilio.com/docs/whatsapp/quickstart

TWILIO_ACCOUNT_SID=
TWILIO_AUTH_TOKEN=
# Your Twilio WhatsApp-enabled phone number (e.g., +14155238886)
TWILIO_WHATSAPP_NUMBER=

# ================================
# PAYMENT PROCESSING (STRIPE)
# ================================
# Get credentials from: https://dashboard.stripe.com/apikeys
# Webhook secret: https://dashboard.stripe.com/webhooks

STRIPE_SECRET_KEY=
STRIPE_PUBLISHABLE_KEY=
STRIPE_WEBHOOK_SECRET=

# Stripe Terminal (for in-person card payments)
# Create location at: https://dashboard.stripe.com/terminal/locations
STRIPE_TERMINAL_LOCATION_ID=

# Stripe Product Price IDs (create products in Stripe Dashboard)
# Format: price_xxxxxxxxxxxxx
# Create 3 products: Starter, Professional, Enterprise
# Each product needs both monthly and yearly price

# Starter Plan (Free or Basic Tier)
STRIPE_PRICE_STARTER_MONTHLY=
STRIPE_PRICE_STARTER_YEARLY=

# Professional Plan
STRIPE_PRICE_PRO_MONTHLY=
STRIPE_PRICE_PRO_YEARLY=

# Enterprise Plan
STRIPE_PRICE_ENTERPRISE_MONTHLY=
STRIPE_PRICE_ENTERPRISE_YEARLY=

# ================================
# AI & ML SERVICES
# ================================

# OpenAI API Key
OPENAI_API_KEY=

# Anthropic API Key
ANTHROPIC_API_KEY=

# Python Analytics Service
PYTHON_SERVICE_URL=http://localhost:8000

# AI Service (Multi-tenant RAG)
AI_SERVICE_URL=http://localhost:8080

# Python RAG Service (Feature 2 - Vector similarity search)
RAG_SERVICE_URL=http://localhost:8001

# Local LLM Model Path (optional)
MODEL_PATH=~/.cache/llama-models/Meta-Llama-3.1-8B-Instruct-Q4_K_M.gguf

# ================================
# FILE STORAGE
# ================================

# Storage Provider: local | s3 | cloudflare-r2 | azure-blob
STORAGE_PROVIDER=local

# AWS S3 Configuration (if using S3)
AWS_REGION=us-east-1
AWS_ACCESS_KEY_ID=
AWS_SECRET_ACCESS_KEY=
AWS_S3_BUCKET=ils-files

# Optional: MinIO for local S3-compatible storage
# S3_ENDPOINT=http://localhost:9000

# CDN Base URL (optional)
CDN_BASE_URL=

# ================================
# INTEGRATIONS
# ================================

# LIMS (Laboratory Information Management System)
LIMS_API_BASE_URL=
LIMS_API_KEY=
LIMS_WEBHOOK_SECRET=

# Analytics Webhook
ANALYTICS_WEBHOOK_URL=

# ================================
# NHS DIGITAL API (UK HEALTHCARE)
# ================================
# Required for UK NHS integration (PDS, Claims, Vouchers)
# Register at: https://onboarding.prod.api.platform.nhs.uk
# Documentation: https://digital.nhs.uk/developer

# NHS API Platform Credentials
# Get from NHS API Platform after registration
NHS_API_KEY=
# RSA Private Key (PEM format) - use \n for newlines
# Generate: openssl genrsa -out nhs-private.key 4096
NHS_PRIVATE_KEY=
# Key ID for JWT header (matches key registered with NHS)
NHS_KEY_ID=ils-key-1

# NHS API Environment: sandbox | integration | production
# Start with sandbox for development
NHS_API_ENVIRONMENT=sandbox

# PCSE API (Primary Care Support England) - for GOS Claims
# Only needed if not using NHS API Platform for claims
PCSE_API_URL=https://api.pcse.nhs.uk/v1
PCSE_API_KEY=

# Organisation Details (for NHS onboarding)
# ODS_CODE - Organisation Data Service code
# Get from: https://www.odsdatasearchandexport.nhs.uk
ODS_CODE=

# ================================
# MONITORING & OBSERVABILITY
# ================================

# Logging Level: debug | info | warn | error
LOG_LEVEL=info

# OpenTelemetry / Prometheus
OTEL_ENABLED=false
OTEL_PROMETHEUS_PORT=9090

# Metrics
METRICS_ENABLED=true

# Sentry Error Tracking
SENTRY_DSN=

# PostHog Product Analytics
POSTHOG_API_KEY=

# ================================
# COMPANY / BRANDING
# ================================

COMPANY_NAME=ILS 2.0
BASE_URL=http://localhost:5000
PORTAL_URL=http://localhost:3000

# ================================
# DATABASE CONNECTION POOLING
# ================================

DB_POOL_MAX=20
DB_POOL_MIN=5
DB_REPLICA_POOL_MAX=10
DB_REPLICA_POOL_MIN=2

# Read Replicas (comma-separated URLs)
DATABASE_READ_REPLICAS=

# ================================
# REPLIT SPECIFIC (AUTO-PROVIDED)
# ================================
# These are auto-provided by Replit, do not set manually

# REPLIT_DOMAINS=
# ISSUER_URL=
# REPL_ID=
# REPLIT_DEPLOYMENT=
# REPL_IDENTITY=
# WEB_REPL_RENEWAL=
# REPLIT_CONNECTORS_HOSTNAME=

# ================================
# RAILWAY DEPLOYMENT (AUTO-PROVIDED)
# ================================
# When deploying to Railway, these are auto-provided:
# - DATABASE_URL (from Railway Postgres)
# - REDIS_URL (from Railway Redis)
# - PORT (Railway auto-assigns)
#
# Set these manually in Railway Variables:
# - APP_URL=https://app.yourdomain.com
# - SESSION_SECRET (generate with: openssl rand -hex 32)
# - JWT_SECRET (generate with: openssl rand -hex 32) - REQUIRED
# - DB_ENCRYPTION_KEY (generate with: openssl rand -base64 32) - REQUIRED for NHS
# - CORS_ORIGIN=https://yourdomain.com
# - STRIPE_SECRET_KEY (use live keys: sk_live_xxx)
# - STRIPE_PUBLISHABLE_KEY (use live keys: pk_live_xxx)
# - STRIPE_TERMINAL_LOCATION_ID (from Stripe Dashboard)
# - RESEND_API_KEY
# - MAIL_FROM

# ================================
# MULTI-TENANT CONFIGURATION (OPTIONAL)
# ================================
# For tenant-specific database URLs and settings
# Example format: TENANT_{tenant_id}_{resource}={value}

# Example:
# TENANT_demo_clinic_001_SALES_DB=postgresql://localhost/demo_clinic_001_sales
# TENANT_demo_clinic_001_INVENTORY_DB=postgresql://localhost/demo_clinic_001_inventory
# TENANT_demo_clinic_001_PATIENT_DB=postgresql://localhost/demo_clinic_001_patients_anon
# TENANT_demo_clinic_001_RATE_LIMIT=60
# TENANT_demo_clinic_001_SUBSCRIPTION_TIER=professional

# ================================
# DEVELOPMENT / DEBUG
# ================================

# Additional environment-specific variables can be added below
