================================================================================
ILS 2.0 - PROJECT OVERVIEW (PART 1 - INTRODUCTION & TECH STACK)
================================================================================

PROJECT NAME: Integrated Lens System 2.0 (ILS 2.0)
DESCRIPTION: Healthcare Operating System for Optical Excellence
VERSION: 2.0
STATUS: Production Ready (98.5% Health Score)
LICENSE: Proprietary & Confidential
OWNER: New Vantage Co

================================================================================
WHAT IS ILS 2.0?
================================================================================

ILS 2.0 is the first Healthcare Operating System purpose-built for the optical 
industry. Think Salesforce + Epic + Shopify for eyecare—all in one platform.

NOT JUST A PRACTICE MANAGEMENT SYSTEM - It unifies your entire operation:

• Clinical Operations → Digital examinations, prescriptions, patient records
• Laboratory Production → Order tracking, quality control, equipment management
• E-Commerce → Shopify integration, POS, frame recommendations
• Healthcare Compliance → NHS integration, GDPR, audit trails
• Business Intelligence → Real-time analytics, forecasting, custom reports
• AI-Powered → Clinical assistant, automated workflows, predictive insights

BUILT FOR:
• Independent Practices - Run your entire practice from your phone
• Optical Laboratories - Production intelligence that prevents bottlenecks
• Healthcare Enterprises - Complete RCM, population health, quality management
• Optical Retailers - Integrated e-commerce with clinical workflows

================================================================================
KEY FEATURES - PRODUCTION-READY
================================================================================

ORDER MANAGEMENT & PRODUCTION WORKFLOW
✓ Comprehensive order lifecycle (draft → submitted → in-production → completed)
✓ Real-time production queue with drag-and-drop job prioritization
✓ Multi-stage quality control checkpoints with automated validation
✓ Patient record management with prescription tracking
✓ OMA file upload and parsing for digital frame tracing
✓ Consult logging system with technical documentation library

AI & ANALYTICS PLATFORM
✓ AI Intelligence Dashboard: Real-time insights, predictive analytics, anomaly detection
✓ Business Intelligence (BI): Custom report builder, KPI tracking, trend analysis
✓ Machine Learning Models: Quality prediction, demand forecasting, process optimization
✓ Natural Language Processing: AI-powered search and recommendations
✓ Autonomous AI Agents: Automated decision-making for routine tasks
✓ Python Real Data Integration: All Python services use live database
✓ Multi-tenant RAG Queries: Secure, isolated database queries

STORAGE & ARCHIVAL SYSTEM
✓ Soft Deletes: Archive records instead of permanent deletion
✓ Historical Snapshots: Point-in-time data capture for time-travel queries
✓ Report Archives: Store expensive reports for instant retrieval
✓ Comprehensive Audit Trail: Complete history of all CRUD operations
✓ Data Export Tracking: GDPR/HIPAA compliant export logging
✓ Retention Policies: Configurable data retention rules (7yr for financial)
✓ Full Recovery: Restore any deleted record
✓ Compliance Ready: HIPAA, GDPR, SOC 2, ISO 27001 compliant

SUPPLIER & PURCHASE ORDER MANAGEMENT
✓ Full CRUD operations for supplier/vendor management
✓ Automated purchase order generation with PDF export
✓ Inventory tracking and material requisition workflows
✓ Supplier performance analytics and vendor scorecards

USER & ACCESS MANAGEMENT
✓ Multi-role RBAC system (ECP, Lab Tech, Engineer, Supplier, Admin, AI Admin)
✓ Account approval workflow (pending/active/suspended states)
✓ Team and organization management with hierarchy support
✓ Audit logging for compliance and security tracking
✓ Master user provisioning for operational control

PAYMENTS & SUBSCRIPTIONS
✓ Stripe integration for payment processing
✓ Tiered subscription plans (Free, Pro, Premium, Enterprise)
✓ Feature-based access control tied to subscription levels
✓ Usage tracking and billing automation

BACKGROUND JOBS & EVENT-DRIVEN ARCHITECTURE
✓ BullMQ + Redis for reliable job queuing (email, PDF, notifications, AI tasks)
✓ Event bus with pub/sub pattern for domain events
✓ Graceful degradation when Redis unavailable
✓ Cron-based scheduled jobs

REAL-TIME FEATURES
✓ WebSocket server for live updates and notifications
✓ Broadcast system for multi-user collaboration
✓ Real-time job status tracking on production dashboard

DEVELOPER EXPERIENCE
✓ TypeScript monorepo with strict type safety
✓ Comprehensive test suite (Jest, Vitest, Playwright)
✓ 98.5% codebase health score with zero critical issues
✓ Hot module reloading for rapid development
✓ Automated database migrations with Drizzle ORM

================================================================================
TECHNOLOGY STACK
================================================================================

FRONTEND (client/)
-------------------
Technology          | Purpose                                    | Version
--------------------|--------------------------------------------|---------
React               | Modern UI framework with hooks             | 18.3
TypeScript          | Strict type safety for JavaScript          | 5.6
Vite                | Lightning-fast dev server & builds         | 7.2
TanStack Query      | Server state management & caching          | 5.60
Wouter              | Lightweight routing                        | 3.3
shadcn/ui           | Accessible, unstyled component primitives  | Latest
Radix UI            | Headless UI components                     | Latest
Tailwind CSS        | Utility-first styling with dark mode       | 3.4
Lucide React        | Beautiful, consistent icon library         | 0.453
React Hook Form     | Type-safe form management                  | 7.55
Zod                 | Runtime type validation                    | 3.24
Recharts            | Data visualization for dashboards          | 2.15

BACKEND (server/)
------------------
Technology          | Purpose                                    | Version
--------------------|--------------------------------------------|---------
Node.js             | JavaScript runtime                         | 20+
Express             | Web framework for REST APIs                | 4.21
TypeScript (ESM)    | Type-safe with ES modules                  | 5.6
Neon Postgres       | Serverless PostgreSQL with pooling         | Latest
Drizzle ORM         | Type-safe query builder                    | 0.44
Drizzle-Zod         | Auto-generate Zod schemas from tables      | 0.7
Passport            | Authentication middleware                  | 0.7
BullMQ              | Job queue for background processing        | 5.63
Redis               | In-memory cache & job storage              | 5.8
Socket.io           | WebSocket for real-time features           | 4.x
Helmet              | Security headers middleware                | 8.1
CORS                | Cross-origin resource sharing              | 2.8
Rate Limit          | DDoS protection and rate limiting          | 8.2
Pino                | Fast JSON logger                           | 10.1
Prometheus          | Metrics collection                         | 14.1

PYTHON SERVICES (python-service/ & ai-service/)
-------------------------------------------------
Technology          | Purpose                                    | Version
--------------------|--------------------------------------------|---------
FastAPI             | High-performance async API framework       | Latest
TensorFlow.js       | Machine learning in Python                 | 4.22
PyTorch             | Deep learning framework                    | Latest
Pandas              | Data analysis and numerical computing      | Latest
NumPy               | Numerical computing                        | Latest
scikit-learn        | Classical ML algorithms                    | Latest
Anthropic Claude    | LLM for AI features                        | Latest
OpenAI GPT-4        | Advanced language model                    | Latest

TESTING FRAMEWORKS
-------------------
Technology          | Purpose                                    | Version
--------------------|--------------------------------------------|---------
Jest                | Unit and integration testing               | 29.7
Vitest              | Fast component testing                     | 4.0
Playwright          | End-to-end browser testing                 | 1.56
React Testing Lib   | Component testing utilities                | 16.3
Supertest           | HTTP assertion library                     | 7.1
JSDOM               | Simulated browser environment               | 27.0

INFRASTRUCTURE & DEVOPS
------------------------
Technology          | Purpose                                    | Version
--------------------|--------------------------------------------|---------
npm Workspaces      | Monorepo management                        | 9+
ESBuild             | Fast production bundling                   | 0.25
tsx/ts-node         | TypeScript execution in dev mode           | 4.20+
Drizzle Kit         | ORM migrations and schema management       | 0.31
Docker              | Container orchestration                    | Latest
Docker Compose      | Local development environment               | Latest
Node-cron           | Scheduled background tasks                 | 4.2
GitHub Actions      | CI/CD pipeline                             | Built-in

DEPLOYMENT PLATFORMS (Supported)
-----------------------------------
• Railway (Recommended) - Modern full-stack deployment
• Render - Docker-based deployment
• AWS ECS - Amazon container service
• Google Cloud Run - Serverless containers
• AWS Lambda - Serverless functions
• Heroku - PaaS platform

DATABASE & STORAGE
-------------------
PostgreSQL 15+ with:
• Neon Serverless (Production - recommended)
• Railway PostgreSQL
• AWS RDS
• Supabase
• Self-hosted PostgreSQL

Optional Components:
• Redis 7+ (Background jobs - graceful fallback if unavailable)
• AWS S3 / MinIO (File storage)

================================================================================
PROJECT STRUCTURE OVERVIEW
================================================================================

ROOT DIRECTORY
---------------
├── client/                    # React frontend (Vite + TypeScript)
├── server/                    # Express backend (TypeScript ESM)
├── shared/                    # Shared types & schemas
├── python-service/            # FastAPI analytics service
├── ai-service/                # ML & AI models
├── scripts/                   # Utility scripts
├── test/                      # Test suites
├── docs/                      # Documentation
├── package.json               # Monorepo root
├── tsconfig.json              # TypeScript configuration
├── vite.config.ts             # Vite build config
├── jest.config.mjs            # Jest test config
├── drizzle.config.ts          # ORM configuration
├── .env.example               # Environment template
└── README.md                  # Main documentation

FRONTEND (client/)
------------------
└── src/
    ├── components/            # React components
    │   ├── ui/                # shadcn/ui primitives
    │   ├── landing/           # Marketing/landing page
    │   ├── dashboard/         # Dashboard-specific
    │   └── ...                # Feature-specific components
    ├── pages/                 # Route-level pages
    │   ├── Dashboard.tsx
    │   ├── Orders.tsx
    │   ├── AIIntelligence.tsx
    │   └── ...
    ├── hooks/                 # Custom React hooks
    │   ├── useAuth.ts
    │   ├── useOrders.ts
    │   └── ...
    ├── lib/                   # Utilities, API clients
    │   ├── api.ts
    │   ├── utils.ts
    │   └── ...
    └── App.tsx                # Root component with routing

BACKEND (server/)
------------------
├── index.ts                   # Entry point (middleware, cron, WebSocket)
├── routes.ts                  # Main route registry (5,800+ lines)
├── storage.ts                 # Data access layer (6,200+ lines)
├── db.ts                      # Database connection
├── routes/                    # Modular route handlers
│   ├── aiIntelligence.ts      # AI features
│   ├── bi.ts                  # Business intelligence
│   ├── payments.ts            # Stripe integration
│   ├── metrics.ts             # Prometheus metrics
│   └── ...
├── middleware/                # Express middleware
│   ├── auth.ts                # Authentication & RBAC
│   ├── security.ts            # Security headers
│   ├── errorHandler.ts        # Error handling
│   ├── audit.ts               # Audit logging
│   └── ...
├── workers/                   # BullMQ background workers
│   ├── emailWorker.ts
│   ├── pdfWorker.ts
│   ├── notificationWorker.ts
│   └── aiWorker.ts
├── events/                    # Event-driven architecture
│   ├── EventBus.ts            # Pub/sub event bus
│   └── handlers/              # Event listeners
├── services/                  # Business logic
│   ├── EmailService.ts
│   ├── PDFService.ts
│   └── ...
├── queue/                     # BullMQ configuration
│   └── config.ts
├── jobs/                      # Cron-scheduled tasks
│   ├── dailyBriefing.ts
│   └── inventoryMonitoring.ts
└── websocket/                 # WebSocket server
    └── WebSocketBroadcaster.ts

SHARED TYPES & SCHEMAS (shared/)
----------------------------------
└── schema.ts                  # Drizzle tables + Zod validators
                               # 110+ tables, 8,400+ lines
                               # SINGLE SOURCE OF TRUTH

PYTHON SERVICES
-----------------
python-service/               # FastAPI analytics service
├── main.py
├── requirements.txt
└── start-service.sh

ai-service/                   # Machine learning & AI
├── models/
├── api/
├── rag/                       # Retrieval Augmented Generation
├── training/
└── requirements.txt

TESTING (test/)
------------------
├── integration/               # API integration tests (Jest)
├── unit/                      # Unit tests (Jest)
├── components/                # Component tests (Vitest)
└── e2e/                       # End-to-end tests (Playwright)

DOCUMENTATION (docs/)
-----------------------
├── architecture.md
├── database.md
├── development.md
├── deployment.md
├── compliance.md
├── clinical-features.md
├── analytics.md
└── ...

================================================================================
DATABASE SCHEMA OVERVIEW
================================================================================

The database schema is defined in shared/schema.ts using Drizzle ORM.

KEY TABLES (90+ tables total, 8,400+ lines)
-------------------------------------------

CORE ENTITIES:
• companies              - Multi-tenant root
• users                  - Authentication & authorization
• roles                  - Role definitions
• permissions            - Permission definitions

CLINICAL DATA:
• patients               - Patient records
• examinations           - Eye examinations
• prescriptions          - Prescription data
• clinical_notes         - Clinical documentation

ORDER MANAGEMENT:
• orders                 - Order lifecycle management
• order_line_items       - Individual items in order
• order_status_timeline  - Order history
• purchase_orders        - PO to suppliers

INVENTORY:
• inventory              - Stock management
• stock_movements        - Inventory transactions
• reorder_points         - Stock level alerts

PRODUCTS:
• lenses                 - Lens products
• frames                 - Frame products
• coatings               - Lens coatings
• materials              - Lens materials

SUPPLIER & PAYMENTS:
• suppliers              - Supplier information
• supplier_contacts      - Supplier contacts
• payments               - Payment records
• invoices               - Invoice records

AI & ANALYTICS:
• ai_conversations       - AI chat history
• ai_models              - Model configurations
• analytics_events       - Tracked events
• predictions            - ML predictions

AUDIT & COMPLIANCE:
• audit_logs             - Change tracking
• data_exports           - GDPR export logs
• soft_deleted_records   - Archived data
• audit_trail            - Full history

KEY RELATIONSHIPS:
users (many) ──→ companies (one)
patients (many) ──→ companies (one)
examinations (many) ──→ patients (one)
prescriptions (many) ──→ examinations (one)
orders (many) ──→ patients (one)
orders (many) ──→ companies (one)
order_line_items (many) ──→ orders (one)

MULTI-TENANCY ENFORCEMENT:
• Every table includes companyId
• All queries automatically filtered by companyId
• Row-level security enforced at application layer

================================================================================
ENVIRONMENT VARIABLES CHECKLIST
================================================================================

DATABASE
---------
DATABASE_URL=postgresql://user:password@hostname/database
  ↳ Neon (recommended), Railway, AWS RDS, or Supabase

SESSION & SECURITY
-------------------
SESSION_SECRET=your_secure_random_string_here
  ↳ Use: openssl rand -hex 32 (256-bit)
ADMIN_SETUP_KEY=your_admin_key_for_first_user

MASTER USER (Optional - auto-provisioned admin account)
---------------------------------------------------------
MASTER_USER_EMAIL=admin@example.com
MASTER_USER_PASSWORD=secure_password_min_12_chars
MASTER_USER_FIRST_NAME=Admin
MASTER_USER_LAST_NAME=User
MASTER_USER_ORGANIZATION=Platform Control

REDIS (Optional - background jobs)
------------------------------------
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=

EMAIL SERVICE (Resend)
-----------------------
RESEND_API_KEY=re_xxxxxxxxxxxx

PAYMENT PROCESSING (Stripe)
-----------------------------
STRIPE_SECRET_KEY=sk_test_xxxxxxxxxxxx
STRIPE_PUBLISHABLE_KEY=pk_test_xxxxxxxxxxxx
STRIPE_WEBHOOK_SECRET=whsec_xxxxxxxxxxxx

AI SERVICES (Optional)
-----------------------
OPENAI_API_KEY=sk-xxxxxxxxxxxx
ANTHROPIC_API_KEY=sk-ant-xxxxxxxxxxxx

NODE ENVIRONMENT
----------------
NODE_ENV=production|development|test

================================================================================
END OF PART 1
================================================================================
Next: See PROJECT_OVERVIEW_PART2.txt for Architecture, Security, and Deployment
================================================================================
