# ===================================
# Job Queue Configuration
# ===================================

# Redis Connection (required for job queues)
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=

# Queue Configuration
ENABLE_JOB_QUEUES=true

# ===================================
# Queue Types & Use Cases
# ===================================

# 1. Email Queue
#    - Welcome emails
#    - Password resets
#    - Order confirmations
#    - Report delivery
#    Concurrency: 10 workers

# 2. Report Queue
#    - Sales reports (PDF/Excel)
#    - Inventory reports
#    - Financial statements
#    - Patient records
#    Concurrency: 2 workers (resource-intensive)

# 3. AI Processing Queue
#    - Frame recommendations
#    - Lens optimizations
#    - Vision analysis
#    - Prescription verification
#    Concurrency: 3 workers (GPU/CPU intensive)

# 4. Export Queue
#    - Customer data exports
#    - Product catalogs
#    - Full database backups
#    - Order history downloads
#    Concurrency: 5 workers

# 5. Notification Queue
#    - Push notifications
#    - SMS messages
#    - In-app notifications
#    - Webhook callbacks
#    Concurrency: 20 workers (high throughput)

# 6. Cleanup Queue
#    - Temp file deletion
#    - Cache expiration
#    - Session cleanup
#    - Old report removal
#    Concurrency: 1 worker (background maintenance)

# ===================================
# Performance Recommendations
# ===================================

# Development (< 10 companies):
# REDIS_HOST=localhost
# ENABLE_JOB_QUEUES=true
# - Local Redis is fine
# - Single server handles all queues

# Staging (10-100 companies):
# REDIS_HOST=redis.staging.yourdomain.com
# ENABLE_JOB_QUEUES=true
# - Managed Redis (AWS ElastiCache, Redis Cloud)
# - Monitor queue depths

# Production (100-1,000 companies):
# REDIS_HOST=redis.prod.yourdomain.com
# ENABLE_JOB_QUEUES=true
# - Redis Cluster or Sentinel
# - Dedicated Redis instance
# - Monitor memory usage
# - Set up alerting

# Production (1,000-10,000 companies):
# REDIS_HOST=redis-cluster.prod.yourdomain.com
# ENABLE_JOB_QUEUES=true
# - Redis Cluster (3+ nodes)
# - Separate Redis per queue type
# - Horizontal scaling
# - Advanced monitoring

# Production (10,000+ companies):
# Multiple Redis clusters:
# REDIS_EMAIL_HOST=redis-email.prod.yourdomain.com
# REDIS_REPORT_HOST=redis-reports.prod.yourdomain.com
# REDIS_AI_HOST=redis-ai.prod.yourdomain.com
# - Separate Redis cluster per queue type
# - Geographic distribution
# - Advanced partitioning

# ===================================
# Bull Board Dashboard (Optional)
# ===================================

# Visual monitoring dashboard for job queues
# Install with: npm install @bull-board/express @bull-board/api @bull-board/ui

# Access dashboard at: http://localhost:5000/admin/queues
# Features:
# - Real-time queue monitoring
# - Job details and logs
# - Retry failed jobs
# - Pause/resume queues
# - Clean old jobs

# ===================================
# Job Retry Configuration
# ===================================

# Default retry settings (configured in QueueService.ts):
# - Attempts: 3
# - Backoff: Exponential (2s, 4s, 8s)
# - Remove completed jobs after: 24 hours
# - Remove failed jobs after: 7 days

# To customize per job type, modify QueueService.ts

# ===================================
# Scheduled Jobs (Cron)
# ===================================

# Examples of recurring jobs:
# - Daily reports: '0 9 * * *' (9 AM daily)
# - Hourly cleanup: '0 * * * *' (Every hour)
# - Weekly backups: '0 2 * * 0' (2 AM Sundays)
# - Monthly invoices: '0 0 1 * *' (1st of month)

# ===================================
# Cost Estimates (Monthly)
# ===================================

# Redis Hosting Options:

# 1. Local Redis (Development):
# Cost: $0
# Memory: Limited by server RAM
# Suitable for: Dev/testing only

# 2. AWS ElastiCache (cache.t3.micro):
# Cost: ~$12/month
# Memory: 0.5 GB
# Suitable for: Small staging (< 100 companies)

# 3. AWS ElastiCache (cache.t3.medium):
# Cost: ~$48/month
# Memory: 3.09 GB
# Suitable for: Production (100-1,000 companies)

# 4. Redis Cloud (8 GB):
# Cost: ~$56/month
# Memory: 8 GB
# Suitable for: Production (1,000-10,000 companies)

# 5. AWS ElastiCache Cluster (3x cache.r6g.large):
# Cost: ~$400/month
# Memory: 40 GB (13.07 GB Ã— 3)
# Suitable for: Large production (10,000+ companies)

# Recommendation: Redis Cloud for simplicity and cost-effectiveness

# ===================================
# Migration from Synchronous to Async
# ===================================

# Step 1: Install dependencies
# npm install bullmq

# Step 2: Start Redis (local or remote)
# docker run -d -p 6379:6379 redis:alpine

# Step 3: Enable job queues in .env
# REDIS_HOST=localhost
# ENABLE_JOB_QUEUES=true

# Step 4: Convert synchronous operations to jobs
# Before:
#   await sendEmail(to, subject, body);
# 
# After:
#   await sendEmailJob(companyId, to, subject, template, data);
#   // Returns job ID, email sent asynchronously

# Step 5: Monitor with Bull Board
# npm install @bull-board/express @bull-board/api @bull-board/ui
# Access: http://localhost:5000/admin/queues

# Step 6: Set up alerting
# Monitor failed jobs, queue depths, processing times
