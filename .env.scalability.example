# ===========================================
# INTEGRATED LENS SYSTEM - SCALABILITY CONFIG
# Environment Variables for Production Scale
# ===========================================

# ===========================================
# DATABASE CONFIGURATION
# ===========================================

# Primary database for writes and critical reads
DATABASE_URL=postgresql://user:password@primary-host:5432/ils_production

# Read replicas for distributing read-heavy workloads (comma-separated)
# Optional: Leave empty to use only primary database
DATABASE_READ_REPLICAS=postgresql://user:password@replica1-host:5432/ils_production,postgresql://user:password@replica2-host:5432/ils_production

# Primary database connection pool
DB_POOL_MAX=20                    # Maximum connections (recommended: 20-50)
DB_POOL_MIN=5                     # Minimum connections (recommended: 5-10)

# Read replica connection pool (can be larger as replicas handle more load)
DB_REPLICA_POOL_MAX=30            # Maximum connections per replica (recommended: 30-50)
DB_REPLICA_POOL_MIN=10            # Minimum connections per replica (recommended: 10-20)

# ===========================================
# REDIS CACHE CONFIGURATION
# ===========================================

# Redis connection URL
# Optional: If not set, system will use in-memory fallback cache
# For production with 1000+ companies, Redis is HIGHLY RECOMMENDED
REDIS_URL=redis://redis-host:6379

# Alternative: Redis with authentication
# REDIS_URL=redis://:password@redis-host:6379

# Alternative: Redis Cluster
# REDIS_URL=redis://redis-cluster:6379

# ===========================================
# APPLICATION CONFIGURATION
# ===========================================

# Application name (used in database connection tracking)
APP_NAME=IntegratedLensSystem

# Node environment
NODE_ENV=production

# Server port
PORT=3000

# Session secret (generate a strong random string)
SESSION_SECRET=your-super-secret-session-key-change-this-in-production

# ===========================================
# RATE LIMITING (OPTIONAL OVERRIDES)
# ===========================================

# These are optional - defaults are set in code based on subscription tier
# Uncomment to override defaults

# RATE_LIMIT_WINDOW_MS=900000      # 15 minutes (default)
# RATE_LIMIT_FREE_MAX=500          # Free tier max requests
# RATE_LIMIT_BASIC_MAX=2000        # Basic tier max requests
# RATE_LIMIT_PRO_MAX=5000          # Professional tier max requests
# RATE_LIMIT_ENTERPRISE_MAX=20000  # Enterprise tier max requests

# ===========================================
# MONITORING & METRICS
# ===========================================

# Metrics collection interval (milliseconds)
METRICS_FLUSH_INTERVAL=60000      # 1 minute (default)

# Metrics buffer size per company
METRICS_BUFFER_SIZE=1000          # Number of requests to keep in memory

# Enable detailed performance logging
ENABLE_PERFORMANCE_LOGGING=true

# ===========================================
# STORAGE & FILE UPLOADS
# ===========================================

# Upload directory (local filesystem)
UPLOAD_DIR=./uploads

# Maximum file size (in bytes)
MAX_FILE_SIZE=10485760            # 10MB

# Alternative: Use S3 for production
# AWS_S3_BUCKET=ils-uploads
# AWS_REGION=us-east-1
# AWS_ACCESS_KEY_ID=your-access-key
# AWS_SECRET_ACCESS_KEY=your-secret-key

# ===========================================
# EXTERNAL SERVICES (OPTIONAL)
# ===========================================

# Stripe (for payments)
# STRIPE_SECRET_KEY=sk_live_...
# STRIPE_WEBHOOK_SECRET=whsec_...

# SendGrid (for emails)
# SENDGRID_API_KEY=SG...

# OpenAI (for AI features)
# OPENAI_API_KEY=sk-...

# ===========================================
# LOGGING & DEBUGGING
# ===========================================

# Log level (error, warn, info, debug)
LOG_LEVEL=info

# Enable SQL query logging (disable in production for performance)
ENABLE_SQL_LOGGING=false

# Enable cache statistics logging
ENABLE_CACHE_STATS=true

# ===========================================
# HEALTH CHECKS & MONITORING ENDPOINTS
# ===========================================

# These endpoints are automatically available:
# GET /api/health/database - Database health check
# GET /api/health/cache - Cache health check
# GET /api/admin/metrics/summary - Overall metrics
# GET /api/admin/metrics/company/:companyId - Company-specific metrics

# ===========================================
# SCALING RECOMMENDATIONS
# ===========================================

# 100-1,000 companies:
# - DB_POOL_MAX=20
# - No read replicas needed
# - In-memory cache acceptable
# - Single app server

# 1,000-5,000 companies:
# - DB_POOL_MAX=30
# - 1-2 read replicas recommended
# - Redis cache REQUIRED
# - 2-3 app servers (load balanced)

# 5,000-10,000 companies:
# - DB_POOL_MAX=40
# - 2-3 read replicas recommended
# - Redis cluster (3 nodes)
# - 3-5 app servers (load balanced)

# 10,000+ companies:
# - DB_POOL_MAX=50
# - 3+ read replicas
# - Redis cluster (6+ nodes)
# - 5+ app servers (auto-scaling)
# - CDN for static assets
# - Dedicated monitoring infrastructure

# ===========================================
# NOTES
# ===========================================

# 1. Always use strong passwords and secrets in production
# 2. Enable SSL/TLS for all database and Redis connections
# 3. Use managed services (RDS, ElastiCache) for better reliability
# 4. Set up monitoring and alerting for all critical metrics
# 5. Regular backups and disaster recovery plan
# 6. Review and optimize based on actual usage patterns
