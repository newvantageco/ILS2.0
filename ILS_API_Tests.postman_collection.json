{
  "info": {
    "name": "ILS API Testing Collection",
    "description": "Comprehensive API testing collection for Integrated Lens System",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:5000/api",
      "type": "string"
    },
    {
      "key": "wsUrl",
      "value": "ws://localhost:5000/ws",
      "type": "string"
    },
    {
      "key": "authToken",
      "value": "",
      "type": "string"
    },
    {
      "key": "userId",
      "value": "",
      "type": "string"
    },
    {
      "key": "organizationId",
      "value": "",
      "type": "string"
    },
    {
      "key": "orderId",
      "value": "",
      "type": "string"
    }
  ],
  "item": [
    {
      "name": "Health Check",
      "item": [
        {
          "name": "Server Health",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/health",
              "host": ["{{baseUrl}}"],
              "path": ["health"]
            }
          },
          "response": []
        }
      ]
    },
    {
      "name": "Authentication",
      "item": [
        {
          "name": "Get Current User",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/auth/user",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "user"]
            }
          },
          "response": []
        },
        {
          "name": "Bootstrap (Get User + Redirect)",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/auth/bootstrap",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "bootstrap"]
            }
          },
          "response": []
        },
        {
          "name": "Complete Signup - ECP",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"role\": \"ecp\",\n  \"organizationName\": \"Test Eye Care Clinic\",\n  \"subscriptionPlan\": \"free_ecp\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/complete-signup",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "complete-signup"]
            }
          },
          "response": []
        },
        {
          "name": "Complete Signup - Lab Tech",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"role\": \"lab_tech\",\n  \"organizationName\": \"Precision Lens Lab\",\n  \"subscriptionPlan\": \"full\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/complete-signup",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "complete-signup"]
            }
          },
          "response": []
        },
        {
          "name": "Complete Signup - Admin",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"role\": \"admin\",\n  \"adminSetupKey\": \"your-admin-key-here\",\n  \"subscriptionPlan\": \"full\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/complete-signup",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "complete-signup"]
            }
          },
          "response": []
        },
        {
          "name": "Logout",
          "request": {
            "method": "POST",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/logout",
              "host": ["{{baseUrl}}"],
              "path": ["logout"]
            }
          },
          "response": []
        }
      ]
    },
    {
      "name": "Orders",
      "item": [
        {
          "name": "Get All Orders",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/orders",
              "host": ["{{baseUrl}}"],
              "path": ["orders"]
            }
          },
          "response": []
        },
        {
          "name": "Get Orders - Filtered by Status",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/orders?status=pending",
              "host": ["{{baseUrl}}"],
              "path": ["orders"],
              "query": [
                {
                  "key": "status",
                  "value": "pending"
                }
              ]
            }
          },
          "response": []
        },
        {
          "name": "Get Orders - With Pagination",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/orders?limit=10&offset=0",
              "host": ["{{baseUrl}}"],
              "path": ["orders"],
              "query": [
                {
                  "key": "limit",
                  "value": "10"
                },
                {
                  "key": "offset",
                  "value": "0"
                }
              ]
            }
          },
          "response": []
        },
        {
          "name": "Create Order",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"customerName\": \"John Doe\",\n  \"patientName\": \"Jane Doe\",\n  \"lensType\": \"single_vision\",\n  \"rightSphere\": -2.50,\n  \"rightCylinder\": -0.75,\n  \"rightAxis\": 180,\n  \"leftSphere\": -2.75,\n  \"leftCylinder\": -0.50,\n  \"leftAxis\": 175,\n  \"rightAdd\": 0,\n  \"leftAdd\": 0,\n  \"pd\": 63,\n  \"coating\": [\"anti_reflective\", \"scratch_resistant\"],\n  \"frameType\": \"full_rim\",\n  \"materialType\": \"polycarbonate\",\n  \"notes\": \"Rush order for patient\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/orders",
              "host": ["{{baseUrl}}"],
              "path": ["orders"]
            }
          },
          "response": []
        },
        {
          "name": "Get Order by ID",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/orders/{{orderId}}",
              "host": ["{{baseUrl}}"],
              "path": ["orders", "{{orderId}}"]
            }
          },
          "response": []
        },
        {
          "name": "Update Order Status",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"status\": \"in_production\",\n  \"notes\": \"Started production process\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/orders/{{orderId}}/status",
              "host": ["{{baseUrl}}"],
              "path": ["orders", "{{orderId}}", "status"]
            }
          },
          "response": []
        },
        {
          "name": "Ship Order",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"trackingNumber\": \"1Z999AA10123456784\",\n  \"carrier\": \"UPS\",\n  \"estimatedDelivery\": \"2025-11-01\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/orders/{{orderId}}/ship",
              "host": ["{{baseUrl}}"],
              "path": ["orders", "{{orderId}}", "ship"]
            }
          },
          "response": []
        }
      ]
    },
    {
      "name": "Users (Admin)",
      "item": [
        {
          "name": "Get All Users",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/users",
              "host": ["{{baseUrl}}"],
              "path": ["users"]
            }
          },
          "response": []
        },
        {
          "name": "Get Pending Users",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/users?accountStatus=pending",
              "host": ["{{baseUrl}}"],
              "path": ["users"],
              "query": [
                {
                  "key": "accountStatus",
                  "value": "pending"
                }
              ]
            }
          },
          "response": []
        },
        {
          "name": "Create User",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"newuser@test.com\",\n  \"role\": \"lab_tech\",\n  \"organizationId\": \"{{organizationId}}\",\n  \"name\": \"New Lab Technician\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/users",
              "host": ["{{baseUrl}}"],
              "path": ["users"]
            }
          },
          "response": []
        },
        {
          "name": "Approve User",
          "request": {
            "method": "PUT",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/users/{{userId}}/approve",
              "host": ["{{baseUrl}}"],
              "path": ["users", "{{userId}}", "approve"]
            }
          },
          "response": []
        },
        {
          "name": "Suspend User",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"reason\": \"Violation of terms of service\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/users/{{userId}}/suspend",
              "host": ["{{baseUrl}}"],
              "path": ["users", "{{userId}}", "suspend"]
            }
          },
          "response": []
        },
        {
          "name": "Delete User",
          "request": {
            "method": "DELETE",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/users/{{userId}}",
              "host": ["{{baseUrl}}"],
              "path": ["users", "{{userId}}"]
            }
          },
          "response": []
        }
      ]
    },
    {
      "name": "Patients (ECP)",
      "item": [
        {
          "name": "Get All Patients",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/patients",
              "host": ["{{baseUrl}}"],
              "path": ["patients"]
            }
          },
          "response": []
        },
        {
          "name": "Create Patient",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"firstName\": \"John\",\n  \"lastName\": \"Doe\",\n  \"dateOfBirth\": \"1985-05-15\",\n  \"email\": \"john.doe@email.com\",\n  \"phone\": \"+1-555-0123\",\n  \"address\": \"123 Main St\",\n  \"city\": \"New York\",\n  \"state\": \"NY\",\n  \"zipCode\": \"10001\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/patients",
              "host": ["{{baseUrl}}"],
              "path": ["patients"]
            }
          },
          "response": []
        }
      ]
    },
    {
      "name": "Prescriptions (ECP)",
      "item": [
        {
          "name": "Get All Prescriptions",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/prescriptions",
              "host": ["{{baseUrl}}"],
              "path": ["prescriptions"]
            }
          },
          "response": []
        },
        {
          "name": "Create Prescription",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"patientId\": \"patient_123\",\n  \"prescriberId\": \"{{userId}}\",\n  \"rightSphere\": -2.50,\n  \"rightCylinder\": -0.75,\n  \"rightAxis\": 180,\n  \"leftSphere\": -2.75,\n  \"leftCylinder\": -0.50,\n  \"leftAxis\": 175,\n  \"rightAdd\": 0,\n  \"leftAdd\": 0,\n  \"pd\": 63,\n  \"expiresAt\": \"2026-10-28\",\n  \"notes\": \"Patient needs anti-reflective coating\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/prescriptions",
              "host": ["{{baseUrl}}"],
              "path": ["prescriptions"]
            }
          },
          "response": []
        }
      ]
    },
    {
      "name": "File Uploads",
      "item": [
        {
          "name": "Upload OMA File",
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "formdata",
              "formdata": [
                {
                  "key": "file",
                  "type": "file",
                  "src": "/path/to/test.oma"
                },
                {
                  "key": "orderId",
                  "value": "{{orderId}}",
                  "type": "text"
                }
              ]
            },
            "url": {
              "raw": "{{baseUrl}}/upload/oma",
              "host": ["{{baseUrl}}"],
              "path": ["upload", "oma"]
            }
          },
          "response": []
        },
        {
          "name": "Upload Frame Trace",
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "formdata",
              "formdata": [
                {
                  "key": "file",
                  "type": "file",
                  "src": "/path/to/frame-trace.png"
                },
                {
                  "key": "orderId",
                  "value": "{{orderId}}",
                  "type": "text"
                }
              ]
            },
            "url": {
              "raw": "{{baseUrl}}/upload/frame-trace",
              "host": ["{{baseUrl}}"],
              "path": ["upload", "frame-trace"]
            }
          },
          "response": []
        }
      ]
    },
    {
      "name": "PDF Generation",
      "item": [
        {
          "name": "Generate Purchase Order PDF",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"purchaseOrderId\": \"po_123\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/pdf/purchase-order",
              "host": ["{{baseUrl}}"],
              "path": ["pdf", "purchase-order"]
            }
          },
          "response": []
        },
        {
          "name": "Generate Prescription PDF",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"prescriptionId\": \"rx_123\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/pdf/prescription",
              "host": ["{{baseUrl}}"],
              "path": ["pdf", "prescription"]
            }
          },
          "response": []
        }
      ]
    },
    {
      "name": "Notifications",
      "item": [
        {
          "name": "Get User Notifications",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/notifications",
              "host": ["{{baseUrl}}"],
              "path": ["notifications"]
            }
          },
          "response": []
        },
        {
          "name": "Mark Notification as Read",
          "request": {
            "method": "PUT",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/notifications/notification_123/read",
              "host": ["{{baseUrl}}"],
              "path": ["notifications", "notification_123", "read"]
            }
          },
          "response": []
        }
      ]
    },
    {
      "name": "AI Engine",
      "item": [
        {
          "name": "Get Demand Forecast",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/ai/demand-forecast?days=30",
              "host": ["{{baseUrl}}"],
              "path": ["ai", "demand-forecast"],
              "query": [
                {
                  "key": "days",
                  "value": "30"
                }
              ]
            }
          },
          "response": []
        },
        {
          "name": "Get Anomaly Alerts",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/ai/anomalies",
              "host": ["{{baseUrl}}"],
              "path": ["ai", "anomalies"]
            }
          },
          "response": []
        },
        {
          "name": "Get Bottleneck Detection",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/ai/bottlenecks",
              "host": ["{{baseUrl}}"],
              "path": ["ai", "bottlenecks"]
            }
          },
          "response": []
        },
        {
          "name": "Train AI Model",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"modelType\": \"demand_forecasting\",\n  \"trainingData\": {\n    \"startDate\": \"2025-01-01\",\n    \"endDate\": \"2025-10-28\"\n  }\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/ai/train",
              "host": ["{{baseUrl}}"],
              "path": ["ai", "train"]
            }
          },
          "response": []
        }
      ]
    },
    {
      "name": "Metrics Dashboard",
      "item": [
        {
          "name": "Get Real-time Metrics",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/metrics/realtime",
              "host": ["{{baseUrl}}"],
              "path": ["metrics", "realtime"]
            }
          },
          "response": []
        },
        {
          "name": "Get Historical Metrics",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/metrics/historical?startDate=2025-10-01&endDate=2025-10-28",
              "host": ["{{baseUrl}}"],
              "path": ["metrics", "historical"],
              "query": [
                {
                  "key": "startDate",
                  "value": "2025-10-01"
                },
                {
                  "key": "endDate",
                  "value": "2025-10-28"
                }
              ]
            }
          },
          "response": []
        }
      ]
    },
    {
      "name": "RBAC Tests",
      "description": "Test role-based access control",
      "item": [
        {
          "name": "ECP - Access Admin Route (Should Fail)",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/users",
              "host": ["{{baseUrl}}"],
              "path": ["users"]
            }
          },
          "response": []
        },
        {
          "name": "Lab Tech - Update Order Status (Should Pass)",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"status\": \"in_production\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/orders/{{orderId}}/status",
              "host": ["{{baseUrl}}"],
              "path": ["orders", "{{orderId}}", "status"]
            }
          },
          "response": []
        },
        {
          "name": "Supplier - Create Order (Should Fail)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"customerName\": \"Test\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/orders",
              "host": ["{{baseUrl}}"],
              "path": ["orders"]
            }
          },
          "response": []
        }
      ]
    },
    {
      "name": "Error Handling Tests",
      "description": "Test various error scenarios",
      "item": [
        {
          "name": "Invalid Order Data",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"customerName\": \"\",\n  \"invalidField\": \"test\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/orders",
              "host": ["{{baseUrl}}"],
              "path": ["orders"]
            }
          },
          "response": []
        },
        {
          "name": "Non-existent Order",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/orders/nonexistent_id",
              "host": ["{{baseUrl}}"],
              "path": ["orders", "nonexistent_id"]
            }
          },
          "response": []
        },
        {
          "name": "SQL Injection Attempt",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/orders?status=pending'; DROP TABLE orders;--",
              "host": ["{{baseUrl}}"],
              "path": ["orders"],
              "query": [
                {
                  "key": "status",
                  "value": "pending'; DROP TABLE orders;--"
                }
              ]
            }
          },
          "response": []
        }
      ]
    }
  ]
}
