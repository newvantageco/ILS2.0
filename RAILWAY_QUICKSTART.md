# ILS 2.0 - Railway Quick Start Guide

Get ILS 2.0 running on Railway in minutes!

## üöÄ Quick Deployment (5 Steps)

### Step 1: Prerequisites

```bash
# Install Railway CLI
npm i -g @railway/cli

# Login to Railway
railway login
```

### Step 2: Initial Setup

```bash
# Run automated setup script
npm run railway:setup
```

This will:
- Create or link Railway project
- Add PostgreSQL database
- Add Redis (optional)
- Guide you through pgvector setup

### Step 3: Set Environment Variables

```bash
# Set basic environment variables
npm run railway:env
```

Then manually set in Railway dashboard:
- Email credentials (Resend or SMTP)
- Stripe API keys
- Storage provider credentials

### Step 4: Deploy All Services

```bash
# Deploy everything at once
npm run railway:deploy:all
```

Or deploy individually:
```bash
npm run railway:deploy        # Main app only
npm run railway:deploy:ai     # AI service only
npm run railway:deploy:analytics  # Analytics service only
npm run railway:deploy:rag    # RAG service only
```

### Step 5: Verify Deployment

```bash
# Check status
npm run railway:check

# View logs
npm run railway:logs

# Open in browser
npm run railway:open
```

---

## üì¶ Services Deployed

After running the quick start, you'll have:

| Service | Description | Port | Public |
|---------|-------------|------|--------|
| **Main App** | Node.js + React frontend | 5000 | ‚úÖ Yes |
| **PostgreSQL** | Database with pgvector | 5432 | ‚ùå No |
| **Redis** | Cache & job queues | 6379 | ‚ùå No |
| **AI Service** | FastAPI ML service | 8080 | ‚ùå No |
| **Analytics** | FastAPI analytics | 8000 | ‚ùå No |
| **RAG Service** | Vector search | 8001 | ‚ùå No |

---

## üîë Required Environment Variables

### Minimal Setup (Required)

These MUST be set for the app to work:

```env
# Auto-set by Railway plugins
DATABASE_URL=${{Postgres.DATABASE_URL}}
REDIS_URL=${{Redis.REDIS_URL}}

# Security (auto-generated by npm run railway:env)
SESSION_SECRET=<auto-generated>
CSRF_SECRET=<auto-generated>
JWT_SECRET=<auto-generated>

# App Configuration (auto-set)
NODE_ENV=production
PORT=5000
APP_URL=https://your-app.railway.app
CORS_ORIGIN=https://your-app.railway.app

# Email Service (YOU MUST SET)
RESEND_API_KEY=<your-key>
EMAIL_FROM=noreply@yourdomain.com

# Payment Processing (YOU MUST SET)
STRIPE_SECRET_KEY=sk_live_...
STRIPE_PUBLISHABLE_KEY=pk_live_...
STRIPE_WEBHOOK_SECRET=whsec_...

# Storage Provider (YOU MUST SET)
STORAGE_PROVIDER=s3
AWS_ACCESS_KEY_ID=<your-key>
AWS_SECRET_ACCESS_KEY=<your-secret>
AWS_S3_BUCKET=ils-production
AWS_REGION=us-east-1
```

### Optional but Recommended

```env
# AI Services (for AI features)
OPENAI_API_KEY=sk-...
ANTHROPIC_API_KEY=sk-ant-...

# Monitoring
SENTRY_DSN=https://...@sentry.io/...
POSTHOG_API_KEY=phc_...

# OAuth
GOOGLE_CLIENT_ID=...apps.googleusercontent.com
GOOGLE_CLIENT_SECRET=...
```

See `railway.env.template` for complete list.

---

## ‚úÖ Post-Deployment Checklist

### 1. Enable pgvector Extension

```bash
railway run psql $DATABASE_URL

# In psql:
CREATE EXTENSION IF NOT EXISTS vector;
\q
```

### 2. Configure Stripe Webhooks

1. Get your Railway URL: `npm run railway:domain`
2. Go to Stripe Dashboard ‚Üí Webhooks
3. Add endpoint: `https://your-app.railway.app/api/webhooks/stripe`
4. Select events to listen for
5. Copy webhook secret to Railway env vars

### 3. Test Health Endpoints

```bash
# Main app
curl https://your-app.railway.app/api/health

# Expected: {"status":"ok","timestamp":"...","uptime":...}
```

### 4. Create Admin User

```bash
railway run npm run create-master-user
```

### 5. Test Email Sending

Send a test email to verify email service is working.

---

## üõ†Ô∏è Common Commands

### Deployment
```bash
npm run railway:deploy              # Deploy main app
npm run railway:deploy:all          # Deploy all services
npm run railway:deploy:ai           # Deploy AI service
npm run railway:deploy:analytics    # Deploy analytics
npm run railway:deploy:rag          # Deploy RAG service
```

### Monitoring
```bash
npm run railway:status              # Check status
npm run railway:logs                # View logs
npm run railway:logs:follow         # Follow logs
npm run railway:check               # Run health checks
```

### Management
```bash
npm run railway:open                # Open dashboard
npm run railway:shell               # Open shell
npm run railway:restart             # Restart service
npm run railway:rollback            # Rollback deployment
npm run railway:variables           # List env vars
```

### Database
```bash
railway run npm run db:migrate      # Run migrations
railway run npm run db:studio       # Open Drizzle Studio
railway run psql $DATABASE_URL      # Connect to DB
```

---

## üîß Troubleshooting

### Build Fails

```bash
# Check build logs
npm run railway:logs

# Try local build first
docker build -t ils-test .

# Verify Node.js version
node --version  # Should be 22.x
```

### Database Connection Error

```bash
# Verify DATABASE_URL is set
railway variables | grep DATABASE_URL

# Test connection
railway run psql $DATABASE_URL -c "SELECT 1"
```

### Out of Memory

1. Go to Railway dashboard
2. Select service
3. Settings ‚Üí Resources
4. Increase memory allocation (recommend 2GB minimum)

### Service Won't Start

```bash
# Check logs for errors
npm run railway:logs:follow

# Verify health check endpoint
curl https://your-app.railway.app/api/health
```

### Redis Connection Issues

```bash
# Verify Redis is running
railway variables | grep REDIS

# Check Redis connection
railway run node -e "const redis = require('ioredis'); const r = new redis(process.env.REDIS_URL); r.ping().then(() => console.log('OK'))"
```

---

## üìä Resource Recommendations

### Production Workloads

| Service | Memory | CPU | Notes |
|---------|--------|-----|-------|
| Main App | 2-4GB | 2 | More if high traffic |
| AI Service | 4-8GB | 2-4 | ML workloads need RAM |
| Analytics | 2-4GB | 2 | Data processing |
| RAG Service | 4GB | 2 | Vector operations |
| PostgreSQL | 2GB+ | 2 | Depends on data size |
| Redis | 1GB | 1 | Cache size dependent |

### Development/Testing

| Service | Memory | CPU |
|---------|--------|-----|
| Main App | 1GB | 1 |
| AI Service | 2GB | 1 |
| Analytics | 1GB | 1 |
| RAG Service | 2GB | 1 |

---

## üåê Custom Domain Setup

### 1. Add Custom Domain in Railway

```bash
# Go to Railway dashboard
npm run railway:open

# Navigate to: Service ‚Üí Settings ‚Üí Domains
# Click "Add Domain" and enter your domain
```

### 2. Configure DNS

Add CNAME record:
```
Type: CNAME
Name: @ (or subdomain)
Value: <your-app>.railway.app
```

### 3. Update Environment Variables

```bash
railway variables set APP_URL=https://yourdomain.com
railway variables set CORS_ORIGIN=https://yourdomain.com
```

### 4. Update Stripe Webhook

Update webhook endpoint to use your custom domain.

---

## üìö Additional Resources

- **Full Documentation:** [RAILWAY_DEPLOYMENT.md](./RAILWAY_DEPLOYMENT.md)
- **Environment Template:** [railway.env.template](./railway.env.template)
- **Project Template:** [railway-project-template.json](./railway-project-template.json)
- **Deployment Script:** [scripts/railway-multi-service-deploy.sh](./scripts/railway-multi-service-deploy.sh)

---

## üÜò Getting Help

### Railway Support
- Status: https://status.railway.app
- Docs: https://docs.railway.app
- Discord: https://discord.gg/railway
- Forum: https://help.railway.app

### ILS 2.0 Support
- Issues: https://github.com/newvantageco/ILS2.0/issues
- Documentation: See `/docs` directory

---

## üéØ Next Steps

After successful deployment:

1. ‚úÖ Configure custom domain
2. ‚úÖ Set up monitoring (Sentry, PostHog)
3. ‚úÖ Enable backups for production
4. ‚úÖ Configure CDN for static assets
5. ‚úÖ Set up CI/CD pipeline
6. ‚úÖ Enable auto-scaling if needed
7. ‚úÖ Review security settings
8. ‚úÖ Configure log aggregation
9. ‚úÖ Set up staging environment
10. ‚úÖ Document runbooks for team

---

**Estimated Time:** 15-30 minutes for basic setup
**Difficulty:** Intermediate
**Cost:** Starts at $5/month on Railway (scales with usage)

---

Happy deploying! üöÇ
